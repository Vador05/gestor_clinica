{"version":3,"sources":["ri-backoffice-angular-libs.js"],"names":["root","factory","define","amd","module","exports","safeAccess","this","access","obj","accessStr","isUndefined","bind","funcArgs","Array","prototype","slice","call","arguments","helper","tokenize","tokens","ctx","fnArgs","length","currentToken","isNull","isTokenFunctionCall","isFunction","undefined","isArray","isTokenArrayAccess","parseInt","substr","a","token","test","str","split","filter","t","mod","CodeMirror","gecko","navigator","userAgent","ie_upto10","ie_11up","exec","ie","ie_version","document","documentMode","webkit","qtwebkit","chrome","presto","safari","vendor","khtml","mac_geMountainLion","phantom","ios","mobile","mac","platform","windows","presto_version","match","Number","flipCtrlCmd","captureRightClick","sawReadOnlySpans","sawCollapsedSpans","place","options","copyObj","defaults","setGuttersForLineNumbers","doc","value","Doc","mode","display","Display","wrapper","updateGutters","themeChanged","lineWrapping","className","autofocus","focusInput","state","keyMaps","overlays","modeGen","overwrite","focused","suppressEdits","pasteIncoming","cutIncoming","draggingText","highlight","Delayed","keySeq","setTimeout","resetInput","registerEventHandlers","ensureGlobalHandlers","startOperation","curOp","forceUpdate","attachDoc","activeElt","input","onFocus","onBlur","opt","optionHandlers","hasOwnProperty","Init","maybeUpdateLineNumberWidth","i","initHooks","endOperation","d","elt","style","width","setAttribute","border","inputDiv","scrollbarH","scrollbarV","scrollbarFiller","gutterFiller","lineDiv","selectionDiv","cursorDiv","measure","lineMeasure","lineSpace","mover","sizer","heightForcer","scrollerCutOff","gutters","lineGutter","scroller","zIndex","paddingRight","draggable","height","position","minHeight","minWidth","appendChild","viewFrom","viewTo","first","view","externalMeasured","viewOffset","lastWrapHeight","lastWrapWidth","updateLineNumbers","lineNumWidth","lineNumInnerWidth","lineNumChars","prevInput","alignWidgets","pollingFast","poll","cachedCharWidth","cachedTextHeight","cachedPaddingH","inaccurateSelection","maxLine","maxLineLength","maxLineChanged","wheelDX","wheelDY","wheelStartX","wheelStartY","shift","selForContextMenu","loadMode","cm","getMode","modeOption","resetModeState","iter","line","stateAfter","styles","frontier","startWorker","regChange","wrappingChanged","addClass","rmClass","findMaxLine","estimateLineHeights","clearCaches","updateScrollbars","estimateHeight","th","textHeight","wrapping","perLine","Math","max","clientWidth","charWidth","lineIsHidden","widgetsHeight","widgets","ceil","text","est","estHeight","updateLineHeight","replace","theme","guttersChanged","alignHorizontally","specs","removeChildren","gutterClass","gElt","updateGutterSpace","offsetWidth","marginLeft","left","fixedGutter","lineLength","len","merged","cur","collapsedSpanAtStart","found","find","from","ch","to","collapsedSpanAtEnd","getLine","indexOf","lineNumbers","concat","splice","hScrollbarTakesSpace","clientHeight","measureForScrollbars","scroll","barHeight","scrollWidth","barWidth","docHeight","round","paddingVert","sWidth","scrollbarWidth","scrollHeight","needsH","needsV","bottom","firstChild","right","coverGutterNextToScrollbar","checkedOverlayScrollbar","w","barMouseDown","e","e_target","operation","onMouseDown","on","visibleLines","viewport","top","scrollTop","floor","paddingTop","lineAtHeight","ensure","ensureFrom","ensureTo","heightAtLine","min","lastLine","comp","compensateForHScroll","scrollLeft","gutterW","hidden","gutter","align","alignable","j","last","lineNumberFor","size","innerW","padding","String","lineNumberFormatter","firstLineNumber","getBoundingClientRect","DisplayUpdate","force","visible","editorIsHidden","wrapperHeight","wrapperWidth","oldViewFrom","oldViewTo","oldScrollerWidth","dims","getDimensions","updateDisplayIfNeeded","update","resetView","countDirtyView","end","viewportMargin","visualLineNo","visualLineEndNo","different","adjustView","toUpdate","patchDisplay","offsetHeight","focus","postUpdateDisplay","updateHeightsInViewport","barMeasure","updateSelection","setDocumentHeight","signalLater","updateDisplaySimple","checkForWebkitWidthBug","prevBottom","offsetTop","bot","node","box","diff","updateWidgetHeight","rest","gutterLeft","clientLeft","n","nextSibling","offsetLeft","fixedPos","gutterTotalWidth","gutterWidth","updateNumbersFrom","container","rm","next","currentWheelTarget","parentNode","removeChild","lineN","lineView","buildLineElement","insertBefore","updateNumber","lineNumber","changes","updateLineForChanges","createTextNode","type","updateLineText","updateLineGutter","updateLineClasses","updateLineWidgets","ensureLineWrapped","replaceChild","updateLineBackground","cls","bgClass","background","wrap","getLineContent","ext","built","buildLineContent","pre","textClass","wrapClass","markers","gutterMarkers","gutterWrap","k","id","insertLineWidgets","insertLineWidgetsFor","allowAbove","ws","widget","handleMouseEvents","ignoreEvents","positionLineWidget","above","noHScroll","push","coverGutter","paddingLeft","Pos","cmp","cmpPos","b","copyPos","x","maxPos","minPos","Selection","ranges","primIndex","primary","equals","other","here","there","anchor","head","deepCopy","out","Range","somethingSelected","empty","contains","pos","range","normalizeSelection","prim","sort","prev","inv","simpleSelection","clipLine","clipPos","clipToLen","linelen","isLine","l","clipPosArray","array","extendRange","extend","posBefore","extendSelection","setSelection","sel","extendSelections","heads","newSel","replaceOneSelection","setSimpleSelection","filterSelectionChange","signal","setSelectionReplaceHistory","done","history","lst","setSelectionNoUndo","addSelectionToHistory","NaN","hasHandler","bias","setSelectionInner","skipAtomicInSelection","ensureCursorVisible","updateInput","selectionChanged","signalCursorActivity","reCheckSelection","sel_dontScroll","mayClear","newAnchor","skipAtomic","newHead","flipped","curPos","dir","cantEdit","search","markedSpans","sp","m","marker","inclusiveLeft","inclusiveRight","explicitlyCleared","atomic","newPos","drawSelection","result","curFragment","cursors","createDocumentFragment","selFragment","selection","collapsed","showCursorWhenSelecting","drawSelectionCursor","drawSelectionRange","moveInputWithCursor","headPos","cursorCoords","wrapOff","lineOff","teTop","teLeft","showSelection","drawn","removeChildrenAndAdd","output","singleCursorHeightPerLine","cursor","cursorHeight","otherCursor","fragment","paddingH","leftSide","rightSide","add","drawForLine","fromArg","toArg","lineObj","lineLen","start","coords","charCoords","iterateBidiSections","getOrder","leftPos","rightPos","tmp","sFrom","sTo","fromLine","toLine","singleVLine","visualLine","leftEnd","rightStart","restartBlink","clearInterval","blinker","visibility","cursorBlinkRate","setInterval","time","startState","set","highlightWorker","Date","workTime","copyState","getStateBefore","changedLines","oldStyles","highlighted","highlightLine","oldCls","styleClasses","newCls","classes","ischange","processLine","workDelay","runInOp","regLineChange","findStartLine","precise","minindent","minline","lim","innerMode","indented","countColumn","tabSize","save","window","getComputedStyle","currentStyle","data","isNaN","ensureLineHeights","rect","curWidth","heights","rects","getClientRects","abs","mapFromLineView","map","cache","maps","caches","lineNo","before","updateExternalMeasurement","LineView","measureChar","measureCharPrepared","prepareMeasureForLine","findViewForLine","findViewIndex","info","hasHeights","prepared","varHeight","key","measureCharInner","bogus","rtop","rbottom","nullRect","collapse","mStart","mEnd","insertLeft","nodeType","isExtendingChar","charAt","maybeUpdateRectForZooming","rSpan","rbot","mid","screen","logicalXDPI","deviceXDPI","hasBadZoomedRects","scaleX","scaleY","logicalYDPI","deviceYDPI","clearLineMeasurementCacheFor","clearLineMeasurementCache","externalMeasure","pageScrollX","pageXOffset","documentElement","body","pageScrollY","pageYOffset","intoCoordSystem","context","widgetHeight","yOff","lOff","xOff","fromCoordSystem","localBox","lineSpaceBox","preparedMeasure","get","getBidi","partPos","part","order","level","bidiLeft","bidiRight","getBidiPartAt","val","bidiOther","estimateCoords","PosWithInfo","outside","xRel","coordsChar","y","coordsCharInner","mergedPos","innerOff","wrongLine","adjust","getX","bidi","dist","lineLeft","lineRight","fromX","fromOutside","toX","toOutside","moveVisually","xDiff","step","middle","middleX","measureText","operationGroup","nextOpId","viewChanged","startHeight","typing","changeObjs","cursorActivityHandlers","cursorActivityCalled","updateMaxLine","scrollToPos","ops","ownsGroup","delayedCallbacks","fireCallbacksForOps","group","callbacks","op","endOperations","endOperation_R1","endOperation_W1","endOperation_R2","endOperation_W2","endOperation_finish","mustUpdate","updatedDisplay","adjustWidthTo","maxScrollLeft","newSelectionNodes","setScrollLeft","forceScroll","scrollPosIntoView","margin","isCursor","maybeScrollWindow","maybeHiddenMarkers","unhidden","maybeUnhiddenMarkers","lines","f","apply","methodOp","docMethodOp","visualLineContinued","buildViewArray","nextPos","lendiff","cut","viewCuttingPoint","index","cutTop","cutBot","arr","oldN","newN","dirty","slowPoll","pollInterval","readInput","fastPoll","missed","p","changed","lastCopied","hasSelection","isReadOnly","disableInput","fakedLastChar","substring","inputHasSelection","withOp","charCodeAt","same","inserted","textLines","splitLines","multiPaste","join","changeEvent","origin","makeChange","electricChars","smartIndent","getModeAt","changeEnd","indentLine","electricInput","minimal","selected","hasCopyEvent","getSelection","content","selectInput","readOnly","ensureFocus","signalDOMEvent","posFromMouse","clickInGutter","eventInWidget","e_preventDefault","word","findWordAt","onContextMenu","setScrollTop","onScrollWheel","reFocus","onKeyUp","onKeyDown","onKeyPress","drag_","e_stop","dragDrop","onDragStart","onDrop","lastMiddleDown","selectionStart","selectionEnd","prepareCopyCut","getSelections","lineRange","getRange","setSelections","blur","onResize","setSize","liberal","forRect","target","space","clientX","clientY","colDiff","shiftKey","e_button","leftButtonDown","lastClick","lastDoubleClick","now","modifier","metaKey","ctrlKey","dragAndDrop","leftButtonStartDrag","leftButtonSelect","dragEnd","e2","off","addNew","ourRange","ourIndex","startSel","altKey","sel_mouse","lastPos","extendTo","startCol","posCol","findColumn","scrollIntoView","oldRange","editorSize","counter","curCount","Infinity","move","up","lastSelOrigin","gutterEvent","prevent","signalfn","mX","mY","lineBox","e_defaultPrevented","g","childNodes","lastDrop","files","dataTransfer","FileReader","File","read","loadFile","file","reader","onload","change","readAsText","getData","listSelections","replaceRange","replaceSelection","setData","setDragImage","img","src","_top","isScroller","wheelSamples","wheelPixelsPerUnit","dx","wheelDeltaX","dy","wheelDeltaY","detail","axis","HORIZONTAL_AXIS","VERTICAL_AXIS","wheelDelta","outer","pixels","movedX","movedY","sample","doHandleBinding","bound","dropShift","commands","prevShift","Pass","lookupKeyForEditor","name","handle","lookupKey","extraKeys","keyMap","stopSeq","dispatchKey","seq","isModifierKey","handleKeyBinding","keyName","motion","handleCharBinding","lastStoppedKey","keyCode","returnValue","code","handled","showCrossHair","charCode","which","fromCharCode","contextMenuInGutter","scrollPos","reset","resetSelectionOnContextMenu","oldCSS","cssText","oldScrollY","scrollY","scrollTo","clearTimeout","detectingSelectAll","prepareSelectAllHack","extval","rehide","selectAll","mouseup","adjustForChange","computeSelAfterChange","offsetPos","old","nw","computeReplacedSel","hint","oldPrev","newPrev","filterChange","canceled","cancel","ignoreReadOnly","removeReadOnlyRanges","makeChangeInner","selAfter","addChangeToHistory","makeChangeSingleDoc","stretchSpansOverChange","rebased","linkedDocs","sharedHist","rebaseHist","makeChangeFromHistory","allowSelectionOnly","hist","event","source","undone","dest","lastOrigin","pop","pushSelectionToHistory","clearRedo","antiChanges","generation","maxGeneration","historyChangeFromChange","after","mergeOldSpans","shiftDoc","distance","spans","removed","getBetween","makeChangeSingleDocInEditor","updateDoc","recomputeMaxLength","checkWidthStart","isWholeLineUpdate","changesHandler","changeHandler","doScroll","innerHeight","scrollNode","limit","endCoords","calculateScrollPos","startTop","startLeft","x1","y1","x2","y2","snapMargin","screentop","docBottom","atTop","atBottom","newTop","screenleft","screenw","tooWide","addToScrollPos","resolveScrollToPos","getCursor","cursorScrollMargin","sPos","how","aggressive","indent","curSpace","curSpaceString","indentation","indentUnit","indentString","indentWithTabs","spaceStr","changeLine","changeType","no","deleteNearSelection","compute","kill","toKill","replaced","findPosH","unit","visually","origDir","possible","findNextLine","moveOnce","boundToLine","moveLogically","sawType","getHelper","isWordChar","hitSide","findPosV","pageSize","constructor","setOption","option","getOption","getDoc","addKeyMap","getKeyMap","removeKeyMap","addOverlay","spec","Error","modeSpec","opaque","removeOverlay","indentSelection","newRanges","getTokenAt","takeToken","getLineTokens","getTokenTypeAt","getLineStyles","getHelpers","helpers","help","helperType","_global","pred","getStateAfter","defaultTextHeight","defaultCharWidth","setGutterMarker","gutterID","isEmpty","clearGutter","addLineWidget","removeLineWidget","clear","lineInfo","getViewport","addWidget","vert","horiz","vspace","hspace","triggerOnKeyDown","triggerOnKeyPress","triggerOnKeyUp","execCommand","cmd","amount","moveH","extendSelectionsBy","rtlMoveVisually","sel_move","deleteH","goalColumn","moveV","goals","startChar","check","toggleOverwrite","hasFocus","getScrollInfo","co","interpret","refresh","oldHeight","swapDoc","getInputField","getWrapperElement","getScrollerElement","getGutterElement","eventMixin","deflt","notOnInit","toString","setValue","specialChars","RegExp","defaultSpecialCharPlaceholder","detach","attach","integer","disabled","undoDepth","tabIndex","modes","mimeModes","defineMode","dependencies","defineMIME","mime","resolveMode","createObj","mfactory","modeObj","modeExtensions","exts","prop","modeProps","stream","skipToEnd","extendMode","properties","defineExtension","func","defineDocExtension","defineOption","defineInitHook","registerHelper","registerGlobalHelper","predicate","nstate","a1","a2","firstLine","singleSelection","killLine","deleteLine","delLineLeft","delWrappedLineLeft","delWrappedLineRight","undo","redo","undoSelection","redoSelection","goDocStart","goDocEnd","goLineStart","lineStart","goLineStartSmart","lineStartSmart","goLineEnd","lineEnd","goLineRight","goLineLeft","goLineLeftSmart","goLineUp","goLineDown","goPageUp","goPageDown","goCharLeft","goCharRight","goColumnLeft","goColumnRight","goWordLeft","goGroupRight","goGroupLeft","goWordRight","delCharBefore","delCharAfter","delWordBefore","delWordAfter","delGroupBefore","delGroupAfter","indentAuto","indentMore","indentLess","insertTab","insertSoftTab","spaces","col","replaceSelections","defaultTab","transposeChars","newlineAndIndent","basic","Left","Right","Up","Down","End","Home","PageUp","PageDown","Delete","Backspace","Shift-Backspace","Tab","Shift-Tab","Enter","Insert","Esc","pcDefault","Ctrl-A","Ctrl-D","Ctrl-Z","Shift-Ctrl-Z","Ctrl-Y","Ctrl-Home","Ctrl-End","Ctrl-Up","Ctrl-Down","Ctrl-Left","Ctrl-Right","Alt-Left","Alt-Right","Ctrl-Backspace","Ctrl-Delete","Ctrl-S","Ctrl-F","Ctrl-G","Shift-Ctrl-G","Shift-Ctrl-F","Shift-Ctrl-R","Ctrl-[","Ctrl-]","Ctrl-U","Shift-Ctrl-U","Alt-U","fallthrough","emacsy","Ctrl-B","Ctrl-P","Ctrl-N","Alt-F","Alt-B","Ctrl-E","Ctrl-V","Shift-Ctrl-V","Ctrl-H","Alt-D","Alt-Backspace","Ctrl-K","Ctrl-T","macDefault","Cmd-A","Cmd-D","Cmd-Z","Shift-Cmd-Z","Cmd-Y","Cmd-Home","Cmd-Up","Cmd-End","Cmd-Down","Cmd-Left","Cmd-Right","Ctrl-Alt-Backspace","Alt-Delete","Cmd-S","Cmd-F","Cmd-G","Shift-Cmd-G","Cmd-Alt-F","Shift-Cmd-Alt-F","Cmd-[","Cmd-]","Cmd-Backspace","Cmd-Delete","Cmd-U","Shift-Cmd-U","normalizeKeyName","parts","alt","ctrl","normalizeKeyMap","keymap","copy","keyname","keys","Object","keyNames","noShift","base","altGraphKey","fromTextArea","textarea","tabindex","placeholder","getAttribute","getValue","form","leaveSubmitMethodAlone","realSubmit","submit","wrappedSubmit","getTextArea","toTextArea","StringStream","string","lastColumnPos","lastColumnValue","eol","sol","peek","eat","ok","eatWhile","eatSpace","skipTo","backUp","column","pattern","consume","caseInsensitive","cased","toLowerCase","current","hideFirstChars","inner","TextMarker","span","getMarkedSpanFor","removeMarkedSpan","visual","parent","side","dHeight","attachLine","detachLine","nextMarkerId","markText","shared","markTextShared","clearWhenEmpty","replacedWith","widgetNode","conflictingCollapsedRange","addToHistory","curLine","addMarkedSpan","MarkedSpan","clearOnEnter","clearHistory","title","startStyle","endStyle","SharedTextMarker","cloneNode","linked","isParent","findSharedMarkers","findMarks","copySharedMarkers","mFrom","mTo","subMark","detachSharedMarkers","subMarker","r","markedSpansBefore","startCh","isInsert","startsBefore","endsAfter","markedSpansAfter","endCh","oldFirst","oldLast","sameLine","offset","clearEmptySpans","newMarkers","gap","gapMarkers","getOldSpans","stretched","oldCur","stretchCur","mark","mk","newParts","dfrom","dto","detachMarkedSpans","attachMarkedSpans","extraLeft","extraRight","compareCollapsedMarkers","lenDiff","aPos","bPos","fromCmp","toCmp","collapsedSpanAtSide","sps","vis","lineIsHiddenInner","LineWidget","adjustScrollWhenAboveVisible","oldH","parentStyle","insertAt","aboveVisible","Line","updateLine","cleanUpLine","extractLineClasses","lineClass","callBlankLine","blankLine","readToken","asArray","getObj","runMode","lineClasses","forceToEnd","flattenSpans","curStart","curStyle","addModeClass","maxHighlightLength","mName","st","o","overlay","at","i_end","updateFrontier","startAt","styleToClassCache","styleToClassCacheWithMode","interpretTokenStyle","builder","addToken","buildToken","buildTokenSplitSpaces","hasBadBidiRects","buildTokenBadBidi","allowFrontierUpdate","insertLineContent","joinClasses","zeroWidthElement","lastChild","special","mustWrap","lastIndex","skipped","txt","tabWidth","specialCharPlaceholder","fullStyle","buildCollapsedSpan","ignoreWidget","allText","nextChange","spanStyle","spanEndStyle","spanStartStyle","foundBookmarks","upto","tokenText","wholeLineUpdateBefore","spansFor","lastText","lastSpans","nlines","added","remove","insert","LeafChunk","chunkSize","removeInner","insertInner","iterN","BranchChunk","children","child","sz","spilled","newleaf","maybeSpill","me","sibling","myIndex","used","nextDocId","cleanGeneration","History","lineSep","getLines","getLineHandle","getLineNumber","getLineHandleVisualStart","lineCount","setCursor","addSelection","dup","setExtending","getExtending","historySize","markClean","changeGeneration","forceSplit","lastOp","lastSelOp","isClean","gen","getHistory","copyHistoryArray","setHistory","histData","addLineClass","where","classTest","removeLineClass","setBookmark","realOpts","findMarksAt","getAllMarks","posFromIndex","indexFromPos","copyHistory","linkedDoc","unlinkDoc","link","splitIds","iterLinkedDocs","getEditor","eachLine","dontDelegate","method","sharedHistOnly","propagate","skip","rel","chunk","h","lh","bidiOrdering","startGen","lastModTime","lastSelTime","histChange","attachLocalSpans","clearSelectionEvents","lastChangeEvent","opId","historyEventDelay","selectionEventCanBeMerged","existing","removeClearedSpans","events","newGroup","instantiateSel","newChanges","rebaseHistSelSingle","rebaseHistArray","sub","copied","preventDefault","e_stopPropagation","stopPropagation","cancelBubble","defaultPrevented","srcElement","button","emitter","addEventListener","attachEvent","_handlers","removeEventListener","detachEvent","args","orphanDelayedCallbacks","list","fireOrphanDelayed","bnd","delayed","override","codemirrorIgnore","cursorActivity","ctor","ms","startIndex","startValue","nextTab","goal","spaceStrs","select","_e","props","inst","create","nonASCIISingleCaseWordChar","isWordCharBasic","toUpperCase","extendingChars","tag","createElement","createRange","setEnd","setStart","createTextRange","moveToElementText","moveEnd","moveStart","count","activeElement","as","forEachCodeMirror","getElementsByClassName","byClass","globalsRegistered","registerGlobalHandlers","resizeTimer","knownScrollbarWidth","div","zwspSupported","badBidiRects","r0","r1","nl","rt","te","ownerDocument","parentElement","compareEndPoints","oncopy","badZoomedRects","normal","fromRange","3","8","9","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","44","45","46","59","61","91","92","93","107","109","127","173","186","187","188","189","190","191","192","219","220","221","222","63232","63233","63234","63235","63272","63273","63275","63276","63277","63302","firstNonWS","inWS","compareBidiLevel","linedir","moveInLine","byUnit","lowTypes","arabicTypes","charType","bidiRE","isNeutral","isStrong","countsAsLeft","countsAsNum","outerType","BidiSpan","types","nstart","unshift","version","require","ie_lt8","matching","(",")","[","]","{","}","findMatchingBracket","strict","config","scanForBracket","forward","maxScanLen","maxScanLineLength","maxScanLines","stack","re","bracketRegex","matchBrackets","autoclear","maxHighlightLen","maxHighlightLineLength","marks","currentlyHighlighted","doMatchBrackets","doFold","finder","minSize","allowFolded","__isFold","cleared","myWidget","makeWidget","myRange","newFoldFunction","rangeFinder","toggleFold","foldCode","fold","unfold","foldAll","unfoldAll","funcs","defaultOptions","auto","minFoldSize","scanUp","editorOptions","foldOptions","foldGutter","onGutterClick","onChange","onViewportChange","onFold","updateInViewport","State","parseOptions","opts","indicatorOpen","indicatorFolded","isFolded","updateFoldInfo","vp","changeUpdate","foldOnChangeTimeSpan","updateViewportTimeSpan","lineText","tokenType","findOpening","openCh","pass","lastIndexOf","startToken","endToken","nextOpen","nextClose","hasImport","semi","has","hasInclude","jQuery","$","defaultOpts","beforeShow","noop","show","hide","color","flat","showInput","allowEmpty","showButtons","clickoutFiresChange","showInitial","showPalette","showPaletteOnly","hideAfterPaletteSelect","togglePaletteOnly","showSelectionPalette","localStorageKey","appendTo","maxSelectionSize","cancelText","chooseText","togglePaletteMoreText","togglePaletteLessText","clearText","noColorSelectedText","preferredFormat","containerClassName","replacerClassName","showAlpha","palette","selectionPalette","spectrums","IE","rgbaSupport","elem","backgroundColor","replaceInput","markup","gradientFix","paletteTemplate","html","tiny","tinycolor","c","toHsl","formattedString","swatchStyle","toRgbString","toFilter","append","attr","hideAll","instanceOptions","callbackContext","spectrum","element","resize","throttle","reflow","isDragging","dragWidth","dragHeight","dragHelperHeight","slideHeight","slideWidth","alphaWidth","alphaSlideHelperWidth","slideHelperHeight","currentHue","currentSaturation","currentValue","currentAlpha","paletteArray","paletteLookup","draggingClass","shiftMovementDirection","boundElement","pickerContainer","dragger","dragHelper","slider","slideHelper","alphaSliderInner","alphaSlider","alphaSlideHelper","textInput","paletteContainer","initialColorContainer","cancelButton","clearButton","chooseButton","toggleButton","isInput","is","isInputTypeColor","inputTypeColorSupport","shouldReplace","replacer","offsetElement","previewElement","initialColor","colorOnShow","currentPreferredFormat","applyOptions","rgb","toggleClass","initialize","updateSelectionPaletteFromStorage","toggle","disable","click","setFromTextInput","keydown","revert","updateOriginalInput","trigger","isValid","css","outerWidth","dragX","dragY","dragStart","dragStop","parseFloat","oldDragX","oldDragY","furtherFromX","setSaturation","updateUI","format","addColorToSelectionPalette","paletteElementClick","ignore","closest","paletteEvent","delegate","localStorage","oldPalette","each","inArray","getUniqueSelectionPalette","unique","reverse","drawPalette","currentColor","drawInitial","initial","removeClass","Event","isDefaultPrevented","onkeydown","clickout","unbind","ignoreFormatChange","newColor","newHsv","toHsv","s","v","getFormat","fromRatio","hasClass","updateHelperLocations","flatColor","toHexString","realColor","displayColor","realHex","realRgb","alpha","toRgb","realAlpha","gradient","gradientType","alphaX","slideY","fireCallback","hasChanged","getOffset","destroy","spect","optionName","optionValue","enable","setOffset","coord","picker","extraY","dpWidth","dpHeight","outerHeight","inputHeight","docElem","viewWidth","viewHeight","onmove","onstart","onstop","dragging","maxHeight","maxWidth","hasTouch","duringDragEvents","stop","t0","originalEvent","touches","pageX","pageY","rightclick","wait","debounce","timeout","throttler","fn","dataID","extra","removeData","load","loadOpts","_cachedResult","colorInput","localization","palettes","processNativeColorInputs","colorInputs","trimLeft","trimRight","tinyCounter","math","mathRound","mathMin","mathMax","mathRandom","random","inputToRGB","_originalInput","_r","_g","_b","_a","_roundA","_format","_gradientType","_ok","_tc_id","isDark","getBrightness","isLight","getOriginalInput","getAlpha","setAlpha","boundAlpha","hsv","rgbToHsv","toHsvString","hsl","rgbToHsl","toHslString","toHex","allow3Char","rgbToHex","toHex8","rgbaToHex","toHex8String","toPercentageRgb","bound01","toPercentageRgbString","toName","hexNames","secondColor","hex8String","secondHex8String","formatSet","hasAlpha","needsAlphaFormat","_applyModification","lighten","brighten","darken","desaturate","saturate","greyscale","spin","_applyCombination","analogous","complement","monochromatic","splitcomplement","triad","tetrad","convertToPercentage","stringInputToObject","rgbToRgb","hsvToRgb","hslToRgb","hue2rgb","q","hex","pad2","convertDecimalToHex","color1","color2","clamp01","hue","results","slices","ret","modification","mix","rgb1","rgb2","w1","w2","rgba","readability","c1","c2","brightnessA","brightnessB","colorDiff","brightness","isReadable","mostReadable","baseColor","colorList","bestColor","bestScore","bestIsReadable","readable","score","names","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","burntsienna","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","flip","isOnePointZero","processPercent","isPercentage","parseIntFromHex","convertHexToDecimal","matchers","CSS_INTEGER","CSS_NUMBER","CSS_UNIT","PERMISSIVE_MATCH3","PERMISSIVE_MATCH4","hsla","hsva","hex3","hex6","hex8","named","angular","addKey","isObject","defineProperty","enumerable","$key","$value","run","$templateCache","put","directive","$http","$routeParams","models","common","selectCache","restrict","scope","attrs","ngModel","modelName","schema","shard","displayField","idSelect","userq","$eval","query","userShard","actualShard","getField","model","dependsOn","getDocumentById","modelId","getModel","ref","getDocument","regex","$or","forDisplay","$regex","$options","forID","isValidObjectID","response","searchRes","present","some","elements","$watch","newValue","searchEnabled","printSelectedElement","selectDisplayField","selectIdField","$on","console","log","raw","$select","modalController","$scope","$modalInstance","configs","fromSchema","action","innerForm","processForm","getShard","submitForm","$broadcast","$valid","postDocument","status","close","putDocument","alert","dismiss","$inject","$rootScope","$modal","open","modalInstance","templateUrl","controller","resolve","then","schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider","select2","stdFormObj","path","lookup","stringify","object","addMapping","createDirective","titleMap","dynMap","dynmap","dynEnum","dynenum","res","resultMap","forEach","setMap","number","modelDate","$render","$viewValue","updateDate","$setViewValue","mixed","dateFormat","$timeout","onFileSelect","$files","myFiles","getModelConfig","fieldName","uploadImage","arrayIndex","defaultImage","filename","getImageUrl","url","image","imageExists","downloadImage","deleteImage","newImageInjector","pathArray","imageinjector","defaultErrorImage","delete","openGallery","ngModal","selectedImage","gallery","uploadToGallery","defaultImageForFile","galleryPath","getGalleryPath","fileExists","sampleImage","deleteFile","galleryDelete","leafletData","$window","$sce","priority","center","lat","lng","zoom","coordinates","mainMarker","dispatchEvent","geojson","uploadFile","getFileUrl","fileinjector","combine","brace","constant","uiCodemirrorConfig","compile","postLink","iElement","iAttrs","codeMirror","initialTextValue","codemirror","uiCodemirror","uiCodemirrorOpts","tagName","cm_el","codemirrorDefaultsKeys","updateOptions","newValues","oldValue","$formatters","JSON","safeViewValue","instance","$apply","parsed","parse","uiRefresh","newVal","oldVal","callback","onLoad","$emit","params","function","onClick","rows","timeMinutes","timeSeconds","newval","seconds","convertToMap","error","addStringToMap","exists","grouping","separator","lock","availableElems","enum","item","getTitle","splitted","prettifyTitle","refreshData","hasAngularVariable","deAngularizeUrl","elems","getAngularVariables","choices","multiselect","items","enumUrl","locked","limitToOptions","minValue","maxValue","iconOn","iconOff","defaultConf","plugins","toolbar1","image_advtab","forced_root_block","autoresize_min_height","autoresize_max_height","fullscreen_new_window","skin_url","fullscreen_settings","theme_advanced_path_location","paste_preprocess","pl","tinymce","$set","isDefined","getContent","isString","setContent","init","selector","setup","editor","$root","$$phase","contentAreaContainer","tinyMCE","riTinymce","PluginManager","pluginUrl","self","win","WINDOW_HEIGHT","WINDOW_BODY","WINDOW_WIDTH","skinUrl","styleSheets","styleSheetsLength","styleSheetHref","href","getEl","$$childTail","getCompleteSelected","populateField","field","openWindow","fieldId","fieldValue","parentWin","windowManager","buttons","subtype","onclick","getElementById","settings","tinyvision","taka","injector","invoke","$compile","$targetDom","_id","$digest","addCommand","file_browser_callback","pathStack","findByPath","galleryGetByPath","isEmptyDir","setSelected","getFullPath","openUploadModal","pathstack","galleryDeleteByPath","removeFile","removeDir","createDir","galleryPostByPath","video","directories","loginProvider","success","whenDropletReady","getUser","user","dropletint","allowedExtensions","setRequestHeaders","Authorization","defineHTTPSuccess","setRequestUrl","onDropletSuccess","finally","wysiwyg","tinymceOptions","punchCardTemplate","plural","singular","template","days","hours","description","flatten","JsonHuman","makePrefixer","prefix","sn","scn","linkNode","HYPERLINK_CLASS_NAME","prefixer","ARRAY","BOOL","INT","FLOAT","STRING","OBJECT","SPECIAL_OBJECT","FUNCTION","UNK","STRING_CLASS_NAME","STRING_EMPTY_CLASS_NAME","BOOL_TRUE_CLASS_NAME","BOOL_FALSE_CLASS_NAME","BOOL_IMAGE","INT_CLASS_NAME","FLOAT_CLASS_NAME","OBJECT_CLASS_NAME","OBJ_KEY_CLASS_NAME","OBJ_VAL_CLASS_NAME","OBJ_EMPTY_CLASS_NAME","FUNCTION_CLASS_NAME","ARRAY_KEY_CLASS_NAME","ARRAY_VAL_CLASS_NAME","ARRAY_CLASS_NAME","ARRAY_EMPTY_CLASS_NAME","UNKNOWN_CLASS_NAME","getType","parentKey","keyNode","valNode","childs","tr","isSpecial","accum","hyperlinksEnabled","aTarget","hyperlinkKeys","boolOpt","bool","showImage","true","false","showText","hyperlinks","showArrayIndices","showArrayIndex","validateOptions","validateArrayIndexOption","validateHyperlinkOptions","validateBoolOptions","boolOptions","messages","cleanup","emit","oldUrl","process","warning","getMessage","message","flash","processData","patchXHR","fnName","newFn","XMLHttpRequest","redefineProp","xhr","FileAPI","shouldLoad","FormData","forceLoad","initializeUploadListener","__listeners","upload","origAddEventListener","orig","__url","__origError","__fileApiXHR","getResponseHeader","getAllResponseHeaders","abort","header","Function","__requestHeaders","__isFileAPIShim","formData","jsonp","complete","err","fileApiXHR","__completed","loaded","__loaded","total","__total","lengthComputable","loadend","statusText","resp","responseText","onreadystatechange","progress","_this","noContentTimeout","headers","hasFlash","__isFileAPIBlobShim","Blob","isInputTypeFile","fo","ActiveXObject","mimeTypes","offsetParent","html5","jsUrl","basePath","script","allScripts","getElementsByTagName","jsPath","staticPath","ngfFixIE","createFileElemFn","bindAttr","changeFn","makeFlashInput","$$ngfRefElem","fileElem","evt","fileApiChangeFn","getFiles","__files_","disableFileInput","loadStarted","listeners","onabort","onerror","onloadstart","onloadend","onprogress","constructEvent","listener","readAsArrayBuffer","readAsBinaryString","readAsDataURL","setRequestHeader","ngFileUpload","service","$q","sendHttp","deferred","defer","promise","__setXHR_","__XHR","xhrFn","notify","progressFunc","reject","origXhrFn","addFieldToFormData","isDate","toISOString","sendFieldsAs","transformRequest","allFields","fields","formDataAppender","fileFormName","fileFormDataName","isFileFormNameString","fileName","http","ArrayBuffer","$parse","linkFileSelect","ngfSelect","isUpdating","fileList","rejFiles","validate","updateModel","ngfChange","bindAttrToFileInput","ngfMultiple","ngfCapture","accept","attributes","attribute","createFileInput","resetOnClick","replaceWith","resetModel","clickHandler","ngfResetOnClick","clickAndAssign","ngfResetModelOnClick","shouldClickLater","ua","globStringToRegex","ngfAccept","$file","$event","fileSizeMax","ngfMaxSize","fileSizeMin","ngfMinSize","regexp","fileChange","noDelay","ngfKeep","prevFiles","$modelValue","ngfKeepDistinct","assign","ngModelRejected","$rejectedFiles","$location","linkDrop","dropAvailable","ngfDropAvailable","available","ngfHideOnDropNotAvailable","ngfDrop","leaveTimeout","ngfStopPropagation","dragOverDelay","actualDragOverClass","effectAllowed","dropEffect","calculateDragOverClass","extractFiles","ngfAllowDir","multiple","accepted","kind","clazz","ngfDragOverClass","delay","allowDir","processing","addFile","traverseFileTree","entry","isDirectory","filePath","dirReader","createReader","entries","readEntries","protocol","webkitGetAsEntry","getAsFile","delays","waitForProcess","ngfSrc","URL","webkitURL","createObjectURL","fileReader","ngfDefaultSrc"],"mappings":"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","file":"ri-backoffice-angular-libs.min.temp.js","sourcesContent":["(function (root, factory) {\n  if(typeof define === \"function\" && define.amd) {\n    define(factory);\n  } else if(typeof module === \"object\" && module.exports) {\n    module.exports = factory();\n  } else {\n    root.safeAccess = factory();\n  }\n}(this, function() {\n\n  return function access(obj, accessStr) {\n    // auto-curry here\n    if (isUndefined(accessStr)) {\n      return access.bind(null, obj);\n    }\n\n    var funcArgs = Array.prototype.slice.call(arguments, 2);\n    return helper(obj, tokenize(accessStr), null, funcArgs);\n  };\n\n  function helper(obj, tokens, ctx, fnArgs) {\n    if (tokens.length === 0) {\n      return obj;\n    }\n\n    var currentToken = tokens[0];\n\n    if (isUndefined(obj) || isNull(obj) ||\n        (isTokenFunctionCall(currentToken) && !isFunction(obj))) {\n      return undefined;\n    }\n\n    if (isTokenFunctionCall(currentToken)) {\n\n      return helper(obj[isArray(fnArgs[0]) ? 'apply' : 'call'](ctx, fnArgs[0]),\n          tokens.slice(1),\n          // clear context because consecutive fn calls execute in global context\n          // e.g. `a.b()()`\n          null,\n          fnArgs.slice(1));\n\n    } else if (isTokenArrayAccess(currentToken)) {\n\n      return helper(obj[parseInt(currentToken.substr(1), 10)],\n          tokens.slice(1),\n          // lookahead two tokens for function calls\n          isTokenFunctionCall(tokens[1]) ? obj : ctx,\n          fnArgs);\n\n    } else {\n\n      return helper(obj[currentToken],\n          tokens.slice(1),\n          // lookahead two tokens for function calls\n          isTokenFunctionCall(tokens[1]) ? obj : ctx,\n          fnArgs);\n\n    }\n  }\n\n  function isUndefined(a) {\n    return a === void 0;\n  }\n\n  function isNull(a) {\n    return a === null;\n  }\n\n  function isArray(a) {\n    return Array.isArray(a);\n  }\n\n  function isFunction(a) {\n    return typeof a === 'function';\n  }\n\n  function isTokenFunctionCall(token) {\n    return token === '()';\n  }\n\n  function isTokenArrayAccess(token) {\n    return /^\\[\\d+\\]$/.test(token);\n  }\n\n  function tokenize(str) {\n    return str.split(/\\.|(\\(\\))|(\\[\\d+?])/).filter(function(t) { return t; });\n  }\n\n}));\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n// This is CodeMirror (http://codemirror.net), a code editor\n// implemented in JavaScript on top of the browser's DOM.\n//\n// You can find some technical background for some of the code below\n// at http://marijnhaverbeke.nl/blog/#cm-internals .\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    module.exports = mod();\n  else if (typeof define == \"function\" && define.amd) // AMD\n    return define([], mod);\n  else // Plain browser env\n    this.CodeMirror = mod();\n})(function() {\n  \"use strict\";\n\n  // BROWSER SNIFFING\n\n  // Kludges for bugs and behavior differences that can't be feature\n  // detected are enabled based on userAgent etc sniffing.\n\n  var gecko = /gecko\\/\\d/i.test(navigator.userAgent);\n  // ie_uptoN means Internet Explorer version N or lower\n  var ie_upto10 = /MSIE \\d/.test(navigator.userAgent);\n  var ie_11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(navigator.userAgent);\n  var ie = ie_upto10 || ie_11up;\n  var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : ie_11up[1]);\n  var webkit = /WebKit\\//.test(navigator.userAgent);\n  var qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(navigator.userAgent);\n  var chrome = /Chrome\\//.test(navigator.userAgent);\n  var presto = /Opera\\//.test(navigator.userAgent);\n  var safari = /Apple Computer/.test(navigator.vendor);\n  var khtml = /KHTML\\//.test(navigator.userAgent);\n  var mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(navigator.userAgent);\n  var phantom = /PhantomJS/.test(navigator.userAgent);\n\n  var ios = /AppleWebKit/.test(navigator.userAgent) && /Mobile\\/\\w+/.test(navigator.userAgent);\n  // This is woefully incomplete. Suggestions for alternative methods welcome.\n  var mobile = ios || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent);\n  var mac = ios || /Mac/.test(navigator.platform);\n  var windows = /win/i.test(navigator.platform);\n\n  var presto_version = presto && navigator.userAgent.match(/Version\\/(\\d*\\.\\d*)/);\n  if (presto_version) presto_version = Number(presto_version[1]);\n  if (presto_version && presto_version >= 15) { presto = false; webkit = true; }\n  // Some browsers use the wrong event properties to signal cmd/ctrl on OS X\n  var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));\n  var captureRightClick = gecko || (ie && ie_version >= 9);\n\n  // Optimize some code when these features are not used.\n  var sawReadOnlySpans = false, sawCollapsedSpans = false;\n\n  // EDITOR CONSTRUCTOR\n\n  // A CodeMirror instance represents an editor. This is the object\n  // that user code is usually dealing with.\n\n  function CodeMirror(place, options) {\n    if (!(this instanceof CodeMirror)) return new CodeMirror(place, options);\n\n    this.options = options = options ? copyObj(options) : {};\n    // Determine effective options based on given values and defaults.\n    copyObj(defaults, options, false);\n    setGuttersForLineNumbers(options);\n\n    var doc = options.value;\n    if (typeof doc == \"string\") doc = new Doc(doc, options.mode);\n    this.doc = doc;\n\n    var display = this.display = new Display(place, doc);\n    display.wrapper.CodeMirror = this;\n    updateGutters(this);\n    themeChanged(this);\n    if (options.lineWrapping)\n      this.display.wrapper.className += \" CodeMirror-wrap\";\n    if (options.autofocus && !mobile) focusInput(this);\n\n    this.state = {\n      keyMaps: [],  // stores maps added by addKeyMap\n      overlays: [], // highlighting overlays, as added by addOverlay\n      modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info\n      overwrite: false, focused: false,\n      suppressEdits: false, // used to disable editing during key handlers when in readOnly mode\n      pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in readInput\n      draggingText: false,\n      highlight: new Delayed(), // stores highlight worker timeout\n      keySeq: null  // Unfinished key sequence\n    };\n\n    // Override magic textarea content restore that IE sometimes does\n    // on our hidden textarea on reload\n    if (ie && ie_version < 11) setTimeout(bind(resetInput, this, true), 20);\n\n    registerEventHandlers(this);\n    ensureGlobalHandlers();\n\n    startOperation(this);\n    this.curOp.forceUpdate = true;\n    attachDoc(this, doc);\n\n    if ((options.autofocus && !mobile) || activeElt() == display.input)\n      setTimeout(bind(onFocus, this), 20);\n    else\n      onBlur(this);\n\n    for (var opt in optionHandlers) if (optionHandlers.hasOwnProperty(opt))\n      optionHandlers[opt](this, options[opt], Init);\n    maybeUpdateLineNumberWidth(this);\n    for (var i = 0; i < initHooks.length; ++i) initHooks[i](this);\n    endOperation(this);\n  }\n\n  // DISPLAY CONSTRUCTOR\n\n  // The display handles the DOM integration, both for input reading\n  // and content drawing. It holds references to DOM nodes and\n  // display-related state.\n\n  function Display(place, doc) {\n    var d = this;\n\n    // The semihidden textarea that is focused when the editor is\n    // focused, and receives input.\n    var input = d.input = elt(\"textarea\", null, null, \"position: absolute; padding: 0; width: 1px; height: 1em; outline: none\");\n    // The textarea is kept positioned near the cursor to prevent the\n    // fact that it'll be scrolled into view on input from scrolling\n    // our fake cursor out of view. On webkit, when wrap=off, paste is\n    // very slow. So make the area wide instead.\n    if (webkit) input.style.width = \"1000px\";\n    else input.setAttribute(\"wrap\", \"off\");\n    // If border: 0; -- iOS fails to open keyboard (issue #1287)\n    if (ios) input.style.border = \"1px solid black\";\n    input.setAttribute(\"autocorrect\", \"off\"); input.setAttribute(\"autocapitalize\", \"off\"); input.setAttribute(\"spellcheck\", \"false\");\n\n    // Wraps and hides input textarea\n    d.inputDiv = elt(\"div\", [input], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");\n    // The fake scrollbar elements.\n    d.scrollbarH = elt(\"div\", [elt(\"div\", null, null, \"height: 100%; min-height: 1px\")], \"CodeMirror-hscrollbar\");\n    d.scrollbarV = elt(\"div\", [elt(\"div\", null, null, \"min-width: 1px\")], \"CodeMirror-vscrollbar\");\n    // Covers bottom-right square when both scrollbars are present.\n    d.scrollbarFiller = elt(\"div\", null, \"CodeMirror-scrollbar-filler\");\n    // Covers bottom of gutter when coverGutterNextToScrollbar is on\n    // and h scrollbar is present.\n    d.gutterFiller = elt(\"div\", null, \"CodeMirror-gutter-filler\");\n    // Will contain the actual code, positioned to cover the viewport.\n    d.lineDiv = elt(\"div\", null, \"CodeMirror-code\");\n    // Elements are added to these to represent selection and cursors.\n    d.selectionDiv = elt(\"div\", null, null, \"position: relative; z-index: 1\");\n    d.cursorDiv = elt(\"div\", null, \"CodeMirror-cursors\");\n    // A visibility: hidden element used to find the size of things.\n    d.measure = elt(\"div\", null, \"CodeMirror-measure\");\n    // When lines outside of the viewport are measured, they are drawn in this.\n    d.lineMeasure = elt(\"div\", null, \"CodeMirror-measure\");\n    // Wraps everything that needs to exist inside the vertically-padded coordinate system\n    d.lineSpace = elt(\"div\", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],\n                      null, \"position: relative; outline: none\");\n    // Moved around its parent to cover visible view.\n    d.mover = elt(\"div\", [elt(\"div\", [d.lineSpace], \"CodeMirror-lines\")], null, \"position: relative\");\n    // Set to the height of the document, allowing scrolling.\n    d.sizer = elt(\"div\", [d.mover], \"CodeMirror-sizer\");\n    // Behavior of elts with overflow: auto and padding is\n    // inconsistent across browsers. This is used to ensure the\n    // scrollable area is big enough.\n    d.heightForcer = elt(\"div\", null, null, \"position: absolute; height: \" + scrollerCutOff + \"px; width: 1px;\");\n    // Will contain the gutters, if any.\n    d.gutters = elt(\"div\", null, \"CodeMirror-gutters\");\n    d.lineGutter = null;\n    // Actual scrollable element.\n    d.scroller = elt(\"div\", [d.sizer, d.heightForcer, d.gutters], \"CodeMirror-scroll\");\n    d.scroller.setAttribute(\"tabIndex\", \"-1\");\n    // The element in which the editor lives.\n    d.wrapper = elt(\"div\", [d.inputDiv, d.scrollbarH, d.scrollbarV,\n                            d.scrollbarFiller, d.gutterFiller, d.scroller], \"CodeMirror\");\n\n    // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)\n    if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }\n    // Needed to hide big blue blinking cursor on Mobile Safari\n    if (ios) input.style.width = \"0px\";\n    if (!webkit) d.scroller.draggable = true;\n    // Needed to handle Tab key in KHTML\n    if (khtml) { d.inputDiv.style.height = \"1px\"; d.inputDiv.style.position = \"absolute\"; }\n    // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).\n    if (ie && ie_version < 8) d.scrollbarH.style.minHeight = d.scrollbarV.style.minWidth = \"18px\";\n\n    if (place) {\n      if (place.appendChild) place.appendChild(d.wrapper);\n      else place(d.wrapper);\n    }\n\n    // Current rendered range (may be bigger than the view window).\n    d.viewFrom = d.viewTo = doc.first;\n    // Information about the rendered lines.\n    d.view = [];\n    // Holds info about a single rendered line when it was rendered\n    // for measurement, while not in view.\n    d.externalMeasured = null;\n    // Empty space (in pixels) above the view\n    d.viewOffset = 0;\n    d.lastWrapHeight = d.lastWrapWidth = 0;\n    d.updateLineNumbers = null;\n\n    // Used to only resize the line number gutter when necessary (when\n    // the amount of lines crosses a boundary that makes its width change)\n    d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;\n    // See readInput and resetInput\n    d.prevInput = \"\";\n    // Set to true when a non-horizontal-scrolling line widget is\n    // added. As an optimization, line widget aligning is skipped when\n    // this is false.\n    d.alignWidgets = false;\n    // Flag that indicates whether we expect input to appear real soon\n    // now (after some event like 'keypress' or 'input') and are\n    // polling intensively.\n    d.pollingFast = false;\n    // Self-resetting timeout for the poller\n    d.poll = new Delayed();\n\n    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n\n    // Tracks when resetInput has punted to just putting a short\n    // string into the textarea instead of the full selection.\n    d.inaccurateSelection = false;\n\n    // Tracks the maximum line length so that the horizontal scrollbar\n    // can be kept static when scrolling.\n    d.maxLine = null;\n    d.maxLineLength = 0;\n    d.maxLineChanged = false;\n\n    // Used for measuring wheel scrolling granularity\n    d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;\n\n    // True when shift is held down.\n    d.shift = false;\n\n    // Used to track whether anything happened since the context menu\n    // was opened.\n    d.selForContextMenu = null;\n  }\n\n  // STATE UPDATES\n\n  // Used to get the editor into a consistent state again when options change.\n\n  function loadMode(cm) {\n    cm.doc.mode = CodeMirror.getMode(cm.options, cm.doc.modeOption);\n    resetModeState(cm);\n  }\n\n  function resetModeState(cm) {\n    cm.doc.iter(function(line) {\n      if (line.stateAfter) line.stateAfter = null;\n      if (line.styles) line.styles = null;\n    });\n    cm.doc.frontier = cm.doc.first;\n    startWorker(cm, 100);\n    cm.state.modeGen++;\n    if (cm.curOp) regChange(cm);\n  }\n\n  function wrappingChanged(cm) {\n    if (cm.options.lineWrapping) {\n      addClass(cm.display.wrapper, \"CodeMirror-wrap\");\n      cm.display.sizer.style.minWidth = \"\";\n    } else {\n      rmClass(cm.display.wrapper, \"CodeMirror-wrap\");\n      findMaxLine(cm);\n    }\n    estimateLineHeights(cm);\n    regChange(cm);\n    clearCaches(cm);\n    setTimeout(function(){updateScrollbars(cm);}, 100);\n  }\n\n  // Returns a function that estimates the height of a line, to use as\n  // first approximation until the line becomes visible (and is thus\n  // properly measurable).\n  function estimateHeight(cm) {\n    var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;\n    var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);\n    return function(line) {\n      if (lineIsHidden(cm.doc, line)) return 0;\n\n      var widgetsHeight = 0;\n      if (line.widgets) for (var i = 0; i < line.widgets.length; i++) {\n        if (line.widgets[i].height) widgetsHeight += line.widgets[i].height;\n      }\n\n      if (wrapping)\n        return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th;\n      else\n        return widgetsHeight + th;\n    };\n  }\n\n  function estimateLineHeights(cm) {\n    var doc = cm.doc, est = estimateHeight(cm);\n    doc.iter(function(line) {\n      var estHeight = est(line);\n      if (estHeight != line.height) updateLineHeight(line, estHeight);\n    });\n  }\n\n  function themeChanged(cm) {\n    cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, \"\") +\n      cm.options.theme.replace(/(^|\\s)\\s*/g, \" cm-s-\");\n    clearCaches(cm);\n  }\n\n  function guttersChanged(cm) {\n    updateGutters(cm);\n    regChange(cm);\n    setTimeout(function(){alignHorizontally(cm);}, 20);\n  }\n\n  // Rebuild the gutter elements, ensure the margin to the left of the\n  // code matches their width.\n  function updateGutters(cm) {\n    var gutters = cm.display.gutters, specs = cm.options.gutters;\n    removeChildren(gutters);\n    for (var i = 0; i < specs.length; ++i) {\n      var gutterClass = specs[i];\n      var gElt = gutters.appendChild(elt(\"div\", null, \"CodeMirror-gutter \" + gutterClass));\n      if (gutterClass == \"CodeMirror-linenumbers\") {\n        cm.display.lineGutter = gElt;\n        gElt.style.width = (cm.display.lineNumWidth || 1) + \"px\";\n      }\n    }\n    gutters.style.display = i ? \"\" : \"none\";\n    updateGutterSpace(cm);\n  }\n\n  function updateGutterSpace(cm) {\n    var width = cm.display.gutters.offsetWidth;\n    cm.display.sizer.style.marginLeft = width + \"px\";\n    cm.display.scrollbarH.style.left = cm.options.fixedGutter ? width + \"px\" : 0;\n  }\n\n  // Compute the character length of a line, taking into account\n  // collapsed ranges (see markText) that might hide parts, and join\n  // other lines onto it.\n  function lineLength(line) {\n    if (line.height == 0) return 0;\n    var len = line.text.length, merged, cur = line;\n    while (merged = collapsedSpanAtStart(cur)) {\n      var found = merged.find(0, true);\n      cur = found.from.line;\n      len += found.from.ch - found.to.ch;\n    }\n    cur = line;\n    while (merged = collapsedSpanAtEnd(cur)) {\n      var found = merged.find(0, true);\n      len -= cur.text.length - found.from.ch;\n      cur = found.to.line;\n      len += cur.text.length - found.to.ch;\n    }\n    return len;\n  }\n\n  // Find the longest line in the document.\n  function findMaxLine(cm) {\n    var d = cm.display, doc = cm.doc;\n    d.maxLine = getLine(doc, doc.first);\n    d.maxLineLength = lineLength(d.maxLine);\n    d.maxLineChanged = true;\n    doc.iter(function(line) {\n      var len = lineLength(line);\n      if (len > d.maxLineLength) {\n        d.maxLineLength = len;\n        d.maxLine = line;\n      }\n    });\n  }\n\n  // Make sure the gutters options contains the element\n  // \"CodeMirror-linenumbers\" when the lineNumbers option is true.\n  function setGuttersForLineNumbers(options) {\n    var found = indexOf(options.gutters, \"CodeMirror-linenumbers\");\n    if (found == -1 && options.lineNumbers) {\n      options.gutters = options.gutters.concat([\"CodeMirror-linenumbers\"]);\n    } else if (found > -1 && !options.lineNumbers) {\n      options.gutters = options.gutters.slice(0);\n      options.gutters.splice(found, 1);\n    }\n  }\n\n  // SCROLLBARS\n\n  function hScrollbarTakesSpace(cm) {\n    return cm.display.scroller.clientHeight - cm.display.wrapper.clientHeight < scrollerCutOff - 3;\n  }\n\n  // Prepare DOM reads needed to update the scrollbars. Done in one\n  // shot to minimize update/measure roundtrips.\n  function measureForScrollbars(cm) {\n    var scroll = cm.display.scroller;\n    return {\n      clientHeight: scroll.clientHeight,\n      barHeight: cm.display.scrollbarV.clientHeight,\n      scrollWidth: scroll.scrollWidth, clientWidth: scroll.clientWidth,\n      hScrollbarTakesSpace: hScrollbarTakesSpace(cm),\n      barWidth: cm.display.scrollbarH.clientWidth,\n      docHeight: Math.round(cm.doc.height + paddingVert(cm.display))\n    };\n  }\n\n  // Re-synchronize the fake scrollbars with the actual size of the\n  // content.\n  function updateScrollbars(cm, measure) {\n    if (!measure) measure = measureForScrollbars(cm);\n    var d = cm.display, sWidth = scrollbarWidth(d.measure);\n    var scrollHeight = measure.docHeight + scrollerCutOff;\n    var needsH = measure.scrollWidth > measure.clientWidth;\n    if (needsH && measure.scrollWidth <= measure.clientWidth + 1 &&\n        sWidth > 0 && !measure.hScrollbarTakesSpace)\n      needsH = false; // (Issue #2562)\n    var needsV = scrollHeight > measure.clientHeight;\n\n    if (needsV) {\n      d.scrollbarV.style.display = \"block\";\n      d.scrollbarV.style.bottom = needsH ? sWidth + \"px\" : \"0\";\n      // A bug in IE8 can cause this value to be negative, so guard it.\n      d.scrollbarV.firstChild.style.height =\n        Math.max(0, scrollHeight - measure.clientHeight + (measure.barHeight || d.scrollbarV.clientHeight)) + \"px\";\n    } else {\n      d.scrollbarV.style.display = \"\";\n      d.scrollbarV.firstChild.style.height = \"0\";\n    }\n    if (needsH) {\n      d.scrollbarH.style.display = \"block\";\n      d.scrollbarH.style.right = needsV ? sWidth + \"px\" : \"0\";\n      d.scrollbarH.firstChild.style.width =\n        (measure.scrollWidth - measure.clientWidth + (measure.barWidth || d.scrollbarH.clientWidth)) + \"px\";\n    } else {\n      d.scrollbarH.style.display = \"\";\n      d.scrollbarH.firstChild.style.width = \"0\";\n    }\n    if (needsH && needsV) {\n      d.scrollbarFiller.style.display = \"block\";\n      d.scrollbarFiller.style.height = d.scrollbarFiller.style.width = sWidth + \"px\";\n    } else d.scrollbarFiller.style.display = \"\";\n    if (needsH && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {\n      d.gutterFiller.style.display = \"block\";\n      d.gutterFiller.style.height = sWidth + \"px\";\n      d.gutterFiller.style.width = d.gutters.offsetWidth + \"px\";\n    } else d.gutterFiller.style.display = \"\";\n\n    if (!cm.state.checkedOverlayScrollbar && measure.clientHeight > 0) {\n      if (sWidth === 0) {\n        var w = mac && !mac_geMountainLion ? \"12px\" : \"18px\";\n        d.scrollbarV.style.minWidth = d.scrollbarH.style.minHeight = w;\n        var barMouseDown = function(e) {\n          if (e_target(e) != d.scrollbarV && e_target(e) != d.scrollbarH)\n            operation(cm, onMouseDown)(e);\n        };\n        on(d.scrollbarV, \"mousedown\", barMouseDown);\n        on(d.scrollbarH, \"mousedown\", barMouseDown);\n      }\n      cm.state.checkedOverlayScrollbar = true;\n    }\n  }\n\n  // Compute the lines that are visible in a given viewport (defaults\n  // the the current scroll position). viewport may contain top,\n  // height, and ensure (see op.scrollToPos) properties.\n  function visibleLines(display, doc, viewport) {\n    var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;\n    top = Math.floor(top - paddingTop(display));\n    var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;\n\n    var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);\n    // Ensure is a {from: {line, ch}, to: {line, ch}} object, and\n    // forces those lines into the viewport (if possible).\n    if (viewport && viewport.ensure) {\n      var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;\n      if (ensureFrom < from)\n        return {from: ensureFrom,\n                to: lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight)};\n      if (Math.min(ensureTo, doc.lastLine()) >= to)\n        return {from: lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight),\n                to: ensureTo};\n    }\n    return {from: from, to: Math.max(to, from + 1)};\n  }\n\n  // LINE NUMBERS\n\n  // Re-align line numbers and gutter marks to compensate for\n  // horizontal scrolling.\n  function alignHorizontally(cm) {\n    var display = cm.display, view = display.view;\n    if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) return;\n    var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;\n    var gutterW = display.gutters.offsetWidth, left = comp + \"px\";\n    for (var i = 0; i < view.length; i++) if (!view[i].hidden) {\n      if (cm.options.fixedGutter && view[i].gutter)\n        view[i].gutter.style.left = left;\n      var align = view[i].alignable;\n      if (align) for (var j = 0; j < align.length; j++)\n        align[j].style.left = left;\n    }\n    if (cm.options.fixedGutter)\n      display.gutters.style.left = (comp + gutterW) + \"px\";\n  }\n\n  // Used to ensure that the line number gutter is still the right\n  // size for the current document size. Returns true when an update\n  // is needed.\n  function maybeUpdateLineNumberWidth(cm) {\n    if (!cm.options.lineNumbers) return false;\n    var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;\n    if (last.length != display.lineNumChars) {\n      var test = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)],\n                                                 \"CodeMirror-linenumber CodeMirror-gutter-elt\"));\n      var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;\n      display.lineGutter.style.width = \"\";\n      display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding);\n      display.lineNumWidth = display.lineNumInnerWidth + padding;\n      display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;\n      display.lineGutter.style.width = display.lineNumWidth + \"px\";\n      updateGutterSpace(cm);\n      return true;\n    }\n    return false;\n  }\n\n  function lineNumberFor(options, i) {\n    return String(options.lineNumberFormatter(i + options.firstLineNumber));\n  }\n\n  // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,\n  // but using getBoundingClientRect to get a sub-pixel-accurate\n  // result.\n  function compensateForHScroll(display) {\n    return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left;\n  }\n\n  // DISPLAY DRAWING\n\n  function DisplayUpdate(cm, viewport, force) {\n    var display = cm.display;\n\n    this.viewport = viewport;\n    // Store some values that we'll need later (but don't want to force a relayout for)\n    this.visible = visibleLines(display, cm.doc, viewport);\n    this.editorIsHidden = !display.wrapper.offsetWidth;\n    this.wrapperHeight = display.wrapper.clientHeight;\n    this.wrapperWidth = display.wrapper.clientWidth;\n    this.oldViewFrom = display.viewFrom; this.oldViewTo = display.viewTo;\n    this.oldScrollerWidth = display.scroller.clientWidth;\n    this.force = force;\n    this.dims = getDimensions(cm);\n  }\n\n  // Does the actual updating of the line display. Bails out\n  // (returning false) when there is nothing to be done and forced is\n  // false.\n  function updateDisplayIfNeeded(cm, update) {\n    var display = cm.display, doc = cm.doc;\n    if (update.editorIsHidden) {\n      resetView(cm);\n      return false;\n    }\n\n    // Bail out if the visible area is already rendered and nothing changed.\n    if (!update.force &&\n        update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&\n        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&\n        countDirtyView(cm) == 0)\n      return false;\n\n    if (maybeUpdateLineNumberWidth(cm)) {\n      resetView(cm);\n      update.dims = getDimensions(cm);\n    }\n\n    // Compute a suitable new viewport (from & to)\n    var end = doc.first + doc.size;\n    var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);\n    var to = Math.min(end, update.visible.to + cm.options.viewportMargin);\n    if (display.viewFrom < from && from - display.viewFrom < 20) from = Math.max(doc.first, display.viewFrom);\n    if (display.viewTo > to && display.viewTo - to < 20) to = Math.min(end, display.viewTo);\n    if (sawCollapsedSpans) {\n      from = visualLineNo(cm.doc, from);\n      to = visualLineEndNo(cm.doc, to);\n    }\n\n    var different = from != display.viewFrom || to != display.viewTo ||\n      display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;\n    adjustView(cm, from, to);\n\n    display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));\n    // Position the mover div to align with the current scroll position\n    cm.display.mover.style.top = display.viewOffset + \"px\";\n\n    var toUpdate = countDirtyView(cm);\n    if (!different && toUpdate == 0 && !update.force &&\n        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))\n      return false;\n\n    // For big changes, we hide the enclosing element during the\n    // update, since that speeds up the operations on most browsers.\n    var focused = activeElt();\n    if (toUpdate > 4) display.lineDiv.style.display = \"none\";\n    patchDisplay(cm, display.updateLineNumbers, update.dims);\n    if (toUpdate > 4) display.lineDiv.style.display = \"\";\n    // There might have been a widget with a focused element that got\n    // hidden or updated, if so re-focus it.\n    if (focused && activeElt() != focused && focused.offsetHeight) focused.focus();\n\n    // Prevent selection and cursors from interfering with the scroll\n    // width.\n    removeChildren(display.cursorDiv);\n    removeChildren(display.selectionDiv);\n\n    if (different) {\n      display.lastWrapHeight = update.wrapperHeight;\n      display.lastWrapWidth = update.wrapperWidth;\n      startWorker(cm, 400);\n    }\n\n    display.updateLineNumbers = null;\n\n    return true;\n  }\n\n  function postUpdateDisplay(cm, update) {\n    var force = update.force, viewport = update.viewport;\n    for (var first = true;; first = false) {\n      if (first && cm.options.lineWrapping && update.oldScrollerWidth != cm.display.scroller.clientWidth) {\n        force = true;\n      } else {\n        force = false;\n        // Clip forced viewport to actual scrollable area.\n        if (viewport && viewport.top != null)\n          viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - scrollerCutOff -\n                                    cm.display.scroller.clientHeight, viewport.top)};\n        // Updated line heights might result in the drawn area not\n        // actually covering the viewport. Keep looping until it does.\n        update.visible = visibleLines(cm.display, cm.doc, viewport);\n        if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)\n          break;\n      }\n      if (!updateDisplayIfNeeded(cm, update)) break;\n      updateHeightsInViewport(cm);\n      var barMeasure = measureForScrollbars(cm);\n      updateSelection(cm);\n      setDocumentHeight(cm, barMeasure);\n      updateScrollbars(cm, barMeasure);\n    }\n\n    signalLater(cm, \"update\", cm);\n    if (cm.display.viewFrom != update.oldViewFrom || cm.display.viewTo != update.oldViewTo)\n      signalLater(cm, \"viewportChange\", cm, cm.display.viewFrom, cm.display.viewTo);\n  }\n\n  function updateDisplaySimple(cm, viewport) {\n    var update = new DisplayUpdate(cm, viewport);\n    if (updateDisplayIfNeeded(cm, update)) {\n      updateHeightsInViewport(cm);\n      postUpdateDisplay(cm, update);\n      var barMeasure = measureForScrollbars(cm);\n      updateSelection(cm);\n      setDocumentHeight(cm, barMeasure);\n      updateScrollbars(cm, barMeasure);\n    }\n  }\n\n  function setDocumentHeight(cm, measure) {\n    cm.display.sizer.style.minHeight = cm.display.heightForcer.style.top = measure.docHeight + \"px\";\n    cm.display.gutters.style.height = Math.max(measure.docHeight, measure.clientHeight - scrollerCutOff) + \"px\";\n  }\n\n  function checkForWebkitWidthBug(cm, measure) {\n    // Work around Webkit bug where it sometimes reserves space for a\n    // non-existing phantom scrollbar in the scroller (Issue #2420)\n    if (cm.display.sizer.offsetWidth + cm.display.gutters.offsetWidth < cm.display.scroller.clientWidth - 1) {\n      cm.display.sizer.style.minHeight = cm.display.heightForcer.style.top = \"0px\";\n      cm.display.gutters.style.height = measure.docHeight + \"px\";\n    }\n  }\n\n  // Read the actual heights of the rendered lines, and update their\n  // stored heights to match.\n  function updateHeightsInViewport(cm) {\n    var display = cm.display;\n    var prevBottom = display.lineDiv.offsetTop;\n    for (var i = 0; i < display.view.length; i++) {\n      var cur = display.view[i], height;\n      if (cur.hidden) continue;\n      if (ie && ie_version < 8) {\n        var bot = cur.node.offsetTop + cur.node.offsetHeight;\n        height = bot - prevBottom;\n        prevBottom = bot;\n      } else {\n        var box = cur.node.getBoundingClientRect();\n        height = box.bottom - box.top;\n      }\n      var diff = cur.line.height - height;\n      if (height < 2) height = textHeight(display);\n      if (diff > .001 || diff < -.001) {\n        updateLineHeight(cur.line, height);\n        updateWidgetHeight(cur.line);\n        if (cur.rest) for (var j = 0; j < cur.rest.length; j++)\n          updateWidgetHeight(cur.rest[j]);\n      }\n    }\n  }\n\n  // Read and store the height of line widgets associated with the\n  // given line.\n  function updateWidgetHeight(line) {\n    if (line.widgets) for (var i = 0; i < line.widgets.length; ++i)\n      line.widgets[i].height = line.widgets[i].node.offsetHeight;\n  }\n\n  // Do a bulk-read of the DOM positions and sizes needed to draw the\n  // view, so that we don't interleave reading and writing to the DOM.\n  function getDimensions(cm) {\n    var d = cm.display, left = {}, width = {};\n    var gutterLeft = d.gutters.clientLeft;\n    for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {\n      left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;\n      width[cm.options.gutters[i]] = n.clientWidth;\n    }\n    return {fixedPos: compensateForHScroll(d),\n            gutterTotalWidth: d.gutters.offsetWidth,\n            gutterLeft: left,\n            gutterWidth: width,\n            wrapperWidth: d.wrapper.clientWidth};\n  }\n\n  // Sync the actual display DOM structure with display.view, removing\n  // nodes for lines that are no longer in view, and creating the ones\n  // that are not there yet, and updating the ones that are out of\n  // date.\n  function patchDisplay(cm, updateNumbersFrom, dims) {\n    var display = cm.display, lineNumbers = cm.options.lineNumbers;\n    var container = display.lineDiv, cur = container.firstChild;\n\n    function rm(node) {\n      var next = node.nextSibling;\n      // Works around a throw-scroll bug in OS X Webkit\n      if (webkit && mac && cm.display.currentWheelTarget == node)\n        node.style.display = \"none\";\n      else\n        node.parentNode.removeChild(node);\n      return next;\n    }\n\n    var view = display.view, lineN = display.viewFrom;\n    // Loop over the elements in the view, syncing cur (the DOM nodes\n    // in display.lineDiv) with the view as we go.\n    for (var i = 0; i < view.length; i++) {\n      var lineView = view[i];\n      if (lineView.hidden) {\n      } else if (!lineView.node) { // Not drawn yet\n        var node = buildLineElement(cm, lineView, lineN, dims);\n        container.insertBefore(node, cur);\n      } else { // Already drawn\n        while (cur != lineView.node) cur = rm(cur);\n        var updateNumber = lineNumbers && updateNumbersFrom != null &&\n          updateNumbersFrom <= lineN && lineView.lineNumber;\n        if (lineView.changes) {\n          if (indexOf(lineView.changes, \"gutter\") > -1) updateNumber = false;\n          updateLineForChanges(cm, lineView, lineN, dims);\n        }\n        if (updateNumber) {\n          removeChildren(lineView.lineNumber);\n          lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));\n        }\n        cur = lineView.node.nextSibling;\n      }\n      lineN += lineView.size;\n    }\n    while (cur) cur = rm(cur);\n  }\n\n  // When an aspect of a line changes, a string is added to\n  // lineView.changes. This updates the relevant part of the line's\n  // DOM structure.\n  function updateLineForChanges(cm, lineView, lineN, dims) {\n    for (var j = 0; j < lineView.changes.length; j++) {\n      var type = lineView.changes[j];\n      if (type == \"text\") updateLineText(cm, lineView);\n      else if (type == \"gutter\") updateLineGutter(cm, lineView, lineN, dims);\n      else if (type == \"class\") updateLineClasses(lineView);\n      else if (type == \"widget\") updateLineWidgets(lineView, dims);\n    }\n    lineView.changes = null;\n  }\n\n  // Lines with gutter elements, widgets or a background class need to\n  // be wrapped, and have the extra elements added to the wrapper div\n  function ensureLineWrapped(lineView) {\n    if (lineView.node == lineView.text) {\n      lineView.node = elt(\"div\", null, null, \"position: relative\");\n      if (lineView.text.parentNode)\n        lineView.text.parentNode.replaceChild(lineView.node, lineView.text);\n      lineView.node.appendChild(lineView.text);\n      if (ie && ie_version < 8) lineView.node.style.zIndex = 2;\n    }\n    return lineView.node;\n  }\n\n  function updateLineBackground(lineView) {\n    var cls = lineView.bgClass ? lineView.bgClass + \" \" + (lineView.line.bgClass || \"\") : lineView.line.bgClass;\n    if (cls) cls += \" CodeMirror-linebackground\";\n    if (lineView.background) {\n      if (cls) lineView.background.className = cls;\n      else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }\n    } else if (cls) {\n      var wrap = ensureLineWrapped(lineView);\n      lineView.background = wrap.insertBefore(elt(\"div\", null, cls), wrap.firstChild);\n    }\n  }\n\n  // Wrapper around buildLineContent which will reuse the structure\n  // in display.externalMeasured when possible.\n  function getLineContent(cm, lineView) {\n    var ext = cm.display.externalMeasured;\n    if (ext && ext.line == lineView.line) {\n      cm.display.externalMeasured = null;\n      lineView.measure = ext.measure;\n      return ext.built;\n    }\n    return buildLineContent(cm, lineView);\n  }\n\n  // Redraw the line's text. Interacts with the background and text\n  // classes because the mode may output tokens that influence these\n  // classes.\n  function updateLineText(cm, lineView) {\n    var cls = lineView.text.className;\n    var built = getLineContent(cm, lineView);\n    if (lineView.text == lineView.node) lineView.node = built.pre;\n    lineView.text.parentNode.replaceChild(built.pre, lineView.text);\n    lineView.text = built.pre;\n    if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {\n      lineView.bgClass = built.bgClass;\n      lineView.textClass = built.textClass;\n      updateLineClasses(lineView);\n    } else if (cls) {\n      lineView.text.className = cls;\n    }\n  }\n\n  function updateLineClasses(lineView) {\n    updateLineBackground(lineView);\n    if (lineView.line.wrapClass)\n      ensureLineWrapped(lineView).className = lineView.line.wrapClass;\n    else if (lineView.node != lineView.text)\n      lineView.node.className = \"\";\n    var textClass = lineView.textClass ? lineView.textClass + \" \" + (lineView.line.textClass || \"\") : lineView.line.textClass;\n    lineView.text.className = textClass || \"\";\n  }\n\n  function updateLineGutter(cm, lineView, lineN, dims) {\n    if (lineView.gutter) {\n      lineView.node.removeChild(lineView.gutter);\n      lineView.gutter = null;\n    }\n    var markers = lineView.line.gutterMarkers;\n    if (cm.options.lineNumbers || markers) {\n      var wrap = ensureLineWrapped(lineView);\n      var gutterWrap = lineView.gutter =\n        wrap.insertBefore(elt(\"div\", null, \"CodeMirror-gutter-wrapper\", \"left: \" +\n                              (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) +\n                              \"px; width: \" + dims.gutterTotalWidth + \"px\"),\n                          lineView.text);\n      if (lineView.line.gutterClass)\n        gutterWrap.className += \" \" + lineView.line.gutterClass;\n      if (cm.options.lineNumbers && (!markers || !markers[\"CodeMirror-linenumbers\"]))\n        lineView.lineNumber = gutterWrap.appendChild(\n          elt(\"div\", lineNumberFor(cm.options, lineN),\n              \"CodeMirror-linenumber CodeMirror-gutter-elt\",\n              \"left: \" + dims.gutterLeft[\"CodeMirror-linenumbers\"] + \"px; width: \"\n              + cm.display.lineNumInnerWidth + \"px\"));\n      if (markers) for (var k = 0; k < cm.options.gutters.length; ++k) {\n        var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];\n        if (found)\n          gutterWrap.appendChild(elt(\"div\", [found], \"CodeMirror-gutter-elt\", \"left: \" +\n                                     dims.gutterLeft[id] + \"px; width: \" + dims.gutterWidth[id] + \"px\"));\n      }\n    }\n  }\n\n  function updateLineWidgets(lineView, dims) {\n    if (lineView.alignable) lineView.alignable = null;\n    for (var node = lineView.node.firstChild, next; node; node = next) {\n      var next = node.nextSibling;\n      if (node.className == \"CodeMirror-linewidget\")\n        lineView.node.removeChild(node);\n    }\n    insertLineWidgets(lineView, dims);\n  }\n\n  // Build a line's DOM representation from scratch\n  function buildLineElement(cm, lineView, lineN, dims) {\n    var built = getLineContent(cm, lineView);\n    lineView.text = lineView.node = built.pre;\n    if (built.bgClass) lineView.bgClass = built.bgClass;\n    if (built.textClass) lineView.textClass = built.textClass;\n\n    updateLineClasses(lineView);\n    updateLineGutter(cm, lineView, lineN, dims);\n    insertLineWidgets(lineView, dims);\n    return lineView.node;\n  }\n\n  // A lineView may contain multiple logical lines (when merged by\n  // collapsed spans). The widgets for all of them need to be drawn.\n  function insertLineWidgets(lineView, dims) {\n    insertLineWidgetsFor(lineView.line, lineView, dims, true);\n    if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)\n      insertLineWidgetsFor(lineView.rest[i], lineView, dims, false);\n  }\n\n  function insertLineWidgetsFor(line, lineView, dims, allowAbove) {\n    if (!line.widgets) return;\n    var wrap = ensureLineWrapped(lineView);\n    for (var i = 0, ws = line.widgets; i < ws.length; ++i) {\n      var widget = ws[i], node = elt(\"div\", [widget.node], \"CodeMirror-linewidget\");\n      if (!widget.handleMouseEvents) node.ignoreEvents = true;\n      positionLineWidget(widget, node, lineView, dims);\n      if (allowAbove && widget.above)\n        wrap.insertBefore(node, lineView.gutter || lineView.text);\n      else\n        wrap.appendChild(node);\n      signalLater(widget, \"redraw\");\n    }\n  }\n\n  function positionLineWidget(widget, node, lineView, dims) {\n    if (widget.noHScroll) {\n      (lineView.alignable || (lineView.alignable = [])).push(node);\n      var width = dims.wrapperWidth;\n      node.style.left = dims.fixedPos + \"px\";\n      if (!widget.coverGutter) {\n        width -= dims.gutterTotalWidth;\n        node.style.paddingLeft = dims.gutterTotalWidth + \"px\";\n      }\n      node.style.width = width + \"px\";\n    }\n    if (widget.coverGutter) {\n      node.style.zIndex = 5;\n      node.style.position = \"relative\";\n      if (!widget.noHScroll) node.style.marginLeft = -dims.gutterTotalWidth + \"px\";\n    }\n  }\n\n  // POSITION OBJECT\n\n  // A Pos instance represents a position within the text.\n  var Pos = CodeMirror.Pos = function(line, ch) {\n    if (!(this instanceof Pos)) return new Pos(line, ch);\n    this.line = line; this.ch = ch;\n  };\n\n  // Compare two positions, return 0 if they are the same, a negative\n  // number when a is less, and a positive number otherwise.\n  var cmp = CodeMirror.cmpPos = function(a, b) { return a.line - b.line || a.ch - b.ch; };\n\n  function copyPos(x) {return Pos(x.line, x.ch);}\n  function maxPos(a, b) { return cmp(a, b) < 0 ? b : a; }\n  function minPos(a, b) { return cmp(a, b) < 0 ? a : b; }\n\n  // SELECTION / CURSOR\n\n  // Selection objects are immutable. A new one is created every time\n  // the selection changes. A selection is one or more non-overlapping\n  // (and non-touching) ranges, sorted, and an integer that indicates\n  // which one is the primary selection (the one that's scrolled into\n  // view, that getCursor returns, etc).\n  function Selection(ranges, primIndex) {\n    this.ranges = ranges;\n    this.primIndex = primIndex;\n  }\n\n  Selection.prototype = {\n    primary: function() { return this.ranges[this.primIndex]; },\n    equals: function(other) {\n      if (other == this) return true;\n      if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) return false;\n      for (var i = 0; i < this.ranges.length; i++) {\n        var here = this.ranges[i], there = other.ranges[i];\n        if (cmp(here.anchor, there.anchor) != 0 || cmp(here.head, there.head) != 0) return false;\n      }\n      return true;\n    },\n    deepCopy: function() {\n      for (var out = [], i = 0; i < this.ranges.length; i++)\n        out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head));\n      return new Selection(out, this.primIndex);\n    },\n    somethingSelected: function() {\n      for (var i = 0; i < this.ranges.length; i++)\n        if (!this.ranges[i].empty()) return true;\n      return false;\n    },\n    contains: function(pos, end) {\n      if (!end) end = pos;\n      for (var i = 0; i < this.ranges.length; i++) {\n        var range = this.ranges[i];\n        if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)\n          return i;\n      }\n      return -1;\n    }\n  };\n\n  function Range(anchor, head) {\n    this.anchor = anchor; this.head = head;\n  }\n\n  Range.prototype = {\n    from: function() { return minPos(this.anchor, this.head); },\n    to: function() { return maxPos(this.anchor, this.head); },\n    empty: function() {\n      return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;\n    }\n  };\n\n  // Take an unsorted, potentially overlapping set of ranges, and\n  // build a selection out of it. 'Consumes' ranges array (modifying\n  // it).\n  function normalizeSelection(ranges, primIndex) {\n    var prim = ranges[primIndex];\n    ranges.sort(function(a, b) { return cmp(a.from(), b.from()); });\n    primIndex = indexOf(ranges, prim);\n    for (var i = 1; i < ranges.length; i++) {\n      var cur = ranges[i], prev = ranges[i - 1];\n      if (cmp(prev.to(), cur.from()) >= 0) {\n        var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());\n        var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;\n        if (i <= primIndex) --primIndex;\n        ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));\n      }\n    }\n    return new Selection(ranges, primIndex);\n  }\n\n  function simpleSelection(anchor, head) {\n    return new Selection([new Range(anchor, head || anchor)], 0);\n  }\n\n  // Most of the external API clips given positions to make sure they\n  // actually exist within the document.\n  function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1));}\n  function clipPos(doc, pos) {\n    if (pos.line < doc.first) return Pos(doc.first, 0);\n    var last = doc.first + doc.size - 1;\n    if (pos.line > last) return Pos(last, getLine(doc, last).text.length);\n    return clipToLen(pos, getLine(doc, pos.line).text.length);\n  }\n  function clipToLen(pos, linelen) {\n    var ch = pos.ch;\n    if (ch == null || ch > linelen) return Pos(pos.line, linelen);\n    else if (ch < 0) return Pos(pos.line, 0);\n    else return pos;\n  }\n  function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size;}\n  function clipPosArray(doc, array) {\n    for (var out = [], i = 0; i < array.length; i++) out[i] = clipPos(doc, array[i]);\n    return out;\n  }\n\n  // SELECTION UPDATES\n\n  // The 'scroll' parameter given to many of these indicated whether\n  // the new cursor position should be scrolled into view after\n  // modifying the selection.\n\n  // If shift is held or the extend flag is set, extends a range to\n  // include a given position (and optionally a second position).\n  // Otherwise, simply returns the range between the given positions.\n  // Used for cursor motion and such.\n  function extendRange(doc, range, head, other) {\n    if (doc.cm && doc.cm.display.shift || doc.extend) {\n      var anchor = range.anchor;\n      if (other) {\n        var posBefore = cmp(head, anchor) < 0;\n        if (posBefore != (cmp(other, anchor) < 0)) {\n          anchor = head;\n          head = other;\n        } else if (posBefore != (cmp(head, other) < 0)) {\n          head = other;\n        }\n      }\n      return new Range(anchor, head);\n    } else {\n      return new Range(other || head, head);\n    }\n  }\n\n  // Extend the primary selection range, discard the rest.\n  function extendSelection(doc, head, other, options) {\n    setSelection(doc, new Selection([extendRange(doc, doc.sel.primary(), head, other)], 0), options);\n  }\n\n  // Extend all selections (pos is an array of selections with length\n  // equal the number of selections)\n  function extendSelections(doc, heads, options) {\n    for (var out = [], i = 0; i < doc.sel.ranges.length; i++)\n      out[i] = extendRange(doc, doc.sel.ranges[i], heads[i], null);\n    var newSel = normalizeSelection(out, doc.sel.primIndex);\n    setSelection(doc, newSel, options);\n  }\n\n  // Updates a single range in the selection.\n  function replaceOneSelection(doc, i, range, options) {\n    var ranges = doc.sel.ranges.slice(0);\n    ranges[i] = range;\n    setSelection(doc, normalizeSelection(ranges, doc.sel.primIndex), options);\n  }\n\n  // Reset the selection to a single range.\n  function setSimpleSelection(doc, anchor, head, options) {\n    setSelection(doc, simpleSelection(anchor, head), options);\n  }\n\n  // Give beforeSelectionChange handlers a change to influence a\n  // selection update.\n  function filterSelectionChange(doc, sel) {\n    var obj = {\n      ranges: sel.ranges,\n      update: function(ranges) {\n        this.ranges = [];\n        for (var i = 0; i < ranges.length; i++)\n          this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),\n                                     clipPos(doc, ranges[i].head));\n      }\n    };\n    signal(doc, \"beforeSelectionChange\", doc, obj);\n    if (doc.cm) signal(doc.cm, \"beforeSelectionChange\", doc.cm, obj);\n    if (obj.ranges != sel.ranges) return normalizeSelection(obj.ranges, obj.ranges.length - 1);\n    else return sel;\n  }\n\n  function setSelectionReplaceHistory(doc, sel, options) {\n    var done = doc.history.done, last = lst(done);\n    if (last && last.ranges) {\n      done[done.length - 1] = sel;\n      setSelectionNoUndo(doc, sel, options);\n    } else {\n      setSelection(doc, sel, options);\n    }\n  }\n\n  // Set a new selection.\n  function setSelection(doc, sel, options) {\n    setSelectionNoUndo(doc, sel, options);\n    addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);\n  }\n\n  function setSelectionNoUndo(doc, sel, options) {\n    if (hasHandler(doc, \"beforeSelectionChange\") || doc.cm && hasHandler(doc.cm, \"beforeSelectionChange\"))\n      sel = filterSelectionChange(doc, sel);\n\n    var bias = options && options.bias ||\n      (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);\n    setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));\n\n    if (!(options && options.scroll === false) && doc.cm)\n      ensureCursorVisible(doc.cm);\n  }\n\n  function setSelectionInner(doc, sel) {\n    if (sel.equals(doc.sel)) return;\n\n    doc.sel = sel;\n\n    if (doc.cm) {\n      doc.cm.curOp.updateInput = doc.cm.curOp.selectionChanged = true;\n      signalCursorActivity(doc.cm);\n    }\n    signalLater(doc, \"cursorActivity\", doc);\n  }\n\n  // Verify that the selection does not partially select any atomic\n  // marked ranges.\n  function reCheckSelection(doc) {\n    setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false), sel_dontScroll);\n  }\n\n  // Return a selection that does not partially select any atomic\n  // ranges.\n  function skipAtomicInSelection(doc, sel, bias, mayClear) {\n    var out;\n    for (var i = 0; i < sel.ranges.length; i++) {\n      var range = sel.ranges[i];\n      var newAnchor = skipAtomic(doc, range.anchor, bias, mayClear);\n      var newHead = skipAtomic(doc, range.head, bias, mayClear);\n      if (out || newAnchor != range.anchor || newHead != range.head) {\n        if (!out) out = sel.ranges.slice(0, i);\n        out[i] = new Range(newAnchor, newHead);\n      }\n    }\n    return out ? normalizeSelection(out, sel.primIndex) : sel;\n  }\n\n  // Ensure a given position is not inside an atomic range.\n  function skipAtomic(doc, pos, bias, mayClear) {\n    var flipped = false, curPos = pos;\n    var dir = bias || 1;\n    doc.cantEdit = false;\n    search: for (;;) {\n      var line = getLine(doc, curPos.line);\n      if (line.markedSpans) {\n        for (var i = 0; i < line.markedSpans.length; ++i) {\n          var sp = line.markedSpans[i], m = sp.marker;\n          if ((sp.from == null || (m.inclusiveLeft ? sp.from <= curPos.ch : sp.from < curPos.ch)) &&\n              (sp.to == null || (m.inclusiveRight ? sp.to >= curPos.ch : sp.to > curPos.ch))) {\n            if (mayClear) {\n              signal(m, \"beforeCursorEnter\");\n              if (m.explicitlyCleared) {\n                if (!line.markedSpans) break;\n                else {--i; continue;}\n              }\n            }\n            if (!m.atomic) continue;\n            var newPos = m.find(dir < 0 ? -1 : 1);\n            if (cmp(newPos, curPos) == 0) {\n              newPos.ch += dir;\n              if (newPos.ch < 0) {\n                if (newPos.line > doc.first) newPos = clipPos(doc, Pos(newPos.line - 1));\n                else newPos = null;\n              } else if (newPos.ch > line.text.length) {\n                if (newPos.line < doc.first + doc.size - 1) newPos = Pos(newPos.line + 1, 0);\n                else newPos = null;\n              }\n              if (!newPos) {\n                if (flipped) {\n                  // Driven in a corner -- no valid cursor position found at all\n                  // -- try again *with* clearing, if we didn't already\n                  if (!mayClear) return skipAtomic(doc, pos, bias, true);\n                  // Otherwise, turn off editing until further notice, and return the start of the doc\n                  doc.cantEdit = true;\n                  return Pos(doc.first, 0);\n                }\n                flipped = true; newPos = pos; dir = -dir;\n              }\n            }\n            curPos = newPos;\n            continue search;\n          }\n        }\n      }\n      return curPos;\n    }\n  }\n\n  // SELECTION DRAWING\n\n  // Redraw the selection and/or cursor\n  function drawSelection(cm) {\n    var display = cm.display, doc = cm.doc, result = {};\n    var curFragment = result.cursors = document.createDocumentFragment();\n    var selFragment = result.selection = document.createDocumentFragment();\n\n    for (var i = 0; i < doc.sel.ranges.length; i++) {\n      var range = doc.sel.ranges[i];\n      var collapsed = range.empty();\n      if (collapsed || cm.options.showCursorWhenSelecting)\n        drawSelectionCursor(cm, range, curFragment);\n      if (!collapsed)\n        drawSelectionRange(cm, range, selFragment);\n    }\n\n    // Move the hidden textarea near the cursor to prevent scrolling artifacts\n    if (cm.options.moveInputWithCursor) {\n      var headPos = cursorCoords(cm, doc.sel.primary().head, \"div\");\n      var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();\n      result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,\n                                          headPos.top + lineOff.top - wrapOff.top));\n      result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,\n                                           headPos.left + lineOff.left - wrapOff.left));\n    }\n\n    return result;\n  }\n\n  function showSelection(cm, drawn) {\n    removeChildrenAndAdd(cm.display.cursorDiv, drawn.cursors);\n    removeChildrenAndAdd(cm.display.selectionDiv, drawn.selection);\n    if (drawn.teTop != null) {\n      cm.display.inputDiv.style.top = drawn.teTop + \"px\";\n      cm.display.inputDiv.style.left = drawn.teLeft + \"px\";\n    }\n  }\n\n  function updateSelection(cm) {\n    showSelection(cm, drawSelection(cm));\n  }\n\n  // Draws a cursor for the given range\n  function drawSelectionCursor(cm, range, output) {\n    var pos = cursorCoords(cm, range.head, \"div\", null, null, !cm.options.singleCursorHeightPerLine);\n\n    var cursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor\"));\n    cursor.style.left = pos.left + \"px\";\n    cursor.style.top = pos.top + \"px\";\n    cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + \"px\";\n\n    if (pos.other) {\n      // Secondary cursor, shown when on a 'jump' in bi-directional text\n      var otherCursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor CodeMirror-secondarycursor\"));\n      otherCursor.style.display = \"\";\n      otherCursor.style.left = pos.other.left + \"px\";\n      otherCursor.style.top = pos.other.top + \"px\";\n      otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + \"px\";\n    }\n  }\n\n  // Draws the given range as a highlighted selection\n  function drawSelectionRange(cm, range, output) {\n    var display = cm.display, doc = cm.doc;\n    var fragment = document.createDocumentFragment();\n    var padding = paddingH(cm.display), leftSide = padding.left, rightSide = display.lineSpace.offsetWidth - padding.right;\n\n    function add(left, top, width, bottom) {\n      if (top < 0) top = 0;\n      top = Math.round(top);\n      bottom = Math.round(bottom);\n      fragment.appendChild(elt(\"div\", null, \"CodeMirror-selected\", \"position: absolute; left: \" + left +\n                               \"px; top: \" + top + \"px; width: \" + (width == null ? rightSide - left : width) +\n                               \"px; height: \" + (bottom - top) + \"px\"));\n    }\n\n    function drawForLine(line, fromArg, toArg) {\n      var lineObj = getLine(doc, line);\n      var lineLen = lineObj.text.length;\n      var start, end;\n      function coords(ch, bias) {\n        return charCoords(cm, Pos(line, ch), \"div\", lineObj, bias);\n      }\n\n      iterateBidiSections(getOrder(lineObj), fromArg || 0, toArg == null ? lineLen : toArg, function(from, to, dir) {\n        var leftPos = coords(from, \"left\"), rightPos, left, right;\n        if (from == to) {\n          rightPos = leftPos;\n          left = right = leftPos.left;\n        } else {\n          rightPos = coords(to - 1, \"right\");\n          if (dir == \"rtl\") { var tmp = leftPos; leftPos = rightPos; rightPos = tmp; }\n          left = leftPos.left;\n          right = rightPos.right;\n        }\n        if (fromArg == null && from == 0) left = leftSide;\n        if (rightPos.top - leftPos.top > 3) { // Different lines, draw top part\n          add(left, leftPos.top, null, leftPos.bottom);\n          left = leftSide;\n          if (leftPos.bottom < rightPos.top) add(left, leftPos.bottom, null, rightPos.top);\n        }\n        if (toArg == null && to == lineLen) right = rightSide;\n        if (!start || leftPos.top < start.top || leftPos.top == start.top && leftPos.left < start.left)\n          start = leftPos;\n        if (!end || rightPos.bottom > end.bottom || rightPos.bottom == end.bottom && rightPos.right > end.right)\n          end = rightPos;\n        if (left < leftSide + 1) left = leftSide;\n        add(left, rightPos.top, right - left, rightPos.bottom);\n      });\n      return {start: start, end: end};\n    }\n\n    var sFrom = range.from(), sTo = range.to();\n    if (sFrom.line == sTo.line) {\n      drawForLine(sFrom.line, sFrom.ch, sTo.ch);\n    } else {\n      var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);\n      var singleVLine = visualLine(fromLine) == visualLine(toLine);\n      var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;\n      var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;\n      if (singleVLine) {\n        if (leftEnd.top < rightStart.top - 2) {\n          add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);\n          add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);\n        } else {\n          add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);\n        }\n      }\n      if (leftEnd.bottom < rightStart.top)\n        add(leftSide, leftEnd.bottom, null, rightStart.top);\n    }\n\n    output.appendChild(fragment);\n  }\n\n  // Cursor-blinking\n  function restartBlink(cm) {\n    if (!cm.state.focused) return;\n    var display = cm.display;\n    clearInterval(display.blinker);\n    var on = true;\n    display.cursorDiv.style.visibility = \"\";\n    if (cm.options.cursorBlinkRate > 0)\n      display.blinker = setInterval(function() {\n        display.cursorDiv.style.visibility = (on = !on) ? \"\" : \"hidden\";\n      }, cm.options.cursorBlinkRate);\n    else if (cm.options.cursorBlinkRate < 0)\n      display.cursorDiv.style.visibility = \"hidden\";\n  }\n\n  // HIGHLIGHT WORKER\n\n  function startWorker(cm, time) {\n    if (cm.doc.mode.startState && cm.doc.frontier < cm.display.viewTo)\n      cm.state.highlight.set(time, bind(highlightWorker, cm));\n  }\n\n  function highlightWorker(cm) {\n    var doc = cm.doc;\n    if (doc.frontier < doc.first) doc.frontier = doc.first;\n    if (doc.frontier >= cm.display.viewTo) return;\n    var end = +new Date + cm.options.workTime;\n    var state = copyState(doc.mode, getStateBefore(cm, doc.frontier));\n    var changedLines = [];\n\n    doc.iter(doc.frontier, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function(line) {\n      if (doc.frontier >= cm.display.viewFrom) { // Visible\n        var oldStyles = line.styles;\n        var highlighted = highlightLine(cm, line, state, true);\n        line.styles = highlighted.styles;\n        var oldCls = line.styleClasses, newCls = highlighted.classes;\n        if (newCls) line.styleClasses = newCls;\n        else if (oldCls) line.styleClasses = null;\n        var ischange = !oldStyles || oldStyles.length != line.styles.length ||\n          oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);\n        for (var i = 0; !ischange && i < oldStyles.length; ++i) ischange = oldStyles[i] != line.styles[i];\n        if (ischange) changedLines.push(doc.frontier);\n        line.stateAfter = copyState(doc.mode, state);\n      } else {\n        processLine(cm, line.text, state);\n        line.stateAfter = doc.frontier % 5 == 0 ? copyState(doc.mode, state) : null;\n      }\n      ++doc.frontier;\n      if (+new Date > end) {\n        startWorker(cm, cm.options.workDelay);\n        return true;\n      }\n    });\n    if (changedLines.length) runInOp(cm, function() {\n      for (var i = 0; i < changedLines.length; i++)\n        regLineChange(cm, changedLines[i], \"text\");\n    });\n  }\n\n  // Finds the line to start with when starting a parse. Tries to\n  // find a line with a stateAfter, so that it can start with a\n  // valid state. If that fails, it returns the line with the\n  // smallest indentation, which tends to need the least context to\n  // parse correctly.\n  function findStartLine(cm, n, precise) {\n    var minindent, minline, doc = cm.doc;\n    var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);\n    for (var search = n; search > lim; --search) {\n      if (search <= doc.first) return doc.first;\n      var line = getLine(doc, search - 1);\n      if (line.stateAfter && (!precise || search <= doc.frontier)) return search;\n      var indented = countColumn(line.text, null, cm.options.tabSize);\n      if (minline == null || minindent > indented) {\n        minline = search - 1;\n        minindent = indented;\n      }\n    }\n    return minline;\n  }\n\n  function getStateBefore(cm, n, precise) {\n    var doc = cm.doc, display = cm.display;\n    if (!doc.mode.startState) return true;\n    var pos = findStartLine(cm, n, precise), state = pos > doc.first && getLine(doc, pos-1).stateAfter;\n    if (!state) state = startState(doc.mode);\n    else state = copyState(doc.mode, state);\n    doc.iter(pos, n, function(line) {\n      processLine(cm, line.text, state);\n      var save = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo;\n      line.stateAfter = save ? copyState(doc.mode, state) : null;\n      ++pos;\n    });\n    if (precise) doc.frontier = pos;\n    return state;\n  }\n\n  // POSITION MEASUREMENT\n\n  function paddingTop(display) {return display.lineSpace.offsetTop;}\n  function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight;}\n  function paddingH(display) {\n    if (display.cachedPaddingH) return display.cachedPaddingH;\n    var e = removeChildrenAndAdd(display.measure, elt(\"pre\", \"x\"));\n    var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;\n    var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};\n    if (!isNaN(data.left) && !isNaN(data.right)) display.cachedPaddingH = data;\n    return data;\n  }\n\n  // Ensure the lineView.wrapping.heights array is populated. This is\n  // an array of bottom offsets for the lines that make up a drawn\n  // line. When lineWrapping is on, there might be more than one\n  // height.\n  function ensureLineHeights(cm, lineView, rect) {\n    var wrapping = cm.options.lineWrapping;\n    var curWidth = wrapping && cm.display.scroller.clientWidth;\n    if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {\n      var heights = lineView.measure.heights = [];\n      if (wrapping) {\n        lineView.measure.width = curWidth;\n        var rects = lineView.text.firstChild.getClientRects();\n        for (var i = 0; i < rects.length - 1; i++) {\n          var cur = rects[i], next = rects[i + 1];\n          if (Math.abs(cur.bottom - next.bottom) > 2)\n            heights.push((cur.bottom + next.top) / 2 - rect.top);\n        }\n      }\n      heights.push(rect.bottom - rect.top);\n    }\n  }\n\n  // Find a line map (mapping character offsets to text nodes) and a\n  // measurement cache for the given line number. (A line view might\n  // contain multiple lines when collapsed ranges are present.)\n  function mapFromLineView(lineView, line, lineN) {\n    if (lineView.line == line)\n      return {map: lineView.measure.map, cache: lineView.measure.cache};\n    for (var i = 0; i < lineView.rest.length; i++)\n      if (lineView.rest[i] == line)\n        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]};\n    for (var i = 0; i < lineView.rest.length; i++)\n      if (lineNo(lineView.rest[i]) > lineN)\n        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i], before: true};\n  }\n\n  // Render a line into the hidden node display.externalMeasured. Used\n  // when measurement is needed for a line that's not in the viewport.\n  function updateExternalMeasurement(cm, line) {\n    line = visualLine(line);\n    var lineN = lineNo(line);\n    var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);\n    view.lineN = lineN;\n    var built = view.built = buildLineContent(cm, view);\n    view.text = built.pre;\n    removeChildrenAndAdd(cm.display.lineMeasure, built.pre);\n    return view;\n  }\n\n  // Get a {top, bottom, left, right} box (in line-local coordinates)\n  // for a given character.\n  function measureChar(cm, line, ch, bias) {\n    return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias);\n  }\n\n  // Find a line view that corresponds to the given line number.\n  function findViewForLine(cm, lineN) {\n    if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)\n      return cm.display.view[findViewIndex(cm, lineN)];\n    var ext = cm.display.externalMeasured;\n    if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)\n      return ext;\n  }\n\n  // Measurement can be split in two steps, the set-up work that\n  // applies to the whole line, and the measurement of the actual\n  // character. Functions like coordsChar, that need to do a lot of\n  // measurements in a row, can thus ensure that the set-up work is\n  // only done once.\n  function prepareMeasureForLine(cm, line) {\n    var lineN = lineNo(line);\n    var view = findViewForLine(cm, lineN);\n    if (view && !view.text)\n      view = null;\n    else if (view && view.changes)\n      updateLineForChanges(cm, view, lineN, getDimensions(cm));\n    if (!view)\n      view = updateExternalMeasurement(cm, line);\n\n    var info = mapFromLineView(view, line, lineN);\n    return {\n      line: line, view: view, rect: null,\n      map: info.map, cache: info.cache, before: info.before,\n      hasHeights: false\n    };\n  }\n\n  // Given a prepared measurement object, measures the position of an\n  // actual character (or fetches it from the cache).\n  function measureCharPrepared(cm, prepared, ch, bias, varHeight) {\n    if (prepared.before) ch = -1;\n    var key = ch + (bias || \"\"), found;\n    if (prepared.cache.hasOwnProperty(key)) {\n      found = prepared.cache[key];\n    } else {\n      if (!prepared.rect)\n        prepared.rect = prepared.view.text.getBoundingClientRect();\n      if (!prepared.hasHeights) {\n        ensureLineHeights(cm, prepared.view, prepared.rect);\n        prepared.hasHeights = true;\n      }\n      found = measureCharInner(cm, prepared, ch, bias);\n      if (!found.bogus) prepared.cache[key] = found;\n    }\n    return {left: found.left, right: found.right,\n            top: varHeight ? found.rtop : found.top,\n            bottom: varHeight ? found.rbottom : found.bottom};\n  }\n\n  var nullRect = {left: 0, right: 0, top: 0, bottom: 0};\n\n  function measureCharInner(cm, prepared, ch, bias) {\n    var map = prepared.map;\n\n    var node, start, end, collapse;\n    // First, search the line map for the text node corresponding to,\n    // or closest to, the target character.\n    for (var i = 0; i < map.length; i += 3) {\n      var mStart = map[i], mEnd = map[i + 1];\n      if (ch < mStart) {\n        start = 0; end = 1;\n        collapse = \"left\";\n      } else if (ch < mEnd) {\n        start = ch - mStart;\n        end = start + 1;\n      } else if (i == map.length - 3 || ch == mEnd && map[i + 3] > ch) {\n        end = mEnd - mStart;\n        start = end - 1;\n        if (ch >= mEnd) collapse = \"right\";\n      }\n      if (start != null) {\n        node = map[i + 2];\n        if (mStart == mEnd && bias == (node.insertLeft ? \"left\" : \"right\"))\n          collapse = bias;\n        if (bias == \"left\" && start == 0)\n          while (i && map[i - 2] == map[i - 3] && map[i - 1].insertLeft) {\n            node = map[(i -= 3) + 2];\n            collapse = \"left\";\n          }\n        if (bias == \"right\" && start == mEnd - mStart)\n          while (i < map.length - 3 && map[i + 3] == map[i + 4] && !map[i + 5].insertLeft) {\n            node = map[(i += 3) + 2];\n            collapse = \"right\";\n          }\n        break;\n      }\n    }\n\n    var rect;\n    if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.\n      for (var i = 0; i < 4; i++) { // Retry a maximum of 4 times when nonsense rectangles are returned\n        while (start && isExtendingChar(prepared.line.text.charAt(mStart + start))) --start;\n        while (mStart + end < mEnd && isExtendingChar(prepared.line.text.charAt(mStart + end))) ++end;\n        if (ie && ie_version < 9 && start == 0 && end == mEnd - mStart) {\n          rect = node.parentNode.getBoundingClientRect();\n        } else if (ie && cm.options.lineWrapping) {\n          var rects = range(node, start, end).getClientRects();\n          if (rects.length)\n            rect = rects[bias == \"right\" ? rects.length - 1 : 0];\n          else\n            rect = nullRect;\n        } else {\n          rect = range(node, start, end).getBoundingClientRect() || nullRect;\n        }\n        if (rect.left || rect.right || start == 0) break;\n        end = start;\n        start = start - 1;\n        collapse = \"right\";\n      }\n      if (ie && ie_version < 11) rect = maybeUpdateRectForZooming(cm.display.measure, rect);\n    } else { // If it is a widget, simply get the box for the whole widget.\n      if (start > 0) collapse = bias = \"right\";\n      var rects;\n      if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)\n        rect = rects[bias == \"right\" ? rects.length - 1 : 0];\n      else\n        rect = node.getBoundingClientRect();\n    }\n    if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {\n      var rSpan = node.parentNode.getClientRects()[0];\n      if (rSpan)\n        rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom};\n      else\n        rect = nullRect;\n    }\n\n    var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;\n    var mid = (rtop + rbot) / 2;\n    var heights = prepared.view.measure.heights;\n    for (var i = 0; i < heights.length - 1; i++)\n      if (mid < heights[i]) break;\n    var top = i ? heights[i - 1] : 0, bot = heights[i];\n    var result = {left: (collapse == \"right\" ? rect.right : rect.left) - prepared.rect.left,\n                  right: (collapse == \"left\" ? rect.left : rect.right) - prepared.rect.left,\n                  top: top, bottom: bot};\n    if (!rect.left && !rect.right) result.bogus = true;\n    if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }\n\n    return result;\n  }\n\n  // Work around problem with bounding client rects on ranges being\n  // returned incorrectly when zoomed on IE10 and below.\n  function maybeUpdateRectForZooming(measure, rect) {\n    if (!window.screen || screen.logicalXDPI == null ||\n        screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))\n      return rect;\n    var scaleX = screen.logicalXDPI / screen.deviceXDPI;\n    var scaleY = screen.logicalYDPI / screen.deviceYDPI;\n    return {left: rect.left * scaleX, right: rect.right * scaleX,\n            top: rect.top * scaleY, bottom: rect.bottom * scaleY};\n  }\n\n  function clearLineMeasurementCacheFor(lineView) {\n    if (lineView.measure) {\n      lineView.measure.cache = {};\n      lineView.measure.heights = null;\n      if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)\n        lineView.measure.caches[i] = {};\n    }\n  }\n\n  function clearLineMeasurementCache(cm) {\n    cm.display.externalMeasure = null;\n    removeChildren(cm.display.lineMeasure);\n    for (var i = 0; i < cm.display.view.length; i++)\n      clearLineMeasurementCacheFor(cm.display.view[i]);\n  }\n\n  function clearCaches(cm) {\n    clearLineMeasurementCache(cm);\n    cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;\n    if (!cm.options.lineWrapping) cm.display.maxLineChanged = true;\n    cm.display.lineNumChars = null;\n  }\n\n  function pageScrollX() { return window.pageXOffset || (document.documentElement || document.body).scrollLeft; }\n  function pageScrollY() { return window.pageYOffset || (document.documentElement || document.body).scrollTop; }\n\n  // Converts a {top, bottom, left, right} box from line-local\n  // coordinates into another coordinate system. Context may be one of\n  // \"line\", \"div\" (display.lineDiv), \"local\"/null (editor), or \"page\".\n  function intoCoordSystem(cm, lineObj, rect, context) {\n    if (lineObj.widgets) for (var i = 0; i < lineObj.widgets.length; ++i) if (lineObj.widgets[i].above) {\n      var size = widgetHeight(lineObj.widgets[i]);\n      rect.top += size; rect.bottom += size;\n    }\n    if (context == \"line\") return rect;\n    if (!context) context = \"local\";\n    var yOff = heightAtLine(lineObj);\n    if (context == \"local\") yOff += paddingTop(cm.display);\n    else yOff -= cm.display.viewOffset;\n    if (context == \"page\" || context == \"window\") {\n      var lOff = cm.display.lineSpace.getBoundingClientRect();\n      yOff += lOff.top + (context == \"window\" ? 0 : pageScrollY());\n      var xOff = lOff.left + (context == \"window\" ? 0 : pageScrollX());\n      rect.left += xOff; rect.right += xOff;\n    }\n    rect.top += yOff; rect.bottom += yOff;\n    return rect;\n  }\n\n  // Coverts a box from \"div\" coords to another coordinate system.\n  // Context may be \"window\", \"page\", \"div\", or \"local\"/null.\n  function fromCoordSystem(cm, coords, context) {\n    if (context == \"div\") return coords;\n    var left = coords.left, top = coords.top;\n    // First move into \"page\" coordinate system\n    if (context == \"page\") {\n      left -= pageScrollX();\n      top -= pageScrollY();\n    } else if (context == \"local\" || !context) {\n      var localBox = cm.display.sizer.getBoundingClientRect();\n      left += localBox.left;\n      top += localBox.top;\n    }\n\n    var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();\n    return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top};\n  }\n\n  function charCoords(cm, pos, context, lineObj, bias) {\n    if (!lineObj) lineObj = getLine(cm.doc, pos.line);\n    return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context);\n  }\n\n  // Returns a box for a given cursor position, which may have an\n  // 'other' property containing the position of the secondary cursor\n  // on a bidi boundary.\n  function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {\n    lineObj = lineObj || getLine(cm.doc, pos.line);\n    if (!preparedMeasure) preparedMeasure = prepareMeasureForLine(cm, lineObj);\n    function get(ch, right) {\n      var m = measureCharPrepared(cm, preparedMeasure, ch, right ? \"right\" : \"left\", varHeight);\n      if (right) m.left = m.right; else m.right = m.left;\n      return intoCoordSystem(cm, lineObj, m, context);\n    }\n    function getBidi(ch, partPos) {\n      var part = order[partPos], right = part.level % 2;\n      if (ch == bidiLeft(part) && partPos && part.level < order[partPos - 1].level) {\n        part = order[--partPos];\n        ch = bidiRight(part) - (part.level % 2 ? 0 : 1);\n        right = true;\n      } else if (ch == bidiRight(part) && partPos < order.length - 1 && part.level < order[partPos + 1].level) {\n        part = order[++partPos];\n        ch = bidiLeft(part) - part.level % 2;\n        right = false;\n      }\n      if (right && ch == part.to && ch > part.from) return get(ch - 1);\n      return get(ch, right);\n    }\n    var order = getOrder(lineObj), ch = pos.ch;\n    if (!order) return get(ch);\n    var partPos = getBidiPartAt(order, ch);\n    var val = getBidi(ch, partPos);\n    if (bidiOther != null) val.other = getBidi(ch, bidiOther);\n    return val;\n  }\n\n  // Used to cheaply estimate the coordinates for a position. Used for\n  // intermediate scroll updates.\n  function estimateCoords(cm, pos) {\n    var left = 0, pos = clipPos(cm.doc, pos);\n    if (!cm.options.lineWrapping) left = charWidth(cm.display) * pos.ch;\n    var lineObj = getLine(cm.doc, pos.line);\n    var top = heightAtLine(lineObj) + paddingTop(cm.display);\n    return {left: left, right: left, top: top, bottom: top + lineObj.height};\n  }\n\n  // Positions returned by coordsChar contain some extra information.\n  // xRel is the relative x position of the input coordinates compared\n  // to the found position (so xRel > 0 means the coordinates are to\n  // the right of the character position, for example). When outside\n  // is true, that means the coordinates lie outside the line's\n  // vertical range.\n  function PosWithInfo(line, ch, outside, xRel) {\n    var pos = Pos(line, ch);\n    pos.xRel = xRel;\n    if (outside) pos.outside = true;\n    return pos;\n  }\n\n  // Compute the character position closest to the given coordinates.\n  // Input must be lineSpace-local (\"div\" coordinate system).\n  function coordsChar(cm, x, y) {\n    var doc = cm.doc;\n    y += cm.display.viewOffset;\n    if (y < 0) return PosWithInfo(doc.first, 0, true, -1);\n    var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;\n    if (lineN > last)\n      return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, true, 1);\n    if (x < 0) x = 0;\n\n    var lineObj = getLine(doc, lineN);\n    for (;;) {\n      var found = coordsCharInner(cm, lineObj, lineN, x, y);\n      var merged = collapsedSpanAtEnd(lineObj);\n      var mergedPos = merged && merged.find(0, true);\n      if (merged && (found.ch > mergedPos.from.ch || found.ch == mergedPos.from.ch && found.xRel > 0))\n        lineN = lineNo(lineObj = mergedPos.to.line);\n      else\n        return found;\n    }\n  }\n\n  function coordsCharInner(cm, lineObj, lineNo, x, y) {\n    var innerOff = y - heightAtLine(lineObj);\n    var wrongLine = false, adjust = 2 * cm.display.wrapper.clientWidth;\n    var preparedMeasure = prepareMeasureForLine(cm, lineObj);\n\n    function getX(ch) {\n      var sp = cursorCoords(cm, Pos(lineNo, ch), \"line\", lineObj, preparedMeasure);\n      wrongLine = true;\n      if (innerOff > sp.bottom) return sp.left - adjust;\n      else if (innerOff < sp.top) return sp.left + adjust;\n      else wrongLine = false;\n      return sp.left;\n    }\n\n    var bidi = getOrder(lineObj), dist = lineObj.text.length;\n    var from = lineLeft(lineObj), to = lineRight(lineObj);\n    var fromX = getX(from), fromOutside = wrongLine, toX = getX(to), toOutside = wrongLine;\n\n    if (x > toX) return PosWithInfo(lineNo, to, toOutside, 1);\n    // Do a binary search between these bounds.\n    for (;;) {\n      if (bidi ? to == from || to == moveVisually(lineObj, from, 1) : to - from <= 1) {\n        var ch = x < fromX || x - fromX <= toX - x ? from : to;\n        var xDiff = x - (ch == from ? fromX : toX);\n        while (isExtendingChar(lineObj.text.charAt(ch))) ++ch;\n        var pos = PosWithInfo(lineNo, ch, ch == from ? fromOutside : toOutside,\n                              xDiff < -1 ? -1 : xDiff > 1 ? 1 : 0);\n        return pos;\n      }\n      var step = Math.ceil(dist / 2), middle = from + step;\n      if (bidi) {\n        middle = from;\n        for (var i = 0; i < step; ++i) middle = moveVisually(lineObj, middle, 1);\n      }\n      var middleX = getX(middle);\n      if (middleX > x) {to = middle; toX = middleX; if (toOutside = wrongLine) toX += 1000; dist = step;}\n      else {from = middle; fromX = middleX; fromOutside = wrongLine; dist -= step;}\n    }\n  }\n\n  var measureText;\n  // Compute the default text height.\n  function textHeight(display) {\n    if (display.cachedTextHeight != null) return display.cachedTextHeight;\n    if (measureText == null) {\n      measureText = elt(\"pre\");\n      // Measure a bunch of lines, for browsers that compute\n      // fractional heights.\n      for (var i = 0; i < 49; ++i) {\n        measureText.appendChild(document.createTextNode(\"x\"));\n        measureText.appendChild(elt(\"br\"));\n      }\n      measureText.appendChild(document.createTextNode(\"x\"));\n    }\n    removeChildrenAndAdd(display.measure, measureText);\n    var height = measureText.offsetHeight / 50;\n    if (height > 3) display.cachedTextHeight = height;\n    removeChildren(display.measure);\n    return height || 1;\n  }\n\n  // Compute the default character width.\n  function charWidth(display) {\n    if (display.cachedCharWidth != null) return display.cachedCharWidth;\n    var anchor = elt(\"span\", \"xxxxxxxxxx\");\n    var pre = elt(\"pre\", [anchor]);\n    removeChildrenAndAdd(display.measure, pre);\n    var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;\n    if (width > 2) display.cachedCharWidth = width;\n    return width || 10;\n  }\n\n  // OPERATIONS\n\n  // Operations are used to wrap a series of changes to the editor\n  // state in such a way that each change won't have to update the\n  // cursor and display (which would be awkward, slow, and\n  // error-prone). Instead, display updates are batched and then all\n  // combined and executed at once.\n\n  var operationGroup = null;\n\n  var nextOpId = 0;\n  // Start a new operation.\n  function startOperation(cm) {\n    cm.curOp = {\n      cm: cm,\n      viewChanged: false,      // Flag that indicates that lines might need to be redrawn\n      startHeight: cm.doc.height, // Used to detect need to update scrollbar\n      forceUpdate: false,      // Used to force a redraw\n      updateInput: null,       // Whether to reset the input textarea\n      typing: false,           // Whether this reset should be careful to leave existing text (for compositing)\n      changeObjs: null,        // Accumulated changes, for firing change events\n      cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on\n      cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already\n      selectionChanged: false, // Whether the selection needs to be redrawn\n      updateMaxLine: false,    // Set when the widest line needs to be determined anew\n      scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet\n      scrollToPos: null,       // Used to scroll to a specific position\n      id: ++nextOpId           // Unique ID\n    };\n    if (operationGroup) {\n      operationGroup.ops.push(cm.curOp);\n    } else {\n      cm.curOp.ownsGroup = operationGroup = {\n        ops: [cm.curOp],\n        delayedCallbacks: []\n      };\n    }\n  }\n\n  function fireCallbacksForOps(group) {\n    // Calls delayed callbacks and cursorActivity handlers until no\n    // new ones appear\n    var callbacks = group.delayedCallbacks, i = 0;\n    do {\n      for (; i < callbacks.length; i++)\n        callbacks[i]();\n      for (var j = 0; j < group.ops.length; j++) {\n        var op = group.ops[j];\n        if (op.cursorActivityHandlers)\n          while (op.cursorActivityCalled < op.cursorActivityHandlers.length)\n            op.cursorActivityHandlers[op.cursorActivityCalled++](op.cm);\n      }\n    } while (i < callbacks.length);\n  }\n\n  // Finish an operation, updating the display and signalling delayed events\n  function endOperation(cm) {\n    var op = cm.curOp, group = op.ownsGroup;\n    if (!group) return;\n\n    try { fireCallbacksForOps(group); }\n    finally {\n      operationGroup = null;\n      for (var i = 0; i < group.ops.length; i++)\n        group.ops[i].cm.curOp = null;\n      endOperations(group);\n    }\n  }\n\n  // The DOM updates done when an operation finishes are batched so\n  // that the minimum number of relayouts are required.\n  function endOperations(group) {\n    var ops = group.ops;\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_R1(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)\n      endOperation_W1(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_R2(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)\n      endOperation_W2(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_finish(ops[i]);\n  }\n\n  function endOperation_R1(op) {\n    var cm = op.cm, display = cm.display;\n    if (op.updateMaxLine) findMaxLine(cm);\n\n    op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||\n      op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||\n                         op.scrollToPos.to.line >= display.viewTo) ||\n      display.maxLineChanged && cm.options.lineWrapping;\n    op.update = op.mustUpdate &&\n      new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);\n  }\n\n  function endOperation_W1(op) {\n    op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);\n  }\n\n  function endOperation_R2(op) {\n    var cm = op.cm, display = cm.display;\n    if (op.updatedDisplay) updateHeightsInViewport(cm);\n\n    op.barMeasure = measureForScrollbars(cm);\n\n    // If the max line changed since it was last measured, measure it,\n    // and ensure the document's width matches it.\n    // updateDisplay_W2 will use these properties to do the actual resizing\n    if (display.maxLineChanged && !cm.options.lineWrapping) {\n      op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;\n      op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo +\n                                  scrollerCutOff - display.scroller.clientWidth);\n    }\n\n    if (op.updatedDisplay || op.selectionChanged)\n      op.newSelectionNodes = drawSelection(cm);\n  }\n\n  function endOperation_W2(op) {\n    var cm = op.cm;\n\n    if (op.adjustWidthTo != null) {\n      cm.display.sizer.style.minWidth = op.adjustWidthTo + \"px\";\n      if (op.maxScrollLeft < cm.doc.scrollLeft)\n        setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true);\n      cm.display.maxLineChanged = false;\n    }\n\n    if (op.newSelectionNodes)\n      showSelection(cm, op.newSelectionNodes);\n    if (op.updatedDisplay)\n      setDocumentHeight(cm, op.barMeasure);\n    if (op.updatedDisplay || op.startHeight != cm.doc.height)\n      updateScrollbars(cm, op.barMeasure);\n\n    if (op.selectionChanged) restartBlink(cm);\n\n    if (cm.state.focused && op.updateInput)\n      resetInput(cm, op.typing);\n  }\n\n  function endOperation_finish(op) {\n    var cm = op.cm, display = cm.display, doc = cm.doc;\n\n    if (op.adjustWidthTo != null && Math.abs(op.barMeasure.scrollWidth - cm.display.scroller.scrollWidth) > 1)\n      updateScrollbars(cm);\n\n    if (op.updatedDisplay) postUpdateDisplay(cm, op.update);\n\n    // Abort mouse wheel delta measurement, when scrolling explicitly\n    if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))\n      display.wheelStartX = display.wheelStartY = null;\n\n    // Propagate the scroll position to the actual DOM scroller\n    if (op.scrollTop != null && (display.scroller.scrollTop != op.scrollTop || op.forceScroll)) {\n      var top = Math.max(0, Math.min(display.scroller.scrollHeight - display.scroller.clientHeight, op.scrollTop));\n      display.scroller.scrollTop = display.scrollbarV.scrollTop = doc.scrollTop = top;\n    }\n    if (op.scrollLeft != null && (display.scroller.scrollLeft != op.scrollLeft || op.forceScroll)) {\n      var left = Math.max(0, Math.min(display.scroller.scrollWidth - display.scroller.clientWidth, op.scrollLeft));\n      display.scroller.scrollLeft = display.scrollbarH.scrollLeft = doc.scrollLeft = left;\n      alignHorizontally(cm);\n    }\n    // If we need to scroll a specific position into view, do so.\n    if (op.scrollToPos) {\n      var coords = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),\n                                     clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);\n      if (op.scrollToPos.isCursor && cm.state.focused) maybeScrollWindow(cm, coords);\n    }\n\n    // Fire events for markers that are hidden/unidden by editing or\n    // undoing\n    var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;\n    if (hidden) for (var i = 0; i < hidden.length; ++i)\n      if (!hidden[i].lines.length) signal(hidden[i], \"hide\");\n    if (unhidden) for (var i = 0; i < unhidden.length; ++i)\n      if (unhidden[i].lines.length) signal(unhidden[i], \"unhide\");\n\n    if (display.wrapper.offsetHeight)\n      doc.scrollTop = cm.display.scroller.scrollTop;\n\n    // Apply workaround for two webkit bugs\n    if (op.updatedDisplay && webkit) {\n      if (cm.options.lineWrapping)\n        checkForWebkitWidthBug(cm, op.barMeasure); // (Issue #2420)\n      if (op.barMeasure.scrollWidth > op.barMeasure.clientWidth &&\n          op.barMeasure.scrollWidth < op.barMeasure.clientWidth + 1 &&\n          !hScrollbarTakesSpace(cm))\n        updateScrollbars(cm); // (Issue #2562)\n    }\n\n    // Fire change events, and delayed event handlers\n    if (op.changeObjs)\n      signal(cm, \"changes\", cm, op.changeObjs);\n  }\n\n  // Run the given function in an operation\n  function runInOp(cm, f) {\n    if (cm.curOp) return f();\n    startOperation(cm);\n    try { return f(); }\n    finally { endOperation(cm); }\n  }\n  // Wraps a function in an operation. Returns the wrapped function.\n  function operation(cm, f) {\n    return function() {\n      if (cm.curOp) return f.apply(cm, arguments);\n      startOperation(cm);\n      try { return f.apply(cm, arguments); }\n      finally { endOperation(cm); }\n    };\n  }\n  // Used to add methods to editor and doc instances, wrapping them in\n  // operations.\n  function methodOp(f) {\n    return function() {\n      if (this.curOp) return f.apply(this, arguments);\n      startOperation(this);\n      try { return f.apply(this, arguments); }\n      finally { endOperation(this); }\n    };\n  }\n  function docMethodOp(f) {\n    return function() {\n      var cm = this.cm;\n      if (!cm || cm.curOp) return f.apply(this, arguments);\n      startOperation(cm);\n      try { return f.apply(this, arguments); }\n      finally { endOperation(cm); }\n    };\n  }\n\n  // VIEW TRACKING\n\n  // These objects are used to represent the visible (currently drawn)\n  // part of the document. A LineView may correspond to multiple\n  // logical lines, if those are connected by collapsed ranges.\n  function LineView(doc, line, lineN) {\n    // The starting line\n    this.line = line;\n    // Continuing lines, if any\n    this.rest = visualLineContinued(line);\n    // Number of logical lines in this visual line\n    this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;\n    this.node = this.text = null;\n    this.hidden = lineIsHidden(doc, line);\n  }\n\n  // Create a range of LineView objects for the given lines.\n  function buildViewArray(cm, from, to) {\n    var array = [], nextPos;\n    for (var pos = from; pos < to; pos = nextPos) {\n      var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);\n      nextPos = pos + view.size;\n      array.push(view);\n    }\n    return array;\n  }\n\n  // Updates the display.view data structure for a given change to the\n  // document. From and to are in pre-change coordinates. Lendiff is\n  // the amount of lines added or subtracted by the change. This is\n  // used for changes that span multiple lines, or change the way\n  // lines are divided into visual lines. regLineChange (below)\n  // registers single-line changes.\n  function regChange(cm, from, to, lendiff) {\n    if (from == null) from = cm.doc.first;\n    if (to == null) to = cm.doc.first + cm.doc.size;\n    if (!lendiff) lendiff = 0;\n\n    var display = cm.display;\n    if (lendiff && to < display.viewTo &&\n        (display.updateLineNumbers == null || display.updateLineNumbers > from))\n      display.updateLineNumbers = from;\n\n    cm.curOp.viewChanged = true;\n\n    if (from >= display.viewTo) { // Change after\n      if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)\n        resetView(cm);\n    } else if (to <= display.viewFrom) { // Change before\n      if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {\n        resetView(cm);\n      } else {\n        display.viewFrom += lendiff;\n        display.viewTo += lendiff;\n      }\n    } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap\n      resetView(cm);\n    } else if (from <= display.viewFrom) { // Top overlap\n      var cut = viewCuttingPoint(cm, to, to + lendiff, 1);\n      if (cut) {\n        display.view = display.view.slice(cut.index);\n        display.viewFrom = cut.lineN;\n        display.viewTo += lendiff;\n      } else {\n        resetView(cm);\n      }\n    } else if (to >= display.viewTo) { // Bottom overlap\n      var cut = viewCuttingPoint(cm, from, from, -1);\n      if (cut) {\n        display.view = display.view.slice(0, cut.index);\n        display.viewTo = cut.lineN;\n      } else {\n        resetView(cm);\n      }\n    } else { // Gap in the middle\n      var cutTop = viewCuttingPoint(cm, from, from, -1);\n      var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);\n      if (cutTop && cutBot) {\n        display.view = display.view.slice(0, cutTop.index)\n          .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))\n          .concat(display.view.slice(cutBot.index));\n        display.viewTo += lendiff;\n      } else {\n        resetView(cm);\n      }\n    }\n\n    var ext = display.externalMeasured;\n    if (ext) {\n      if (to < ext.lineN)\n        ext.lineN += lendiff;\n      else if (from < ext.lineN + ext.size)\n        display.externalMeasured = null;\n    }\n  }\n\n  // Register a change to a single line. Type must be one of \"text\",\n  // \"gutter\", \"class\", \"widget\"\n  function regLineChange(cm, line, type) {\n    cm.curOp.viewChanged = true;\n    var display = cm.display, ext = cm.display.externalMeasured;\n    if (ext && line >= ext.lineN && line < ext.lineN + ext.size)\n      display.externalMeasured = null;\n\n    if (line < display.viewFrom || line >= display.viewTo) return;\n    var lineView = display.view[findViewIndex(cm, line)];\n    if (lineView.node == null) return;\n    var arr = lineView.changes || (lineView.changes = []);\n    if (indexOf(arr, type) == -1) arr.push(type);\n  }\n\n  // Clear the view.\n  function resetView(cm) {\n    cm.display.viewFrom = cm.display.viewTo = cm.doc.first;\n    cm.display.view = [];\n    cm.display.viewOffset = 0;\n  }\n\n  // Find the view element corresponding to a given line. Return null\n  // when the line isn't visible.\n  function findViewIndex(cm, n) {\n    if (n >= cm.display.viewTo) return null;\n    n -= cm.display.viewFrom;\n    if (n < 0) return null;\n    var view = cm.display.view;\n    for (var i = 0; i < view.length; i++) {\n      n -= view[i].size;\n      if (n < 0) return i;\n    }\n  }\n\n  function viewCuttingPoint(cm, oldN, newN, dir) {\n    var index = findViewIndex(cm, oldN), diff, view = cm.display.view;\n    if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)\n      return {index: index, lineN: newN};\n    for (var i = 0, n = cm.display.viewFrom; i < index; i++)\n      n += view[i].size;\n    if (n != oldN) {\n      if (dir > 0) {\n        if (index == view.length - 1) return null;\n        diff = (n + view[index].size) - oldN;\n        index++;\n      } else {\n        diff = n - oldN;\n      }\n      oldN += diff; newN += diff;\n    }\n    while (visualLineNo(cm.doc, newN) != newN) {\n      if (index == (dir < 0 ? 0 : view.length - 1)) return null;\n      newN += dir * view[index - (dir < 0 ? 1 : 0)].size;\n      index += dir;\n    }\n    return {index: index, lineN: newN};\n  }\n\n  // Force the view to cover a given range, adding empty view element\n  // or clipping off existing ones as needed.\n  function adjustView(cm, from, to) {\n    var display = cm.display, view = display.view;\n    if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {\n      display.view = buildViewArray(cm, from, to);\n      display.viewFrom = from;\n    } else {\n      if (display.viewFrom > from)\n        display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view);\n      else if (display.viewFrom < from)\n        display.view = display.view.slice(findViewIndex(cm, from));\n      display.viewFrom = from;\n      if (display.viewTo < to)\n        display.view = display.view.concat(buildViewArray(cm, display.viewTo, to));\n      else if (display.viewTo > to)\n        display.view = display.view.slice(0, findViewIndex(cm, to));\n    }\n    display.viewTo = to;\n  }\n\n  // Count the number of lines in the view whose DOM representation is\n  // out of date (or nonexistent).\n  function countDirtyView(cm) {\n    var view = cm.display.view, dirty = 0;\n    for (var i = 0; i < view.length; i++) {\n      var lineView = view[i];\n      if (!lineView.hidden && (!lineView.node || lineView.changes)) ++dirty;\n    }\n    return dirty;\n  }\n\n  // INPUT HANDLING\n\n  // Poll for input changes, using the normal rate of polling. This\n  // runs as long as the editor is focused.\n  function slowPoll(cm) {\n    if (cm.display.pollingFast) return;\n    cm.display.poll.set(cm.options.pollInterval, function() {\n      readInput(cm);\n      if (cm.state.focused) slowPoll(cm);\n    });\n  }\n\n  // When an event has just come in that is likely to add or change\n  // something in the input textarea, we poll faster, to ensure that\n  // the change appears on the screen quickly.\n  function fastPoll(cm) {\n    var missed = false;\n    cm.display.pollingFast = true;\n    function p() {\n      var changed = readInput(cm);\n      if (!changed && !missed) {missed = true; cm.display.poll.set(60, p);}\n      else {cm.display.pollingFast = false; slowPoll(cm);}\n    }\n    cm.display.poll.set(20, p);\n  }\n\n  // This will be set to an array of strings when copying, so that,\n  // when pasting, we know what kind of selections the copied text\n  // was made out of.\n  var lastCopied = null;\n\n  // Read input from the textarea, and update the document to match.\n  // When something is selected, it is present in the textarea, and\n  // selected (unless it is huge, in which case a placeholder is\n  // used). When nothing is selected, the cursor sits after previously\n  // seen text (can be empty), which is stored in prevInput (we must\n  // not reset the textarea when typing, because that breaks IME).\n  function readInput(cm) {\n    var input = cm.display.input, prevInput = cm.display.prevInput, doc = cm.doc;\n    // Since this is called a *lot*, try to bail out as cheaply as\n    // possible when it is clear that nothing happened. hasSelection\n    // will be the case when there is a lot of text in the textarea,\n    // in which case reading its value would be expensive.\n    if (!cm.state.focused || (hasSelection(input) && !prevInput) || isReadOnly(cm) || cm.options.disableInput || cm.state.keySeq)\n      return false;\n    // See paste handler for more on the fakedLastChar kludge\n    if (cm.state.pasteIncoming && cm.state.fakedLastChar) {\n      input.value = input.value.substring(0, input.value.length - 1);\n      cm.state.fakedLastChar = false;\n    }\n    var text = input.value;\n    // If nothing changed, bail.\n    if (text == prevInput && !cm.somethingSelected()) return false;\n    // Work around nonsensical selection resetting in IE9/10, and\n    // inexplicable appearance of private area unicode characters on\n    // some key combos in Mac (#2689).\n    if (ie && ie_version >= 9 && cm.display.inputHasSelection === text ||\n        mac && /[\\uf700-\\uf7ff]/.test(text)) {\n      resetInput(cm);\n      return false;\n    }\n\n    var withOp = !cm.curOp;\n    if (withOp) startOperation(cm);\n    cm.display.shift = false;\n\n    if (text.charCodeAt(0) == 0x200b && doc.sel == cm.display.selForContextMenu && !prevInput)\n      prevInput = \"\\u200b\";\n    // Find the part of the input that is actually new\n    var same = 0, l = Math.min(prevInput.length, text.length);\n    while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) ++same;\n    var inserted = text.slice(same), textLines = splitLines(inserted);\n\n    // When pasing N lines into N selections, insert one line per selection\n    var multiPaste = null;\n    if (cm.state.pasteIncoming && doc.sel.ranges.length > 1) {\n      if (lastCopied && lastCopied.join(\"\\n\") == inserted)\n        multiPaste = doc.sel.ranges.length % lastCopied.length == 0 && map(lastCopied, splitLines);\n      else if (textLines.length == doc.sel.ranges.length)\n        multiPaste = map(textLines, function(l) { return [l]; });\n    }\n\n    // Normal behavior is to insert the new text into every selection\n    for (var i = doc.sel.ranges.length - 1; i >= 0; i--) {\n      var range = doc.sel.ranges[i];\n      var from = range.from(), to = range.to();\n      // Handle deletion\n      if (same < prevInput.length)\n        from = Pos(from.line, from.ch - (prevInput.length - same));\n      // Handle overwrite\n      else if (cm.state.overwrite && range.empty() && !cm.state.pasteIncoming)\n        to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length));\n      var updateInput = cm.curOp.updateInput;\n      var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i % multiPaste.length] : textLines,\n                         origin: cm.state.pasteIncoming ? \"paste\" : cm.state.cutIncoming ? \"cut\" : \"+input\"};\n      makeChange(cm.doc, changeEvent);\n      signalLater(cm, \"inputRead\", cm, changeEvent);\n      // When an 'electric' character is inserted, immediately trigger a reindent\n      if (inserted && !cm.state.pasteIncoming && cm.options.electricChars &&\n          cm.options.smartIndent && range.head.ch < 100 &&\n          (!i || doc.sel.ranges[i - 1].head.line != range.head.line)) {\n        var mode = cm.getModeAt(range.head);\n        var end = changeEnd(changeEvent);\n        if (mode.electricChars) {\n          for (var j = 0; j < mode.electricChars.length; j++)\n            if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {\n              indentLine(cm, end.line, \"smart\");\n              break;\n            }\n        } else if (mode.electricInput) {\n          if (mode.electricInput.test(getLine(doc, end.line).text.slice(0, end.ch)))\n            indentLine(cm, end.line, \"smart\");\n        }\n      }\n    }\n    ensureCursorVisible(cm);\n    cm.curOp.updateInput = updateInput;\n    cm.curOp.typing = true;\n\n    // Don't leave long text in the textarea, since it makes further polling slow\n    if (text.length > 1000 || text.indexOf(\"\\n\") > -1) input.value = cm.display.prevInput = \"\";\n    else cm.display.prevInput = text;\n    if (withOp) endOperation(cm);\n    cm.state.pasteIncoming = cm.state.cutIncoming = false;\n    return true;\n  }\n\n  // Reset the input to correspond to the selection (or to be empty,\n  // when not typing and nothing is selected)\n  function resetInput(cm, typing) {\n    var minimal, selected, doc = cm.doc;\n    if (cm.somethingSelected()) {\n      cm.display.prevInput = \"\";\n      var range = doc.sel.primary();\n      minimal = hasCopyEvent &&\n        (range.to().line - range.from().line > 100 || (selected = cm.getSelection()).length > 1000);\n      var content = minimal ? \"-\" : selected || cm.getSelection();\n      cm.display.input.value = content;\n      if (cm.state.focused) selectInput(cm.display.input);\n      if (ie && ie_version >= 9) cm.display.inputHasSelection = content;\n    } else if (!typing) {\n      cm.display.prevInput = cm.display.input.value = \"\";\n      if (ie && ie_version >= 9) cm.display.inputHasSelection = null;\n    }\n    cm.display.inaccurateSelection = minimal;\n  }\n\n  function focusInput(cm) {\n    if (cm.options.readOnly != \"nocursor\" && (!mobile || activeElt() != cm.display.input))\n      cm.display.input.focus();\n  }\n\n  function ensureFocus(cm) {\n    if (!cm.state.focused) { focusInput(cm); onFocus(cm); }\n  }\n\n  function isReadOnly(cm) {\n    return cm.options.readOnly || cm.doc.cantEdit;\n  }\n\n  // EVENT HANDLERS\n\n  // Attach the necessary event handlers when initializing the editor\n  function registerEventHandlers(cm) {\n    var d = cm.display;\n    on(d.scroller, \"mousedown\", operation(cm, onMouseDown));\n    // Older IE's will not fire a second mousedown for a double click\n    if (ie && ie_version < 11)\n      on(d.scroller, \"dblclick\", operation(cm, function(e) {\n        if (signalDOMEvent(cm, e)) return;\n        var pos = posFromMouse(cm, e);\n        if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) return;\n        e_preventDefault(e);\n        var word = cm.findWordAt(pos);\n        extendSelection(cm.doc, word.anchor, word.head);\n      }));\n    else\n      on(d.scroller, \"dblclick\", function(e) { signalDOMEvent(cm, e) || e_preventDefault(e); });\n    // Prevent normal selection in the editor (we handle our own)\n    on(d.lineSpace, \"selectstart\", function(e) {\n      if (!eventInWidget(d, e)) e_preventDefault(e);\n    });\n    // Some browsers fire contextmenu *after* opening the menu, at\n    // which point we can't mess with it anymore. Context menu is\n    // handled in onMouseDown for these browsers.\n    if (!captureRightClick) on(d.scroller, \"contextmenu\", function(e) {onContextMenu(cm, e);});\n\n    // Sync scrolling between fake scrollbars and real scrollable\n    // area, ensure viewport is updated when scrolling.\n    on(d.scroller, \"scroll\", function() {\n      if (d.scroller.clientHeight) {\n        setScrollTop(cm, d.scroller.scrollTop);\n        setScrollLeft(cm, d.scroller.scrollLeft, true);\n        signal(cm, \"scroll\", cm);\n      }\n    });\n    on(d.scrollbarV, \"scroll\", function() {\n      if (d.scroller.clientHeight) setScrollTop(cm, d.scrollbarV.scrollTop);\n    });\n    on(d.scrollbarH, \"scroll\", function() {\n      if (d.scroller.clientHeight) setScrollLeft(cm, d.scrollbarH.scrollLeft);\n    });\n\n    // Listen to wheel events in order to try and update the viewport on time.\n    on(d.scroller, \"mousewheel\", function(e){onScrollWheel(cm, e);});\n    on(d.scroller, \"DOMMouseScroll\", function(e){onScrollWheel(cm, e);});\n\n    // Prevent clicks in the scrollbars from killing focus\n    function reFocus() { if (cm.state.focused) setTimeout(bind(focusInput, cm), 0); }\n    on(d.scrollbarH, \"mousedown\", reFocus);\n    on(d.scrollbarV, \"mousedown\", reFocus);\n    // Prevent wrapper from ever scrolling\n    on(d.wrapper, \"scroll\", function() { d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });\n\n    on(d.input, \"keyup\", function(e) { onKeyUp.call(cm, e); });\n    on(d.input, \"input\", function() {\n      if (ie && ie_version >= 9 && cm.display.inputHasSelection) cm.display.inputHasSelection = null;\n      fastPoll(cm);\n    });\n    on(d.input, \"keydown\", operation(cm, onKeyDown));\n    on(d.input, \"keypress\", operation(cm, onKeyPress));\n    on(d.input, \"focus\", bind(onFocus, cm));\n    on(d.input, \"blur\", bind(onBlur, cm));\n\n    function drag_(e) {\n      if (!signalDOMEvent(cm, e)) e_stop(e);\n    }\n    if (cm.options.dragDrop) {\n      on(d.scroller, \"dragstart\", function(e){onDragStart(cm, e);});\n      on(d.scroller, \"dragenter\", drag_);\n      on(d.scroller, \"dragover\", drag_);\n      on(d.scroller, \"drop\", operation(cm, onDrop));\n    }\n    on(d.scroller, \"paste\", function(e) {\n      if (eventInWidget(d, e)) return;\n      cm.state.pasteIncoming = true;\n      focusInput(cm);\n      fastPoll(cm);\n    });\n    on(d.input, \"paste\", function() {\n      // Workaround for webkit bug https://bugs.webkit.org/show_bug.cgi?id=90206\n      // Add a char to the end of textarea before paste occur so that\n      // selection doesn't span to the end of textarea.\n      if (webkit && !cm.state.fakedLastChar && !(new Date - cm.state.lastMiddleDown < 200)) {\n        var start = d.input.selectionStart, end = d.input.selectionEnd;\n        d.input.value += \"$\";\n        // The selection end needs to be set before the start, otherwise there\n        // can be an intermediate non-empty selection between the two, which\n        // can override the middle-click paste buffer on linux and cause the\n        // wrong thing to get pasted.\n        d.input.selectionEnd = end;\n        d.input.selectionStart = start;\n        cm.state.fakedLastChar = true;\n      }\n      cm.state.pasteIncoming = true;\n      fastPoll(cm);\n    });\n\n    function prepareCopyCut(e) {\n      if (cm.somethingSelected()) {\n        lastCopied = cm.getSelections();\n        if (d.inaccurateSelection) {\n          d.prevInput = \"\";\n          d.inaccurateSelection = false;\n          d.input.value = lastCopied.join(\"\\n\");\n          selectInput(d.input);\n        }\n      } else {\n        var text = [], ranges = [];\n        for (var i = 0; i < cm.doc.sel.ranges.length; i++) {\n          var line = cm.doc.sel.ranges[i].head.line;\n          var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};\n          ranges.push(lineRange);\n          text.push(cm.getRange(lineRange.anchor, lineRange.head));\n        }\n        if (e.type == \"cut\") {\n          cm.setSelections(ranges, null, sel_dontScroll);\n        } else {\n          d.prevInput = \"\";\n          d.input.value = text.join(\"\\n\");\n          selectInput(d.input);\n        }\n        lastCopied = text;\n      }\n      if (e.type == \"cut\") cm.state.cutIncoming = true;\n    }\n    on(d.input, \"cut\", prepareCopyCut);\n    on(d.input, \"copy\", prepareCopyCut);\n\n    // Needed to handle Tab key in KHTML\n    if (khtml) on(d.sizer, \"mouseup\", function() {\n      if (activeElt() == d.input) d.input.blur();\n      focusInput(cm);\n    });\n  }\n\n  // Called when the window resizes\n  function onResize(cm) {\n    var d = cm.display;\n    if (d.lastWrapHeight == d.wrapper.clientHeight && d.lastWrapWidth == d.wrapper.clientWidth)\n      return;\n    // Might be a text scaling operation, clear size caches.\n    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n    cm.setSize();\n  }\n\n  // MOUSE EVENTS\n\n  // Return true when the given mouse event happened in a widget\n  function eventInWidget(display, e) {\n    for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {\n      if (!n || n.ignoreEvents || n.parentNode == display.sizer && n != display.mover) return true;\n    }\n  }\n\n  // Given a mouse event, find the corresponding position. If liberal\n  // is false, it checks whether a gutter or scrollbar was clicked,\n  // and returns null if it was. forRect is used by rectangular\n  // selections, and tries to estimate a character position even for\n  // coordinates beyond the right of the text.\n  function posFromMouse(cm, e, liberal, forRect) {\n    var display = cm.display;\n    if (!liberal) {\n      var target = e_target(e);\n      if (target == display.scrollbarH || target == display.scrollbarV ||\n          target == display.scrollbarFiller || target == display.gutterFiller) return null;\n    }\n    var x, y, space = display.lineSpace.getBoundingClientRect();\n    // Fails unpredictably on IE[67] when mouse is dragged around quickly.\n    try { x = e.clientX - space.left; y = e.clientY - space.top; }\n    catch (e) { return null; }\n    var coords = coordsChar(cm, x, y), line;\n    if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {\n      var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;\n      coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));\n    }\n    return coords;\n  }\n\n  // A mouse down can be a single click, double click, triple click,\n  // start of selection drag, start of text drag, new cursor\n  // (ctrl-click), rectangle drag (alt-drag), or xwin\n  // middle-click-paste. Or it might be a click on something we should\n  // not interfere with, such as a scrollbar or widget.\n  function onMouseDown(e) {\n    if (signalDOMEvent(this, e)) return;\n    var cm = this, display = cm.display;\n    display.shift = e.shiftKey;\n\n    if (eventInWidget(display, e)) {\n      if (!webkit) {\n        // Briefly turn off draggability, to allow widgets to do\n        // normal dragging things.\n        display.scroller.draggable = false;\n        setTimeout(function(){display.scroller.draggable = true;}, 100);\n      }\n      return;\n    }\n    if (clickInGutter(cm, e)) return;\n    var start = posFromMouse(cm, e);\n    window.focus();\n\n    switch (e_button(e)) {\n    case 1:\n      if (start)\n        leftButtonDown(cm, e, start);\n      else if (e_target(e) == display.scroller)\n        e_preventDefault(e);\n      break;\n    case 2:\n      if (webkit) cm.state.lastMiddleDown = +new Date;\n      if (start) extendSelection(cm.doc, start);\n      setTimeout(bind(focusInput, cm), 20);\n      e_preventDefault(e);\n      break;\n    case 3:\n      if (captureRightClick) onContextMenu(cm, e);\n      break;\n    }\n  }\n\n  var lastClick, lastDoubleClick;\n  function leftButtonDown(cm, e, start) {\n    setTimeout(bind(ensureFocus, cm), 0);\n\n    var now = +new Date, type;\n    if (lastDoubleClick && lastDoubleClick.time > now - 400 && cmp(lastDoubleClick.pos, start) == 0) {\n      type = \"triple\";\n    } else if (lastClick && lastClick.time > now - 400 && cmp(lastClick.pos, start) == 0) {\n      type = \"double\";\n      lastDoubleClick = {time: now, pos: start};\n    } else {\n      type = \"single\";\n      lastClick = {time: now, pos: start};\n    }\n\n    var sel = cm.doc.sel, modifier = mac ? e.metaKey : e.ctrlKey;\n    if (cm.options.dragDrop && dragAndDrop && !isReadOnly(cm) &&\n        type == \"single\" && sel.contains(start) > -1 && sel.somethingSelected())\n      leftButtonStartDrag(cm, e, start, modifier);\n    else\n      leftButtonSelect(cm, e, start, type, modifier);\n  }\n\n  // Start a text drag. When it ends, see if any dragging actually\n  // happen, and treat as a click if it didn't.\n  function leftButtonStartDrag(cm, e, start, modifier) {\n    var display = cm.display;\n    var dragEnd = operation(cm, function(e2) {\n      if (webkit) display.scroller.draggable = false;\n      cm.state.draggingText = false;\n      off(document, \"mouseup\", dragEnd);\n      off(display.scroller, \"drop\", dragEnd);\n      if (Math.abs(e.clientX - e2.clientX) + Math.abs(e.clientY - e2.clientY) < 10) {\n        e_preventDefault(e2);\n        if (!modifier)\n          extendSelection(cm.doc, start);\n        focusInput(cm);\n        // Work around unexplainable focus problem in IE9 (#2127)\n        if (ie && ie_version == 9)\n          setTimeout(function() {document.body.focus(); focusInput(cm);}, 20);\n      }\n    });\n    // Let the drag handler handle this.\n    if (webkit) display.scroller.draggable = true;\n    cm.state.draggingText = dragEnd;\n    // IE's approach to draggable\n    if (display.scroller.dragDrop) display.scroller.dragDrop();\n    on(document, \"mouseup\", dragEnd);\n    on(display.scroller, \"drop\", dragEnd);\n  }\n\n  // Normal selection, as opposed to text dragging.\n  function leftButtonSelect(cm, e, start, type, addNew) {\n    var display = cm.display, doc = cm.doc;\n    e_preventDefault(e);\n\n    var ourRange, ourIndex, startSel = doc.sel;\n    if (addNew && !e.shiftKey) {\n      ourIndex = doc.sel.contains(start);\n      if (ourIndex > -1)\n        ourRange = doc.sel.ranges[ourIndex];\n      else\n        ourRange = new Range(start, start);\n    } else {\n      ourRange = doc.sel.primary();\n    }\n\n    if (e.altKey) {\n      type = \"rect\";\n      if (!addNew) ourRange = new Range(start, start);\n      start = posFromMouse(cm, e, true, true);\n      ourIndex = -1;\n    } else if (type == \"double\") {\n      var word = cm.findWordAt(start);\n      if (cm.display.shift || doc.extend)\n        ourRange = extendRange(doc, ourRange, word.anchor, word.head);\n      else\n        ourRange = word;\n    } else if (type == \"triple\") {\n      var line = new Range(Pos(start.line, 0), clipPos(doc, Pos(start.line + 1, 0)));\n      if (cm.display.shift || doc.extend)\n        ourRange = extendRange(doc, ourRange, line.anchor, line.head);\n      else\n        ourRange = line;\n    } else {\n      ourRange = extendRange(doc, ourRange, start);\n    }\n\n    if (!addNew) {\n      ourIndex = 0;\n      setSelection(doc, new Selection([ourRange], 0), sel_mouse);\n      startSel = doc.sel;\n    } else if (ourIndex > -1) {\n      replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);\n    } else {\n      ourIndex = doc.sel.ranges.length;\n      setSelection(doc, normalizeSelection(doc.sel.ranges.concat([ourRange]), ourIndex),\n                   {scroll: false, origin: \"*mouse\"});\n    }\n\n    var lastPos = start;\n    function extendTo(pos) {\n      if (cmp(lastPos, pos) == 0) return;\n      lastPos = pos;\n\n      if (type == \"rect\") {\n        var ranges = [], tabSize = cm.options.tabSize;\n        var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);\n        var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);\n        var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);\n        for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));\n             line <= end; line++) {\n          var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);\n          if (left == right)\n            ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos)));\n          else if (text.length > leftPos)\n            ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize))));\n        }\n        if (!ranges.length) ranges.push(new Range(start, start));\n        setSelection(doc, normalizeSelection(startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),\n                     {origin: \"*mouse\", scroll: false});\n        cm.scrollIntoView(pos);\n      } else {\n        var oldRange = ourRange;\n        var anchor = oldRange.anchor, head = pos;\n        if (type != \"single\") {\n          if (type == \"double\")\n            var range = cm.findWordAt(pos);\n          else\n            var range = new Range(Pos(pos.line, 0), clipPos(doc, Pos(pos.line + 1, 0)));\n          if (cmp(range.anchor, anchor) > 0) {\n            head = range.head;\n            anchor = minPos(oldRange.from(), range.anchor);\n          } else {\n            head = range.anchor;\n            anchor = maxPos(oldRange.to(), range.head);\n          }\n        }\n        var ranges = startSel.ranges.slice(0);\n        ranges[ourIndex] = new Range(clipPos(doc, anchor), head);\n        setSelection(doc, normalizeSelection(ranges, ourIndex), sel_mouse);\n      }\n    }\n\n    var editorSize = display.wrapper.getBoundingClientRect();\n    // Used to ensure timeout re-tries don't fire when another extend\n    // happened in the meantime (clearTimeout isn't reliable -- at\n    // least on Chrome, the timeouts still happen even when cleared,\n    // if the clear happens after their scheduled firing time).\n    var counter = 0;\n\n    function extend(e) {\n      var curCount = ++counter;\n      var cur = posFromMouse(cm, e, true, type == \"rect\");\n      if (!cur) return;\n      if (cmp(cur, lastPos) != 0) {\n        ensureFocus(cm);\n        extendTo(cur);\n        var visible = visibleLines(display, doc);\n        if (cur.line >= visible.to || cur.line < visible.from)\n          setTimeout(operation(cm, function(){if (counter == curCount) extend(e);}), 150);\n      } else {\n        var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;\n        if (outside) setTimeout(operation(cm, function() {\n          if (counter != curCount) return;\n          display.scroller.scrollTop += outside;\n          extend(e);\n        }), 50);\n      }\n    }\n\n    function done(e) {\n      counter = Infinity;\n      e_preventDefault(e);\n      focusInput(cm);\n      off(document, \"mousemove\", move);\n      off(document, \"mouseup\", up);\n      doc.history.lastSelOrigin = null;\n    }\n\n    var move = operation(cm, function(e) {\n      if (!e_button(e)) done(e);\n      else extend(e);\n    });\n    var up = operation(cm, done);\n    on(document, \"mousemove\", move);\n    on(document, \"mouseup\", up);\n  }\n\n  // Determines whether an event happened in the gutter, and fires the\n  // handlers for the corresponding event.\n  function gutterEvent(cm, e, type, prevent, signalfn) {\n    try { var mX = e.clientX, mY = e.clientY; }\n    catch(e) { return false; }\n    if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) return false;\n    if (prevent) e_preventDefault(e);\n\n    var display = cm.display;\n    var lineBox = display.lineDiv.getBoundingClientRect();\n\n    if (mY > lineBox.bottom || !hasHandler(cm, type)) return e_defaultPrevented(e);\n    mY -= lineBox.top - display.viewOffset;\n\n    for (var i = 0; i < cm.options.gutters.length; ++i) {\n      var g = display.gutters.childNodes[i];\n      if (g && g.getBoundingClientRect().right >= mX) {\n        var line = lineAtHeight(cm.doc, mY);\n        var gutter = cm.options.gutters[i];\n        signalfn(cm, type, cm, line, gutter, e);\n        return e_defaultPrevented(e);\n      }\n    }\n  }\n\n  function clickInGutter(cm, e) {\n    return gutterEvent(cm, e, \"gutterClick\", true, signalLater);\n  }\n\n  // Kludge to work around strange IE behavior where it'll sometimes\n  // re-fire a series of drag-related events right after the drop (#1551)\n  var lastDrop = 0;\n\n  function onDrop(e) {\n    var cm = this;\n    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))\n      return;\n    e_preventDefault(e);\n    if (ie) lastDrop = +new Date;\n    var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;\n    if (!pos || isReadOnly(cm)) return;\n    // Might be a file drop, in which case we simply extract the text\n    // and insert it.\n    if (files && files.length && window.FileReader && window.File) {\n      var n = files.length, text = Array(n), read = 0;\n      var loadFile = function(file, i) {\n        var reader = new FileReader;\n        reader.onload = operation(cm, function() {\n          text[i] = reader.result;\n          if (++read == n) {\n            pos = clipPos(cm.doc, pos);\n            var change = {from: pos, to: pos, text: splitLines(text.join(\"\\n\")), origin: \"paste\"};\n            makeChange(cm.doc, change);\n            setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));\n          }\n        });\n        reader.readAsText(file);\n      };\n      for (var i = 0; i < n; ++i) loadFile(files[i], i);\n    } else { // Normal drop\n      // Don't do a replace if the drop happened inside of the selected text.\n      if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {\n        cm.state.draggingText(e);\n        // Ensure the editor is re-focused\n        setTimeout(bind(focusInput, cm), 20);\n        return;\n      }\n      try {\n        var text = e.dataTransfer.getData(\"Text\");\n        if (text) {\n          if (cm.state.draggingText && !(mac ? e.metaKey : e.ctrlKey))\n            var selected = cm.listSelections();\n          setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));\n          if (selected) for (var i = 0; i < selected.length; ++i)\n            replaceRange(cm.doc, \"\", selected[i].anchor, selected[i].head, \"drag\");\n          cm.replaceSelection(text, \"around\", \"paste\");\n          focusInput(cm);\n        }\n      }\n      catch(e){}\n    }\n  }\n\n  function onDragStart(cm, e) {\n    if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return; }\n    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) return;\n\n    e.dataTransfer.setData(\"Text\", cm.getSelection());\n\n    // Use dummy image instead of default browsers image.\n    // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.\n    if (e.dataTransfer.setDragImage && !safari) {\n      var img = elt(\"img\", null, null, \"position: fixed; left: 0; top: 0;\");\n      img.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n      if (presto) {\n        img.width = img.height = 1;\n        cm.display.wrapper.appendChild(img);\n        // Force a relayout, or Opera won't use our image for some obscure reason\n        img._top = img.offsetTop;\n      }\n      e.dataTransfer.setDragImage(img, 0, 0);\n      if (presto) img.parentNode.removeChild(img);\n    }\n  }\n\n  // SCROLL EVENTS\n\n  // Sync the scrollable area and scrollbars, ensure the viewport\n  // covers the visible area.\n  function setScrollTop(cm, val) {\n    if (Math.abs(cm.doc.scrollTop - val) < 2) return;\n    cm.doc.scrollTop = val;\n    if (!gecko) updateDisplaySimple(cm, {top: val});\n    if (cm.display.scroller.scrollTop != val) cm.display.scroller.scrollTop = val;\n    if (cm.display.scrollbarV.scrollTop != val) cm.display.scrollbarV.scrollTop = val;\n    if (gecko) updateDisplaySimple(cm);\n    startWorker(cm, 100);\n  }\n  // Sync scroller and scrollbar, ensure the gutter elements are\n  // aligned.\n  function setScrollLeft(cm, val, isScroller) {\n    if (isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) return;\n    val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);\n    cm.doc.scrollLeft = val;\n    alignHorizontally(cm);\n    if (cm.display.scroller.scrollLeft != val) cm.display.scroller.scrollLeft = val;\n    if (cm.display.scrollbarH.scrollLeft != val) cm.display.scrollbarH.scrollLeft = val;\n  }\n\n  // Since the delta values reported on mouse wheel events are\n  // unstandardized between browsers and even browser versions, and\n  // generally horribly unpredictable, this code starts by measuring\n  // the scroll effect that the first few mouse wheel events have,\n  // and, from that, detects the way it can convert deltas to pixel\n  // offsets afterwards.\n  //\n  // The reason we want to know the amount a wheel event will scroll\n  // is that it gives us a chance to update the display before the\n  // actual scrolling happens, reducing flickering.\n\n  var wheelSamples = 0, wheelPixelsPerUnit = null;\n  // Fill in a browser-detected starting value on browsers where we\n  // know one. These don't have to be accurate -- the result of them\n  // being wrong would just be a slight flicker on the first wheel\n  // scroll (if it is large enough).\n  if (ie) wheelPixelsPerUnit = -.53;\n  else if (gecko) wheelPixelsPerUnit = 15;\n  else if (chrome) wheelPixelsPerUnit = -.7;\n  else if (safari) wheelPixelsPerUnit = -1/3;\n\n  function onScrollWheel(cm, e) {\n    var dx = e.wheelDeltaX, dy = e.wheelDeltaY;\n    if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) dx = e.detail;\n    if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) dy = e.detail;\n    else if (dy == null) dy = e.wheelDelta;\n\n    var display = cm.display, scroll = display.scroller;\n    // Quit if there's nothing to scroll here\n    if (!(dx && scroll.scrollWidth > scroll.clientWidth ||\n          dy && scroll.scrollHeight > scroll.clientHeight)) return;\n\n    // Webkit browsers on OS X abort momentum scrolls when the target\n    // of the scroll event is removed from the scrollable element.\n    // This hack (see related code in patchDisplay) makes sure the\n    // element is kept around.\n    if (dy && mac && webkit) {\n      outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {\n        for (var i = 0; i < view.length; i++) {\n          if (view[i].node == cur) {\n            cm.display.currentWheelTarget = cur;\n            break outer;\n          }\n        }\n      }\n    }\n\n    // On some browsers, horizontal scrolling will cause redraws to\n    // happen before the gutter has been realigned, causing it to\n    // wriggle around in a most unseemly way. When we have an\n    // estimated pixels/delta value, we just handle horizontal\n    // scrolling entirely here. It'll be slightly off from native, but\n    // better than glitching out.\n    if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {\n      if (dy)\n        setScrollTop(cm, Math.max(0, Math.min(scroll.scrollTop + dy * wheelPixelsPerUnit, scroll.scrollHeight - scroll.clientHeight)));\n      setScrollLeft(cm, Math.max(0, Math.min(scroll.scrollLeft + dx * wheelPixelsPerUnit, scroll.scrollWidth - scroll.clientWidth)));\n      e_preventDefault(e);\n      display.wheelStartX = null; // Abort measurement, if in progress\n      return;\n    }\n\n    // 'Project' the visible viewport to cover the area that is being\n    // scrolled into view (if we know enough to estimate it).\n    if (dy && wheelPixelsPerUnit != null) {\n      var pixels = dy * wheelPixelsPerUnit;\n      var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;\n      if (pixels < 0) top = Math.max(0, top + pixels - 50);\n      else bot = Math.min(cm.doc.height, bot + pixels + 50);\n      updateDisplaySimple(cm, {top: top, bottom: bot});\n    }\n\n    if (wheelSamples < 20) {\n      if (display.wheelStartX == null) {\n        display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;\n        display.wheelDX = dx; display.wheelDY = dy;\n        setTimeout(function() {\n          if (display.wheelStartX == null) return;\n          var movedX = scroll.scrollLeft - display.wheelStartX;\n          var movedY = scroll.scrollTop - display.wheelStartY;\n          var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||\n            (movedX && display.wheelDX && movedX / display.wheelDX);\n          display.wheelStartX = display.wheelStartY = null;\n          if (!sample) return;\n          wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);\n          ++wheelSamples;\n        }, 200);\n      } else {\n        display.wheelDX += dx; display.wheelDY += dy;\n      }\n    }\n  }\n\n  // KEY EVENTS\n\n  // Run a handler that was bound to a key.\n  function doHandleBinding(cm, bound, dropShift) {\n    if (typeof bound == \"string\") {\n      bound = commands[bound];\n      if (!bound) return false;\n    }\n    // Ensure previous input has been read, so that the handler sees a\n    // consistent view of the document\n    if (cm.display.pollingFast && readInput(cm)) cm.display.pollingFast = false;\n    var prevShift = cm.display.shift, done = false;\n    try {\n      if (isReadOnly(cm)) cm.state.suppressEdits = true;\n      if (dropShift) cm.display.shift = false;\n      done = bound(cm) != Pass;\n    } finally {\n      cm.display.shift = prevShift;\n      cm.state.suppressEdits = false;\n    }\n    return done;\n  }\n\n  function lookupKeyForEditor(cm, name, handle) {\n    for (var i = 0; i < cm.state.keyMaps.length; i++) {\n      var result = lookupKey(name, cm.state.keyMaps[i], handle);\n      if (result) return result;\n    }\n    return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle))\n      || lookupKey(name, cm.options.keyMap, handle);\n  }\n\n  var stopSeq = new Delayed;\n  function dispatchKey(cm, name, e, handle) {\n    var seq = cm.state.keySeq;\n    if (seq) {\n      if (isModifierKey(name)) return \"handled\";\n      stopSeq.set(50, function() {\n        if (cm.state.keySeq == seq) {\n          cm.state.keySeq = null;\n          resetInput(cm);\n        }\n      });\n      name = seq + \" \" + name;\n    }\n    var result = lookupKeyForEditor(cm, name, handle);\n\n    if (result == \"multi\")\n      cm.state.keySeq = name;\n    if (result == \"handled\")\n      signalLater(cm, \"keyHandled\", cm, name, e);\n\n    if (result == \"handled\" || result == \"multi\") {\n      e_preventDefault(e);\n      restartBlink(cm);\n    }\n\n    if (seq && !result && /\\'$/.test(name)) {\n      e_preventDefault(e);\n      return true;\n    }\n    return !!result;\n  }\n\n  // Handle a key from the keydown event.\n  function handleKeyBinding(cm, e) {\n    var name = keyName(e, true);\n    if (!name) return false;\n\n    if (e.shiftKey && !cm.state.keySeq) {\n      // First try to resolve full name (including 'Shift-'). Failing\n      // that, see if there is a cursor-motion command (starting with\n      // 'go') bound to the keyname without 'Shift-'.\n      return dispatchKey(cm, \"Shift-\" + name, e, function(b) {return doHandleBinding(cm, b, true);})\n          || dispatchKey(cm, name, e, function(b) {\n               if (typeof b == \"string\" ? /^go[A-Z]/.test(b) : b.motion)\n                 return doHandleBinding(cm, b);\n             });\n    } else {\n      return dispatchKey(cm, name, e, function(b) { return doHandleBinding(cm, b); });\n    }\n  }\n\n  // Handle a key from the keypress event\n  function handleCharBinding(cm, e, ch) {\n    return dispatchKey(cm, \"'\" + ch + \"'\", e,\n                       function(b) { return doHandleBinding(cm, b, true); });\n  }\n\n  var lastStoppedKey = null;\n  function onKeyDown(e) {\n    var cm = this;\n    ensureFocus(cm);\n    if (signalDOMEvent(cm, e)) return;\n    // IE does strange things with escape.\n    if (ie && ie_version < 11 && e.keyCode == 27) e.returnValue = false;\n    var code = e.keyCode;\n    cm.display.shift = code == 16 || e.shiftKey;\n    var handled = handleKeyBinding(cm, e);\n    if (presto) {\n      lastStoppedKey = handled ? code : null;\n      // Opera has no cut event... we try to at least catch the key combo\n      if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))\n        cm.replaceSelection(\"\", null, \"cut\");\n    }\n\n    // Turn mouse into crosshair when Alt is held on Mac.\n    if (code == 18 && !/\\bCodeMirror-crosshair\\b/.test(cm.display.lineDiv.className))\n      showCrossHair(cm);\n  }\n\n  function showCrossHair(cm) {\n    var lineDiv = cm.display.lineDiv;\n    addClass(lineDiv, \"CodeMirror-crosshair\");\n\n    function up(e) {\n      if (e.keyCode == 18 || !e.altKey) {\n        rmClass(lineDiv, \"CodeMirror-crosshair\");\n        off(document, \"keyup\", up);\n        off(document, \"mouseover\", up);\n      }\n    }\n    on(document, \"keyup\", up);\n    on(document, \"mouseover\", up);\n  }\n\n  function onKeyUp(e) {\n    if (e.keyCode == 16) this.doc.sel.shift = false;\n    signalDOMEvent(this, e);\n  }\n\n  function onKeyPress(e) {\n    var cm = this;\n    if (signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) return;\n    var keyCode = e.keyCode, charCode = e.charCode;\n    if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return;}\n    if (((presto && (!e.which || e.which < 10)) || khtml) && handleKeyBinding(cm, e)) return;\n    var ch = String.fromCharCode(charCode == null ? keyCode : charCode);\n    if (handleCharBinding(cm, e, ch)) return;\n    if (ie && ie_version >= 9) cm.display.inputHasSelection = null;\n    fastPoll(cm);\n  }\n\n  // FOCUS/BLUR EVENTS\n\n  function onFocus(cm) {\n    if (cm.options.readOnly == \"nocursor\") return;\n    if (!cm.state.focused) {\n      signal(cm, \"focus\", cm);\n      cm.state.focused = true;\n      addClass(cm.display.wrapper, \"CodeMirror-focused\");\n      // The prevInput test prevents this from firing when a context\n      // menu is closed (since the resetInput would kill the\n      // select-all detection hack)\n      if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {\n        resetInput(cm);\n        if (webkit) setTimeout(bind(resetInput, cm, true), 0); // Issue #1730\n      }\n    }\n    slowPoll(cm);\n    restartBlink(cm);\n  }\n  function onBlur(cm) {\n    if (cm.state.focused) {\n      signal(cm, \"blur\", cm);\n      cm.state.focused = false;\n      rmClass(cm.display.wrapper, \"CodeMirror-focused\");\n    }\n    clearInterval(cm.display.blinker);\n    setTimeout(function() {if (!cm.state.focused) cm.display.shift = false;}, 150);\n  }\n\n  // CONTEXT MENU HANDLING\n\n  // To make the context menu work, we need to briefly unhide the\n  // textarea (making it as unobtrusive as possible) to let the\n  // right-click take effect on it.\n  function onContextMenu(cm, e) {\n    if (signalDOMEvent(cm, e, \"contextmenu\")) return;\n    var display = cm.display;\n    if (eventInWidget(display, e) || contextMenuInGutter(cm, e)) return;\n\n    var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;\n    if (!pos || presto) return; // Opera is difficult.\n\n    // Reset the current text selection only if the click is done outside of the selection\n    // and 'resetSelectionOnContextMenu' option is true.\n    var reset = cm.options.resetSelectionOnContextMenu;\n    if (reset && cm.doc.sel.contains(pos) == -1)\n      operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll);\n\n    var oldCSS = display.input.style.cssText;\n    display.inputDiv.style.position = \"absolute\";\n    display.input.style.cssText = \"position: fixed; width: 30px; height: 30px; top: \" + (e.clientY - 5) +\n      \"px; left: \" + (e.clientX - 5) + \"px; z-index: 1000; background: \" +\n      (ie ? \"rgba(255, 255, 255, .05)\" : \"transparent\") +\n      \"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);\";\n    if (webkit) var oldScrollY = window.scrollY; // Work around Chrome issue (#2712)\n    focusInput(cm);\n    if (webkit) window.scrollTo(null, oldScrollY);\n    resetInput(cm);\n    // Adds \"Select all\" to context menu in FF\n    if (!cm.somethingSelected()) display.input.value = display.prevInput = \" \";\n    display.selForContextMenu = cm.doc.sel;\n    clearTimeout(display.detectingSelectAll);\n\n    // Select-all will be greyed out if there's nothing to select, so\n    // this adds a zero-width space so that we can later check whether\n    // it got selected.\n    function prepareSelectAllHack() {\n      if (display.input.selectionStart != null) {\n        var selected = cm.somethingSelected();\n        var extval = display.input.value = \"\\u200b\" + (selected ? display.input.value : \"\");\n        display.prevInput = selected ? \"\" : \"\\u200b\";\n        display.input.selectionStart = 1; display.input.selectionEnd = extval.length;\n        // Re-set this, in case some other handler touched the\n        // selection in the meantime.\n        display.selForContextMenu = cm.doc.sel;\n      }\n    }\n    function rehide() {\n      display.inputDiv.style.position = \"relative\";\n      display.input.style.cssText = oldCSS;\n      if (ie && ie_version < 9) display.scrollbarV.scrollTop = display.scroller.scrollTop = scrollPos;\n      slowPoll(cm);\n\n      // Try to detect the user choosing select-all\n      if (display.input.selectionStart != null) {\n        if (!ie || (ie && ie_version < 9)) prepareSelectAllHack();\n        var i = 0, poll = function() {\n          if (display.selForContextMenu == cm.doc.sel && display.input.selectionStart == 0)\n            operation(cm, commands.selectAll)(cm);\n          else if (i++ < 10) display.detectingSelectAll = setTimeout(poll, 500);\n          else resetInput(cm);\n        };\n        display.detectingSelectAll = setTimeout(poll, 200);\n      }\n    }\n\n    if (ie && ie_version >= 9) prepareSelectAllHack();\n    if (captureRightClick) {\n      e_stop(e);\n      var mouseup = function() {\n        off(window, \"mouseup\", mouseup);\n        setTimeout(rehide, 20);\n      };\n      on(window, \"mouseup\", mouseup);\n    } else {\n      setTimeout(rehide, 50);\n    }\n  }\n\n  function contextMenuInGutter(cm, e) {\n    if (!hasHandler(cm, \"gutterContextMenu\")) return false;\n    return gutterEvent(cm, e, \"gutterContextMenu\", false, signal);\n  }\n\n  // UPDATING\n\n  // Compute the position of the end of a change (its 'to' property\n  // refers to the pre-change end).\n  var changeEnd = CodeMirror.changeEnd = function(change) {\n    if (!change.text) return change.to;\n    return Pos(change.from.line + change.text.length - 1,\n               lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0));\n  };\n\n  // Adjust a position to refer to the post-change position of the\n  // same text, or the end of the change if the change covers it.\n  function adjustForChange(pos, change) {\n    if (cmp(pos, change.from) < 0) return pos;\n    if (cmp(pos, change.to) <= 0) return changeEnd(change);\n\n    var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;\n    if (pos.line == change.to.line) ch += changeEnd(change).ch - change.to.ch;\n    return Pos(line, ch);\n  }\n\n  function computeSelAfterChange(doc, change) {\n    var out = [];\n    for (var i = 0; i < doc.sel.ranges.length; i++) {\n      var range = doc.sel.ranges[i];\n      out.push(new Range(adjustForChange(range.anchor, change),\n                         adjustForChange(range.head, change)));\n    }\n    return normalizeSelection(out, doc.sel.primIndex);\n  }\n\n  function offsetPos(pos, old, nw) {\n    if (pos.line == old.line)\n      return Pos(nw.line, pos.ch - old.ch + nw.ch);\n    else\n      return Pos(nw.line + (pos.line - old.line), pos.ch);\n  }\n\n  // Used by replaceSelections to allow moving the selection to the\n  // start or around the replaced test. Hint may be \"start\" or \"around\".\n  function computeReplacedSel(doc, changes, hint) {\n    var out = [];\n    var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;\n    for (var i = 0; i < changes.length; i++) {\n      var change = changes[i];\n      var from = offsetPos(change.from, oldPrev, newPrev);\n      var to = offsetPos(changeEnd(change), oldPrev, newPrev);\n      oldPrev = change.to;\n      newPrev = to;\n      if (hint == \"around\") {\n        var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;\n        out[i] = new Range(inv ? to : from, inv ? from : to);\n      } else {\n        out[i] = new Range(from, from);\n      }\n    }\n    return new Selection(out, doc.sel.primIndex);\n  }\n\n  // Allow \"beforeChange\" event handlers to influence a change\n  function filterChange(doc, change, update) {\n    var obj = {\n      canceled: false,\n      from: change.from,\n      to: change.to,\n      text: change.text,\n      origin: change.origin,\n      cancel: function() { this.canceled = true; }\n    };\n    if (update) obj.update = function(from, to, text, origin) {\n      if (from) this.from = clipPos(doc, from);\n      if (to) this.to = clipPos(doc, to);\n      if (text) this.text = text;\n      if (origin !== undefined) this.origin = origin;\n    };\n    signal(doc, \"beforeChange\", doc, obj);\n    if (doc.cm) signal(doc.cm, \"beforeChange\", doc.cm, obj);\n\n    if (obj.canceled) return null;\n    return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin};\n  }\n\n  // Apply a change to a document, and add it to the document's\n  // history, and propagating it to all linked documents.\n  function makeChange(doc, change, ignoreReadOnly) {\n    if (doc.cm) {\n      if (!doc.cm.curOp) return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly);\n      if (doc.cm.state.suppressEdits) return;\n    }\n\n    if (hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\")) {\n      change = filterChange(doc, change, true);\n      if (!change) return;\n    }\n\n    // Possibly split or suppress the update based on the presence\n    // of read-only spans in its range.\n    var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\n    if (split) {\n      for (var i = split.length - 1; i >= 0; --i)\n        makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text});\n    } else {\n      makeChangeInner(doc, change);\n    }\n  }\n\n  function makeChangeInner(doc, change) {\n    if (change.text.length == 1 && change.text[0] == \"\" && cmp(change.from, change.to) == 0) return;\n    var selAfter = computeSelAfterChange(doc, change);\n    addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\n\n    makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\n    var rebased = [];\n\n    linkedDocs(doc, function(doc, sharedHist) {\n      if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n        rebaseHist(doc.history, change);\n        rebased.push(doc.history);\n      }\n      makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));\n    });\n  }\n\n  // Revert a change stored in a document's history.\n  function makeChangeFromHistory(doc, type, allowSelectionOnly) {\n    if (doc.cm && doc.cm.state.suppressEdits) return;\n\n    var hist = doc.history, event, selAfter = doc.sel;\n    var source = type == \"undo\" ? hist.done : hist.undone, dest = type == \"undo\" ? hist.undone : hist.done;\n\n    // Verify that there is a useable event (so that ctrl-z won't\n    // needlessly clear selection events)\n    for (var i = 0; i < source.length; i++) {\n      event = source[i];\n      if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)\n        break;\n    }\n    if (i == source.length) return;\n    hist.lastOrigin = hist.lastSelOrigin = null;\n\n    for (;;) {\n      event = source.pop();\n      if (event.ranges) {\n        pushSelectionToHistory(event, dest);\n        if (allowSelectionOnly && !event.equals(doc.sel)) {\n          setSelection(doc, event, {clearRedo: false});\n          return;\n        }\n        selAfter = event;\n      }\n      else break;\n    }\n\n    // Build up a reverse change object to add to the opposite history\n    // stack (redo when undoing, and vice versa).\n    var antiChanges = [];\n    pushSelectionToHistory(selAfter, dest);\n    dest.push({changes: antiChanges, generation: hist.generation});\n    hist.generation = event.generation || ++hist.maxGeneration;\n\n    var filter = hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\");\n\n    for (var i = event.changes.length - 1; i >= 0; --i) {\n      var change = event.changes[i];\n      change.origin = type;\n      if (filter && !filterChange(doc, change, false)) {\n        source.length = 0;\n        return;\n      }\n\n      antiChanges.push(historyChangeFromChange(doc, change));\n\n      var after = i ? computeSelAfterChange(doc, change) : lst(source);\n      makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));\n      if (!i && doc.cm) doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)});\n      var rebased = [];\n\n      // Propagate to the linked documents\n      linkedDocs(doc, function(doc, sharedHist) {\n        if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n          rebaseHist(doc.history, change);\n          rebased.push(doc.history);\n        }\n        makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));\n      });\n    }\n  }\n\n  // Sub-views need their line numbers shifted when text is added\n  // above or below them in the parent document.\n  function shiftDoc(doc, distance) {\n    if (distance == 0) return;\n    doc.first += distance;\n    doc.sel = new Selection(map(doc.sel.ranges, function(range) {\n      return new Range(Pos(range.anchor.line + distance, range.anchor.ch),\n                       Pos(range.head.line + distance, range.head.ch));\n    }), doc.sel.primIndex);\n    if (doc.cm) {\n      regChange(doc.cm, doc.first, doc.first - distance, distance);\n      for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)\n        regLineChange(doc.cm, l, \"gutter\");\n    }\n  }\n\n  // More lower-level change function, handling only a single document\n  // (not linked ones).\n  function makeChangeSingleDoc(doc, change, selAfter, spans) {\n    if (doc.cm && !doc.cm.curOp)\n      return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans);\n\n    if (change.to.line < doc.first) {\n      shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));\n      return;\n    }\n    if (change.from.line > doc.lastLine()) return;\n\n    // Clip the change to the size of this doc\n    if (change.from.line < doc.first) {\n      var shift = change.text.length - 1 - (doc.first - change.from.line);\n      shiftDoc(doc, shift);\n      change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),\n                text: [lst(change.text)], origin: change.origin};\n    }\n    var last = doc.lastLine();\n    if (change.to.line > last) {\n      change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),\n                text: [change.text[0]], origin: change.origin};\n    }\n\n    change.removed = getBetween(doc, change.from, change.to);\n\n    if (!selAfter) selAfter = computeSelAfterChange(doc, change);\n    if (doc.cm) makeChangeSingleDocInEditor(doc.cm, change, spans);\n    else updateDoc(doc, change, spans);\n    setSelectionNoUndo(doc, selAfter, sel_dontScroll);\n  }\n\n  // Handle the interaction of a change to a document with the editor\n  // that this document is part of.\n  function makeChangeSingleDocInEditor(cm, change, spans) {\n    var doc = cm.doc, display = cm.display, from = change.from, to = change.to;\n\n    var recomputeMaxLength = false, checkWidthStart = from.line;\n    if (!cm.options.lineWrapping) {\n      checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));\n      doc.iter(checkWidthStart, to.line + 1, function(line) {\n        if (line == display.maxLine) {\n          recomputeMaxLength = true;\n          return true;\n        }\n      });\n    }\n\n    if (doc.sel.contains(change.from, change.to) > -1)\n      signalCursorActivity(cm);\n\n    updateDoc(doc, change, spans, estimateHeight(cm));\n\n    if (!cm.options.lineWrapping) {\n      doc.iter(checkWidthStart, from.line + change.text.length, function(line) {\n        var len = lineLength(line);\n        if (len > display.maxLineLength) {\n          display.maxLine = line;\n          display.maxLineLength = len;\n          display.maxLineChanged = true;\n          recomputeMaxLength = false;\n        }\n      });\n      if (recomputeMaxLength) cm.curOp.updateMaxLine = true;\n    }\n\n    // Adjust frontier, schedule worker\n    doc.frontier = Math.min(doc.frontier, from.line);\n    startWorker(cm, 400);\n\n    var lendiff = change.text.length - (to.line - from.line) - 1;\n    // Remember that these lines changed, for updating the display\n    if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))\n      regLineChange(cm, from.line, \"text\");\n    else\n      regChange(cm, from.line, to.line + 1, lendiff);\n\n    var changesHandler = hasHandler(cm, \"changes\"), changeHandler = hasHandler(cm, \"change\");\n    if (changeHandler || changesHandler) {\n      var obj = {\n        from: from, to: to,\n        text: change.text,\n        removed: change.removed,\n        origin: change.origin\n      };\n      if (changeHandler) signalLater(cm, \"change\", cm, obj);\n      if (changesHandler) (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj);\n    }\n    cm.display.selForContextMenu = null;\n  }\n\n  function replaceRange(doc, code, from, to, origin) {\n    if (!to) to = from;\n    if (cmp(to, from) < 0) { var tmp = to; to = from; from = tmp; }\n    if (typeof code == \"string\") code = splitLines(code);\n    makeChange(doc, {from: from, to: to, text: code, origin: origin});\n  }\n\n  // SCROLLING THINGS INTO VIEW\n\n  // If an editor sits on the top or bottom of the window, partially\n  // scrolled out of view, this ensures that the cursor is visible.\n  function maybeScrollWindow(cm, coords) {\n    if (signalDOMEvent(cm, \"scrollCursorIntoView\")) return;\n\n    var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;\n    if (coords.top + box.top < 0) doScroll = true;\n    else if (coords.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) doScroll = false;\n    if (doScroll != null && !phantom) {\n      var scrollNode = elt(\"div\", \"\\u200b\", null, \"position: absolute; top: \" +\n                           (coords.top - display.viewOffset - paddingTop(cm.display)) + \"px; height: \" +\n                           (coords.bottom - coords.top + scrollerCutOff) + \"px; left: \" +\n                           coords.left + \"px; width: 2px;\");\n      cm.display.lineSpace.appendChild(scrollNode);\n      scrollNode.scrollIntoView(doScroll);\n      cm.display.lineSpace.removeChild(scrollNode);\n    }\n  }\n\n  // Scroll a given position into view (immediately), verifying that\n  // it actually became visible (as line heights are accurately\n  // measured, the position of something may 'drift' during drawing).\n  function scrollPosIntoView(cm, pos, end, margin) {\n    if (margin == null) margin = 0;\n    for (var limit = 0; limit < 5; limit++) {\n      var changed = false, coords = cursorCoords(cm, pos);\n      var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);\n      var scrollPos = calculateScrollPos(cm, Math.min(coords.left, endCoords.left),\n                                         Math.min(coords.top, endCoords.top) - margin,\n                                         Math.max(coords.left, endCoords.left),\n                                         Math.max(coords.bottom, endCoords.bottom) + margin);\n      var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;\n      if (scrollPos.scrollTop != null) {\n        setScrollTop(cm, scrollPos.scrollTop);\n        if (Math.abs(cm.doc.scrollTop - startTop) > 1) changed = true;\n      }\n      if (scrollPos.scrollLeft != null) {\n        setScrollLeft(cm, scrollPos.scrollLeft);\n        if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) changed = true;\n      }\n      if (!changed) return coords;\n    }\n  }\n\n  // Scroll a given set of coordinates into view (immediately).\n  function scrollIntoView(cm, x1, y1, x2, y2) {\n    var scrollPos = calculateScrollPos(cm, x1, y1, x2, y2);\n    if (scrollPos.scrollTop != null) setScrollTop(cm, scrollPos.scrollTop);\n    if (scrollPos.scrollLeft != null) setScrollLeft(cm, scrollPos.scrollLeft);\n  }\n\n  // Calculate a new scroll position needed to scroll the given\n  // rectangle into view. Returns an object with scrollTop and\n  // scrollLeft properties. When these are undefined, the\n  // vertical/horizontal position does not need to be adjusted.\n  function calculateScrollPos(cm, x1, y1, x2, y2) {\n    var display = cm.display, snapMargin = textHeight(cm.display);\n    if (y1 < 0) y1 = 0;\n    var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;\n    var screen = display.scroller.clientHeight - scrollerCutOff, result = {};\n    if (y2 - y1 > screen) y2 = y1 + screen;\n    var docBottom = cm.doc.height + paddingVert(display);\n    var atTop = y1 < snapMargin, atBottom = y2 > docBottom - snapMargin;\n    if (y1 < screentop) {\n      result.scrollTop = atTop ? 0 : y1;\n    } else if (y2 > screentop + screen) {\n      var newTop = Math.min(y1, (atBottom ? docBottom : y2) - screen);\n      if (newTop != screentop) result.scrollTop = newTop;\n    }\n\n    var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;\n    var screenw = display.scroller.clientWidth - scrollerCutOff - display.gutters.offsetWidth;\n    var tooWide = x2 - x1 > screenw;\n    if (tooWide) x2 = x1 + screenw;\n    if (x1 < 10)\n      result.scrollLeft = 0;\n    else if (x1 < screenleft)\n      result.scrollLeft = Math.max(0, x1 - (tooWide ? 0 : 10));\n    else if (x2 > screenw + screenleft - 3)\n      result.scrollLeft = x2 + (tooWide ? 0 : 10) - screenw;\n\n    return result;\n  }\n\n  // Store a relative adjustment to the scroll position in the current\n  // operation (to be applied when the operation finishes).\n  function addToScrollPos(cm, left, top) {\n    if (left != null || top != null) resolveScrollToPos(cm);\n    if (left != null)\n      cm.curOp.scrollLeft = (cm.curOp.scrollLeft == null ? cm.doc.scrollLeft : cm.curOp.scrollLeft) + left;\n    if (top != null)\n      cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;\n  }\n\n  // Make sure that at the end of the operation the current cursor is\n  // shown.\n  function ensureCursorVisible(cm) {\n    resolveScrollToPos(cm);\n    var cur = cm.getCursor(), from = cur, to = cur;\n    if (!cm.options.lineWrapping) {\n      from = cur.ch ? Pos(cur.line, cur.ch - 1) : cur;\n      to = Pos(cur.line, cur.ch + 1);\n    }\n    cm.curOp.scrollToPos = {from: from, to: to, margin: cm.options.cursorScrollMargin, isCursor: true};\n  }\n\n  // When an operation has its scrollToPos property set, and another\n  // scroll action is applied before the end of the operation, this\n  // 'simulates' scrolling that position into view in a cheap way, so\n  // that the effect of intermediate scroll commands is not ignored.\n  function resolveScrollToPos(cm) {\n    var range = cm.curOp.scrollToPos;\n    if (range) {\n      cm.curOp.scrollToPos = null;\n      var from = estimateCoords(cm, range.from), to = estimateCoords(cm, range.to);\n      var sPos = calculateScrollPos(cm, Math.min(from.left, to.left),\n                                    Math.min(from.top, to.top) - range.margin,\n                                    Math.max(from.right, to.right),\n                                    Math.max(from.bottom, to.bottom) + range.margin);\n      cm.scrollTo(sPos.scrollLeft, sPos.scrollTop);\n    }\n  }\n\n  // API UTILITIES\n\n  // Indent the given line. The how parameter can be \"smart\",\n  // \"add\"/null, \"subtract\", or \"prev\". When aggressive is false\n  // (typically set to true for forced single-line indents), empty\n  // lines are not indented, and places where the mode returns Pass\n  // are left alone.\n  function indentLine(cm, n, how, aggressive) {\n    var doc = cm.doc, state;\n    if (how == null) how = \"add\";\n    if (how == \"smart\") {\n      // Fall back to \"prev\" when the mode doesn't have an indentation\n      // method.\n      if (!doc.mode.indent) how = \"prev\";\n      else state = getStateBefore(cm, n);\n    }\n\n    var tabSize = cm.options.tabSize;\n    var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);\n    if (line.stateAfter) line.stateAfter = null;\n    var curSpaceString = line.text.match(/^\\s*/)[0], indentation;\n    if (!aggressive && !/\\S/.test(line.text)) {\n      indentation = 0;\n      how = \"not\";\n    } else if (how == \"smart\") {\n      indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);\n      if (indentation == Pass || indentation > 150) {\n        if (!aggressive) return;\n        how = \"prev\";\n      }\n    }\n    if (how == \"prev\") {\n      if (n > doc.first) indentation = countColumn(getLine(doc, n-1).text, null, tabSize);\n      else indentation = 0;\n    } else if (how == \"add\") {\n      indentation = curSpace + cm.options.indentUnit;\n    } else if (how == \"subtract\") {\n      indentation = curSpace - cm.options.indentUnit;\n    } else if (typeof how == \"number\") {\n      indentation = curSpace + how;\n    }\n    indentation = Math.max(0, indentation);\n\n    var indentString = \"\", pos = 0;\n    if (cm.options.indentWithTabs)\n      for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += \"\\t\";}\n    if (pos < indentation) indentString += spaceStr(indentation - pos);\n\n    if (indentString != curSpaceString) {\n      replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), \"+input\");\n    } else {\n      // Ensure that, if the cursor was in the whitespace at the start\n      // of the line, it is moved to the end of that space.\n      for (var i = 0; i < doc.sel.ranges.length; i++) {\n        var range = doc.sel.ranges[i];\n        if (range.head.line == n && range.head.ch < curSpaceString.length) {\n          var pos = Pos(n, curSpaceString.length);\n          replaceOneSelection(doc, i, new Range(pos, pos));\n          break;\n        }\n      }\n    }\n    line.stateAfter = null;\n  }\n\n  // Utility for applying a change to a line by handle or number,\n  // returning the number and optionally registering the line as\n  // changed.\n  function changeLine(doc, handle, changeType, op) {\n    var no = handle, line = handle;\n    if (typeof handle == \"number\") line = getLine(doc, clipLine(doc, handle));\n    else no = lineNo(handle);\n    if (no == null) return null;\n    if (op(line, no) && doc.cm) regLineChange(doc.cm, no, changeType);\n    return line;\n  }\n\n  // Helper for deleting text near the selection(s), used to implement\n  // backspace, delete, and similar functionality.\n  function deleteNearSelection(cm, compute) {\n    var ranges = cm.doc.sel.ranges, kill = [];\n    // Build up a set of ranges to kill first, merging overlapping\n    // ranges.\n    for (var i = 0; i < ranges.length; i++) {\n      var toKill = compute(ranges[i]);\n      while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {\n        var replaced = kill.pop();\n        if (cmp(replaced.from, toKill.from) < 0) {\n          toKill.from = replaced.from;\n          break;\n        }\n      }\n      kill.push(toKill);\n    }\n    // Next, remove those actual ranges.\n    runInOp(cm, function() {\n      for (var i = kill.length - 1; i >= 0; i--)\n        replaceRange(cm.doc, \"\", kill[i].from, kill[i].to, \"+delete\");\n      ensureCursorVisible(cm);\n    });\n  }\n\n  // Used for horizontal relative motion. Dir is -1 or 1 (left or\n  // right), unit can be \"char\", \"column\" (like char, but doesn't\n  // cross line boundaries), \"word\" (across next word), or \"group\" (to\n  // the start of next group of word or non-word-non-whitespace\n  // chars). The visually param controls whether, in right-to-left\n  // text, direction 1 means to move towards the next index in the\n  // string, or towards the character to the right of the current\n  // position. The resulting position will have a hitSide=true\n  // property if it reached the end of the document.\n  function findPosH(doc, pos, dir, unit, visually) {\n    var line = pos.line, ch = pos.ch, origDir = dir;\n    var lineObj = getLine(doc, line);\n    var possible = true;\n    function findNextLine() {\n      var l = line + dir;\n      if (l < doc.first || l >= doc.first + doc.size) return (possible = false);\n      line = l;\n      return lineObj = getLine(doc, l);\n    }\n    function moveOnce(boundToLine) {\n      var next = (visually ? moveVisually : moveLogically)(lineObj, ch, dir, true);\n      if (next == null) {\n        if (!boundToLine && findNextLine()) {\n          if (visually) ch = (dir < 0 ? lineRight : lineLeft)(lineObj);\n          else ch = dir < 0 ? lineObj.text.length : 0;\n        } else return (possible = false);\n      } else ch = next;\n      return true;\n    }\n\n    if (unit == \"char\") moveOnce();\n    else if (unit == \"column\") moveOnce(true);\n    else if (unit == \"word\" || unit == \"group\") {\n      var sawType = null, group = unit == \"group\";\n      var helper = doc.cm && doc.cm.getHelper(pos, \"wordChars\");\n      for (var first = true;; first = false) {\n        if (dir < 0 && !moveOnce(!first)) break;\n        var cur = lineObj.text.charAt(ch) || \"\\n\";\n        var type = isWordChar(cur, helper) ? \"w\"\n          : group && cur == \"\\n\" ? \"n\"\n          : !group || /\\s/.test(cur) ? null\n          : \"p\";\n        if (group && !first && !type) type = \"s\";\n        if (sawType && sawType != type) {\n          if (dir < 0) {dir = 1; moveOnce();}\n          break;\n        }\n\n        if (type) sawType = type;\n        if (dir > 0 && !moveOnce(!first)) break;\n      }\n    }\n    var result = skipAtomic(doc, Pos(line, ch), origDir, true);\n    if (!possible) result.hitSide = true;\n    return result;\n  }\n\n  // For relative vertical movement. Dir may be -1 or 1. Unit can be\n  // \"page\" or \"line\". The resulting position will have a hitSide=true\n  // property if it reached the end of the document.\n  function findPosV(cm, pos, dir, unit) {\n    var doc = cm.doc, x = pos.left, y;\n    if (unit == \"page\") {\n      var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);\n      y = pos.top + dir * (pageSize - (dir < 0 ? 1.5 : .5) * textHeight(cm.display));\n    } else if (unit == \"line\") {\n      y = dir > 0 ? pos.bottom + 3 : pos.top - 3;\n    }\n    for (;;) {\n      var target = coordsChar(cm, x, y);\n      if (!target.outside) break;\n      if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break; }\n      y += dir * 5;\n    }\n    return target;\n  }\n\n  // EDITOR METHODS\n\n  // The publicly visible API. Note that methodOp(f) means\n  // 'wrap f in an operation, performed on its `this` parameter'.\n\n  // This is not the complete set of editor methods. Most of the\n  // methods defined on the Doc type are also injected into\n  // CodeMirror.prototype, for backwards compatibility and\n  // convenience.\n\n  CodeMirror.prototype = {\n    constructor: CodeMirror,\n    focus: function(){window.focus(); focusInput(this); fastPoll(this);},\n\n    setOption: function(option, value) {\n      var options = this.options, old = options[option];\n      if (options[option] == value && option != \"mode\") return;\n      options[option] = value;\n      if (optionHandlers.hasOwnProperty(option))\n        operation(this, optionHandlers[option])(this, value, old);\n    },\n\n    getOption: function(option) {return this.options[option];},\n    getDoc: function() {return this.doc;},\n\n    addKeyMap: function(map, bottom) {\n      this.state.keyMaps[bottom ? \"push\" : \"unshift\"](getKeyMap(map));\n    },\n    removeKeyMap: function(map) {\n      var maps = this.state.keyMaps;\n      for (var i = 0; i < maps.length; ++i)\n        if (maps[i] == map || maps[i].name == map) {\n          maps.splice(i, 1);\n          return true;\n        }\n    },\n\n    addOverlay: methodOp(function(spec, options) {\n      var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);\n      if (mode.startState) throw new Error(\"Overlays may not be stateful.\");\n      this.state.overlays.push({mode: mode, modeSpec: spec, opaque: options && options.opaque});\n      this.state.modeGen++;\n      regChange(this);\n    }),\n    removeOverlay: methodOp(function(spec) {\n      var overlays = this.state.overlays;\n      for (var i = 0; i < overlays.length; ++i) {\n        var cur = overlays[i].modeSpec;\n        if (cur == spec || typeof spec == \"string\" && cur.name == spec) {\n          overlays.splice(i, 1);\n          this.state.modeGen++;\n          regChange(this);\n          return;\n        }\n      }\n    }),\n\n    indentLine: methodOp(function(n, dir, aggressive) {\n      if (typeof dir != \"string\" && typeof dir != \"number\") {\n        if (dir == null) dir = this.options.smartIndent ? \"smart\" : \"prev\";\n        else dir = dir ? \"add\" : \"subtract\";\n      }\n      if (isLine(this.doc, n)) indentLine(this, n, dir, aggressive);\n    }),\n    indentSelection: methodOp(function(how) {\n      var ranges = this.doc.sel.ranges, end = -1;\n      for (var i = 0; i < ranges.length; i++) {\n        var range = ranges[i];\n        if (!range.empty()) {\n          var from = range.from(), to = range.to();\n          var start = Math.max(end, from.line);\n          end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;\n          for (var j = start; j < end; ++j)\n            indentLine(this, j, how);\n          var newRanges = this.doc.sel.ranges;\n          if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)\n            replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll);\n        } else if (range.head.line > end) {\n          indentLine(this, range.head.line, how, true);\n          end = range.head.line;\n          if (i == this.doc.sel.primIndex) ensureCursorVisible(this);\n        }\n      }\n    }),\n\n    // Fetch the parser token for a given character. Useful for hacks\n    // that want to inspect the mode state (say, for completion).\n    getTokenAt: function(pos, precise) {\n      return takeToken(this, pos, precise);\n    },\n\n    getLineTokens: function(line, precise) {\n      return takeToken(this, Pos(line), precise, true);\n    },\n\n    getTokenTypeAt: function(pos) {\n      pos = clipPos(this.doc, pos);\n      var styles = getLineStyles(this, getLine(this.doc, pos.line));\n      var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;\n      var type;\n      if (ch == 0) type = styles[2];\n      else for (;;) {\n        var mid = (before + after) >> 1;\n        if ((mid ? styles[mid * 2 - 1] : 0) >= ch) after = mid;\n        else if (styles[mid * 2 + 1] < ch) before = mid + 1;\n        else { type = styles[mid * 2 + 2]; break; }\n      }\n      var cut = type ? type.indexOf(\"cm-overlay \") : -1;\n      return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1);\n    },\n\n    getModeAt: function(pos) {\n      var mode = this.doc.mode;\n      if (!mode.innerMode) return mode;\n      return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode;\n    },\n\n    getHelper: function(pos, type) {\n      return this.getHelpers(pos, type)[0];\n    },\n\n    getHelpers: function(pos, type) {\n      var found = [];\n      if (!helpers.hasOwnProperty(type)) return helpers;\n      var help = helpers[type], mode = this.getModeAt(pos);\n      if (typeof mode[type] == \"string\") {\n        if (help[mode[type]]) found.push(help[mode[type]]);\n      } else if (mode[type]) {\n        for (var i = 0; i < mode[type].length; i++) {\n          var val = help[mode[type][i]];\n          if (val) found.push(val);\n        }\n      } else if (mode.helperType && help[mode.helperType]) {\n        found.push(help[mode.helperType]);\n      } else if (help[mode.name]) {\n        found.push(help[mode.name]);\n      }\n      for (var i = 0; i < help._global.length; i++) {\n        var cur = help._global[i];\n        if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)\n          found.push(cur.val);\n      }\n      return found;\n    },\n\n    getStateAfter: function(line, precise) {\n      var doc = this.doc;\n      line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);\n      return getStateBefore(this, line + 1, precise);\n    },\n\n    cursorCoords: function(start, mode) {\n      var pos, range = this.doc.sel.primary();\n      if (start == null) pos = range.head;\n      else if (typeof start == \"object\") pos = clipPos(this.doc, start);\n      else pos = start ? range.from() : range.to();\n      return cursorCoords(this, pos, mode || \"page\");\n    },\n\n    charCoords: function(pos, mode) {\n      return charCoords(this, clipPos(this.doc, pos), mode || \"page\");\n    },\n\n    coordsChar: function(coords, mode) {\n      coords = fromCoordSystem(this, coords, mode || \"page\");\n      return coordsChar(this, coords.left, coords.top);\n    },\n\n    lineAtHeight: function(height, mode) {\n      height = fromCoordSystem(this, {top: height, left: 0}, mode || \"page\").top;\n      return lineAtHeight(this.doc, height + this.display.viewOffset);\n    },\n    heightAtLine: function(line, mode) {\n      var end = false, last = this.doc.first + this.doc.size - 1;\n      if (line < this.doc.first) line = this.doc.first;\n      else if (line > last) { line = last; end = true; }\n      var lineObj = getLine(this.doc, line);\n      return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || \"page\").top +\n        (end ? this.doc.height - heightAtLine(lineObj) : 0);\n    },\n\n    defaultTextHeight: function() { return textHeight(this.display); },\n    defaultCharWidth: function() { return charWidth(this.display); },\n\n    setGutterMarker: methodOp(function(line, gutterID, value) {\n      return changeLine(this.doc, line, \"gutter\", function(line) {\n        var markers = line.gutterMarkers || (line.gutterMarkers = {});\n        markers[gutterID] = value;\n        if (!value && isEmpty(markers)) line.gutterMarkers = null;\n        return true;\n      });\n    }),\n\n    clearGutter: methodOp(function(gutterID) {\n      var cm = this, doc = cm.doc, i = doc.first;\n      doc.iter(function(line) {\n        if (line.gutterMarkers && line.gutterMarkers[gutterID]) {\n          line.gutterMarkers[gutterID] = null;\n          regLineChange(cm, i, \"gutter\");\n          if (isEmpty(line.gutterMarkers)) line.gutterMarkers = null;\n        }\n        ++i;\n      });\n    }),\n\n    addLineWidget: methodOp(function(handle, node, options) {\n      return addLineWidget(this, handle, node, options);\n    }),\n\n    removeLineWidget: function(widget) { widget.clear(); },\n\n    lineInfo: function(line) {\n      if (typeof line == \"number\") {\n        if (!isLine(this.doc, line)) return null;\n        var n = line;\n        line = getLine(this.doc, line);\n        if (!line) return null;\n      } else {\n        var n = lineNo(line);\n        if (n == null) return null;\n      }\n      return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,\n              textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,\n              widgets: line.widgets};\n    },\n\n    getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo};},\n\n    addWidget: function(pos, node, scroll, vert, horiz) {\n      var display = this.display;\n      pos = cursorCoords(this, clipPos(this.doc, pos));\n      var top = pos.bottom, left = pos.left;\n      node.style.position = \"absolute\";\n      display.sizer.appendChild(node);\n      if (vert == \"over\") {\n        top = pos.top;\n      } else if (vert == \"above\" || vert == \"near\") {\n        var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),\n        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);\n        // Default to positioning above (if specified and possible); otherwise default to positioning below\n        if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)\n          top = pos.top - node.offsetHeight;\n        else if (pos.bottom + node.offsetHeight <= vspace)\n          top = pos.bottom;\n        if (left + node.offsetWidth > hspace)\n          left = hspace - node.offsetWidth;\n      }\n      node.style.top = top + \"px\";\n      node.style.left = node.style.right = \"\";\n      if (horiz == \"right\") {\n        left = display.sizer.clientWidth - node.offsetWidth;\n        node.style.right = \"0px\";\n      } else {\n        if (horiz == \"left\") left = 0;\n        else if (horiz == \"middle\") left = (display.sizer.clientWidth - node.offsetWidth) / 2;\n        node.style.left = left + \"px\";\n      }\n      if (scroll)\n        scrollIntoView(this, left, top, left + node.offsetWidth, top + node.offsetHeight);\n    },\n\n    triggerOnKeyDown: methodOp(onKeyDown),\n    triggerOnKeyPress: methodOp(onKeyPress),\n    triggerOnKeyUp: onKeyUp,\n\n    execCommand: function(cmd) {\n      if (commands.hasOwnProperty(cmd))\n        return commands[cmd](this);\n    },\n\n    findPosH: function(from, amount, unit, visually) {\n      var dir = 1;\n      if (amount < 0) { dir = -1; amount = -amount; }\n      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\n        cur = findPosH(this.doc, cur, dir, unit, visually);\n        if (cur.hitSide) break;\n      }\n      return cur;\n    },\n\n    moveH: methodOp(function(dir, unit) {\n      var cm = this;\n      cm.extendSelectionsBy(function(range) {\n        if (cm.display.shift || cm.doc.extend || range.empty())\n          return findPosH(cm.doc, range.head, dir, unit, cm.options.rtlMoveVisually);\n        else\n          return dir < 0 ? range.from() : range.to();\n      }, sel_move);\n    }),\n\n    deleteH: methodOp(function(dir, unit) {\n      var sel = this.doc.sel, doc = this.doc;\n      if (sel.somethingSelected())\n        doc.replaceSelection(\"\", null, \"+delete\");\n      else\n        deleteNearSelection(this, function(range) {\n          var other = findPosH(doc, range.head, dir, unit, false);\n          return dir < 0 ? {from: other, to: range.head} : {from: range.head, to: other};\n        });\n    }),\n\n    findPosV: function(from, amount, unit, goalColumn) {\n      var dir = 1, x = goalColumn;\n      if (amount < 0) { dir = -1; amount = -amount; }\n      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\n        var coords = cursorCoords(this, cur, \"div\");\n        if (x == null) x = coords.left;\n        else coords.left = x;\n        cur = findPosV(this, coords, dir, unit);\n        if (cur.hitSide) break;\n      }\n      return cur;\n    },\n\n    moveV: methodOp(function(dir, unit) {\n      var cm = this, doc = this.doc, goals = [];\n      var collapse = !cm.display.shift && !doc.extend && doc.sel.somethingSelected();\n      doc.extendSelectionsBy(function(range) {\n        if (collapse)\n          return dir < 0 ? range.from() : range.to();\n        var headPos = cursorCoords(cm, range.head, \"div\");\n        if (range.goalColumn != null) headPos.left = range.goalColumn;\n        goals.push(headPos.left);\n        var pos = findPosV(cm, headPos, dir, unit);\n        if (unit == \"page\" && range == doc.sel.primary())\n          addToScrollPos(cm, null, charCoords(cm, pos, \"div\").top - headPos.top);\n        return pos;\n      }, sel_move);\n      if (goals.length) for (var i = 0; i < doc.sel.ranges.length; i++)\n        doc.sel.ranges[i].goalColumn = goals[i];\n    }),\n\n    // Find the word at the given position (as returned by coordsChar).\n    findWordAt: function(pos) {\n      var doc = this.doc, line = getLine(doc, pos.line).text;\n      var start = pos.ch, end = pos.ch;\n      if (line) {\n        var helper = this.getHelper(pos, \"wordChars\");\n        if ((pos.xRel < 0 || end == line.length) && start) --start; else ++end;\n        var startChar = line.charAt(start);\n        var check = isWordChar(startChar, helper)\n          ? function(ch) { return isWordChar(ch, helper); }\n          : /\\s/.test(startChar) ? function(ch) {return /\\s/.test(ch);}\n          : function(ch) {return !/\\s/.test(ch) && !isWordChar(ch);};\n        while (start > 0 && check(line.charAt(start - 1))) --start;\n        while (end < line.length && check(line.charAt(end))) ++end;\n      }\n      return new Range(Pos(pos.line, start), Pos(pos.line, end));\n    },\n\n    toggleOverwrite: function(value) {\n      if (value != null && value == this.state.overwrite) return;\n      if (this.state.overwrite = !this.state.overwrite)\n        addClass(this.display.cursorDiv, \"CodeMirror-overwrite\");\n      else\n        rmClass(this.display.cursorDiv, \"CodeMirror-overwrite\");\n\n      signal(this, \"overwriteToggle\", this, this.state.overwrite);\n    },\n    hasFocus: function() { return activeElt() == this.display.input; },\n\n    scrollTo: methodOp(function(x, y) {\n      if (x != null || y != null) resolveScrollToPos(this);\n      if (x != null) this.curOp.scrollLeft = x;\n      if (y != null) this.curOp.scrollTop = y;\n    }),\n    getScrollInfo: function() {\n      var scroller = this.display.scroller, co = scrollerCutOff;\n      return {left: scroller.scrollLeft, top: scroller.scrollTop,\n              height: scroller.scrollHeight - co, width: scroller.scrollWidth - co,\n              clientHeight: scroller.clientHeight - co, clientWidth: scroller.clientWidth - co};\n    },\n\n    scrollIntoView: methodOp(function(range, margin) {\n      if (range == null) {\n        range = {from: this.doc.sel.primary().head, to: null};\n        if (margin == null) margin = this.options.cursorScrollMargin;\n      } else if (typeof range == \"number\") {\n        range = {from: Pos(range, 0), to: null};\n      } else if (range.from == null) {\n        range = {from: range, to: null};\n      }\n      if (!range.to) range.to = range.from;\n      range.margin = margin || 0;\n\n      if (range.from.line != null) {\n        resolveScrollToPos(this);\n        this.curOp.scrollToPos = range;\n      } else {\n        var sPos = calculateScrollPos(this, Math.min(range.from.left, range.to.left),\n                                      Math.min(range.from.top, range.to.top) - range.margin,\n                                      Math.max(range.from.right, range.to.right),\n                                      Math.max(range.from.bottom, range.to.bottom) + range.margin);\n        this.scrollTo(sPos.scrollLeft, sPos.scrollTop);\n      }\n    }),\n\n    setSize: methodOp(function(width, height) {\n      var cm = this;\n      function interpret(val) {\n        return typeof val == \"number\" || /^\\d+$/.test(String(val)) ? val + \"px\" : val;\n      }\n      if (width != null) cm.display.wrapper.style.width = interpret(width);\n      if (height != null) cm.display.wrapper.style.height = interpret(height);\n      if (cm.options.lineWrapping) clearLineMeasurementCache(this);\n      var lineNo = cm.display.viewFrom;\n      cm.doc.iter(lineNo, cm.display.viewTo, function(line) {\n        if (line.widgets) for (var i = 0; i < line.widgets.length; i++)\n          if (line.widgets[i].noHScroll) { regLineChange(cm, lineNo, \"widget\"); break; }\n        ++lineNo;\n      });\n      cm.curOp.forceUpdate = true;\n      signal(cm, \"refresh\", this);\n    }),\n\n    operation: function(f){return runInOp(this, f);},\n\n    refresh: methodOp(function() {\n      var oldHeight = this.display.cachedTextHeight;\n      regChange(this);\n      this.curOp.forceUpdate = true;\n      clearCaches(this);\n      this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop);\n      updateGutterSpace(this);\n      if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)\n        estimateLineHeights(this);\n      signal(this, \"refresh\", this);\n    }),\n\n    swapDoc: methodOp(function(doc) {\n      var old = this.doc;\n      old.cm = null;\n      attachDoc(this, doc);\n      clearCaches(this);\n      resetInput(this);\n      this.scrollTo(doc.scrollLeft, doc.scrollTop);\n      this.curOp.forceScroll = true;\n      signalLater(this, \"swapDoc\", this, old);\n      return old;\n    }),\n\n    getInputField: function(){return this.display.input;},\n    getWrapperElement: function(){return this.display.wrapper;},\n    getScrollerElement: function(){return this.display.scroller;},\n    getGutterElement: function(){return this.display.gutters;}\n  };\n  eventMixin(CodeMirror);\n\n  // OPTION DEFAULTS\n\n  // The default configuration options.\n  var defaults = CodeMirror.defaults = {};\n  // Functions to run when options are changed.\n  var optionHandlers = CodeMirror.optionHandlers = {};\n\n  function option(name, deflt, handle, notOnInit) {\n    CodeMirror.defaults[name] = deflt;\n    if (handle) optionHandlers[name] =\n      notOnInit ? function(cm, val, old) {if (old != Init) handle(cm, val, old);} : handle;\n  }\n\n  // Passed to option handlers when there is no old value.\n  var Init = CodeMirror.Init = {toString: function(){return \"CodeMirror.Init\";}};\n\n  // These two are, on init, called from the constructor because they\n  // have to be initialized before the editor can start at all.\n  option(\"value\", \"\", function(cm, val) {\n    cm.setValue(val);\n  }, true);\n  option(\"mode\", null, function(cm, val) {\n    cm.doc.modeOption = val;\n    loadMode(cm);\n  }, true);\n\n  option(\"indentUnit\", 2, loadMode, true);\n  option(\"indentWithTabs\", false);\n  option(\"smartIndent\", true);\n  option(\"tabSize\", 4, function(cm) {\n    resetModeState(cm);\n    clearCaches(cm);\n    regChange(cm);\n  }, true);\n  option(\"specialChars\", /[\\t\\u0000-\\u0019\\u00ad\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g, function(cm, val) {\n    cm.options.specialChars = new RegExp(val.source + (val.test(\"\\t\") ? \"\" : \"|\\t\"), \"g\");\n    cm.refresh();\n  }, true);\n  option(\"specialCharPlaceholder\", defaultSpecialCharPlaceholder, function(cm) {cm.refresh();}, true);\n  option(\"electricChars\", true);\n  option(\"rtlMoveVisually\", !windows);\n  option(\"wholeLineUpdateBefore\", true);\n\n  option(\"theme\", \"default\", function(cm) {\n    themeChanged(cm);\n    guttersChanged(cm);\n  }, true);\n  option(\"keyMap\", \"default\", function(cm, val, old) {\n    var next = getKeyMap(val);\n    var prev = old != CodeMirror.Init && getKeyMap(old);\n    if (prev && prev.detach) prev.detach(cm, next);\n    if (next.attach) next.attach(cm, prev || null);\n  });\n  option(\"extraKeys\", null);\n\n  option(\"lineWrapping\", false, wrappingChanged, true);\n  option(\"gutters\", [], function(cm) {\n    setGuttersForLineNumbers(cm.options);\n    guttersChanged(cm);\n  }, true);\n  option(\"fixedGutter\", true, function(cm, val) {\n    cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + \"px\" : \"0\";\n    cm.refresh();\n  }, true);\n  option(\"coverGutterNextToScrollbar\", false, updateScrollbars, true);\n  option(\"lineNumbers\", false, function(cm) {\n    setGuttersForLineNumbers(cm.options);\n    guttersChanged(cm);\n  }, true);\n  option(\"firstLineNumber\", 1, guttersChanged, true);\n  option(\"lineNumberFormatter\", function(integer) {return integer;}, guttersChanged, true);\n  option(\"showCursorWhenSelecting\", false, updateSelection, true);\n\n  option(\"resetSelectionOnContextMenu\", true);\n\n  option(\"readOnly\", false, function(cm, val) {\n    if (val == \"nocursor\") {\n      onBlur(cm);\n      cm.display.input.blur();\n      cm.display.disabled = true;\n    } else {\n      cm.display.disabled = false;\n      if (!val) resetInput(cm);\n    }\n  });\n  option(\"disableInput\", false, function(cm, val) {if (!val) resetInput(cm);}, true);\n  option(\"dragDrop\", true);\n\n  option(\"cursorBlinkRate\", 530);\n  option(\"cursorScrollMargin\", 0);\n  option(\"cursorHeight\", 1, updateSelection, true);\n  option(\"singleCursorHeightPerLine\", true, updateSelection, true);\n  option(\"workTime\", 100);\n  option(\"workDelay\", 100);\n  option(\"flattenSpans\", true, resetModeState, true);\n  option(\"addModeClass\", false, resetModeState, true);\n  option(\"pollInterval\", 100);\n  option(\"undoDepth\", 200, function(cm, val){cm.doc.history.undoDepth = val;});\n  option(\"historyEventDelay\", 1250);\n  option(\"viewportMargin\", 10, function(cm){cm.refresh();}, true);\n  option(\"maxHighlightLength\", 10000, resetModeState, true);\n  option(\"moveInputWithCursor\", true, function(cm, val) {\n    if (!val) cm.display.inputDiv.style.top = cm.display.inputDiv.style.left = 0;\n  });\n\n  option(\"tabindex\", null, function(cm, val) {\n    cm.display.input.tabIndex = val || \"\";\n  });\n  option(\"autofocus\", null);\n\n  // MODE DEFINITION AND QUERYING\n\n  // Known modes, by name and by MIME\n  var modes = CodeMirror.modes = {}, mimeModes = CodeMirror.mimeModes = {};\n\n  // Extra arguments are stored as the mode's dependencies, which is\n  // used by (legacy) mechanisms like loadmode.js to automatically\n  // load a mode. (Preferred mechanism is the require/define calls.)\n  CodeMirror.defineMode = function(name, mode) {\n    if (!CodeMirror.defaults.mode && name != \"null\") CodeMirror.defaults.mode = name;\n    if (arguments.length > 2)\n      mode.dependencies = Array.prototype.slice.call(arguments, 2);\n    modes[name] = mode;\n  };\n\n  CodeMirror.defineMIME = function(mime, spec) {\n    mimeModes[mime] = spec;\n  };\n\n  // Given a MIME type, a {name, ...options} config object, or a name\n  // string, return a mode config object.\n  CodeMirror.resolveMode = function(spec) {\n    if (typeof spec == \"string\" && mimeModes.hasOwnProperty(spec)) {\n      spec = mimeModes[spec];\n    } else if (spec && typeof spec.name == \"string\" && mimeModes.hasOwnProperty(spec.name)) {\n      var found = mimeModes[spec.name];\n      if (typeof found == \"string\") found = {name: found};\n      spec = createObj(found, spec);\n      spec.name = found.name;\n    } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {\n      return CodeMirror.resolveMode(\"application/xml\");\n    }\n    if (typeof spec == \"string\") return {name: spec};\n    else return spec || {name: \"null\"};\n  };\n\n  // Given a mode spec (anything that resolveMode accepts), find and\n  // initialize an actual mode object.\n  CodeMirror.getMode = function(options, spec) {\n    var spec = CodeMirror.resolveMode(spec);\n    var mfactory = modes[spec.name];\n    if (!mfactory) return CodeMirror.getMode(options, \"text/plain\");\n    var modeObj = mfactory(options, spec);\n    if (modeExtensions.hasOwnProperty(spec.name)) {\n      var exts = modeExtensions[spec.name];\n      for (var prop in exts) {\n        if (!exts.hasOwnProperty(prop)) continue;\n        if (modeObj.hasOwnProperty(prop)) modeObj[\"_\" + prop] = modeObj[prop];\n        modeObj[prop] = exts[prop];\n      }\n    }\n    modeObj.name = spec.name;\n    if (spec.helperType) modeObj.helperType = spec.helperType;\n    if (spec.modeProps) for (var prop in spec.modeProps)\n      modeObj[prop] = spec.modeProps[prop];\n\n    return modeObj;\n  };\n\n  // Minimal default mode.\n  CodeMirror.defineMode(\"null\", function() {\n    return {token: function(stream) {stream.skipToEnd();}};\n  });\n  CodeMirror.defineMIME(\"text/plain\", \"null\");\n\n  // This can be used to attach properties to mode objects from\n  // outside the actual mode definition.\n  var modeExtensions = CodeMirror.modeExtensions = {};\n  CodeMirror.extendMode = function(mode, properties) {\n    var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});\n    copyObj(properties, exts);\n  };\n\n  // EXTENSIONS\n\n  CodeMirror.defineExtension = function(name, func) {\n    CodeMirror.prototype[name] = func;\n  };\n  CodeMirror.defineDocExtension = function(name, func) {\n    Doc.prototype[name] = func;\n  };\n  CodeMirror.defineOption = option;\n\n  var initHooks = [];\n  CodeMirror.defineInitHook = function(f) {initHooks.push(f);};\n\n  var helpers = CodeMirror.helpers = {};\n  CodeMirror.registerHelper = function(type, name, value) {\n    if (!helpers.hasOwnProperty(type)) helpers[type] = CodeMirror[type] = {_global: []};\n    helpers[type][name] = value;\n  };\n  CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {\n    CodeMirror.registerHelper(type, name, value);\n    helpers[type]._global.push({pred: predicate, val: value});\n  };\n\n  // MODE STATE HANDLING\n\n  // Utility functions for working with state. Exported because nested\n  // modes need to do this for their inner modes.\n\n  var copyState = CodeMirror.copyState = function(mode, state) {\n    if (state === true) return state;\n    if (mode.copyState) return mode.copyState(state);\n    var nstate = {};\n    for (var n in state) {\n      var val = state[n];\n      if (val instanceof Array) val = val.concat([]);\n      nstate[n] = val;\n    }\n    return nstate;\n  };\n\n  var startState = CodeMirror.startState = function(mode, a1, a2) {\n    return mode.startState ? mode.startState(a1, a2) : true;\n  };\n\n  // Given a mode and a state (for that mode), find the inner mode and\n  // state at the position that the state refers to.\n  CodeMirror.innerMode = function(mode, state) {\n    while (mode.innerMode) {\n      var info = mode.innerMode(state);\n      if (!info || info.mode == mode) break;\n      state = info.state;\n      mode = info.mode;\n    }\n    return info || {mode: mode, state: state};\n  };\n\n  // STANDARD COMMANDS\n\n  // Commands are parameter-less actions that can be performed on an\n  // editor, mostly used for keybindings.\n  var commands = CodeMirror.commands = {\n    selectAll: function(cm) {cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);},\n    singleSelection: function(cm) {\n      cm.setSelection(cm.getCursor(\"anchor\"), cm.getCursor(\"head\"), sel_dontScroll);\n    },\n    killLine: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        if (range.empty()) {\n          var len = getLine(cm.doc, range.head.line).text.length;\n          if (range.head.ch == len && range.head.line < cm.lastLine())\n            return {from: range.head, to: Pos(range.head.line + 1, 0)};\n          else\n            return {from: range.head, to: Pos(range.head.line, len)};\n        } else {\n          return {from: range.from(), to: range.to()};\n        }\n      });\n    },\n    deleteLine: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        return {from: Pos(range.from().line, 0),\n                to: clipPos(cm.doc, Pos(range.to().line + 1, 0))};\n      });\n    },\n    delLineLeft: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        return {from: Pos(range.from().line, 0), to: range.from()};\n      });\n    },\n    delWrappedLineLeft: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var leftPos = cm.coordsChar({left: 0, top: top}, \"div\");\n        return {from: leftPos, to: range.from()};\n      });\n    },\n    delWrappedLineRight: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\n        return {from: range.from(), to: rightPos };\n      });\n    },\n    undo: function(cm) {cm.undo();},\n    redo: function(cm) {cm.redo();},\n    undoSelection: function(cm) {cm.undoSelection();},\n    redoSelection: function(cm) {cm.redoSelection();},\n    goDocStart: function(cm) {cm.extendSelection(Pos(cm.firstLine(), 0));},\n    goDocEnd: function(cm) {cm.extendSelection(Pos(cm.lastLine()));},\n    goLineStart: function(cm) {\n      cm.extendSelectionsBy(function(range) { return lineStart(cm, range.head.line); },\n                            {origin: \"+move\", bias: 1});\n    },\n    goLineStartSmart: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        return lineStartSmart(cm, range.head);\n      }, {origin: \"+move\", bias: 1});\n    },\n    goLineEnd: function(cm) {\n      cm.extendSelectionsBy(function(range) { return lineEnd(cm, range.head.line); },\n                            {origin: \"+move\", bias: -1});\n    },\n    goLineRight: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\n      }, sel_move);\n    },\n    goLineLeft: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        return cm.coordsChar({left: 0, top: top}, \"div\");\n      }, sel_move);\n    },\n    goLineLeftSmart: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var pos = cm.coordsChar({left: 0, top: top}, \"div\");\n        if (pos.ch < cm.getLine(pos.line).search(/\\S/)) return lineStartSmart(cm, range.head);\n        return pos;\n      }, sel_move);\n    },\n    goLineUp: function(cm) {cm.moveV(-1, \"line\");},\n    goLineDown: function(cm) {cm.moveV(1, \"line\");},\n    goPageUp: function(cm) {cm.moveV(-1, \"page\");},\n    goPageDown: function(cm) {cm.moveV(1, \"page\");},\n    goCharLeft: function(cm) {cm.moveH(-1, \"char\");},\n    goCharRight: function(cm) {cm.moveH(1, \"char\");},\n    goColumnLeft: function(cm) {cm.moveH(-1, \"column\");},\n    goColumnRight: function(cm) {cm.moveH(1, \"column\");},\n    goWordLeft: function(cm) {cm.moveH(-1, \"word\");},\n    goGroupRight: function(cm) {cm.moveH(1, \"group\");},\n    goGroupLeft: function(cm) {cm.moveH(-1, \"group\");},\n    goWordRight: function(cm) {cm.moveH(1, \"word\");},\n    delCharBefore: function(cm) {cm.deleteH(-1, \"char\");},\n    delCharAfter: function(cm) {cm.deleteH(1, \"char\");},\n    delWordBefore: function(cm) {cm.deleteH(-1, \"word\");},\n    delWordAfter: function(cm) {cm.deleteH(1, \"word\");},\n    delGroupBefore: function(cm) {cm.deleteH(-1, \"group\");},\n    delGroupAfter: function(cm) {cm.deleteH(1, \"group\");},\n    indentAuto: function(cm) {cm.indentSelection(\"smart\");},\n    indentMore: function(cm) {cm.indentSelection(\"add\");},\n    indentLess: function(cm) {cm.indentSelection(\"subtract\");},\n    insertTab: function(cm) {cm.replaceSelection(\"\\t\");},\n    insertSoftTab: function(cm) {\n      var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;\n      for (var i = 0; i < ranges.length; i++) {\n        var pos = ranges[i].from();\n        var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);\n        spaces.push(new Array(tabSize - col % tabSize + 1).join(\" \"));\n      }\n      cm.replaceSelections(spaces);\n    },\n    defaultTab: function(cm) {\n      if (cm.somethingSelected()) cm.indentSelection(\"add\");\n      else cm.execCommand(\"insertTab\");\n    },\n    transposeChars: function(cm) {\n      runInOp(cm, function() {\n        var ranges = cm.listSelections(), newSel = [];\n        for (var i = 0; i < ranges.length; i++) {\n          var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;\n          if (line) {\n            if (cur.ch == line.length) cur = new Pos(cur.line, cur.ch - 1);\n            if (cur.ch > 0) {\n              cur = new Pos(cur.line, cur.ch + 1);\n              cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),\n                              Pos(cur.line, cur.ch - 2), cur, \"+transpose\");\n            } else if (cur.line > cm.doc.first) {\n              var prev = getLine(cm.doc, cur.line - 1).text;\n              if (prev)\n                cm.replaceRange(line.charAt(0) + \"\\n\" + prev.charAt(prev.length - 1),\n                                Pos(cur.line - 1, prev.length - 1), Pos(cur.line, 1), \"+transpose\");\n            }\n          }\n          newSel.push(new Range(cur, cur));\n        }\n        cm.setSelections(newSel);\n      });\n    },\n    newlineAndIndent: function(cm) {\n      runInOp(cm, function() {\n        var len = cm.listSelections().length;\n        for (var i = 0; i < len; i++) {\n          var range = cm.listSelections()[i];\n          cm.replaceRange(\"\\n\", range.anchor, range.head, \"+input\");\n          cm.indentLine(range.from().line + 1, null, true);\n          ensureCursorVisible(cm);\n        }\n      });\n    },\n    toggleOverwrite: function(cm) {cm.toggleOverwrite();}\n  };\n\n\n  // STANDARD KEYMAPS\n\n  var keyMap = CodeMirror.keyMap = {};\n\n  keyMap.basic = {\n    \"Left\": \"goCharLeft\", \"Right\": \"goCharRight\", \"Up\": \"goLineUp\", \"Down\": \"goLineDown\",\n    \"End\": \"goLineEnd\", \"Home\": \"goLineStartSmart\", \"PageUp\": \"goPageUp\", \"PageDown\": \"goPageDown\",\n    \"Delete\": \"delCharAfter\", \"Backspace\": \"delCharBefore\", \"Shift-Backspace\": \"delCharBefore\",\n    \"Tab\": \"defaultTab\", \"Shift-Tab\": \"indentAuto\",\n    \"Enter\": \"newlineAndIndent\", \"Insert\": \"toggleOverwrite\",\n    \"Esc\": \"singleSelection\"\n  };\n  // Note that the save and find-related commands aren't defined by\n  // default. User code or addons can define them. Unknown commands\n  // are simply ignored.\n  keyMap.pcDefault = {\n    \"Ctrl-A\": \"selectAll\", \"Ctrl-D\": \"deleteLine\", \"Ctrl-Z\": \"undo\", \"Shift-Ctrl-Z\": \"redo\", \"Ctrl-Y\": \"redo\",\n    \"Ctrl-Home\": \"goDocStart\", \"Ctrl-End\": \"goDocEnd\", \"Ctrl-Up\": \"goLineUp\", \"Ctrl-Down\": \"goLineDown\",\n    \"Ctrl-Left\": \"goGroupLeft\", \"Ctrl-Right\": \"goGroupRight\", \"Alt-Left\": \"goLineStart\", \"Alt-Right\": \"goLineEnd\",\n    \"Ctrl-Backspace\": \"delGroupBefore\", \"Ctrl-Delete\": \"delGroupAfter\", \"Ctrl-S\": \"save\", \"Ctrl-F\": \"find\",\n    \"Ctrl-G\": \"findNext\", \"Shift-Ctrl-G\": \"findPrev\", \"Shift-Ctrl-F\": \"replace\", \"Shift-Ctrl-R\": \"replaceAll\",\n    \"Ctrl-[\": \"indentLess\", \"Ctrl-]\": \"indentMore\",\n    \"Ctrl-U\": \"undoSelection\", \"Shift-Ctrl-U\": \"redoSelection\", \"Alt-U\": \"redoSelection\",\n    fallthrough: \"basic\"\n  };\n  // Very basic readline/emacs-style bindings, which are standard on Mac.\n  keyMap.emacsy = {\n    \"Ctrl-F\": \"goCharRight\", \"Ctrl-B\": \"goCharLeft\", \"Ctrl-P\": \"goLineUp\", \"Ctrl-N\": \"goLineDown\",\n    \"Alt-F\": \"goWordRight\", \"Alt-B\": \"goWordLeft\", \"Ctrl-A\": \"goLineStart\", \"Ctrl-E\": \"goLineEnd\",\n    \"Ctrl-V\": \"goPageDown\", \"Shift-Ctrl-V\": \"goPageUp\", \"Ctrl-D\": \"delCharAfter\", \"Ctrl-H\": \"delCharBefore\",\n    \"Alt-D\": \"delWordAfter\", \"Alt-Backspace\": \"delWordBefore\", \"Ctrl-K\": \"killLine\", \"Ctrl-T\": \"transposeChars\"\n  };\n  keyMap.macDefault = {\n    \"Cmd-A\": \"selectAll\", \"Cmd-D\": \"deleteLine\", \"Cmd-Z\": \"undo\", \"Shift-Cmd-Z\": \"redo\", \"Cmd-Y\": \"redo\",\n    \"Cmd-Home\": \"goDocStart\", \"Cmd-Up\": \"goDocStart\", \"Cmd-End\": \"goDocEnd\", \"Cmd-Down\": \"goDocEnd\", \"Alt-Left\": \"goGroupLeft\",\n    \"Alt-Right\": \"goGroupRight\", \"Cmd-Left\": \"goLineLeft\", \"Cmd-Right\": \"goLineRight\", \"Alt-Backspace\": \"delGroupBefore\",\n    \"Ctrl-Alt-Backspace\": \"delGroupAfter\", \"Alt-Delete\": \"delGroupAfter\", \"Cmd-S\": \"save\", \"Cmd-F\": \"find\",\n    \"Cmd-G\": \"findNext\", \"Shift-Cmd-G\": \"findPrev\", \"Cmd-Alt-F\": \"replace\", \"Shift-Cmd-Alt-F\": \"replaceAll\",\n    \"Cmd-[\": \"indentLess\", \"Cmd-]\": \"indentMore\", \"Cmd-Backspace\": \"delWrappedLineLeft\", \"Cmd-Delete\": \"delWrappedLineRight\",\n    \"Cmd-U\": \"undoSelection\", \"Shift-Cmd-U\": \"redoSelection\", \"Ctrl-Up\": \"goDocStart\", \"Ctrl-Down\": \"goDocEnd\",\n    fallthrough: [\"basic\", \"emacsy\"]\n  };\n  keyMap[\"default\"] = mac ? keyMap.macDefault : keyMap.pcDefault;\n\n  // KEYMAP DISPATCH\n\n  function normalizeKeyName(name) {\n    var parts = name.split(/-(?!$)/), name = parts[parts.length - 1];\n    var alt, ctrl, shift, cmd;\n    for (var i = 0; i < parts.length - 1; i++) {\n      var mod = parts[i];\n      if (/^(cmd|meta|m)$/i.test(mod)) cmd = true;\n      else if (/^a(lt)?$/i.test(mod)) alt = true;\n      else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true;\n      else if (/^s(hift)$/i.test(mod)) shift = true;\n      else throw new Error(\"Unrecognized modifier name: \" + mod);\n    }\n    if (alt) name = \"Alt-\" + name;\n    if (ctrl) name = \"Ctrl-\" + name;\n    if (cmd) name = \"Cmd-\" + name;\n    if (shift) name = \"Shift-\" + name;\n    return name;\n  }\n\n  // This is a kludge to keep keymaps mostly working as raw objects\n  // (backwards compatibility) while at the same time support features\n  // like normalization and multi-stroke key bindings. It compiles a\n  // new normalized keymap, and then updates the old object to reflect\n  // this.\n  CodeMirror.normalizeKeyMap = function(keymap) {\n    var copy = {};\n    for (var keyname in keymap) if (keymap.hasOwnProperty(keyname)) {\n      var value = keymap[keyname];\n      if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) continue;\n      if (value == \"...\") { delete keymap[keyname]; continue; }\n\n      var keys = map(keyname.split(\" \"), normalizeKeyName);\n      for (var i = 0; i < keys.length; i++) {\n        var val, name;\n        if (i == keys.length - 1) {\n          name = keyname;\n          val = value;\n        } else {\n          name = keys.slice(0, i + 1).join(\" \");\n          val = \"...\";\n        }\n        var prev = copy[name];\n        if (!prev) copy[name] = val;\n        else if (prev != val) throw new Error(\"Inconsistent bindings for \" + name);\n      }\n      delete keymap[keyname];\n    }\n    for (var prop in copy) keymap[prop] = copy[prop];\n    return keymap;\n  };\n\n  var lookupKey = CodeMirror.lookupKey = function(key, map, handle) {\n    map = getKeyMap(map);\n    var found = map.call ? map.call(key) : map[key];\n    if (found === false) return \"nothing\";\n    if (found === \"...\") return \"multi\";\n    if (found != null && handle(found)) return \"handled\";\n\n    if (map.fallthrough) {\n      if (Object.prototype.toString.call(map.fallthrough) != \"[object Array]\")\n        return lookupKey(key, map.fallthrough, handle);\n      for (var i = 0; i < map.fallthrough.length; i++) {\n        var result = lookupKey(key, map.fallthrough[i], handle);\n        if (result) return result;\n      }\n    }\n  };\n\n  // Modifier key presses don't count as 'real' key presses for the\n  // purpose of keymap fallthrough.\n  var isModifierKey = CodeMirror.isModifierKey = function(value) {\n    var name = typeof value == \"string\" ? value : keyNames[value.keyCode];\n    return name == \"Ctrl\" || name == \"Alt\" || name == \"Shift\" || name == \"Mod\";\n  };\n\n  // Look up the name of a key as indicated by an event object.\n  var keyName = CodeMirror.keyName = function(event, noShift) {\n    if (presto && event.keyCode == 34 && event[\"char\"]) return false;\n    var base = keyNames[event.keyCode], name = base;\n    if (name == null || event.altGraphKey) return false;\n    if (event.altKey && base != \"Alt\") name = \"Alt-\" + name;\n    if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != \"Ctrl\") name = \"Ctrl-\" + name;\n    if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != \"Cmd\") name = \"Cmd-\" + name;\n    if (!noShift && event.shiftKey && base != \"Shift\") name = \"Shift-\" + name;\n    return name;\n  };\n\n  function getKeyMap(val) {\n    return typeof val == \"string\" ? keyMap[val] : val;\n  }\n\n  // FROMTEXTAREA\n\n  CodeMirror.fromTextArea = function(textarea, options) {\n    if (!options) options = {};\n    options.value = textarea.value;\n    if (!options.tabindex && textarea.tabindex)\n      options.tabindex = textarea.tabindex;\n    if (!options.placeholder && textarea.placeholder)\n      options.placeholder = textarea.placeholder;\n    // Set autofocus to true if this textarea is focused, or if it has\n    // autofocus and no other element is focused.\n    if (options.autofocus == null) {\n      var hasFocus = activeElt();\n      options.autofocus = hasFocus == textarea ||\n        textarea.getAttribute(\"autofocus\") != null && hasFocus == document.body;\n    }\n\n    function save() {textarea.value = cm.getValue();}\n    if (textarea.form) {\n      on(textarea.form, \"submit\", save);\n      // Deplorable hack to make the submit method do the right thing.\n      if (!options.leaveSubmitMethodAlone) {\n        var form = textarea.form, realSubmit = form.submit;\n        try {\n          var wrappedSubmit = form.submit = function() {\n            save();\n            form.submit = realSubmit;\n            form.submit();\n            form.submit = wrappedSubmit;\n          };\n        } catch(e) {}\n      }\n    }\n\n    textarea.style.display = \"none\";\n    var cm = CodeMirror(function(node) {\n      textarea.parentNode.insertBefore(node, textarea.nextSibling);\n    }, options);\n    cm.save = save;\n    cm.getTextArea = function() { return textarea; };\n    cm.toTextArea = function() {\n      cm.toTextArea = isNaN; // Prevent this from being ran twice\n      save();\n      textarea.parentNode.removeChild(cm.getWrapperElement());\n      textarea.style.display = \"\";\n      if (textarea.form) {\n        off(textarea.form, \"submit\", save);\n        if (typeof textarea.form.submit == \"function\")\n          textarea.form.submit = realSubmit;\n      }\n    };\n    return cm;\n  };\n\n  // STRING STREAM\n\n  // Fed to the mode parsers, provides helper functions to make\n  // parsers more succinct.\n\n  var StringStream = CodeMirror.StringStream = function(string, tabSize) {\n    this.pos = this.start = 0;\n    this.string = string;\n    this.tabSize = tabSize || 8;\n    this.lastColumnPos = this.lastColumnValue = 0;\n    this.lineStart = 0;\n  };\n\n  StringStream.prototype = {\n    eol: function() {return this.pos >= this.string.length;},\n    sol: function() {return this.pos == this.lineStart;},\n    peek: function() {return this.string.charAt(this.pos) || undefined;},\n    next: function() {\n      if (this.pos < this.string.length)\n        return this.string.charAt(this.pos++);\n    },\n    eat: function(match) {\n      var ch = this.string.charAt(this.pos);\n      if (typeof match == \"string\") var ok = ch == match;\n      else var ok = ch && (match.test ? match.test(ch) : match(ch));\n      if (ok) {++this.pos; return ch;}\n    },\n    eatWhile: function(match) {\n      var start = this.pos;\n      while (this.eat(match)){}\n      return this.pos > start;\n    },\n    eatSpace: function() {\n      var start = this.pos;\n      while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) ++this.pos;\n      return this.pos > start;\n    },\n    skipToEnd: function() {this.pos = this.string.length;},\n    skipTo: function(ch) {\n      var found = this.string.indexOf(ch, this.pos);\n      if (found > -1) {this.pos = found; return true;}\n    },\n    backUp: function(n) {this.pos -= n;},\n    column: function() {\n      if (this.lastColumnPos < this.start) {\n        this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\n        this.lastColumnPos = this.start;\n      }\n      return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\n    },\n    indentation: function() {\n      return countColumn(this.string, null, this.tabSize) -\n        (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\n    },\n    match: function(pattern, consume, caseInsensitive) {\n      if (typeof pattern == \"string\") {\n        var cased = function(str) {return caseInsensitive ? str.toLowerCase() : str;};\n        var substr = this.string.substr(this.pos, pattern.length);\n        if (cased(substr) == cased(pattern)) {\n          if (consume !== false) this.pos += pattern.length;\n          return true;\n        }\n      } else {\n        var match = this.string.slice(this.pos).match(pattern);\n        if (match && match.index > 0) return null;\n        if (match && consume !== false) this.pos += match[0].length;\n        return match;\n      }\n    },\n    current: function(){return this.string.slice(this.start, this.pos);},\n    hideFirstChars: function(n, inner) {\n      this.lineStart += n;\n      try { return inner(); }\n      finally { this.lineStart -= n; }\n    }\n  };\n\n  // TEXTMARKERS\n\n  // Created with markText and setBookmark methods. A TextMarker is a\n  // handle that can be used to clear or find a marked position in the\n  // document. Line objects hold arrays (markedSpans) containing\n  // {from, to, marker} object pointing to such marker objects, and\n  // indicating that such a marker is present on that line. Multiple\n  // lines may point to the same marker when it spans across lines.\n  // The spans will have null for their from/to properties when the\n  // marker continues beyond the start/end of the line. Markers have\n  // links back to the lines they currently touch.\n\n  var TextMarker = CodeMirror.TextMarker = function(doc, type) {\n    this.lines = [];\n    this.type = type;\n    this.doc = doc;\n  };\n  eventMixin(TextMarker);\n\n  // Clear the marker.\n  TextMarker.prototype.clear = function() {\n    if (this.explicitlyCleared) return;\n    var cm = this.doc.cm, withOp = cm && !cm.curOp;\n    if (withOp) startOperation(cm);\n    if (hasHandler(this, \"clear\")) {\n      var found = this.find();\n      if (found) signalLater(this, \"clear\", found.from, found.to);\n    }\n    var min = null, max = null;\n    for (var i = 0; i < this.lines.length; ++i) {\n      var line = this.lines[i];\n      var span = getMarkedSpanFor(line.markedSpans, this);\n      if (cm && !this.collapsed) regLineChange(cm, lineNo(line), \"text\");\n      else if (cm) {\n        if (span.to != null) max = lineNo(line);\n        if (span.from != null) min = lineNo(line);\n      }\n      line.markedSpans = removeMarkedSpan(line.markedSpans, span);\n      if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)\n        updateLineHeight(line, textHeight(cm.display));\n    }\n    if (cm && this.collapsed && !cm.options.lineWrapping) for (var i = 0; i < this.lines.length; ++i) {\n      var visual = visualLine(this.lines[i]), len = lineLength(visual);\n      if (len > cm.display.maxLineLength) {\n        cm.display.maxLine = visual;\n        cm.display.maxLineLength = len;\n        cm.display.maxLineChanged = true;\n      }\n    }\n\n    if (min != null && cm && this.collapsed) regChange(cm, min, max + 1);\n    this.lines.length = 0;\n    this.explicitlyCleared = true;\n    if (this.atomic && this.doc.cantEdit) {\n      this.doc.cantEdit = false;\n      if (cm) reCheckSelection(cm.doc);\n    }\n    if (cm) signalLater(cm, \"markerCleared\", cm, this);\n    if (withOp) endOperation(cm);\n    if (this.parent) this.parent.clear();\n  };\n\n  // Find the position of the marker in the document. Returns a {from,\n  // to} object by default. Side can be passed to get a specific side\n  // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the\n  // Pos objects returned contain a line object, rather than a line\n  // number (used to prevent looking up the same line twice).\n  TextMarker.prototype.find = function(side, lineObj) {\n    if (side == null && this.type == \"bookmark\") side = 1;\n    var from, to;\n    for (var i = 0; i < this.lines.length; ++i) {\n      var line = this.lines[i];\n      var span = getMarkedSpanFor(line.markedSpans, this);\n      if (span.from != null) {\n        from = Pos(lineObj ? line : lineNo(line), span.from);\n        if (side == -1) return from;\n      }\n      if (span.to != null) {\n        to = Pos(lineObj ? line : lineNo(line), span.to);\n        if (side == 1) return to;\n      }\n    }\n    return from && {from: from, to: to};\n  };\n\n  // Signals that the marker's widget changed, and surrounding layout\n  // should be recomputed.\n  TextMarker.prototype.changed = function() {\n    var pos = this.find(-1, true), widget = this, cm = this.doc.cm;\n    if (!pos || !cm) return;\n    runInOp(cm, function() {\n      var line = pos.line, lineN = lineNo(pos.line);\n      var view = findViewForLine(cm, lineN);\n      if (view) {\n        clearLineMeasurementCacheFor(view);\n        cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;\n      }\n      cm.curOp.updateMaxLine = true;\n      if (!lineIsHidden(widget.doc, line) && widget.height != null) {\n        var oldHeight = widget.height;\n        widget.height = null;\n        var dHeight = widgetHeight(widget) - oldHeight;\n        if (dHeight)\n          updateLineHeight(line, line.height + dHeight);\n      }\n    });\n  };\n\n  TextMarker.prototype.attachLine = function(line) {\n    if (!this.lines.length && this.doc.cm) {\n      var op = this.doc.cm.curOp;\n      if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)\n        (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this);\n    }\n    this.lines.push(line);\n  };\n  TextMarker.prototype.detachLine = function(line) {\n    this.lines.splice(indexOf(this.lines, line), 1);\n    if (!this.lines.length && this.doc.cm) {\n      var op = this.doc.cm.curOp;\n      (op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);\n    }\n  };\n\n  // Collapsed markers have unique ids, in order to be able to order\n  // them, which is needed for uniquely determining an outer marker\n  // when they overlap (they may nest, but not partially overlap).\n  var nextMarkerId = 0;\n\n  // Create a marker, wire it up to the right lines, and\n  function markText(doc, from, to, options, type) {\n    // Shared markers (across linked documents) are handled separately\n    // (markTextShared will call out to this again, once per\n    // document).\n    if (options && options.shared) return markTextShared(doc, from, to, options, type);\n    // Ensure we are in an operation.\n    if (doc.cm && !doc.cm.curOp) return operation(doc.cm, markText)(doc, from, to, options, type);\n\n    var marker = new TextMarker(doc, type), diff = cmp(from, to);\n    if (options) copyObj(options, marker, false);\n    // Don't connect empty markers unless clearWhenEmpty is false\n    if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)\n      return marker;\n    if (marker.replacedWith) {\n      // Showing up as a widget implies collapsed (widget replaces text)\n      marker.collapsed = true;\n      marker.widgetNode = elt(\"span\", [marker.replacedWith], \"CodeMirror-widget\");\n      if (!options.handleMouseEvents) marker.widgetNode.ignoreEvents = true;\n      if (options.insertLeft) marker.widgetNode.insertLeft = true;\n    }\n    if (marker.collapsed) {\n      if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||\n          from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))\n        throw new Error(\"Inserting collapsed marker partially overlapping an existing one\");\n      sawCollapsedSpans = true;\n    }\n\n    if (marker.addToHistory)\n      addChangeToHistory(doc, {from: from, to: to, origin: \"markText\"}, doc.sel, NaN);\n\n    var curLine = from.line, cm = doc.cm, updateMaxLine;\n    doc.iter(curLine, to.line + 1, function(line) {\n      if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)\n        updateMaxLine = true;\n      if (marker.collapsed && curLine != from.line) updateLineHeight(line, 0);\n      addMarkedSpan(line, new MarkedSpan(marker,\n                                         curLine == from.line ? from.ch : null,\n                                         curLine == to.line ? to.ch : null));\n      ++curLine;\n    });\n    // lineIsHidden depends on the presence of the spans, so needs a second pass\n    if (marker.collapsed) doc.iter(from.line, to.line + 1, function(line) {\n      if (lineIsHidden(doc, line)) updateLineHeight(line, 0);\n    });\n\n    if (marker.clearOnEnter) on(marker, \"beforeCursorEnter\", function() { marker.clear(); });\n\n    if (marker.readOnly) {\n      sawReadOnlySpans = true;\n      if (doc.history.done.length || doc.history.undone.length)\n        doc.clearHistory();\n    }\n    if (marker.collapsed) {\n      marker.id = ++nextMarkerId;\n      marker.atomic = true;\n    }\n    if (cm) {\n      // Sync editor state\n      if (updateMaxLine) cm.curOp.updateMaxLine = true;\n      if (marker.collapsed)\n        regChange(cm, from.line, to.line + 1);\n      else if (marker.className || marker.title || marker.startStyle || marker.endStyle)\n        for (var i = from.line; i <= to.line; i++) regLineChange(cm, i, \"text\");\n      if (marker.atomic) reCheckSelection(cm.doc);\n      signalLater(cm, \"markerAdded\", cm, marker);\n    }\n    return marker;\n  }\n\n  // SHARED TEXTMARKERS\n\n  // A shared marker spans multiple linked documents. It is\n  // implemented as a meta-marker-object controlling multiple normal\n  // markers.\n  var SharedTextMarker = CodeMirror.SharedTextMarker = function(markers, primary) {\n    this.markers = markers;\n    this.primary = primary;\n    for (var i = 0; i < markers.length; ++i)\n      markers[i].parent = this;\n  };\n  eventMixin(SharedTextMarker);\n\n  SharedTextMarker.prototype.clear = function() {\n    if (this.explicitlyCleared) return;\n    this.explicitlyCleared = true;\n    for (var i = 0; i < this.markers.length; ++i)\n      this.markers[i].clear();\n    signalLater(this, \"clear\");\n  };\n  SharedTextMarker.prototype.find = function(side, lineObj) {\n    return this.primary.find(side, lineObj);\n  };\n\n  function markTextShared(doc, from, to, options, type) {\n    options = copyObj(options);\n    options.shared = false;\n    var markers = [markText(doc, from, to, options, type)], primary = markers[0];\n    var widget = options.widgetNode;\n    linkedDocs(doc, function(doc) {\n      if (widget) options.widgetNode = widget.cloneNode(true);\n      markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));\n      for (var i = 0; i < doc.linked.length; ++i)\n        if (doc.linked[i].isParent) return;\n      primary = lst(markers);\n    });\n    return new SharedTextMarker(markers, primary);\n  }\n\n  function findSharedMarkers(doc) {\n    return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())),\n                         function(m) { return m.parent; });\n  }\n\n  function copySharedMarkers(doc, markers) {\n    for (var i = 0; i < markers.length; i++) {\n      var marker = markers[i], pos = marker.find();\n      var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);\n      if (cmp(mFrom, mTo)) {\n        var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);\n        marker.markers.push(subMark);\n        subMark.parent = marker;\n      }\n    }\n  }\n\n  function detachSharedMarkers(markers) {\n    for (var i = 0; i < markers.length; i++) {\n      var marker = markers[i], linked = [marker.primary.doc];;\n      linkedDocs(marker.primary.doc, function(d) { linked.push(d); });\n      for (var j = 0; j < marker.markers.length; j++) {\n        var subMarker = marker.markers[j];\n        if (indexOf(linked, subMarker.doc) == -1) {\n          subMarker.parent = null;\n          marker.markers.splice(j--, 1);\n        }\n      }\n    }\n  }\n\n  // TEXTMARKER SPANS\n\n  function MarkedSpan(marker, from, to) {\n    this.marker = marker;\n    this.from = from; this.to = to;\n  }\n\n  // Search an array of spans for a span matching the given marker.\n  function getMarkedSpanFor(spans, marker) {\n    if (spans) for (var i = 0; i < spans.length; ++i) {\n      var span = spans[i];\n      if (span.marker == marker) return span;\n    }\n  }\n  // Remove a span from an array, returning undefined if no spans are\n  // left (we don't store arrays for lines without spans).\n  function removeMarkedSpan(spans, span) {\n    for (var r, i = 0; i < spans.length; ++i)\n      if (spans[i] != span) (r || (r = [])).push(spans[i]);\n    return r;\n  }\n  // Add a span to a line.\n  function addMarkedSpan(line, span) {\n    line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];\n    span.marker.attachLine(line);\n  }\n\n  // Used for the algorithm that adjusts markers for a change in the\n  // document. These functions cut an array of spans at a given\n  // character position, returning an array of remaining chunks (or\n  // undefined if nothing remains).\n  function markedSpansBefore(old, startCh, isInsert) {\n    if (old) for (var i = 0, nw; i < old.length; ++i) {\n      var span = old[i], marker = span.marker;\n      var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);\n      if (startsBefore || span.from == startCh && marker.type == \"bookmark\" && (!isInsert || !span.marker.insertLeft)) {\n        var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh);\n        (nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));\n      }\n    }\n    return nw;\n  }\n  function markedSpansAfter(old, endCh, isInsert) {\n    if (old) for (var i = 0, nw; i < old.length; ++i) {\n      var span = old[i], marker = span.marker;\n      var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);\n      if (endsAfter || span.from == endCh && marker.type == \"bookmark\" && (!isInsert || span.marker.insertLeft)) {\n        var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh);\n        (nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,\n                                              span.to == null ? null : span.to - endCh));\n      }\n    }\n    return nw;\n  }\n\n  // Given a change object, compute the new set of marker spans that\n  // cover the line in which the change took place. Removes spans\n  // entirely within the change, reconnects spans belonging to the\n  // same marker that appear on both sides of the change, and cuts off\n  // spans partially within the change. Returns an array of span\n  // arrays with one element for each line in (after) the change.\n  function stretchSpansOverChange(doc, change) {\n    var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;\n    var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;\n    if (!oldFirst && !oldLast) return null;\n\n    var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;\n    // Get the spans that 'stick out' on both sides\n    var first = markedSpansBefore(oldFirst, startCh, isInsert);\n    var last = markedSpansAfter(oldLast, endCh, isInsert);\n\n    // Next, merge those two ends\n    var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);\n    if (first) {\n      // Fix up .to properties of first\n      for (var i = 0; i < first.length; ++i) {\n        var span = first[i];\n        if (span.to == null) {\n          var found = getMarkedSpanFor(last, span.marker);\n          if (!found) span.to = startCh;\n          else if (sameLine) span.to = found.to == null ? null : found.to + offset;\n        }\n      }\n    }\n    if (last) {\n      // Fix up .from in last (or move them into first in case of sameLine)\n      for (var i = 0; i < last.length; ++i) {\n        var span = last[i];\n        if (span.to != null) span.to += offset;\n        if (span.from == null) {\n          var found = getMarkedSpanFor(first, span.marker);\n          if (!found) {\n            span.from = offset;\n            if (sameLine) (first || (first = [])).push(span);\n          }\n        } else {\n          span.from += offset;\n          if (sameLine) (first || (first = [])).push(span);\n        }\n      }\n    }\n    // Make sure we didn't create any zero-length spans\n    if (first) first = clearEmptySpans(first);\n    if (last && last != first) last = clearEmptySpans(last);\n\n    var newMarkers = [first];\n    if (!sameLine) {\n      // Fill gap with whole-line-spans\n      var gap = change.text.length - 2, gapMarkers;\n      if (gap > 0 && first)\n        for (var i = 0; i < first.length; ++i)\n          if (first[i].to == null)\n            (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i].marker, null, null));\n      for (var i = 0; i < gap; ++i)\n        newMarkers.push(gapMarkers);\n      newMarkers.push(last);\n    }\n    return newMarkers;\n  }\n\n  // Remove spans that are empty and don't have a clearWhenEmpty\n  // option of false.\n  function clearEmptySpans(spans) {\n    for (var i = 0; i < spans.length; ++i) {\n      var span = spans[i];\n      if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)\n        spans.splice(i--, 1);\n    }\n    if (!spans.length) return null;\n    return spans;\n  }\n\n  // Used for un/re-doing changes from the history. Combines the\n  // result of computing the existing spans with the set of spans that\n  // existed in the history (so that deleting around a span and then\n  // undoing brings back the span).\n  function mergeOldSpans(doc, change) {\n    var old = getOldSpans(doc, change);\n    var stretched = stretchSpansOverChange(doc, change);\n    if (!old) return stretched;\n    if (!stretched) return old;\n\n    for (var i = 0; i < old.length; ++i) {\n      var oldCur = old[i], stretchCur = stretched[i];\n      if (oldCur && stretchCur) {\n        spans: for (var j = 0; j < stretchCur.length; ++j) {\n          var span = stretchCur[j];\n          for (var k = 0; k < oldCur.length; ++k)\n            if (oldCur[k].marker == span.marker) continue spans;\n          oldCur.push(span);\n        }\n      } else if (stretchCur) {\n        old[i] = stretchCur;\n      }\n    }\n    return old;\n  }\n\n  // Used to 'clip' out readOnly ranges when making a change.\n  function removeReadOnlyRanges(doc, from, to) {\n    var markers = null;\n    doc.iter(from.line, to.line + 1, function(line) {\n      if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {\n        var mark = line.markedSpans[i].marker;\n        if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))\n          (markers || (markers = [])).push(mark);\n      }\n    });\n    if (!markers) return null;\n    var parts = [{from: from, to: to}];\n    for (var i = 0; i < markers.length; ++i) {\n      var mk = markers[i], m = mk.find(0);\n      for (var j = 0; j < parts.length; ++j) {\n        var p = parts[j];\n        if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) continue;\n        var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);\n        if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)\n          newParts.push({from: p.from, to: m.from});\n        if (dto > 0 || !mk.inclusiveRight && !dto)\n          newParts.push({from: m.to, to: p.to});\n        parts.splice.apply(parts, newParts);\n        j += newParts.length - 1;\n      }\n    }\n    return parts;\n  }\n\n  // Connect or disconnect spans from a line.\n  function detachMarkedSpans(line) {\n    var spans = line.markedSpans;\n    if (!spans) return;\n    for (var i = 0; i < spans.length; ++i)\n      spans[i].marker.detachLine(line);\n    line.markedSpans = null;\n  }\n  function attachMarkedSpans(line, spans) {\n    if (!spans) return;\n    for (var i = 0; i < spans.length; ++i)\n      spans[i].marker.attachLine(line);\n    line.markedSpans = spans;\n  }\n\n  // Helpers used when computing which overlapping collapsed span\n  // counts as the larger one.\n  function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0; }\n  function extraRight(marker) { return marker.inclusiveRight ? 1 : 0; }\n\n  // Returns a number indicating which of two overlapping collapsed\n  // spans is larger (and thus includes the other). Falls back to\n  // comparing ids when the spans cover exactly the same range.\n  function compareCollapsedMarkers(a, b) {\n    var lenDiff = a.lines.length - b.lines.length;\n    if (lenDiff != 0) return lenDiff;\n    var aPos = a.find(), bPos = b.find();\n    var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);\n    if (fromCmp) return -fromCmp;\n    var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);\n    if (toCmp) return toCmp;\n    return b.id - a.id;\n  }\n\n  // Find out whether a line ends or starts in a collapsed span. If\n  // so, return the marker for that span.\n  function collapsedSpanAtSide(line, start) {\n    var sps = sawCollapsedSpans && line.markedSpans, found;\n    if (sps) for (var sp, i = 0; i < sps.length; ++i) {\n      sp = sps[i];\n      if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&\n          (!found || compareCollapsedMarkers(found, sp.marker) < 0))\n        found = sp.marker;\n    }\n    return found;\n  }\n  function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true); }\n  function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false); }\n\n  // Test whether there exists a collapsed span that partially\n  // overlaps (covers the start or end, but not both) of a new span.\n  // Such overlap is not allowed.\n  function conflictingCollapsedRange(doc, lineNo, from, to, marker) {\n    var line = getLine(doc, lineNo);\n    var sps = sawCollapsedSpans && line.markedSpans;\n    if (sps) for (var i = 0; i < sps.length; ++i) {\n      var sp = sps[i];\n      if (!sp.marker.collapsed) continue;\n      var found = sp.marker.find(0);\n      var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);\n      var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);\n      if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) continue;\n      if (fromCmp <= 0 && (cmp(found.to, from) > 0 || (sp.marker.inclusiveRight && marker.inclusiveLeft)) ||\n          fromCmp >= 0 && (cmp(found.from, to) < 0 || (sp.marker.inclusiveLeft && marker.inclusiveRight)))\n        return true;\n    }\n  }\n\n  // A visual line is a line as drawn on the screen. Folding, for\n  // example, can cause multiple logical lines to appear on the same\n  // visual line. This finds the start of the visual line that the\n  // given line is part of (usually that is the line itself).\n  function visualLine(line) {\n    var merged;\n    while (merged = collapsedSpanAtStart(line))\n      line = merged.find(-1, true).line;\n    return line;\n  }\n\n  // Returns an array of logical lines that continue the visual line\n  // started by the argument, or undefined if there are no such lines.\n  function visualLineContinued(line) {\n    var merged, lines;\n    while (merged = collapsedSpanAtEnd(line)) {\n      line = merged.find(1, true).line;\n      (lines || (lines = [])).push(line);\n    }\n    return lines;\n  }\n\n  // Get the line number of the start of the visual line that the\n  // given line number is part of.\n  function visualLineNo(doc, lineN) {\n    var line = getLine(doc, lineN), vis = visualLine(line);\n    if (line == vis) return lineN;\n    return lineNo(vis);\n  }\n  // Get the line number of the start of the next visual line after\n  // the given line.\n  function visualLineEndNo(doc, lineN) {\n    if (lineN > doc.lastLine()) return lineN;\n    var line = getLine(doc, lineN), merged;\n    if (!lineIsHidden(doc, line)) return lineN;\n    while (merged = collapsedSpanAtEnd(line))\n      line = merged.find(1, true).line;\n    return lineNo(line) + 1;\n  }\n\n  // Compute whether a line is hidden. Lines count as hidden when they\n  // are part of a visual line that starts with another line, or when\n  // they are entirely covered by collapsed, non-widget span.\n  function lineIsHidden(doc, line) {\n    var sps = sawCollapsedSpans && line.markedSpans;\n    if (sps) for (var sp, i = 0; i < sps.length; ++i) {\n      sp = sps[i];\n      if (!sp.marker.collapsed) continue;\n      if (sp.from == null) return true;\n      if (sp.marker.widgetNode) continue;\n      if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))\n        return true;\n    }\n  }\n  function lineIsHiddenInner(doc, line, span) {\n    if (span.to == null) {\n      var end = span.marker.find(1, true);\n      return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker));\n    }\n    if (span.marker.inclusiveRight && span.to == line.text.length)\n      return true;\n    for (var sp, i = 0; i < line.markedSpans.length; ++i) {\n      sp = line.markedSpans[i];\n      if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&\n          (sp.to == null || sp.to != span.from) &&\n          (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&\n          lineIsHiddenInner(doc, line, sp)) return true;\n    }\n  }\n\n  // LINE WIDGETS\n\n  // Line widgets are block elements displayed above or below a line.\n\n  var LineWidget = CodeMirror.LineWidget = function(cm, node, options) {\n    if (options) for (var opt in options) if (options.hasOwnProperty(opt))\n      this[opt] = options[opt];\n    this.cm = cm;\n    this.node = node;\n  };\n  eventMixin(LineWidget);\n\n  function adjustScrollWhenAboveVisible(cm, line, diff) {\n    if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))\n      addToScrollPos(cm, null, diff);\n  }\n\n  LineWidget.prototype.clear = function() {\n    var cm = this.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);\n    if (no == null || !ws) return;\n    for (var i = 0; i < ws.length; ++i) if (ws[i] == this) ws.splice(i--, 1);\n    if (!ws.length) line.widgets = null;\n    var height = widgetHeight(this);\n    runInOp(cm, function() {\n      adjustScrollWhenAboveVisible(cm, line, -height);\n      regLineChange(cm, no, \"widget\");\n      updateLineHeight(line, Math.max(0, line.height - height));\n    });\n  };\n  LineWidget.prototype.changed = function() {\n    var oldH = this.height, cm = this.cm, line = this.line;\n    this.height = null;\n    var diff = widgetHeight(this) - oldH;\n    if (!diff) return;\n    runInOp(cm, function() {\n      cm.curOp.forceUpdate = true;\n      adjustScrollWhenAboveVisible(cm, line, diff);\n      updateLineHeight(line, line.height + diff);\n    });\n  };\n\n  function widgetHeight(widget) {\n    if (widget.height != null) return widget.height;\n    if (!contains(document.body, widget.node)) {\n      var parentStyle = \"position: relative;\";\n      if (widget.coverGutter)\n        parentStyle += \"margin-left: -\" + widget.cm.getGutterElement().offsetWidth + \"px;\";\n      removeChildrenAndAdd(widget.cm.display.measure, elt(\"div\", [widget.node], null, parentStyle));\n    }\n    return widget.height = widget.node.offsetHeight;\n  }\n\n  function addLineWidget(cm, handle, node, options) {\n    var widget = new LineWidget(cm, node, options);\n    if (widget.noHScroll) cm.display.alignWidgets = true;\n    changeLine(cm.doc, handle, \"widget\", function(line) {\n      var widgets = line.widgets || (line.widgets = []);\n      if (widget.insertAt == null) widgets.push(widget);\n      else widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget);\n      widget.line = line;\n      if (!lineIsHidden(cm.doc, line)) {\n        var aboveVisible = heightAtLine(line) < cm.doc.scrollTop;\n        updateLineHeight(line, line.height + widgetHeight(widget));\n        if (aboveVisible) addToScrollPos(cm, null, widget.height);\n        cm.curOp.forceUpdate = true;\n      }\n      return true;\n    });\n    return widget;\n  }\n\n  // LINE DATA STRUCTURE\n\n  // Line objects. These hold state related to a line, including\n  // highlighting info (the styles array).\n  var Line = CodeMirror.Line = function(text, markedSpans, estimateHeight) {\n    this.text = text;\n    attachMarkedSpans(this, markedSpans);\n    this.height = estimateHeight ? estimateHeight(this) : 1;\n  };\n  eventMixin(Line);\n  Line.prototype.lineNo = function() { return lineNo(this); };\n\n  // Change the content (text, markers) of a line. Automatically\n  // invalidates cached information and tries to re-estimate the\n  // line's height.\n  function updateLine(line, text, markedSpans, estimateHeight) {\n    line.text = text;\n    if (line.stateAfter) line.stateAfter = null;\n    if (line.styles) line.styles = null;\n    if (line.order != null) line.order = null;\n    detachMarkedSpans(line);\n    attachMarkedSpans(line, markedSpans);\n    var estHeight = estimateHeight ? estimateHeight(line) : 1;\n    if (estHeight != line.height) updateLineHeight(line, estHeight);\n  }\n\n  // Detach a line from the document tree and its markers.\n  function cleanUpLine(line) {\n    line.parent = null;\n    detachMarkedSpans(line);\n  }\n\n  function extractLineClasses(type, output) {\n    if (type) for (;;) {\n      var lineClass = type.match(/(?:^|\\s+)line-(background-)?(\\S+)/);\n      if (!lineClass) break;\n      type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);\n      var prop = lineClass[1] ? \"bgClass\" : \"textClass\";\n      if (output[prop] == null)\n        output[prop] = lineClass[2];\n      else if (!(new RegExp(\"(?:^|\\s)\" + lineClass[2] + \"(?:$|\\s)\")).test(output[prop]))\n        output[prop] += \" \" + lineClass[2];\n    }\n    return type;\n  }\n\n  function callBlankLine(mode, state) {\n    if (mode.blankLine) return mode.blankLine(state);\n    if (!mode.innerMode) return;\n    var inner = CodeMirror.innerMode(mode, state);\n    if (inner.mode.blankLine) return inner.mode.blankLine(inner.state);\n  }\n\n  function readToken(mode, stream, state, inner) {\n    for (var i = 0; i < 10; i++) {\n      if (inner) inner[0] = CodeMirror.innerMode(mode, state).mode;\n      var style = mode.token(stream, state);\n      if (stream.pos > stream.start) return style;\n    }\n    throw new Error(\"Mode \" + mode.name + \" failed to advance stream.\");\n  }\n\n  // Utility for getTokenAt and getLineTokens\n  function takeToken(cm, pos, precise, asArray) {\n    function getObj(copy) {\n      return {start: stream.start, end: stream.pos,\n              string: stream.current(),\n              type: style || null,\n              state: copy ? copyState(doc.mode, state) : state};\n    }\n\n    var doc = cm.doc, mode = doc.mode, style;\n    pos = clipPos(doc, pos);\n    var line = getLine(doc, pos.line), state = getStateBefore(cm, pos.line, precise);\n    var stream = new StringStream(line.text, cm.options.tabSize), tokens;\n    if (asArray) tokens = [];\n    while ((asArray || stream.pos < pos.ch) && !stream.eol()) {\n      stream.start = stream.pos;\n      style = readToken(mode, stream, state);\n      if (asArray) tokens.push(getObj(true));\n    }\n    return asArray ? tokens : getObj();\n  }\n\n  // Run the given mode's parser over a line, calling f for each token.\n  function runMode(cm, text, mode, state, f, lineClasses, forceToEnd) {\n    var flattenSpans = mode.flattenSpans;\n    if (flattenSpans == null) flattenSpans = cm.options.flattenSpans;\n    var curStart = 0, curStyle = null;\n    var stream = new StringStream(text, cm.options.tabSize), style;\n    var inner = cm.options.addModeClass && [null];\n    if (text == \"\") extractLineClasses(callBlankLine(mode, state), lineClasses);\n    while (!stream.eol()) {\n      if (stream.pos > cm.options.maxHighlightLength) {\n        flattenSpans = false;\n        if (forceToEnd) processLine(cm, text, state, stream.pos);\n        stream.pos = text.length;\n        style = null;\n      } else {\n        style = extractLineClasses(readToken(mode, stream, state, inner), lineClasses);\n      }\n      if (inner) {\n        var mName = inner[0].name;\n        if (mName) style = \"m-\" + (style ? mName + \" \" + style : mName);\n      }\n      if (!flattenSpans || curStyle != style) {\n        if (curStart < stream.start) f(stream.start, curStyle);\n        curStart = stream.start; curStyle = style;\n      }\n      stream.start = stream.pos;\n    }\n    while (curStart < stream.pos) {\n      // Webkit seems to refuse to render text nodes longer than 57444 characters\n      var pos = Math.min(stream.pos, curStart + 50000);\n      f(pos, curStyle);\n      curStart = pos;\n    }\n  }\n\n  // Compute a style array (an array starting with a mode generation\n  // -- for invalidation -- followed by pairs of end positions and\n  // style strings), which is used to highlight the tokens on the\n  // line.\n  function highlightLine(cm, line, state, forceToEnd) {\n    // A styles array always starts with a number identifying the\n    // mode/overlays that it is based on (for easy invalidation).\n    var st = [cm.state.modeGen], lineClasses = {};\n    // Compute the base array of styles\n    runMode(cm, line.text, cm.doc.mode, state, function(end, style) {\n      st.push(end, style);\n    }, lineClasses, forceToEnd);\n\n    // Run overlays, adjust style array.\n    for (var o = 0; o < cm.state.overlays.length; ++o) {\n      var overlay = cm.state.overlays[o], i = 1, at = 0;\n      runMode(cm, line.text, overlay.mode, true, function(end, style) {\n        var start = i;\n        // Ensure there's a token end at the current position, and that i points at it\n        while (at < end) {\n          var i_end = st[i];\n          if (i_end > end)\n            st.splice(i, 1, end, st[i+1], i_end);\n          i += 2;\n          at = Math.min(end, i_end);\n        }\n        if (!style) return;\n        if (overlay.opaque) {\n          st.splice(start, i - start, end, \"cm-overlay \" + style);\n          i = start + 2;\n        } else {\n          for (; start < i; start += 2) {\n            var cur = st[start+1];\n            st[start+1] = (cur ? cur + \" \" : \"\") + \"cm-overlay \" + style;\n          }\n        }\n      }, lineClasses);\n    }\n\n    return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null};\n  }\n\n  function getLineStyles(cm, line, updateFrontier) {\n    if (!line.styles || line.styles[0] != cm.state.modeGen) {\n      var result = highlightLine(cm, line, line.stateAfter = getStateBefore(cm, lineNo(line)));\n      line.styles = result.styles;\n      if (result.classes) line.styleClasses = result.classes;\n      else if (line.styleClasses) line.styleClasses = null;\n      if (updateFrontier === cm.doc.frontier) cm.doc.frontier++;\n    }\n    return line.styles;\n  }\n\n  // Lightweight form of highlight -- proceed over this line and\n  // update state, but don't save a style array. Used for lines that\n  // aren't currently visible.\n  function processLine(cm, text, state, startAt) {\n    var mode = cm.doc.mode;\n    var stream = new StringStream(text, cm.options.tabSize);\n    stream.start = stream.pos = startAt || 0;\n    if (text == \"\") callBlankLine(mode, state);\n    while (!stream.eol() && stream.pos <= cm.options.maxHighlightLength) {\n      readToken(mode, stream, state);\n      stream.start = stream.pos;\n    }\n  }\n\n  // Convert a style as returned by a mode (either null, or a string\n  // containing one or more styles) to a CSS style. This is cached,\n  // and also looks for line-wide styles.\n  var styleToClassCache = {}, styleToClassCacheWithMode = {};\n  function interpretTokenStyle(style, options) {\n    if (!style || /^\\s*$/.test(style)) return null;\n    var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;\n    return cache[style] ||\n      (cache[style] = style.replace(/\\S+/g, \"cm-$&\"));\n  }\n\n  // Render the DOM representation of the text of a line. Also builds\n  // up a 'line map', which points at the DOM nodes that represent\n  // specific stretches of text, and is used by the measuring code.\n  // The returned object contains the DOM node, this map, and\n  // information about line-wide styles that were set by the mode.\n  function buildLineContent(cm, lineView) {\n    // The padding-right forces the element to have a 'border', which\n    // is needed on Webkit to be able to get line-level bounding\n    // rectangles for it (in measureChar).\n    var content = elt(\"span\", null, null, webkit ? \"padding-right: .1px\" : null);\n    var builder = {pre: elt(\"pre\", [content]), content: content, col: 0, pos: 0, cm: cm};\n    lineView.measure = {};\n\n    // Iterate over the logical lines that make up this visual line.\n    for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {\n      var line = i ? lineView.rest[i - 1] : lineView.line, order;\n      builder.pos = 0;\n      builder.addToken = buildToken;\n      // Optionally wire in some hacks into the token-rendering\n      // algorithm, to deal with browser quirks.\n      if ((ie || webkit) && cm.getOption(\"lineWrapping\"))\n        builder.addToken = buildTokenSplitSpaces(builder.addToken);\n      if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line)))\n        builder.addToken = buildTokenBadBidi(builder.addToken, order);\n      builder.map = [];\n      var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);\n      insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));\n      if (line.styleClasses) {\n        if (line.styleClasses.bgClass)\n          builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || \"\");\n        if (line.styleClasses.textClass)\n          builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || \"\");\n      }\n\n      // Ensure at least a single node is present, for measuring.\n      if (builder.map.length == 0)\n        builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure)));\n\n      // Store the map and a cache object for the current logical line\n      if (i == 0) {\n        lineView.measure.map = builder.map;\n        lineView.measure.cache = {};\n      } else {\n        (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map);\n        (lineView.measure.caches || (lineView.measure.caches = [])).push({});\n      }\n    }\n\n    // See issue #2901\n    if (webkit && /\\bcm-tab\\b/.test(builder.content.lastChild.className))\n      builder.content.className = \"cm-tab-wrap-hack\";\n\n    signal(cm, \"renderLine\", cm, lineView.line, builder.pre);\n    if (builder.pre.className)\n      builder.textClass = joinClasses(builder.pre.className, builder.textClass || \"\");\n\n    return builder;\n  }\n\n  function defaultSpecialCharPlaceholder(ch) {\n    var token = elt(\"span\", \"\\u2022\", \"cm-invalidchar\");\n    token.title = \"\\\\u\" + ch.charCodeAt(0).toString(16);\n    return token;\n  }\n\n  // Build up the DOM representation for a single token, and add it to\n  // the line map. Takes care to render special characters separately.\n  function buildToken(builder, text, style, startStyle, endStyle, title) {\n    if (!text) return;\n    var special = builder.cm.options.specialChars, mustWrap = false;\n    if (!special.test(text)) {\n      builder.col += text.length;\n      var content = document.createTextNode(text);\n      builder.map.push(builder.pos, builder.pos + text.length, content);\n      if (ie && ie_version < 9) mustWrap = true;\n      builder.pos += text.length;\n    } else {\n      var content = document.createDocumentFragment(), pos = 0;\n      while (true) {\n        special.lastIndex = pos;\n        var m = special.exec(text);\n        var skipped = m ? m.index - pos : text.length - pos;\n        if (skipped) {\n          var txt = document.createTextNode(text.slice(pos, pos + skipped));\n          if (ie && ie_version < 9) content.appendChild(elt(\"span\", [txt]));\n          else content.appendChild(txt);\n          builder.map.push(builder.pos, builder.pos + skipped, txt);\n          builder.col += skipped;\n          builder.pos += skipped;\n        }\n        if (!m) break;\n        pos += skipped + 1;\n        if (m[0] == \"\\t\") {\n          var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;\n          var txt = content.appendChild(elt(\"span\", spaceStr(tabWidth), \"cm-tab\"));\n          builder.col += tabWidth;\n        } else {\n          var txt = builder.cm.options.specialCharPlaceholder(m[0]);\n          if (ie && ie_version < 9) content.appendChild(elt(\"span\", [txt]));\n          else content.appendChild(txt);\n          builder.col += 1;\n        }\n        builder.map.push(builder.pos, builder.pos + 1, txt);\n        builder.pos++;\n      }\n    }\n    if (style || startStyle || endStyle || mustWrap) {\n      var fullStyle = style || \"\";\n      if (startStyle) fullStyle += startStyle;\n      if (endStyle) fullStyle += endStyle;\n      var token = elt(\"span\", [content], fullStyle);\n      if (title) token.title = title;\n      return builder.content.appendChild(token);\n    }\n    builder.content.appendChild(content);\n  }\n\n  function buildTokenSplitSpaces(inner) {\n    function split(old) {\n      var out = \" \";\n      for (var i = 0; i < old.length - 2; ++i) out += i % 2 ? \" \" : \"\\u00a0\";\n      out += \" \";\n      return out;\n    }\n    return function(builder, text, style, startStyle, endStyle, title) {\n      inner(builder, text.replace(/ {3,}/g, split), style, startStyle, endStyle, title);\n    };\n  }\n\n  // Work around nonsense dimensions being reported for stretches of\n  // right-to-left text.\n  function buildTokenBadBidi(inner, order) {\n    return function(builder, text, style, startStyle, endStyle, title) {\n      style = style ? style + \" cm-force-border\" : \"cm-force-border\";\n      var start = builder.pos, end = start + text.length;\n      for (;;) {\n        // Find the part that overlaps with the start of this text\n        for (var i = 0; i < order.length; i++) {\n          var part = order[i];\n          if (part.to > start && part.from <= start) break;\n        }\n        if (part.to >= end) return inner(builder, text, style, startStyle, endStyle, title);\n        inner(builder, text.slice(0, part.to - start), style, startStyle, null, title);\n        startStyle = null;\n        text = text.slice(part.to - start);\n        start = part.to;\n      }\n    };\n  }\n\n  function buildCollapsedSpan(builder, size, marker, ignoreWidget) {\n    var widget = !ignoreWidget && marker.widgetNode;\n    if (widget) {\n      builder.map.push(builder.pos, builder.pos + size, widget);\n      builder.content.appendChild(widget);\n    }\n    builder.pos += size;\n  }\n\n  // Outputs a number of spans to make up a line, taking highlighting\n  // and marked text into account.\n  function insertLineContent(line, builder, styles) {\n    var spans = line.markedSpans, allText = line.text, at = 0;\n    if (!spans) {\n      for (var i = 1; i < styles.length; i+=2)\n        builder.addToken(builder, allText.slice(at, at = styles[i]), interpretTokenStyle(styles[i+1], builder.cm.options));\n      return;\n    }\n\n    var len = allText.length, pos = 0, i = 1, text = \"\", style;\n    var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, title, collapsed;\n    for (;;) {\n      if (nextChange == pos) { // Update current marker set\n        spanStyle = spanEndStyle = spanStartStyle = title = \"\";\n        collapsed = null; nextChange = Infinity;\n        var foundBookmarks = [];\n        for (var j = 0; j < spans.length; ++j) {\n          var sp = spans[j], m = sp.marker;\n          if (sp.from <= pos && (sp.to == null || sp.to > pos)) {\n            if (sp.to != null && nextChange > sp.to) { nextChange = sp.to; spanEndStyle = \"\"; }\n            if (m.className) spanStyle += \" \" + m.className;\n            if (m.startStyle && sp.from == pos) spanStartStyle += \" \" + m.startStyle;\n            if (m.endStyle && sp.to == nextChange) spanEndStyle += \" \" + m.endStyle;\n            if (m.title && !title) title = m.title;\n            if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))\n              collapsed = sp;\n          } else if (sp.from > pos && nextChange > sp.from) {\n            nextChange = sp.from;\n          }\n          if (m.type == \"bookmark\" && sp.from == pos && m.widgetNode) foundBookmarks.push(m);\n        }\n        if (collapsed && (collapsed.from || 0) == pos) {\n          buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,\n                             collapsed.marker, collapsed.from == null);\n          if (collapsed.to == null) return;\n        }\n        if (!collapsed && foundBookmarks.length) for (var j = 0; j < foundBookmarks.length; ++j)\n          buildCollapsedSpan(builder, 0, foundBookmarks[j]);\n      }\n      if (pos >= len) break;\n\n      var upto = Math.min(len, nextChange);\n      while (true) {\n        if (text) {\n          var end = pos + text.length;\n          if (!collapsed) {\n            var tokenText = end > upto ? text.slice(0, upto - pos) : text;\n            builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,\n                             spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : \"\", title);\n          }\n          if (end >= upto) {text = text.slice(upto - pos); pos = upto; break;}\n          pos = end;\n          spanStartStyle = \"\";\n        }\n        text = allText.slice(at, at = styles[i++]);\n        style = interpretTokenStyle(styles[i++], builder.cm.options);\n      }\n    }\n  }\n\n  // DOCUMENT DATA STRUCTURE\n\n  // By default, updates that start and end at the beginning of a line\n  // are treated specially, in order to make the association of line\n  // widgets and marker elements with the text behave more intuitive.\n  function isWholeLineUpdate(doc, change) {\n    return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == \"\" &&\n      (!doc.cm || doc.cm.options.wholeLineUpdateBefore);\n  }\n\n  // Perform a change on the document data structure.\n  function updateDoc(doc, change, markedSpans, estimateHeight) {\n    function spansFor(n) {return markedSpans ? markedSpans[n] : null;}\n    function update(line, text, spans) {\n      updateLine(line, text, spans, estimateHeight);\n      signalLater(line, \"change\", line, change);\n    }\n\n    var from = change.from, to = change.to, text = change.text;\n    var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);\n    var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;\n\n    // Adjust the line structure\n    if (isWholeLineUpdate(doc, change)) {\n      // This is a whole-line replace. Treated specially to make\n      // sure line objects move the way they are supposed to.\n      for (var i = 0, added = []; i < text.length - 1; ++i)\n        added.push(new Line(text[i], spansFor(i), estimateHeight));\n      update(lastLine, lastLine.text, lastSpans);\n      if (nlines) doc.remove(from.line, nlines);\n      if (added.length) doc.insert(from.line, added);\n    } else if (firstLine == lastLine) {\n      if (text.length == 1) {\n        update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);\n      } else {\n        for (var added = [], i = 1; i < text.length - 1; ++i)\n          added.push(new Line(text[i], spansFor(i), estimateHeight));\n        added.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));\n        update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n        doc.insert(from.line + 1, added);\n      }\n    } else if (text.length == 1) {\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));\n      doc.remove(from.line + 1, nlines);\n    } else {\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n      update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);\n      for (var i = 1, added = []; i < text.length - 1; ++i)\n        added.push(new Line(text[i], spansFor(i), estimateHeight));\n      if (nlines > 1) doc.remove(from.line + 1, nlines - 1);\n      doc.insert(from.line + 1, added);\n    }\n\n    signalLater(doc, \"change\", doc, change);\n  }\n\n  // The document is represented as a BTree consisting of leaves, with\n  // chunk of lines in them, and branches, with up to ten leaves or\n  // other branch nodes below them. The top node is always a branch\n  // node, and is the document object itself (meaning it has\n  // additional methods and properties).\n  //\n  // All nodes have parent links. The tree is used both to go from\n  // line numbers to line objects, and to go from objects to numbers.\n  // It also indexes by height, and is used to convert between height\n  // and line object, and to find the total height of the document.\n  //\n  // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html\n\n  function LeafChunk(lines) {\n    this.lines = lines;\n    this.parent = null;\n    for (var i = 0, height = 0; i < lines.length; ++i) {\n      lines[i].parent = this;\n      height += lines[i].height;\n    }\n    this.height = height;\n  }\n\n  LeafChunk.prototype = {\n    chunkSize: function() { return this.lines.length; },\n    // Remove the n lines at offset 'at'.\n    removeInner: function(at, n) {\n      for (var i = at, e = at + n; i < e; ++i) {\n        var line = this.lines[i];\n        this.height -= line.height;\n        cleanUpLine(line);\n        signalLater(line, \"delete\");\n      }\n      this.lines.splice(at, n);\n    },\n    // Helper used to collapse a small branch into a single leaf.\n    collapse: function(lines) {\n      lines.push.apply(lines, this.lines);\n    },\n    // Insert the given array of lines at offset 'at', count them as\n    // having the given height.\n    insertInner: function(at, lines, height) {\n      this.height += height;\n      this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));\n      for (var i = 0; i < lines.length; ++i) lines[i].parent = this;\n    },\n    // Used to iterate over a part of the tree.\n    iterN: function(at, n, op) {\n      for (var e = at + n; at < e; ++at)\n        if (op(this.lines[at])) return true;\n    }\n  };\n\n  function BranchChunk(children) {\n    this.children = children;\n    var size = 0, height = 0;\n    for (var i = 0; i < children.length; ++i) {\n      var ch = children[i];\n      size += ch.chunkSize(); height += ch.height;\n      ch.parent = this;\n    }\n    this.size = size;\n    this.height = height;\n    this.parent = null;\n  }\n\n  BranchChunk.prototype = {\n    chunkSize: function() { return this.size; },\n    removeInner: function(at, n) {\n      this.size -= n;\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at < sz) {\n          var rm = Math.min(n, sz - at), oldHeight = child.height;\n          child.removeInner(at, rm);\n          this.height -= oldHeight - child.height;\n          if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }\n          if ((n -= rm) == 0) break;\n          at = 0;\n        } else at -= sz;\n      }\n      // If the result is smaller than 25 lines, ensure that it is a\n      // single leaf node.\n      if (this.size - n < 25 &&\n          (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {\n        var lines = [];\n        this.collapse(lines);\n        this.children = [new LeafChunk(lines)];\n        this.children[0].parent = this;\n      }\n    },\n    collapse: function(lines) {\n      for (var i = 0; i < this.children.length; ++i) this.children[i].collapse(lines);\n    },\n    insertInner: function(at, lines, height) {\n      this.size += lines.length;\n      this.height += height;\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at <= sz) {\n          child.insertInner(at, lines, height);\n          if (child.lines && child.lines.length > 50) {\n            while (child.lines.length > 50) {\n              var spilled = child.lines.splice(child.lines.length - 25, 25);\n              var newleaf = new LeafChunk(spilled);\n              child.height -= newleaf.height;\n              this.children.splice(i + 1, 0, newleaf);\n              newleaf.parent = this;\n            }\n            this.maybeSpill();\n          }\n          break;\n        }\n        at -= sz;\n      }\n    },\n    // When a node has grown, check whether it should be split.\n    maybeSpill: function() {\n      if (this.children.length <= 10) return;\n      var me = this;\n      do {\n        var spilled = me.children.splice(me.children.length - 5, 5);\n        var sibling = new BranchChunk(spilled);\n        if (!me.parent) { // Become the parent node\n          var copy = new BranchChunk(me.children);\n          copy.parent = me;\n          me.children = [copy, sibling];\n          me = copy;\n        } else {\n          me.size -= sibling.size;\n          me.height -= sibling.height;\n          var myIndex = indexOf(me.parent.children, me);\n          me.parent.children.splice(myIndex + 1, 0, sibling);\n        }\n        sibling.parent = me.parent;\n      } while (me.children.length > 10);\n      me.parent.maybeSpill();\n    },\n    iterN: function(at, n, op) {\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at < sz) {\n          var used = Math.min(n, sz - at);\n          if (child.iterN(at, used, op)) return true;\n          if ((n -= used) == 0) break;\n          at = 0;\n        } else at -= sz;\n      }\n    }\n  };\n\n  var nextDocId = 0;\n  var Doc = CodeMirror.Doc = function(text, mode, firstLine) {\n    if (!(this instanceof Doc)) return new Doc(text, mode, firstLine);\n    if (firstLine == null) firstLine = 0;\n\n    BranchChunk.call(this, [new LeafChunk([new Line(\"\", null)])]);\n    this.first = firstLine;\n    this.scrollTop = this.scrollLeft = 0;\n    this.cantEdit = false;\n    this.cleanGeneration = 1;\n    this.frontier = firstLine;\n    var start = Pos(firstLine, 0);\n    this.sel = simpleSelection(start);\n    this.history = new History(null);\n    this.id = ++nextDocId;\n    this.modeOption = mode;\n\n    if (typeof text == \"string\") text = splitLines(text);\n    updateDoc(this, {from: start, to: start, text: text});\n    setSelection(this, simpleSelection(start), sel_dontScroll);\n  };\n\n  Doc.prototype = createObj(BranchChunk.prototype, {\n    constructor: Doc,\n    // Iterate over the document. Supports two forms -- with only one\n    // argument, it calls that for each line in the document. With\n    // three, it iterates over the range given by the first two (with\n    // the second being non-inclusive).\n    iter: function(from, to, op) {\n      if (op) this.iterN(from - this.first, to - from, op);\n      else this.iterN(this.first, this.first + this.size, from);\n    },\n\n    // Non-public interface for adding and removing lines.\n    insert: function(at, lines) {\n      var height = 0;\n      for (var i = 0; i < lines.length; ++i) height += lines[i].height;\n      this.insertInner(at - this.first, lines, height);\n    },\n    remove: function(at, n) { this.removeInner(at - this.first, n); },\n\n    // From here, the methods are part of the public interface. Most\n    // are also available from CodeMirror (editor) instances.\n\n    getValue: function(lineSep) {\n      var lines = getLines(this, this.first, this.first + this.size);\n      if (lineSep === false) return lines;\n      return lines.join(lineSep || \"\\n\");\n    },\n    setValue: docMethodOp(function(code) {\n      var top = Pos(this.first, 0), last = this.first + this.size - 1;\n      makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),\n                        text: splitLines(code), origin: \"setValue\"}, true);\n      setSelection(this, simpleSelection(top));\n    }),\n    replaceRange: function(code, from, to, origin) {\n      from = clipPos(this, from);\n      to = to ? clipPos(this, to) : from;\n      replaceRange(this, code, from, to, origin);\n    },\n    getRange: function(from, to, lineSep) {\n      var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\n      if (lineSep === false) return lines;\n      return lines.join(lineSep || \"\\n\");\n    },\n\n    getLine: function(line) {var l = this.getLineHandle(line); return l && l.text;},\n\n    getLineHandle: function(line) {if (isLine(this, line)) return getLine(this, line);},\n    getLineNumber: function(line) {return lineNo(line);},\n\n    getLineHandleVisualStart: function(line) {\n      if (typeof line == \"number\") line = getLine(this, line);\n      return visualLine(line);\n    },\n\n    lineCount: function() {return this.size;},\n    firstLine: function() {return this.first;},\n    lastLine: function() {return this.first + this.size - 1;},\n\n    clipPos: function(pos) {return clipPos(this, pos);},\n\n    getCursor: function(start) {\n      var range = this.sel.primary(), pos;\n      if (start == null || start == \"head\") pos = range.head;\n      else if (start == \"anchor\") pos = range.anchor;\n      else if (start == \"end\" || start == \"to\" || start === false) pos = range.to();\n      else pos = range.from();\n      return pos;\n    },\n    listSelections: function() { return this.sel.ranges; },\n    somethingSelected: function() {return this.sel.somethingSelected();},\n\n    setCursor: docMethodOp(function(line, ch, options) {\n      setSimpleSelection(this, clipPos(this, typeof line == \"number\" ? Pos(line, ch || 0) : line), null, options);\n    }),\n    setSelection: docMethodOp(function(anchor, head, options) {\n      setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);\n    }),\n    extendSelection: docMethodOp(function(head, other, options) {\n      extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);\n    }),\n    extendSelections: docMethodOp(function(heads, options) {\n      extendSelections(this, clipPosArray(this, heads, options));\n    }),\n    extendSelectionsBy: docMethodOp(function(f, options) {\n      extendSelections(this, map(this.sel.ranges, f), options);\n    }),\n    setSelections: docMethodOp(function(ranges, primary, options) {\n      if (!ranges.length) return;\n      for (var i = 0, out = []; i < ranges.length; i++)\n        out[i] = new Range(clipPos(this, ranges[i].anchor),\n                           clipPos(this, ranges[i].head));\n      if (primary == null) primary = Math.min(ranges.length - 1, this.sel.primIndex);\n      setSelection(this, normalizeSelection(out, primary), options);\n    }),\n    addSelection: docMethodOp(function(anchor, head, options) {\n      var ranges = this.sel.ranges.slice(0);\n      ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));\n      setSelection(this, normalizeSelection(ranges, ranges.length - 1), options);\n    }),\n\n    getSelection: function(lineSep) {\n      var ranges = this.sel.ranges, lines;\n      for (var i = 0; i < ranges.length; i++) {\n        var sel = getBetween(this, ranges[i].from(), ranges[i].to());\n        lines = lines ? lines.concat(sel) : sel;\n      }\n      if (lineSep === false) return lines;\n      else return lines.join(lineSep || \"\\n\");\n    },\n    getSelections: function(lineSep) {\n      var parts = [], ranges = this.sel.ranges;\n      for (var i = 0; i < ranges.length; i++) {\n        var sel = getBetween(this, ranges[i].from(), ranges[i].to());\n        if (lineSep !== false) sel = sel.join(lineSep || \"\\n\");\n        parts[i] = sel;\n      }\n      return parts;\n    },\n    replaceSelection: function(code, collapse, origin) {\n      var dup = [];\n      for (var i = 0; i < this.sel.ranges.length; i++)\n        dup[i] = code;\n      this.replaceSelections(dup, collapse, origin || \"+input\");\n    },\n    replaceSelections: docMethodOp(function(code, collapse, origin) {\n      var changes = [], sel = this.sel;\n      for (var i = 0; i < sel.ranges.length; i++) {\n        var range = sel.ranges[i];\n        changes[i] = {from: range.from(), to: range.to(), text: splitLines(code[i]), origin: origin};\n      }\n      var newSel = collapse && collapse != \"end\" && computeReplacedSel(this, changes, collapse);\n      for (var i = changes.length - 1; i >= 0; i--)\n        makeChange(this, changes[i]);\n      if (newSel) setSelectionReplaceHistory(this, newSel);\n      else if (this.cm) ensureCursorVisible(this.cm);\n    }),\n    undo: docMethodOp(function() {makeChangeFromHistory(this, \"undo\");}),\n    redo: docMethodOp(function() {makeChangeFromHistory(this, \"redo\");}),\n    undoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"undo\", true);}),\n    redoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"redo\", true);}),\n\n    setExtending: function(val) {this.extend = val;},\n    getExtending: function() {return this.extend;},\n\n    historySize: function() {\n      var hist = this.history, done = 0, undone = 0;\n      for (var i = 0; i < hist.done.length; i++) if (!hist.done[i].ranges) ++done;\n      for (var i = 0; i < hist.undone.length; i++) if (!hist.undone[i].ranges) ++undone;\n      return {undo: done, redo: undone};\n    },\n    clearHistory: function() {this.history = new History(this.history.maxGeneration);},\n\n    markClean: function() {\n      this.cleanGeneration = this.changeGeneration(true);\n    },\n    changeGeneration: function(forceSplit) {\n      if (forceSplit)\n        this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null;\n      return this.history.generation;\n    },\n    isClean: function (gen) {\n      return this.history.generation == (gen || this.cleanGeneration);\n    },\n\n    getHistory: function() {\n      return {done: copyHistoryArray(this.history.done),\n              undone: copyHistoryArray(this.history.undone)};\n    },\n    setHistory: function(histData) {\n      var hist = this.history = new History(this.history.maxGeneration);\n      hist.done = copyHistoryArray(histData.done.slice(0), null, true);\n      hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);\n    },\n\n    addLineClass: docMethodOp(function(handle, where, cls) {\n      return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function(line) {\n        var prop = where == \"text\" ? \"textClass\"\n                 : where == \"background\" ? \"bgClass\"\n                 : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\n        if (!line[prop]) line[prop] = cls;\n        else if (classTest(cls).test(line[prop])) return false;\n        else line[prop] += \" \" + cls;\n        return true;\n      });\n    }),\n    removeLineClass: docMethodOp(function(handle, where, cls) {\n      return changeLine(this, handle, \"class\", function(line) {\n        var prop = where == \"text\" ? \"textClass\"\n                 : where == \"background\" ? \"bgClass\"\n                 : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\n        var cur = line[prop];\n        if (!cur) return false;\n        else if (cls == null) line[prop] = null;\n        else {\n          var found = cur.match(classTest(cls));\n          if (!found) return false;\n          var end = found.index + found[0].length;\n          line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? \"\" : \" \") + cur.slice(end) || null;\n        }\n        return true;\n      });\n    }),\n\n    markText: function(from, to, options) {\n      return markText(this, clipPos(this, from), clipPos(this, to), options, \"range\");\n    },\n    setBookmark: function(pos, options) {\n      var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),\n                      insertLeft: options && options.insertLeft,\n                      clearWhenEmpty: false, shared: options && options.shared};\n      pos = clipPos(this, pos);\n      return markText(this, pos, pos, realOpts, \"bookmark\");\n    },\n    findMarksAt: function(pos) {\n      pos = clipPos(this, pos);\n      var markers = [], spans = getLine(this, pos.line).markedSpans;\n      if (spans) for (var i = 0; i < spans.length; ++i) {\n        var span = spans[i];\n        if ((span.from == null || span.from <= pos.ch) &&\n            (span.to == null || span.to >= pos.ch))\n          markers.push(span.marker.parent || span.marker);\n      }\n      return markers;\n    },\n    findMarks: function(from, to, filter) {\n      from = clipPos(this, from); to = clipPos(this, to);\n      var found = [], lineNo = from.line;\n      this.iter(from.line, to.line + 1, function(line) {\n        var spans = line.markedSpans;\n        if (spans) for (var i = 0; i < spans.length; i++) {\n          var span = spans[i];\n          if (!(lineNo == from.line && from.ch > span.to ||\n                span.from == null && lineNo != from.line||\n                lineNo == to.line && span.from > to.ch) &&\n              (!filter || filter(span.marker)))\n            found.push(span.marker.parent || span.marker);\n        }\n        ++lineNo;\n      });\n      return found;\n    },\n    getAllMarks: function() {\n      var markers = [];\n      this.iter(function(line) {\n        var sps = line.markedSpans;\n        if (sps) for (var i = 0; i < sps.length; ++i)\n          if (sps[i].from != null) markers.push(sps[i].marker);\n      });\n      return markers;\n    },\n\n    posFromIndex: function(off) {\n      var ch, lineNo = this.first;\n      this.iter(function(line) {\n        var sz = line.text.length + 1;\n        if (sz > off) { ch = off; return true; }\n        off -= sz;\n        ++lineNo;\n      });\n      return clipPos(this, Pos(lineNo, ch));\n    },\n    indexFromPos: function (coords) {\n      coords = clipPos(this, coords);\n      var index = coords.ch;\n      if (coords.line < this.first || coords.ch < 0) return 0;\n      this.iter(this.first, coords.line, function (line) {\n        index += line.text.length + 1;\n      });\n      return index;\n    },\n\n    copy: function(copyHistory) {\n      var doc = new Doc(getLines(this, this.first, this.first + this.size), this.modeOption, this.first);\n      doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;\n      doc.sel = this.sel;\n      doc.extend = false;\n      if (copyHistory) {\n        doc.history.undoDepth = this.history.undoDepth;\n        doc.setHistory(this.getHistory());\n      }\n      return doc;\n    },\n\n    linkedDoc: function(options) {\n      if (!options) options = {};\n      var from = this.first, to = this.first + this.size;\n      if (options.from != null && options.from > from) from = options.from;\n      if (options.to != null && options.to < to) to = options.to;\n      var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from);\n      if (options.sharedHist) copy.history = this.history;\n      (this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});\n      copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];\n      copySharedMarkers(copy, findSharedMarkers(this));\n      return copy;\n    },\n    unlinkDoc: function(other) {\n      if (other instanceof CodeMirror) other = other.doc;\n      if (this.linked) for (var i = 0; i < this.linked.length; ++i) {\n        var link = this.linked[i];\n        if (link.doc != other) continue;\n        this.linked.splice(i, 1);\n        other.unlinkDoc(this);\n        detachSharedMarkers(findSharedMarkers(this));\n        break;\n      }\n      // If the histories were shared, split them again\n      if (other.history == this.history) {\n        var splitIds = [other.id];\n        linkedDocs(other, function(doc) {splitIds.push(doc.id);}, true);\n        other.history = new History(null);\n        other.history.done = copyHistoryArray(this.history.done, splitIds);\n        other.history.undone = copyHistoryArray(this.history.undone, splitIds);\n      }\n    },\n    iterLinkedDocs: function(f) {linkedDocs(this, f);},\n\n    getMode: function() {return this.mode;},\n    getEditor: function() {return this.cm;}\n  });\n\n  // Public alias.\n  Doc.prototype.eachLine = Doc.prototype.iter;\n\n  // Set up methods on CodeMirror's prototype to redirect to the editor's document.\n  var dontDelegate = \"iter insert remove copy getEditor\".split(\" \");\n  for (var prop in Doc.prototype) if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)\n    CodeMirror.prototype[prop] = (function(method) {\n      return function() {return method.apply(this.doc, arguments);};\n    })(Doc.prototype[prop]);\n\n  eventMixin(Doc);\n\n  // Call f for all linked documents.\n  function linkedDocs(doc, f, sharedHistOnly) {\n    function propagate(doc, skip, sharedHist) {\n      if (doc.linked) for (var i = 0; i < doc.linked.length; ++i) {\n        var rel = doc.linked[i];\n        if (rel.doc == skip) continue;\n        var shared = sharedHist && rel.sharedHist;\n        if (sharedHistOnly && !shared) continue;\n        f(rel.doc, shared);\n        propagate(rel.doc, doc, shared);\n      }\n    }\n    propagate(doc, null, true);\n  }\n\n  // Attach a document to an editor.\n  function attachDoc(cm, doc) {\n    if (doc.cm) throw new Error(\"This document is already in use.\");\n    cm.doc = doc;\n    doc.cm = cm;\n    estimateLineHeights(cm);\n    loadMode(cm);\n    if (!cm.options.lineWrapping) findMaxLine(cm);\n    cm.options.mode = doc.modeOption;\n    regChange(cm);\n  }\n\n  // LINE UTILITIES\n\n  // Find the line object corresponding to the given line number.\n  function getLine(doc, n) {\n    n -= doc.first;\n    if (n < 0 || n >= doc.size) throw new Error(\"There is no line \" + (n + doc.first) + \" in the document.\");\n    for (var chunk = doc; !chunk.lines;) {\n      for (var i = 0;; ++i) {\n        var child = chunk.children[i], sz = child.chunkSize();\n        if (n < sz) { chunk = child; break; }\n        n -= sz;\n      }\n    }\n    return chunk.lines[n];\n  }\n\n  // Get the part of a document between two positions, as an array of\n  // strings.\n  function getBetween(doc, start, end) {\n    var out = [], n = start.line;\n    doc.iter(start.line, end.line + 1, function(line) {\n      var text = line.text;\n      if (n == end.line) text = text.slice(0, end.ch);\n      if (n == start.line) text = text.slice(start.ch);\n      out.push(text);\n      ++n;\n    });\n    return out;\n  }\n  // Get the lines between from and to, as array of strings.\n  function getLines(doc, from, to) {\n    var out = [];\n    doc.iter(from, to, function(line) { out.push(line.text); });\n    return out;\n  }\n\n  // Update the height of a line, propagating the height change\n  // upwards to parent nodes.\n  function updateLineHeight(line, height) {\n    var diff = height - line.height;\n    if (diff) for (var n = line; n; n = n.parent) n.height += diff;\n  }\n\n  // Given a line object, find its line number by walking up through\n  // its parent links.\n  function lineNo(line) {\n    if (line.parent == null) return null;\n    var cur = line.parent, no = indexOf(cur.lines, line);\n    for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {\n      for (var i = 0;; ++i) {\n        if (chunk.children[i] == cur) break;\n        no += chunk.children[i].chunkSize();\n      }\n    }\n    return no + cur.first;\n  }\n\n  // Find the line at the given vertical position, using the height\n  // information in the document tree.\n  function lineAtHeight(chunk, h) {\n    var n = chunk.first;\n    outer: do {\n      for (var i = 0; i < chunk.children.length; ++i) {\n        var child = chunk.children[i], ch = child.height;\n        if (h < ch) { chunk = child; continue outer; }\n        h -= ch;\n        n += child.chunkSize();\n      }\n      return n;\n    } while (!chunk.lines);\n    for (var i = 0; i < chunk.lines.length; ++i) {\n      var line = chunk.lines[i], lh = line.height;\n      if (h < lh) break;\n      h -= lh;\n    }\n    return n + i;\n  }\n\n\n  // Find the height above the given line.\n  function heightAtLine(lineObj) {\n    lineObj = visualLine(lineObj);\n\n    var h = 0, chunk = lineObj.parent;\n    for (var i = 0; i < chunk.lines.length; ++i) {\n      var line = chunk.lines[i];\n      if (line == lineObj) break;\n      else h += line.height;\n    }\n    for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {\n      for (var i = 0; i < p.children.length; ++i) {\n        var cur = p.children[i];\n        if (cur == chunk) break;\n        else h += cur.height;\n      }\n    }\n    return h;\n  }\n\n  // Get the bidi ordering for the given line (and cache it). Returns\n  // false for lines that are fully left-to-right, and an array of\n  // BidiSpan objects otherwise.\n  function getOrder(line) {\n    var order = line.order;\n    if (order == null) order = line.order = bidiOrdering(line.text);\n    return order;\n  }\n\n  // HISTORY\n\n  function History(startGen) {\n    // Arrays of change events and selections. Doing something adds an\n    // event to done and clears undo. Undoing moves events from done\n    // to undone, redoing moves them in the other direction.\n    this.done = []; this.undone = [];\n    this.undoDepth = Infinity;\n    // Used to track when changes can be merged into a single undo\n    // event\n    this.lastModTime = this.lastSelTime = 0;\n    this.lastOp = this.lastSelOp = null;\n    this.lastOrigin = this.lastSelOrigin = null;\n    // Used by the isClean() method\n    this.generation = this.maxGeneration = startGen || 1;\n  }\n\n  // Create a history change event from an updateDoc-style change\n  // object.\n  function historyChangeFromChange(doc, change) {\n    var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};\n    attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);\n    linkedDocs(doc, function(doc) {attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);}, true);\n    return histChange;\n  }\n\n  // Pop all selection events off the end of a history array. Stop at\n  // a change event.\n  function clearSelectionEvents(array) {\n    while (array.length) {\n      var last = lst(array);\n      if (last.ranges) array.pop();\n      else break;\n    }\n  }\n\n  // Find the top change event in the history. Pop off selection\n  // events that are in the way.\n  function lastChangeEvent(hist, force) {\n    if (force) {\n      clearSelectionEvents(hist.done);\n      return lst(hist.done);\n    } else if (hist.done.length && !lst(hist.done).ranges) {\n      return lst(hist.done);\n    } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {\n      hist.done.pop();\n      return lst(hist.done);\n    }\n  }\n\n  // Register a change in the history. Merges changes that are within\n  // a single operation, ore are close together with an origin that\n  // allows merging (starting with \"+\") into a single event.\n  function addChangeToHistory(doc, change, selAfter, opId) {\n    var hist = doc.history;\n    hist.undone.length = 0;\n    var time = +new Date, cur;\n\n    if ((hist.lastOp == opId ||\n         hist.lastOrigin == change.origin && change.origin &&\n         ((change.origin.charAt(0) == \"+\" && doc.cm && hist.lastModTime > time - doc.cm.options.historyEventDelay) ||\n          change.origin.charAt(0) == \"*\")) &&\n        (cur = lastChangeEvent(hist, hist.lastOp == opId))) {\n      // Merge this change into the last event\n      var last = lst(cur.changes);\n      if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {\n        // Optimized case for simple insertion -- don't want to add\n        // new changesets for every character typed\n        last.to = changeEnd(change);\n      } else {\n        // Add new sub-event\n        cur.changes.push(historyChangeFromChange(doc, change));\n      }\n    } else {\n      // Can not be merged, start a new event.\n      var before = lst(hist.done);\n      if (!before || !before.ranges)\n        pushSelectionToHistory(doc.sel, hist.done);\n      cur = {changes: [historyChangeFromChange(doc, change)],\n             generation: hist.generation};\n      hist.done.push(cur);\n      while (hist.done.length > hist.undoDepth) {\n        hist.done.shift();\n        if (!hist.done[0].ranges) hist.done.shift();\n      }\n    }\n    hist.done.push(selAfter);\n    hist.generation = ++hist.maxGeneration;\n    hist.lastModTime = hist.lastSelTime = time;\n    hist.lastOp = hist.lastSelOp = opId;\n    hist.lastOrigin = hist.lastSelOrigin = change.origin;\n\n    if (!last) signal(doc, \"historyAdded\");\n  }\n\n  function selectionEventCanBeMerged(doc, origin, prev, sel) {\n    var ch = origin.charAt(0);\n    return ch == \"*\" ||\n      ch == \"+\" &&\n      prev.ranges.length == sel.ranges.length &&\n      prev.somethingSelected() == sel.somethingSelected() &&\n      new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500);\n  }\n\n  // Called whenever the selection changes, sets the new selection as\n  // the pending selection in the history, and pushes the old pending\n  // selection into the 'done' array when it was significantly\n  // different (in number of selected ranges, emptiness, or time).\n  function addSelectionToHistory(doc, sel, opId, options) {\n    var hist = doc.history, origin = options && options.origin;\n\n    // A new event is started when the previous origin does not match\n    // the current, or the origins don't allow matching. Origins\n    // starting with * are always merged, those starting with + are\n    // merged when similar and close together in time.\n    if (opId == hist.lastSelOp ||\n        (origin && hist.lastSelOrigin == origin &&\n         (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||\n          selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))\n      hist.done[hist.done.length - 1] = sel;\n    else\n      pushSelectionToHistory(sel, hist.done);\n\n    hist.lastSelTime = +new Date;\n    hist.lastSelOrigin = origin;\n    hist.lastSelOp = opId;\n    if (options && options.clearRedo !== false)\n      clearSelectionEvents(hist.undone);\n  }\n\n  function pushSelectionToHistory(sel, dest) {\n    var top = lst(dest);\n    if (!(top && top.ranges && top.equals(sel)))\n      dest.push(sel);\n  }\n\n  // Used to store marked span information in the history.\n  function attachLocalSpans(doc, change, from, to) {\n    var existing = change[\"spans_\" + doc.id], n = 0;\n    doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function(line) {\n      if (line.markedSpans)\n        (existing || (existing = change[\"spans_\" + doc.id] = {}))[n] = line.markedSpans;\n      ++n;\n    });\n  }\n\n  // When un/re-doing restores text containing marked spans, those\n  // that have been explicitly cleared should not be restored.\n  function removeClearedSpans(spans) {\n    if (!spans) return null;\n    for (var i = 0, out; i < spans.length; ++i) {\n      if (spans[i].marker.explicitlyCleared) { if (!out) out = spans.slice(0, i); }\n      else if (out) out.push(spans[i]);\n    }\n    return !out ? spans : out.length ? out : null;\n  }\n\n  // Retrieve and filter the old marked spans stored in a change event.\n  function getOldSpans(doc, change) {\n    var found = change[\"spans_\" + doc.id];\n    if (!found) return null;\n    for (var i = 0, nw = []; i < change.text.length; ++i)\n      nw.push(removeClearedSpans(found[i]));\n    return nw;\n  }\n\n  // Used both to provide a JSON-safe object in .getHistory, and, when\n  // detaching a document, to split the history in two\n  function copyHistoryArray(events, newGroup, instantiateSel) {\n    for (var i = 0, copy = []; i < events.length; ++i) {\n      var event = events[i];\n      if (event.ranges) {\n        copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);\n        continue;\n      }\n      var changes = event.changes, newChanges = [];\n      copy.push({changes: newChanges});\n      for (var j = 0; j < changes.length; ++j) {\n        var change = changes[j], m;\n        newChanges.push({from: change.from, to: change.to, text: change.text});\n        if (newGroup) for (var prop in change) if (m = prop.match(/^spans_(\\d+)$/)) {\n          if (indexOf(newGroup, Number(m[1])) > -1) {\n            lst(newChanges)[prop] = change[prop];\n            delete change[prop];\n          }\n        }\n      }\n    }\n    return copy;\n  }\n\n  // Rebasing/resetting history to deal with externally-sourced changes\n\n  function rebaseHistSelSingle(pos, from, to, diff) {\n    if (to < pos.line) {\n      pos.line += diff;\n    } else if (from < pos.line) {\n      pos.line = from;\n      pos.ch = 0;\n    }\n  }\n\n  // Tries to rebase an array of history events given a change in the\n  // document. If the change touches the same lines as the event, the\n  // event, and everything 'behind' it, is discarded. If the change is\n  // before the event, the event's positions are updated. Uses a\n  // copy-on-write scheme for the positions, to avoid having to\n  // reallocate them all on every rebase, but also avoid problems with\n  // shared position objects being unsafely updated.\n  function rebaseHistArray(array, from, to, diff) {\n    for (var i = 0; i < array.length; ++i) {\n      var sub = array[i], ok = true;\n      if (sub.ranges) {\n        if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }\n        for (var j = 0; j < sub.ranges.length; j++) {\n          rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);\n          rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);\n        }\n        continue;\n      }\n      for (var j = 0; j < sub.changes.length; ++j) {\n        var cur = sub.changes[j];\n        if (to < cur.from.line) {\n          cur.from = Pos(cur.from.line + diff, cur.from.ch);\n          cur.to = Pos(cur.to.line + diff, cur.to.ch);\n        } else if (from <= cur.to.line) {\n          ok = false;\n          break;\n        }\n      }\n      if (!ok) {\n        array.splice(0, i + 1);\n        i = 0;\n      }\n    }\n  }\n\n  function rebaseHist(hist, change) {\n    var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;\n    rebaseHistArray(hist.done, from, to, diff);\n    rebaseHistArray(hist.undone, from, to, diff);\n  }\n\n  // EVENT UTILITIES\n\n  // Due to the fact that we still support jurassic IE versions, some\n  // compatibility wrappers are needed.\n\n  var e_preventDefault = CodeMirror.e_preventDefault = function(e) {\n    if (e.preventDefault) e.preventDefault();\n    else e.returnValue = false;\n  };\n  var e_stopPropagation = CodeMirror.e_stopPropagation = function(e) {\n    if (e.stopPropagation) e.stopPropagation();\n    else e.cancelBubble = true;\n  };\n  function e_defaultPrevented(e) {\n    return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false;\n  }\n  var e_stop = CodeMirror.e_stop = function(e) {e_preventDefault(e); e_stopPropagation(e);};\n\n  function e_target(e) {return e.target || e.srcElement;}\n  function e_button(e) {\n    var b = e.which;\n    if (b == null) {\n      if (e.button & 1) b = 1;\n      else if (e.button & 2) b = 3;\n      else if (e.button & 4) b = 2;\n    }\n    if (mac && e.ctrlKey && b == 1) b = 3;\n    return b;\n  }\n\n  // EVENT HANDLING\n\n  // Lightweight event framework. on/off also work on DOM nodes,\n  // registering native DOM handlers.\n\n  var on = CodeMirror.on = function(emitter, type, f) {\n    if (emitter.addEventListener)\n      emitter.addEventListener(type, f, false);\n    else if (emitter.attachEvent)\n      emitter.attachEvent(\"on\" + type, f);\n    else {\n      var map = emitter._handlers || (emitter._handlers = {});\n      var arr = map[type] || (map[type] = []);\n      arr.push(f);\n    }\n  };\n\n  var off = CodeMirror.off = function(emitter, type, f) {\n    if (emitter.removeEventListener)\n      emitter.removeEventListener(type, f, false);\n    else if (emitter.detachEvent)\n      emitter.detachEvent(\"on\" + type, f);\n    else {\n      var arr = emitter._handlers && emitter._handlers[type];\n      if (!arr) return;\n      for (var i = 0; i < arr.length; ++i)\n        if (arr[i] == f) { arr.splice(i, 1); break; }\n    }\n  };\n\n  var signal = CodeMirror.signal = function(emitter, type /*, values...*/) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    if (!arr) return;\n    var args = Array.prototype.slice.call(arguments, 2);\n    for (var i = 0; i < arr.length; ++i) arr[i].apply(null, args);\n  };\n\n  var orphanDelayedCallbacks = null;\n\n  // Often, we want to signal events at a point where we are in the\n  // middle of some work, but don't want the handler to start calling\n  // other methods on the editor, which might be in an inconsistent\n  // state or simply not expect any other events to happen.\n  // signalLater looks whether there are any handlers, and schedules\n  // them to be executed when the last operation ends, or, if no\n  // operation is active, when a timeout fires.\n  function signalLater(emitter, type /*, values...*/) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    if (!arr) return;\n    var args = Array.prototype.slice.call(arguments, 2), list;\n    if (operationGroup) {\n      list = operationGroup.delayedCallbacks;\n    } else if (orphanDelayedCallbacks) {\n      list = orphanDelayedCallbacks;\n    } else {\n      list = orphanDelayedCallbacks = [];\n      setTimeout(fireOrphanDelayed, 0);\n    }\n    function bnd(f) {return function(){f.apply(null, args);};};\n    for (var i = 0; i < arr.length; ++i)\n      list.push(bnd(arr[i]));\n  }\n\n  function fireOrphanDelayed() {\n    var delayed = orphanDelayedCallbacks;\n    orphanDelayedCallbacks = null;\n    for (var i = 0; i < delayed.length; ++i) delayed[i]();\n  }\n\n  // The DOM events that CodeMirror handles can be overridden by\n  // registering a (non-DOM) handler on the editor for the event name,\n  // and preventDefault-ing the event in that handler.\n  function signalDOMEvent(cm, e, override) {\n    if (typeof e == \"string\")\n      e = {type: e, preventDefault: function() { this.defaultPrevented = true; }};\n    signal(cm, override || e.type, cm, e);\n    return e_defaultPrevented(e) || e.codemirrorIgnore;\n  }\n\n  function signalCursorActivity(cm) {\n    var arr = cm._handlers && cm._handlers.cursorActivity;\n    if (!arr) return;\n    var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);\n    for (var i = 0; i < arr.length; ++i) if (indexOf(set, arr[i]) == -1)\n      set.push(arr[i]);\n  }\n\n  function hasHandler(emitter, type) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    return arr && arr.length > 0;\n  }\n\n  // Add on and off methods to a constructor's prototype, to make\n  // registering events on such objects more convenient.\n  function eventMixin(ctor) {\n    ctor.prototype.on = function(type, f) {on(this, type, f);};\n    ctor.prototype.off = function(type, f) {off(this, type, f);};\n  }\n\n  // MISC UTILITIES\n\n  // Number of pixels added to scroller and sizer to hide scrollbar\n  var scrollerCutOff = 30;\n\n  // Returned or thrown by various protocols to signal 'I'm not\n  // handling this'.\n  var Pass = CodeMirror.Pass = {toString: function(){return \"CodeMirror.Pass\";}};\n\n  // Reused option objects for setSelection & friends\n  var sel_dontScroll = {scroll: false}, sel_mouse = {origin: \"*mouse\"}, sel_move = {origin: \"+move\"};\n\n  function Delayed() {this.id = null;}\n  Delayed.prototype.set = function(ms, f) {\n    clearTimeout(this.id);\n    this.id = setTimeout(f, ms);\n  };\n\n  // Counts the column offset in a string, taking tabs into account.\n  // Used mostly to find indentation.\n  var countColumn = CodeMirror.countColumn = function(string, end, tabSize, startIndex, startValue) {\n    if (end == null) {\n      end = string.search(/[^\\s\\u00a0]/);\n      if (end == -1) end = string.length;\n    }\n    for (var i = startIndex || 0, n = startValue || 0;;) {\n      var nextTab = string.indexOf(\"\\t\", i);\n      if (nextTab < 0 || nextTab >= end)\n        return n + (end - i);\n      n += nextTab - i;\n      n += tabSize - (n % tabSize);\n      i = nextTab + 1;\n    }\n  };\n\n  // The inverse of countColumn -- find the offset that corresponds to\n  // a particular column.\n  function findColumn(string, goal, tabSize) {\n    for (var pos = 0, col = 0;;) {\n      var nextTab = string.indexOf(\"\\t\", pos);\n      if (nextTab == -1) nextTab = string.length;\n      var skipped = nextTab - pos;\n      if (nextTab == string.length || col + skipped >= goal)\n        return pos + Math.min(skipped, goal - col);\n      col += nextTab - pos;\n      col += tabSize - (col % tabSize);\n      pos = nextTab + 1;\n      if (col >= goal) return pos;\n    }\n  }\n\n  var spaceStrs = [\"\"];\n  function spaceStr(n) {\n    while (spaceStrs.length <= n)\n      spaceStrs.push(lst(spaceStrs) + \" \");\n    return spaceStrs[n];\n  }\n\n  function lst(arr) { return arr[arr.length-1]; }\n\n  var selectInput = function(node) { node.select(); };\n  if (ios) // Mobile Safari apparently has a bug where select() is broken.\n    selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; };\n  else if (ie) // Suppress mysterious IE10 errors\n    selectInput = function(node) { try { node.select(); } catch(_e) {} };\n\n  function indexOf(array, elt) {\n    for (var i = 0; i < array.length; ++i)\n      if (array[i] == elt) return i;\n    return -1;\n  }\n  if ([].indexOf) indexOf = function(array, elt) { return array.indexOf(elt); };\n  function map(array, f) {\n    var out = [];\n    for (var i = 0; i < array.length; i++) out[i] = f(array[i], i);\n    return out;\n  }\n  if ([].map) map = function(array, f) { return array.map(f); };\n\n  function createObj(base, props) {\n    var inst;\n    if (Object.create) {\n      inst = Object.create(base);\n    } else {\n      var ctor = function() {};\n      ctor.prototype = base;\n      inst = new ctor();\n    }\n    if (props) copyObj(props, inst);\n    return inst;\n  };\n\n  function copyObj(obj, target, overwrite) {\n    if (!target) target = {};\n    for (var prop in obj)\n      if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))\n        target[prop] = obj[prop];\n    return target;\n  }\n\n  function bind(f) {\n    var args = Array.prototype.slice.call(arguments, 1);\n    return function(){return f.apply(null, args);};\n  }\n\n  var nonASCIISingleCaseWordChar = /[\\u00df\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\n  var isWordCharBasic = CodeMirror.isWordChar = function(ch) {\n    return /\\w/.test(ch) || ch > \"\\x80\" &&\n      (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch));\n  };\n  function isWordChar(ch, helper) {\n    if (!helper) return isWordCharBasic(ch);\n    if (helper.source.indexOf(\"\\\\w\") > -1 && isWordCharBasic(ch)) return true;\n    return helper.test(ch);\n  }\n\n  function isEmpty(obj) {\n    for (var n in obj) if (obj.hasOwnProperty(n) && obj[n]) return false;\n    return true;\n  }\n\n  // Extending unicode characters. A series of a non-extending char +\n  // any number of extending chars is treated as a single unit as far\n  // as editing and measuring is concerned. This is not fully correct,\n  // since some scripts/fonts/browsers also treat other configurations\n  // of code points as a group.\n  var extendingChars = /[\\u0300-\\u036f\\u0483-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u065e\\u0670\\u06d6-\\u06dc\\u06de-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0900-\\u0902\\u093c\\u0941-\\u0948\\u094d\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2\\u09e3\\u0a01\\u0a02\\u0a3c\\u0a41\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70\\u0a71\\u0a75\\u0a81\\u0a82\\u0abc\\u0ac1-\\u0ac5\\u0ac7\\u0ac8\\u0acd\\u0ae2\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0d3e\\u0d41-\\u0d44\\u0d4d\\u0d57\\u0d62\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0f18\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86\\u0f87\\u0f90-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039\\u103a\\u103d\\u103e\\u1058\\u1059\\u105e-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108d\\u109d\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193b\\u1a17\\u1a18\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1b00-\\u1b03\\u1b34\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80\\u1b81\\u1ba2-\\u1ba5\\u1ba8\\u1ba9\\u1c2c-\\u1c33\\u1c36\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1dc0-\\u1de6\\u1dfd-\\u1dff\\u200c\\u200d\\u20d0-\\u20f0\\u2cef-\\u2cf1\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua66f-\\ua672\\ua67c\\ua67d\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua825\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc\\uaa29-\\uaa2e\\uaa31\\uaa32\\uaa35\\uaa36\\uaa43\\uaa4c\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uabe5\\uabe8\\uabed\\udc00-\\udfff\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\uff9e\\uff9f]/;\n  function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch); }\n\n  // DOM UTILITIES\n\n  function elt(tag, content, className, style) {\n    var e = document.createElement(tag);\n    if (className) e.className = className;\n    if (style) e.style.cssText = style;\n    if (typeof content == \"string\") e.appendChild(document.createTextNode(content));\n    else if (content) for (var i = 0; i < content.length; ++i) e.appendChild(content[i]);\n    return e;\n  }\n\n  var range;\n  if (document.createRange) range = function(node, start, end) {\n    var r = document.createRange();\n    r.setEnd(node, end);\n    r.setStart(node, start);\n    return r;\n  };\n  else range = function(node, start, end) {\n    var r = document.body.createTextRange();\n    try { r.moveToElementText(node.parentNode); }\n    catch(e) { return r; }\n    r.collapse(true);\n    r.moveEnd(\"character\", end);\n    r.moveStart(\"character\", start);\n    return r;\n  };\n\n  function removeChildren(e) {\n    for (var count = e.childNodes.length; count > 0; --count)\n      e.removeChild(e.firstChild);\n    return e;\n  }\n\n  function removeChildrenAndAdd(parent, e) {\n    return removeChildren(parent).appendChild(e);\n  }\n\n  function contains(parent, child) {\n    if (parent.contains)\n      return parent.contains(child);\n    while (child = child.parentNode)\n      if (child == parent) return true;\n  }\n\n  function activeElt() { return document.activeElement; }\n  // Older versions of IE throws unspecified error when touching\n  // document.activeElement in some cases (during loading, in iframe)\n  if (ie && ie_version < 11) activeElt = function() {\n    try { return document.activeElement; }\n    catch(e) { return document.body; }\n  };\n\n  function classTest(cls) { return new RegExp(\"(^|\\\\s)\" + cls + \"(?:$|\\\\s)\\\\s*\"); }\n  var rmClass = CodeMirror.rmClass = function(node, cls) {\n    var current = node.className;\n    var match = classTest(cls).exec(current);\n    if (match) {\n      var after = current.slice(match.index + match[0].length);\n      node.className = current.slice(0, match.index) + (after ? match[1] + after : \"\");\n    }\n  };\n  var addClass = CodeMirror.addClass = function(node, cls) {\n    var current = node.className;\n    if (!classTest(cls).test(current)) node.className += (current ? \" \" : \"\") + cls;\n  };\n  function joinClasses(a, b) {\n    var as = a.split(\" \");\n    for (var i = 0; i < as.length; i++)\n      if (as[i] && !classTest(as[i]).test(b)) b += \" \" + as[i];\n    return b;\n  }\n\n  // WINDOW-WIDE EVENTS\n\n  // These must be handled carefully, because naively registering a\n  // handler for each editor will cause the editors to never be\n  // garbage collected.\n\n  function forEachCodeMirror(f) {\n    if (!document.body.getElementsByClassName) return;\n    var byClass = document.body.getElementsByClassName(\"CodeMirror\");\n    for (var i = 0; i < byClass.length; i++) {\n      var cm = byClass[i].CodeMirror;\n      if (cm) f(cm);\n    }\n  }\n\n  var globalsRegistered = false;\n  function ensureGlobalHandlers() {\n    if (globalsRegistered) return;\n    registerGlobalHandlers();\n    globalsRegistered = true;\n  }\n  function registerGlobalHandlers() {\n    // When the window resizes, we need to refresh active editors.\n    var resizeTimer;\n    on(window, \"resize\", function() {\n      if (resizeTimer == null) resizeTimer = setTimeout(function() {\n        resizeTimer = null;\n        knownScrollbarWidth = null;\n        forEachCodeMirror(onResize);\n      }, 100);\n    });\n    // When the window loses focus, we want to show the editor as blurred\n    on(window, \"blur\", function() {\n      forEachCodeMirror(onBlur);\n    });\n  }\n\n  // FEATURE DETECTION\n\n  // Detect drag-and-drop\n  var dragAndDrop = function() {\n    // There is *some* kind of drag-and-drop support in IE6-8, but I\n    // couldn't get it to work yet.\n    if (ie && ie_version < 9) return false;\n    var div = elt('div');\n    return \"draggable\" in div || \"dragDrop\" in div;\n  }();\n\n  var knownScrollbarWidth;\n  function scrollbarWidth(measure) {\n    if (knownScrollbarWidth != null) return knownScrollbarWidth;\n    var test = elt(\"div\", null, null, \"width: 50px; height: 50px; overflow-x: scroll\");\n    removeChildrenAndAdd(measure, test);\n    if (test.offsetWidth)\n      knownScrollbarWidth = test.offsetHeight - test.clientHeight;\n    return knownScrollbarWidth || 0;\n  }\n\n  var zwspSupported;\n  function zeroWidthElement(measure) {\n    if (zwspSupported == null) {\n      var test = elt(\"span\", \"\\u200b\");\n      removeChildrenAndAdd(measure, elt(\"span\", [test, document.createTextNode(\"x\")]));\n      if (measure.firstChild.offsetHeight != 0)\n        zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8);\n    }\n    if (zwspSupported) return elt(\"span\", \"\\u200b\");\n    else return elt(\"span\", \"\\u00a0\", null, \"display: inline-block; width: 1px; margin-right: -1px\");\n  }\n\n  // Feature-detect IE's crummy client rect reporting for bidi text\n  var badBidiRects;\n  function hasBadBidiRects(measure) {\n    if (badBidiRects != null) return badBidiRects;\n    var txt = removeChildrenAndAdd(measure, document.createTextNode(\"A\\u062eA\"));\n    var r0 = range(txt, 0, 1).getBoundingClientRect();\n    if (!r0 || r0.left == r0.right) return false; // Safari returns null in some cases (#2780)\n    var r1 = range(txt, 1, 2).getBoundingClientRect();\n    return badBidiRects = (r1.right - r0.right < 3);\n  }\n\n  // See if \"\".split is the broken IE version, if so, provide an\n  // alternative way to split lines.\n  var splitLines = CodeMirror.splitLines = \"\\n\\nb\".split(/\\n/).length != 3 ? function(string) {\n    var pos = 0, result = [], l = string.length;\n    while (pos <= l) {\n      var nl = string.indexOf(\"\\n\", pos);\n      if (nl == -1) nl = string.length;\n      var line = string.slice(pos, string.charAt(nl - 1) == \"\\r\" ? nl - 1 : nl);\n      var rt = line.indexOf(\"\\r\");\n      if (rt != -1) {\n        result.push(line.slice(0, rt));\n        pos += rt + 1;\n      } else {\n        result.push(line);\n        pos = nl + 1;\n      }\n    }\n    return result;\n  } : function(string){return string.split(/\\r\\n?|\\n/);};\n\n  var hasSelection = window.getSelection ? function(te) {\n    try { return te.selectionStart != te.selectionEnd; }\n    catch(e) { return false; }\n  } : function(te) {\n    try {var range = te.ownerDocument.selection.createRange();}\n    catch(e) {}\n    if (!range || range.parentElement() != te) return false;\n    return range.compareEndPoints(\"StartToEnd\", range) != 0;\n  };\n\n  var hasCopyEvent = (function() {\n    var e = elt(\"div\");\n    if (\"oncopy\" in e) return true;\n    e.setAttribute(\"oncopy\", \"return;\");\n    return typeof e.oncopy == \"function\";\n  })();\n\n  var badZoomedRects = null;\n  function hasBadZoomedRects(measure) {\n    if (badZoomedRects != null) return badZoomedRects;\n    var node = removeChildrenAndAdd(measure, elt(\"span\", \"x\"));\n    var normal = node.getBoundingClientRect();\n    var fromRange = range(node, 0, 1).getBoundingClientRect();\n    return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1;\n  }\n\n  // KEY NAMES\n\n  var keyNames = {3: \"Enter\", 8: \"Backspace\", 9: \"Tab\", 13: \"Enter\", 16: \"Shift\", 17: \"Ctrl\", 18: \"Alt\",\n                  19: \"Pause\", 20: \"CapsLock\", 27: \"Esc\", 32: \"Space\", 33: \"PageUp\", 34: \"PageDown\", 35: \"End\",\n                  36: \"Home\", 37: \"Left\", 38: \"Up\", 39: \"Right\", 40: \"Down\", 44: \"PrintScrn\", 45: \"Insert\",\n                  46: \"Delete\", 59: \";\", 61: \"=\", 91: \"Mod\", 92: \"Mod\", 93: \"Mod\", 107: \"=\", 109: \"-\", 127: \"Delete\",\n                  173: \"-\", 186: \";\", 187: \"=\", 188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\",\n                  221: \"]\", 222: \"'\", 63232: \"Up\", 63233: \"Down\", 63234: \"Left\", 63235: \"Right\", 63272: \"Delete\",\n                  63273: \"Home\", 63275: \"End\", 63276: \"PageUp\", 63277: \"PageDown\", 63302: \"Insert\"};\n  CodeMirror.keyNames = keyNames;\n  (function() {\n    // Number keys\n    for (var i = 0; i < 10; i++) keyNames[i + 48] = keyNames[i + 96] = String(i);\n    // Alphabetic keys\n    for (var i = 65; i <= 90; i++) keyNames[i] = String.fromCharCode(i);\n    // Function keys\n    for (var i = 1; i <= 12; i++) keyNames[i + 111] = keyNames[i + 63235] = \"F\" + i;\n  })();\n\n  // BIDI HELPERS\n\n  function iterateBidiSections(order, from, to, f) {\n    if (!order) return f(from, to, \"ltr\");\n    var found = false;\n    for (var i = 0; i < order.length; ++i) {\n      var part = order[i];\n      if (part.from < to && part.to > from || from == to && part.to == from) {\n        f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? \"rtl\" : \"ltr\");\n        found = true;\n      }\n    }\n    if (!found) f(from, to, \"ltr\");\n  }\n\n  function bidiLeft(part) { return part.level % 2 ? part.to : part.from; }\n  function bidiRight(part) { return part.level % 2 ? part.from : part.to; }\n\n  function lineLeft(line) { var order = getOrder(line); return order ? bidiLeft(order[0]) : 0; }\n  function lineRight(line) {\n    var order = getOrder(line);\n    if (!order) return line.text.length;\n    return bidiRight(lst(order));\n  }\n\n  function lineStart(cm, lineN) {\n    var line = getLine(cm.doc, lineN);\n    var visual = visualLine(line);\n    if (visual != line) lineN = lineNo(visual);\n    var order = getOrder(visual);\n    var ch = !order ? 0 : order[0].level % 2 ? lineRight(visual) : lineLeft(visual);\n    return Pos(lineN, ch);\n  }\n  function lineEnd(cm, lineN) {\n    var merged, line = getLine(cm.doc, lineN);\n    while (merged = collapsedSpanAtEnd(line)) {\n      line = merged.find(1, true).line;\n      lineN = null;\n    }\n    var order = getOrder(line);\n    var ch = !order ? line.text.length : order[0].level % 2 ? lineLeft(line) : lineRight(line);\n    return Pos(lineN == null ? lineNo(line) : lineN, ch);\n  }\n  function lineStartSmart(cm, pos) {\n    var start = lineStart(cm, pos.line);\n    var line = getLine(cm.doc, start.line);\n    var order = getOrder(line);\n    if (!order || order[0].level == 0) {\n      var firstNonWS = Math.max(0, line.text.search(/\\S/));\n      var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;\n      return Pos(start.line, inWS ? 0 : firstNonWS);\n    }\n    return start;\n  }\n\n  function compareBidiLevel(order, a, b) {\n    var linedir = order[0].level;\n    if (a == linedir) return true;\n    if (b == linedir) return false;\n    return a < b;\n  }\n  var bidiOther;\n  function getBidiPartAt(order, pos) {\n    bidiOther = null;\n    for (var i = 0, found; i < order.length; ++i) {\n      var cur = order[i];\n      if (cur.from < pos && cur.to > pos) return i;\n      if ((cur.from == pos || cur.to == pos)) {\n        if (found == null) {\n          found = i;\n        } else if (compareBidiLevel(order, cur.level, order[found].level)) {\n          if (cur.from != cur.to) bidiOther = found;\n          return i;\n        } else {\n          if (cur.from != cur.to) bidiOther = i;\n          return found;\n        }\n      }\n    }\n    return found;\n  }\n\n  function moveInLine(line, pos, dir, byUnit) {\n    if (!byUnit) return pos + dir;\n    do pos += dir;\n    while (pos > 0 && isExtendingChar(line.text.charAt(pos)));\n    return pos;\n  }\n\n  // This is needed in order to move 'visually' through bi-directional\n  // text -- i.e., pressing left should make the cursor go left, even\n  // when in RTL text. The tricky part is the 'jumps', where RTL and\n  // LTR text touch each other. This often requires the cursor offset\n  // to move more than one unit, in order to visually move one unit.\n  function moveVisually(line, start, dir, byUnit) {\n    var bidi = getOrder(line);\n    if (!bidi) return moveLogically(line, start, dir, byUnit);\n    var pos = getBidiPartAt(bidi, start), part = bidi[pos];\n    var target = moveInLine(line, start, part.level % 2 ? -dir : dir, byUnit);\n\n    for (;;) {\n      if (target > part.from && target < part.to) return target;\n      if (target == part.from || target == part.to) {\n        if (getBidiPartAt(bidi, target) == pos) return target;\n        part = bidi[pos += dir];\n        return (dir > 0) == part.level % 2 ? part.to : part.from;\n      } else {\n        part = bidi[pos += dir];\n        if (!part) return null;\n        if ((dir > 0) == part.level % 2)\n          target = moveInLine(line, part.to, -1, byUnit);\n        else\n          target = moveInLine(line, part.from, 1, byUnit);\n      }\n    }\n  }\n\n  function moveLogically(line, start, dir, byUnit) {\n    var target = start + dir;\n    if (byUnit) while (target > 0 && isExtendingChar(line.text.charAt(target))) target += dir;\n    return target < 0 || target > line.text.length ? null : target;\n  }\n\n  // Bidirectional ordering algorithm\n  // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm\n  // that this (partially) implements.\n\n  // One-char codes used for character types:\n  // L (L):   Left-to-Right\n  // R (R):   Right-to-Left\n  // r (AL):  Right-to-Left Arabic\n  // 1 (EN):  European Number\n  // + (ES):  European Number Separator\n  // % (ET):  European Number Terminator\n  // n (AN):  Arabic Number\n  // , (CS):  Common Number Separator\n  // m (NSM): Non-Spacing Mark\n  // b (BN):  Boundary Neutral\n  // s (B):   Paragraph Separator\n  // t (S):   Segment Separator\n  // w (WS):  Whitespace\n  // N (ON):  Other Neutrals\n\n  // Returns null if characters are ordered as they appear\n  // (left-to-right), or an array of sections ({from, to, level}\n  // objects) in the order in which they occur visually.\n  var bidiOrdering = (function() {\n    // Character types for codepoints 0 to 0xff\n    var lowTypes = \"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN\";\n    // Character types for codepoints 0x600 to 0x6ff\n    var arabicTypes = \"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm\";\n    function charType(code) {\n      if (code <= 0xf7) return lowTypes.charAt(code);\n      else if (0x590 <= code && code <= 0x5f4) return \"R\";\n      else if (0x600 <= code && code <= 0x6ed) return arabicTypes.charAt(code - 0x600);\n      else if (0x6ee <= code && code <= 0x8ac) return \"r\";\n      else if (0x2000 <= code && code <= 0x200b) return \"w\";\n      else if (code == 0x200c) return \"b\";\n      else return \"L\";\n    }\n\n    var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;\n    var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;\n    // Browsers seem to always treat the boundaries of block elements as being L.\n    var outerType = \"L\";\n\n    function BidiSpan(level, from, to) {\n      this.level = level;\n      this.from = from; this.to = to;\n    }\n\n    return function(str) {\n      if (!bidiRE.test(str)) return false;\n      var len = str.length, types = [];\n      for (var i = 0, type; i < len; ++i)\n        types.push(type = charType(str.charCodeAt(i)));\n\n      // W1. Examine each non-spacing mark (NSM) in the level run, and\n      // change the type of the NSM to the type of the previous\n      // character. If the NSM is at the start of the level run, it will\n      // get the type of sor.\n      for (var i = 0, prev = outerType; i < len; ++i) {\n        var type = types[i];\n        if (type == \"m\") types[i] = prev;\n        else prev = type;\n      }\n\n      // W2. Search backwards from each instance of a European number\n      // until the first strong type (R, L, AL, or sor) is found. If an\n      // AL is found, change the type of the European number to Arabic\n      // number.\n      // W3. Change all ALs to R.\n      for (var i = 0, cur = outerType; i < len; ++i) {\n        var type = types[i];\n        if (type == \"1\" && cur == \"r\") types[i] = \"n\";\n        else if (isStrong.test(type)) { cur = type; if (type == \"r\") types[i] = \"R\"; }\n      }\n\n      // W4. A single European separator between two European numbers\n      // changes to a European number. A single common separator between\n      // two numbers of the same type changes to that type.\n      for (var i = 1, prev = types[0]; i < len - 1; ++i) {\n        var type = types[i];\n        if (type == \"+\" && prev == \"1\" && types[i+1] == \"1\") types[i] = \"1\";\n        else if (type == \",\" && prev == types[i+1] &&\n                 (prev == \"1\" || prev == \"n\")) types[i] = prev;\n        prev = type;\n      }\n\n      // W5. A sequence of European terminators adjacent to European\n      // numbers changes to all European numbers.\n      // W6. Otherwise, separators and terminators change to Other\n      // Neutral.\n      for (var i = 0; i < len; ++i) {\n        var type = types[i];\n        if (type == \",\") types[i] = \"N\";\n        else if (type == \"%\") {\n          for (var end = i + 1; end < len && types[end] == \"%\"; ++end) {}\n          var replace = (i && types[i-1] == \"!\") || (end < len && types[end] == \"1\") ? \"1\" : \"N\";\n          for (var j = i; j < end; ++j) types[j] = replace;\n          i = end - 1;\n        }\n      }\n\n      // W7. Search backwards from each instance of a European number\n      // until the first strong type (R, L, or sor) is found. If an L is\n      // found, then change the type of the European number to L.\n      for (var i = 0, cur = outerType; i < len; ++i) {\n        var type = types[i];\n        if (cur == \"L\" && type == \"1\") types[i] = \"L\";\n        else if (isStrong.test(type)) cur = type;\n      }\n\n      // N1. A sequence of neutrals takes the direction of the\n      // surrounding strong text if the text on both sides has the same\n      // direction. European and Arabic numbers act as if they were R in\n      // terms of their influence on neutrals. Start-of-level-run (sor)\n      // and end-of-level-run (eor) are used at level run boundaries.\n      // N2. Any remaining neutrals take the embedding direction.\n      for (var i = 0; i < len; ++i) {\n        if (isNeutral.test(types[i])) {\n          for (var end = i + 1; end < len && isNeutral.test(types[end]); ++end) {}\n          var before = (i ? types[i-1] : outerType) == \"L\";\n          var after = (end < len ? types[end] : outerType) == \"L\";\n          var replace = before || after ? \"L\" : \"R\";\n          for (var j = i; j < end; ++j) types[j] = replace;\n          i = end - 1;\n        }\n      }\n\n      // Here we depart from the documented algorithm, in order to avoid\n      // building up an actual levels array. Since there are only three\n      // levels (0, 1, 2) in an implementation that doesn't take\n      // explicit embedding into account, we can build up the order on\n      // the fly, without following the level-based algorithm.\n      var order = [], m;\n      for (var i = 0; i < len;) {\n        if (countsAsLeft.test(types[i])) {\n          var start = i;\n          for (++i; i < len && countsAsLeft.test(types[i]); ++i) {}\n          order.push(new BidiSpan(0, start, i));\n        } else {\n          var pos = i, at = order.length;\n          for (++i; i < len && types[i] != \"L\"; ++i) {}\n          for (var j = pos; j < i;) {\n            if (countsAsNum.test(types[j])) {\n              if (pos < j) order.splice(at, 0, new BidiSpan(1, pos, j));\n              var nstart = j;\n              for (++j; j < i && countsAsNum.test(types[j]); ++j) {}\n              order.splice(at, 0, new BidiSpan(2, nstart, j));\n              pos = j;\n            } else ++j;\n          }\n          if (pos < i) order.splice(at, 0, new BidiSpan(1, pos, i));\n        }\n      }\n      if (order[0].level == 1 && (m = str.match(/^\\s+/))) {\n        order[0].from = m[0].length;\n        order.unshift(new BidiSpan(0, 0, m[0].length));\n      }\n      if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {\n        lst(order).to -= m[0].length;\n        order.push(new BidiSpan(0, len - m[0].length, len));\n      }\n      if (order[0].level != lst(order).level)\n        order.push(new BidiSpan(order[0].level, len, len));\n\n      return order;\n    };\n  })();\n\n  // THE END\n\n  CodeMirror.version = \"4.8.0\";\n\n  return CodeMirror;\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  var ie_lt8 = /MSIE \\d/.test(navigator.userAgent) &&\n    (document.documentMode == null || document.documentMode < 8);\n\n  var Pos = CodeMirror.Pos;\n\n  var matching = {\"(\": \")>\", \")\": \"(<\", \"[\": \"]>\", \"]\": \"[<\", \"{\": \"}>\", \"}\": \"{<\"};\n\n  function findMatchingBracket(cm, where, strict, config) {\n    var line = cm.getLineHandle(where.line), pos = where.ch - 1;\n    var match = (pos >= 0 && matching[line.text.charAt(pos)]) || matching[line.text.charAt(++pos)];\n    if (!match) return null;\n    var dir = match.charAt(1) == \">\" ? 1 : -1;\n    if (strict && (dir > 0) != (pos == where.ch)) return null;\n    var style = cm.getTokenTypeAt(Pos(where.line, pos + 1));\n\n    var found = scanForBracket(cm, Pos(where.line, pos + (dir > 0 ? 1 : 0)), dir, style || null, config);\n    if (found == null) return null;\n    return {from: Pos(where.line, pos), to: found && found.pos,\n            match: found && found.ch == match.charAt(0), forward: dir > 0};\n  }\n\n  // bracketRegex is used to specify which type of bracket to scan\n  // should be a regexp, e.g. /[[\\]]/\n  //\n  // Note: If \"where\" is on an open bracket, then this bracket is ignored.\n  //\n  // Returns false when no bracket was found, null when it reached\n  // maxScanLines and gave up\n  function scanForBracket(cm, where, dir, style, config) {\n    var maxScanLen = (config && config.maxScanLineLength) || 10000;\n    var maxScanLines = (config && config.maxScanLines) || 1000;\n\n    var stack = [];\n    var re = config && config.bracketRegex ? config.bracketRegex : /[(){}[\\]]/;\n    var lineEnd = dir > 0 ? Math.min(where.line + maxScanLines, cm.lastLine() + 1)\n                          : Math.max(cm.firstLine() - 1, where.line - maxScanLines);\n    for (var lineNo = where.line; lineNo != lineEnd; lineNo += dir) {\n      var line = cm.getLine(lineNo);\n      if (!line) continue;\n      var pos = dir > 0 ? 0 : line.length - 1, end = dir > 0 ? line.length : -1;\n      if (line.length > maxScanLen) continue;\n      if (lineNo == where.line) pos = where.ch - (dir < 0 ? 1 : 0);\n      for (; pos != end; pos += dir) {\n        var ch = line.charAt(pos);\n        if (re.test(ch) && (style === undefined || cm.getTokenTypeAt(Pos(lineNo, pos + 1)) == style)) {\n          var match = matching[ch];\n          if ((match.charAt(1) == \">\") == (dir > 0)) stack.push(ch);\n          else if (!stack.length) return {pos: Pos(lineNo, pos), ch: ch};\n          else stack.pop();\n        }\n      }\n    }\n    return lineNo - dir == (dir > 0 ? cm.lastLine() : cm.firstLine()) ? false : null;\n  }\n\n  function matchBrackets(cm, autoclear, config) {\n    // Disable brace matching in long lines, since it'll cause hugely slow updates\n    var maxHighlightLen = cm.state.matchBrackets.maxHighlightLineLength || 1000;\n    var marks = [], ranges = cm.listSelections();\n    for (var i = 0; i < ranges.length; i++) {\n      var match = ranges[i].empty() && findMatchingBracket(cm, ranges[i].head, false, config);\n      if (match && cm.getLine(match.from.line).length <= maxHighlightLen) {\n        var style = match.match ? \"CodeMirror-matchingbracket\" : \"CodeMirror-nonmatchingbracket\";\n        marks.push(cm.markText(match.from, Pos(match.from.line, match.from.ch + 1), {className: style}));\n        if (match.to && cm.getLine(match.to.line).length <= maxHighlightLen)\n          marks.push(cm.markText(match.to, Pos(match.to.line, match.to.ch + 1), {className: style}));\n      }\n    }\n\n    if (marks.length) {\n      // Kludge to work around the IE bug from issue #1193, where text\n      // input stops going to the textare whever this fires.\n      if (ie_lt8 && cm.state.focused) cm.display.input.focus();\n\n      var clear = function() {\n        cm.operation(function() {\n          for (var i = 0; i < marks.length; i++) marks[i].clear();\n        });\n      };\n      if (autoclear) setTimeout(clear, 800);\n      else return clear;\n    }\n  }\n\n  var currentlyHighlighted = null;\n  function doMatchBrackets(cm) {\n    cm.operation(function() {\n      if (currentlyHighlighted) {currentlyHighlighted(); currentlyHighlighted = null;}\n      currentlyHighlighted = matchBrackets(cm, false, cm.state.matchBrackets);\n    });\n  }\n\n  CodeMirror.defineOption(\"matchBrackets\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init)\n      cm.off(\"cursorActivity\", doMatchBrackets);\n    if (val) {\n      cm.state.matchBrackets = typeof val == \"object\" ? val : {};\n      cm.on(\"cursorActivity\", doMatchBrackets);\n    }\n  });\n\n  CodeMirror.defineExtension(\"matchBrackets\", function() {matchBrackets(this, true);});\n  CodeMirror.defineExtension(\"findMatchingBracket\", function(pos, strict, config){\n    return findMatchingBracket(this, pos, strict, config);\n  });\n  CodeMirror.defineExtension(\"scanForBracket\", function(pos, dir, style, config){\n    return scanForBracket(this, pos, dir, style, config);\n  });\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  function doFold(cm, pos, options, force) {\n    if (options && options.call) {\n      var finder = options;\n      options = null;\n    } else {\n      var finder = getOption(cm, options, \"rangeFinder\");\n    }\n    if (typeof pos == \"number\") pos = CodeMirror.Pos(pos, 0);\n    var minSize = getOption(cm, options, \"minFoldSize\");\n\n    function getRange(allowFolded) {\n      var range = finder(cm, pos);\n      if (!range || range.to.line - range.from.line < minSize) return null;\n      var marks = cm.findMarksAt(range.from);\n      for (var i = 0; i < marks.length; ++i) {\n        if (marks[i].__isFold && force !== \"fold\") {\n          if (!allowFolded) return null;\n          range.cleared = true;\n          marks[i].clear();\n        }\n      }\n      return range;\n    }\n\n    var range = getRange(true);\n    if (getOption(cm, options, \"scanUp\")) while (!range && pos.line > cm.firstLine()) {\n      pos = CodeMirror.Pos(pos.line - 1, 0);\n      range = getRange(false);\n    }\n    if (!range || range.cleared || force === \"unfold\") return;\n\n    var myWidget = makeWidget(cm, options);\n    CodeMirror.on(myWidget, \"mousedown\", function(e) {\n      myRange.clear();\n      CodeMirror.e_preventDefault(e);\n    });\n    var myRange = cm.markText(range.from, range.to, {\n      replacedWith: myWidget,\n      clearOnEnter: true,\n      __isFold: true\n    });\n    myRange.on(\"clear\", function(from, to) {\n      CodeMirror.signal(cm, \"unfold\", cm, from, to);\n    });\n    CodeMirror.signal(cm, \"fold\", cm, range.from, range.to);\n  }\n\n  function makeWidget(cm, options) {\n    var widget = getOption(cm, options, \"widget\");\n    if (typeof widget == \"string\") {\n      var text = document.createTextNode(widget);\n      widget = document.createElement(\"span\");\n      widget.appendChild(text);\n      widget.className = \"CodeMirror-foldmarker\";\n    }\n    return widget;\n  }\n\n  // Clumsy backwards-compatible interface\n  CodeMirror.newFoldFunction = function(rangeFinder, widget) {\n    return function(cm, pos) { doFold(cm, pos, {rangeFinder: rangeFinder, widget: widget}); };\n  };\n\n  // New-style interface\n  CodeMirror.defineExtension(\"foldCode\", function(pos, options, force) {\n    doFold(this, pos, options, force);\n  });\n\n  CodeMirror.defineExtension(\"isFolded\", function(pos) {\n    var marks = this.findMarksAt(pos);\n    for (var i = 0; i < marks.length; ++i)\n      if (marks[i].__isFold) return true;\n  });\n\n  CodeMirror.commands.toggleFold = function(cm) {\n    cm.foldCode(cm.getCursor());\n  };\n  CodeMirror.commands.fold = function(cm) {\n    cm.foldCode(cm.getCursor(), null, \"fold\");\n  };\n  CodeMirror.commands.unfold = function(cm) {\n    cm.foldCode(cm.getCursor(), null, \"unfold\");\n  };\n  CodeMirror.commands.foldAll = function(cm) {\n    cm.operation(function() {\n      for (var i = cm.firstLine(), e = cm.lastLine(); i <= e; i++)\n        cm.foldCode(CodeMirror.Pos(i, 0), null, \"fold\");\n    });\n  };\n  CodeMirror.commands.unfoldAll = function(cm) {\n    cm.operation(function() {\n      for (var i = cm.firstLine(), e = cm.lastLine(); i <= e; i++)\n        cm.foldCode(CodeMirror.Pos(i, 0), null, \"unfold\");\n    });\n  };\n\n  CodeMirror.registerHelper(\"fold\", \"combine\", function() {\n    var funcs = Array.prototype.slice.call(arguments, 0);\n    return function(cm, start) {\n      for (var i = 0; i < funcs.length; ++i) {\n        var found = funcs[i](cm, start);\n        if (found) return found;\n      }\n    };\n  });\n\n  CodeMirror.registerHelper(\"fold\", \"auto\", function(cm, start) {\n    var helpers = cm.getHelpers(start, \"fold\");\n    for (var i = 0; i < helpers.length; i++) {\n      var cur = helpers[i](cm, start);\n      if (cur) return cur;\n    }\n  });\n\n  var defaultOptions = {\n    rangeFinder: CodeMirror.fold.auto,\n    widget: \"\\u2194\",\n    minFoldSize: 0,\n    scanUp: false\n  };\n\n  CodeMirror.defineOption(\"foldOptions\", null);\n\n  function getOption(cm, options, name) {\n    if (options && options[name] !== undefined)\n      return options[name];\n    var editorOptions = cm.options.foldOptions;\n    if (editorOptions && editorOptions[name] !== undefined)\n      return editorOptions[name];\n    return defaultOptions[name];\n  }\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"./foldcode\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"./foldcode\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  CodeMirror.defineOption(\"foldGutter\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      cm.clearGutter(cm.state.foldGutter.options.gutter);\n      cm.state.foldGutter = null;\n      cm.off(\"gutterClick\", onGutterClick);\n      cm.off(\"change\", onChange);\n      cm.off(\"viewportChange\", onViewportChange);\n      cm.off(\"fold\", onFold);\n      cm.off(\"unfold\", onFold);\n      cm.off(\"swapDoc\", updateInViewport);\n    }\n    if (val) {\n      cm.state.foldGutter = new State(parseOptions(val));\n      updateInViewport(cm);\n      cm.on(\"gutterClick\", onGutterClick);\n      cm.on(\"change\", onChange);\n      cm.on(\"viewportChange\", onViewportChange);\n      cm.on(\"fold\", onFold);\n      cm.on(\"unfold\", onFold);\n      cm.on(\"swapDoc\", updateInViewport);\n    }\n  });\n\n  var Pos = CodeMirror.Pos;\n\n  function State(options) {\n    this.options = options;\n    this.from = this.to = 0;\n  }\n\n  function parseOptions(opts) {\n    if (opts === true) opts = {};\n    if (opts.gutter == null) opts.gutter = \"CodeMirror-foldgutter\";\n    if (opts.indicatorOpen == null) opts.indicatorOpen = \"CodeMirror-foldgutter-open\";\n    if (opts.indicatorFolded == null) opts.indicatorFolded = \"CodeMirror-foldgutter-folded\";\n    return opts;\n  }\n\n  function isFolded(cm, line) {\n    var marks = cm.findMarksAt(Pos(line));\n    for (var i = 0; i < marks.length; ++i)\n      if (marks[i].__isFold && marks[i].find().from.line == line) return true;\n  }\n\n  function marker(spec) {\n    if (typeof spec == \"string\") {\n      var elt = document.createElement(\"div\");\n      elt.className = spec + \" CodeMirror-guttermarker-subtle\";\n      return elt;\n    } else {\n      return spec.cloneNode(true);\n    }\n  }\n\n  function updateFoldInfo(cm, from, to) {\n    var opts = cm.state.foldGutter.options, cur = from;\n    cm.eachLine(from, to, function(line) {\n      var mark = null;\n      if (isFolded(cm, cur)) {\n        mark = marker(opts.indicatorFolded);\n      } else {\n        var pos = Pos(cur, 0), func = opts.rangeFinder || CodeMirror.fold.auto;\n        var range = func && func(cm, pos);\n        if (range && range.from.line + 1 < range.to.line)\n          mark = marker(opts.indicatorOpen);\n      }\n      cm.setGutterMarker(line, opts.gutter, mark);\n      ++cur;\n    });\n  }\n\n  function updateInViewport(cm) {\n    var vp = cm.getViewport(), state = cm.state.foldGutter;\n    if (!state) return;\n    cm.operation(function() {\n      updateFoldInfo(cm, vp.from, vp.to);\n    });\n    state.from = vp.from; state.to = vp.to;\n  }\n\n  function onGutterClick(cm, line, gutter) {\n    var opts = cm.state.foldGutter.options;\n    if (gutter != opts.gutter) return;\n    cm.foldCode(Pos(line, 0), opts.rangeFinder);\n  }\n\n  function onChange(cm) {\n    var state = cm.state.foldGutter, opts = cm.state.foldGutter.options;\n    state.from = state.to = 0;\n    clearTimeout(state.changeUpdate);\n    state.changeUpdate = setTimeout(function() { updateInViewport(cm); }, opts.foldOnChangeTimeSpan || 600);\n  }\n\n  function onViewportChange(cm) {\n    var state = cm.state.foldGutter, opts = cm.state.foldGutter.options;\n    clearTimeout(state.changeUpdate);\n    state.changeUpdate = setTimeout(function() {\n      var vp = cm.getViewport();\n      if (state.from == state.to || vp.from - state.to > 20 || state.from - vp.to > 20) {\n        updateInViewport(cm);\n      } else {\n        cm.operation(function() {\n          if (vp.from < state.from) {\n            updateFoldInfo(cm, vp.from, state.from);\n            state.from = vp.from;\n          }\n          if (vp.to > state.to) {\n            updateFoldInfo(cm, state.to, vp.to);\n            state.to = vp.to;\n          }\n        });\n      }\n    }, opts.updateViewportTimeSpan || 400);\n  }\n\n  function onFold(cm, from) {\n    var state = cm.state.foldGutter, line = from.line;\n    if (line >= state.from && line < state.to)\n      updateFoldInfo(cm, line, line + 1);\n  }\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n\"use strict\";\n\nCodeMirror.registerHelper(\"fold\", \"brace\", function(cm, start) {\n  var line = start.line, lineText = cm.getLine(line);\n  var startCh, tokenType;\n\n  function findOpening(openCh) {\n    for (var at = start.ch, pass = 0;;) {\n      var found = at <= 0 ? -1 : lineText.lastIndexOf(openCh, at - 1);\n      if (found == -1) {\n        if (pass == 1) break;\n        pass = 1;\n        at = lineText.length;\n        continue;\n      }\n      if (pass == 1 && found < start.ch) break;\n      tokenType = cm.getTokenTypeAt(CodeMirror.Pos(line, found + 1));\n      if (!/^(comment|string)/.test(tokenType)) return found + 1;\n      at = found - 1;\n    }\n  }\n\n  var startToken = \"{\", endToken = \"}\", startCh = findOpening(\"{\");\n  if (startCh == null) {\n    startToken = \"[\", endToken = \"]\";\n    startCh = findOpening(\"[\");\n  }\n\n  if (startCh == null) return;\n  var count = 1, lastLine = cm.lastLine(), end, endCh;\n  outer: for (var i = line; i <= lastLine; ++i) {\n    var text = cm.getLine(i), pos = i == line ? startCh : 0;\n    for (;;) {\n      var nextOpen = text.indexOf(startToken, pos), nextClose = text.indexOf(endToken, pos);\n      if (nextOpen < 0) nextOpen = text.length;\n      if (nextClose < 0) nextClose = text.length;\n      pos = Math.min(nextOpen, nextClose);\n      if (pos == text.length) break;\n      if (cm.getTokenTypeAt(CodeMirror.Pos(i, pos + 1)) == tokenType) {\n        if (pos == nextOpen) ++count;\n        else if (!--count) { end = i; endCh = pos; break outer; }\n      }\n      ++pos;\n    }\n  }\n  if (end == null || line == end && endCh == startCh) return;\n  return {from: CodeMirror.Pos(line, startCh),\n          to: CodeMirror.Pos(end, endCh)};\n});\n\nCodeMirror.registerHelper(\"fold\", \"import\", function(cm, start) {\n  function hasImport(line) {\n    if (line < cm.firstLine() || line > cm.lastLine()) return null;\n    var start = cm.getTokenAt(CodeMirror.Pos(line, 1));\n    if (!/\\S/.test(start.string)) start = cm.getTokenAt(CodeMirror.Pos(line, start.end + 1));\n    if (start.type != \"keyword\" || start.string != \"import\") return null;\n    // Now find closing semicolon, return its position\n    for (var i = line, e = Math.min(cm.lastLine(), line + 10); i <= e; ++i) {\n      var text = cm.getLine(i), semi = text.indexOf(\";\");\n      if (semi != -1) return {startCh: start.end, end: CodeMirror.Pos(i, semi)};\n    }\n  }\n\n  var start = start.line, has = hasImport(start), prev;\n  if (!has || hasImport(start - 1) || ((prev = hasImport(start - 2)) && prev.end.line == start - 1))\n    return null;\n  for (var end = has.end;;) {\n    var next = hasImport(end.line + 1);\n    if (next == null) break;\n    end = next.end;\n  }\n  return {from: cm.clipPos(CodeMirror.Pos(start, has.startCh + 1)), to: end};\n});\n\nCodeMirror.registerHelper(\"fold\", \"include\", function(cm, start) {\n  function hasInclude(line) {\n    if (line < cm.firstLine() || line > cm.lastLine()) return null;\n    var start = cm.getTokenAt(CodeMirror.Pos(line, 1));\n    if (!/\\S/.test(start.string)) start = cm.getTokenAt(CodeMirror.Pos(line, start.end + 1));\n    if (start.type == \"meta\" && start.string.slice(0, 8) == \"#include\") return start.start + 8;\n  }\n\n  var start = start.line, has = hasInclude(start);\n  if (has == null || hasInclude(start - 1) != null) return null;\n  for (var end = start;;) {\n    var next = hasInclude(end + 1);\n    if (next == null) break;\n    ++end;\n  }\n  return {from: CodeMirror.Pos(start, has + 1),\n          to: cm.clipPos(CodeMirror.Pos(end))};\n});\n\n});\n\n// Spectrum Colorpicker v1.7.0\n// https://github.com/bgrins/spectrum\n// Author: Brian Grinstead\n// License: MIT\n\n(function (factory) {\n    \"use strict\";\n\n    if (typeof define === 'function' && define.amd) { // AMD\n        define(['jquery'], factory);\n    }\n    else if (typeof exports == \"object\" && typeof module == \"object\") { // CommonJS\n        module.exports = factory;\n    }\n    else { // Browser\n        factory(jQuery);\n    }\n})(function($, undefined) {\n    \"use strict\";\n\n    var defaultOpts = {\n\n        // Callbacks\n        beforeShow: noop,\n        move: noop,\n        change: noop,\n        show: noop,\n        hide: noop,\n\n        // Options\n        color: false,\n        flat: false,\n        showInput: false,\n        allowEmpty: false,\n        showButtons: true,\n        clickoutFiresChange: true,\n        showInitial: false,\n        showPalette: false,\n        showPaletteOnly: false,\n        hideAfterPaletteSelect: false,\n        togglePaletteOnly: false,\n        showSelectionPalette: true,\n        localStorageKey: false,\n        appendTo: \"body\",\n        maxSelectionSize: 7,\n        cancelText: \"cancel\",\n        chooseText: \"choose\",\n        togglePaletteMoreText: \"more\",\n        togglePaletteLessText: \"less\",\n        clearText: \"Clear Color Selection\",\n        noColorSelectedText: \"No Color Selected\",\n        preferredFormat: false,\n        className: \"\", // Deprecated - use containerClassName and replacerClassName instead.\n        containerClassName: \"\",\n        replacerClassName: \"\",\n        showAlpha: false,\n        theme: \"sp-light\",\n        palette: [[\"#ffffff\", \"#000000\", \"#ff0000\", \"#ff8000\", \"#ffff00\", \"#008000\", \"#0000ff\", \"#4b0082\", \"#9400d3\"]],\n        selectionPalette: [],\n        disabled: false,\n        offset: null\n    },\n    spectrums = [],\n    IE = !!/msie/i.exec( window.navigator.userAgent ),\n    rgbaSupport = (function() {\n        function contains( str, substr ) {\n            return !!~('' + str).indexOf(substr);\n        }\n\n        var elem = document.createElement('div');\n        var style = elem.style;\n        style.cssText = 'background-color:rgba(0,0,0,.5)';\n        return contains(style.backgroundColor, 'rgba') || contains(style.backgroundColor, 'hsla');\n    })(),\n    replaceInput = [\n        \"<div class='sp-replacer'>\",\n            \"<div class='sp-preview'><div class='sp-preview-inner'></div></div>\",\n            \"<div class='sp-dd'>&#9660;</div>\",\n        \"</div>\"\n    ].join(''),\n    markup = (function () {\n\n        // IE does not support gradients with multiple stops, so we need to simulate\n        //  that for the rainbow slider with 8 divs that each have a single gradient\n        var gradientFix = \"\";\n        if (IE) {\n            for (var i = 1; i <= 6; i++) {\n                gradientFix += \"<div class='sp-\" + i + \"'></div>\";\n            }\n        }\n\n        return [\n            \"<div class='sp-container sp-hidden'>\",\n                \"<div class='sp-palette-container'>\",\n                    \"<div class='sp-palette sp-thumb sp-cf'></div>\",\n                    \"<div class='sp-palette-button-container sp-cf'>\",\n                        \"<button type='button' class='sp-palette-toggle'></button>\",\n                    \"</div>\",\n                \"</div>\",\n                \"<div class='sp-picker-container'>\",\n                    \"<div class='sp-top sp-cf'>\",\n                        \"<div class='sp-fill'></div>\",\n                        \"<div class='sp-top-inner'>\",\n                            \"<div class='sp-color'>\",\n                                \"<div class='sp-sat'>\",\n                                    \"<div class='sp-val'>\",\n                                        \"<div class='sp-dragger'></div>\",\n                                    \"</div>\",\n                                \"</div>\",\n                            \"</div>\",\n                            \"<div class='sp-clear sp-clear-display'>\",\n                            \"</div>\",\n                            \"<div class='sp-hue'>\",\n                                \"<div class='sp-slider'></div>\",\n                                gradientFix,\n                            \"</div>\",\n                        \"</div>\",\n                        \"<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>\",\n                    \"</div>\",\n                    \"<div class='sp-input-container sp-cf'>\",\n                        \"<input class='sp-input' type='text' spellcheck='false'  />\",\n                    \"</div>\",\n                    \"<div class='sp-initial sp-thumb sp-cf'></div>\",\n                    \"<div class='sp-button-container sp-cf'>\",\n                        \"<a class='sp-cancel' href='#'></a>\",\n                        \"<button type='button' class='sp-choose'></button>\",\n                    \"</div>\",\n                \"</div>\",\n            \"</div>\"\n        ].join(\"\");\n    })();\n\n    function paletteTemplate (p, color, className, opts) {\n        var html = [];\n        for (var i = 0; i < p.length; i++) {\n            var current = p[i];\n            if(current) {\n                var tiny = tinycolor(current);\n                var c = tiny.toHsl().l < 0.5 ? \"sp-thumb-el sp-thumb-dark\" : \"sp-thumb-el sp-thumb-light\";\n                c += (tinycolor.equals(color, current)) ? \" sp-thumb-active\" : \"\";\n                var formattedString = tiny.toString(opts.preferredFormat || \"rgb\");\n                var swatchStyle = rgbaSupport ? (\"background-color:\" + tiny.toRgbString()) : \"filter:\" + tiny.toFilter();\n                html.push('<span title=\"' + formattedString + '\" data-color=\"' + tiny.toRgbString() + '\" class=\"' + c + '\"><span class=\"sp-thumb-inner\" style=\"' + swatchStyle + ';\" /></span>');\n            } else {\n                var cls = 'sp-clear-display';\n                html.push($('<div />')\n                    .append($('<span data-color=\"\" style=\"background-color:transparent;\" class=\"' + cls + '\"></span>')\n                        .attr('title', opts.noColorSelectedText)\n                    )\n                    .html()\n                );\n            }\n        }\n        return \"<div class='sp-cf \" + className + \"'>\" + html.join('') + \"</div>\";\n    }\n\n    function hideAll() {\n        for (var i = 0; i < spectrums.length; i++) {\n            if (spectrums[i]) {\n                spectrums[i].hide();\n            }\n        }\n    }\n\n    function instanceOptions(o, callbackContext) {\n        var opts = $.extend({}, defaultOpts, o);\n        opts.callbacks = {\n            'move': bind(opts.move, callbackContext),\n            'change': bind(opts.change, callbackContext),\n            'show': bind(opts.show, callbackContext),\n            'hide': bind(opts.hide, callbackContext),\n            'beforeShow': bind(opts.beforeShow, callbackContext)\n        };\n\n        return opts;\n    }\n\n    function spectrum(element, o) {\n\n        var opts = instanceOptions(o, element),\n            flat = opts.flat,\n            showSelectionPalette = opts.showSelectionPalette,\n            localStorageKey = opts.localStorageKey,\n            theme = opts.theme,\n            callbacks = opts.callbacks,\n            resize = throttle(reflow, 10),\n            visible = false,\n            isDragging = false,\n            dragWidth = 0,\n            dragHeight = 0,\n            dragHelperHeight = 0,\n            slideHeight = 0,\n            slideWidth = 0,\n            alphaWidth = 0,\n            alphaSlideHelperWidth = 0,\n            slideHelperHeight = 0,\n            currentHue = 0,\n            currentSaturation = 0,\n            currentValue = 0,\n            currentAlpha = 1,\n            palette = [],\n            paletteArray = [],\n            paletteLookup = {},\n            selectionPalette = opts.selectionPalette.slice(0),\n            maxSelectionSize = opts.maxSelectionSize,\n            draggingClass = \"sp-dragging\",\n            shiftMovementDirection = null;\n\n        var doc = element.ownerDocument,\n            body = doc.body,\n            boundElement = $(element),\n            disabled = false,\n            container = $(markup, doc).addClass(theme),\n            pickerContainer = container.find(\".sp-picker-container\"),\n            dragger = container.find(\".sp-color\"),\n            dragHelper = container.find(\".sp-dragger\"),\n            slider = container.find(\".sp-hue\"),\n            slideHelper = container.find(\".sp-slider\"),\n            alphaSliderInner = container.find(\".sp-alpha-inner\"),\n            alphaSlider = container.find(\".sp-alpha\"),\n            alphaSlideHelper = container.find(\".sp-alpha-handle\"),\n            textInput = container.find(\".sp-input\"),\n            paletteContainer = container.find(\".sp-palette\"),\n            initialColorContainer = container.find(\".sp-initial\"),\n            cancelButton = container.find(\".sp-cancel\"),\n            clearButton = container.find(\".sp-clear\"),\n            chooseButton = container.find(\".sp-choose\"),\n            toggleButton = container.find(\".sp-palette-toggle\"),\n            isInput = boundElement.is(\"input\"),\n            isInputTypeColor = isInput && boundElement.attr(\"type\") === \"color\" && inputTypeColorSupport(),\n            shouldReplace = isInput && !flat,\n            replacer = (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName) : $([]),\n            offsetElement = (shouldReplace) ? replacer : boundElement,\n            previewElement = replacer.find(\".sp-preview-inner\"),\n            initialColor = opts.color || (isInput && boundElement.val()),\n            colorOnShow = false,\n            preferredFormat = opts.preferredFormat,\n            currentPreferredFormat = preferredFormat,\n            clickoutFiresChange = !opts.showButtons || opts.clickoutFiresChange,\n            isEmpty = !initialColor,\n            allowEmpty = opts.allowEmpty && !isInputTypeColor;\n\n        function applyOptions() {\n\n            if (opts.showPaletteOnly) {\n                opts.showPalette = true;\n            }\n\n            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);\n\n            if (opts.palette) {\n                palette = opts.palette.slice(0);\n                paletteArray = $.isArray(palette[0]) ? palette : [palette];\n                paletteLookup = {};\n                for (var i = 0; i < paletteArray.length; i++) {\n                    for (var j = 0; j < paletteArray[i].length; j++) {\n                        var rgb = tinycolor(paletteArray[i][j]).toRgbString();\n                        paletteLookup[rgb] = true;\n                    }\n                }\n            }\n\n            container.toggleClass(\"sp-flat\", flat);\n            container.toggleClass(\"sp-input-disabled\", !opts.showInput);\n            container.toggleClass(\"sp-alpha-enabled\", opts.showAlpha);\n            container.toggleClass(\"sp-clear-enabled\", allowEmpty);\n            container.toggleClass(\"sp-buttons-disabled\", !opts.showButtons);\n            container.toggleClass(\"sp-palette-buttons-disabled\", !opts.togglePaletteOnly);\n            container.toggleClass(\"sp-palette-disabled\", !opts.showPalette);\n            container.toggleClass(\"sp-palette-only\", opts.showPaletteOnly);\n            container.toggleClass(\"sp-initial-disabled\", !opts.showInitial);\n            container.addClass(opts.className).addClass(opts.containerClassName);\n\n            reflow();\n        }\n\n        function initialize() {\n\n            if (IE) {\n                container.find(\"*:not(input)\").attr(\"unselectable\", \"on\");\n            }\n\n            applyOptions();\n\n            if (shouldReplace) {\n                boundElement.after(replacer).hide();\n            }\n\n            if (!allowEmpty) {\n                clearButton.hide();\n            }\n\n            if (flat) {\n                boundElement.after(container).hide();\n            }\n            else {\n\n                var appendTo = opts.appendTo === \"parent\" ? boundElement.parent() : $(opts.appendTo);\n                if (appendTo.length !== 1) {\n                    appendTo = $(\"body\");\n                }\n\n                appendTo.append(container);\n            }\n\n            updateSelectionPaletteFromStorage();\n\n            offsetElement.bind(\"click.spectrum touchstart.spectrum\", function (e) {\n                if (!disabled) {\n                    toggle();\n                }\n\n                e.stopPropagation();\n\n                if (!$(e.target).is(\"input\")) {\n                    e.preventDefault();\n                }\n            });\n\n            if(boundElement.is(\":disabled\") || (opts.disabled === true)) {\n                disable();\n            }\n\n            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.\n            container.click(stopPropagation);\n\n            // Handle user typed input\n            textInput.change(setFromTextInput);\n            textInput.bind(\"paste\", function () {\n                setTimeout(setFromTextInput, 1);\n            });\n            textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });\n\n            cancelButton.text(opts.cancelText);\n            cancelButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                revert();\n                hide();\n            });\n\n            clearButton.attr(\"title\", opts.clearText);\n            clearButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                isEmpty = true;\n                move();\n\n                if(flat) {\n                    //for the flat style, this is a change event\n                    updateOriginalInput(true);\n                }\n            });\n\n            chooseButton.text(opts.chooseText);\n            chooseButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n\n                if (IE && textInput.is(\":focus\")) {\n                    textInput.trigger('change');\n                }\n\n                if (isValid()) {\n                    updateOriginalInput(true);\n                    hide();\n                }\n            });\n\n            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);\n            toggleButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n\n                opts.showPaletteOnly = !opts.showPaletteOnly;\n\n                // To make sure the Picker area is drawn on the right, next to the\n                // Palette area (and not below the palette), first move the Palette\n                // to the left to make space for the picker, plus 5px extra.\n                // The 'applyOptions' function puts the whole container back into place\n                // and takes care of the button-text and the sp-palette-only CSS class.\n                if (!opts.showPaletteOnly && !flat) {\n                    container.css('left', '-=' + (pickerContainer.outerWidth(true) + 5));\n                }\n                applyOptions();\n            });\n\n            draggable(alphaSlider, function (dragX, dragY, e) {\n                currentAlpha = (dragX / alphaWidth);\n                isEmpty = false;\n                if (e.shiftKey) {\n                    currentAlpha = Math.round(currentAlpha * 10) / 10;\n                }\n\n                move();\n            }, dragStart, dragStop);\n\n            draggable(slider, function (dragX, dragY) {\n                currentHue = parseFloat(dragY / slideHeight);\n                isEmpty = false;\n                if (!opts.showAlpha) {\n                    currentAlpha = 1;\n                }\n                move();\n            }, dragStart, dragStop);\n\n            draggable(dragger, function (dragX, dragY, e) {\n\n                // shift+drag should snap the movement to either the x or y axis.\n                if (!e.shiftKey) {\n                    shiftMovementDirection = null;\n                }\n                else if (!shiftMovementDirection) {\n                    var oldDragX = currentSaturation * dragWidth;\n                    var oldDragY = dragHeight - (currentValue * dragHeight);\n                    var furtherFromX = Math.abs(dragX - oldDragX) > Math.abs(dragY - oldDragY);\n\n                    shiftMovementDirection = furtherFromX ? \"x\" : \"y\";\n                }\n\n                var setSaturation = !shiftMovementDirection || shiftMovementDirection === \"x\";\n                var setValue = !shiftMovementDirection || shiftMovementDirection === \"y\";\n\n                if (setSaturation) {\n                    currentSaturation = parseFloat(dragX / dragWidth);\n                }\n                if (setValue) {\n                    currentValue = parseFloat((dragHeight - dragY) / dragHeight);\n                }\n\n                isEmpty = false;\n                if (!opts.showAlpha) {\n                    currentAlpha = 1;\n                }\n\n                move();\n\n            }, dragStart, dragStop);\n\n            if (!!initialColor) {\n                set(initialColor);\n\n                // In case color was black - update the preview UI and set the format\n                // since the set function will not run (default color is black).\n                updateUI();\n                currentPreferredFormat = preferredFormat || tinycolor(initialColor).format;\n\n                addColorToSelectionPalette(initialColor);\n            }\n            else {\n                updateUI();\n            }\n\n            if (flat) {\n                show();\n            }\n\n            function paletteElementClick(e) {\n                if (e.data && e.data.ignore) {\n                    set($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\n                    move();\n                }\n                else {\n                    set($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\n                    move();\n                    updateOriginalInput(true);\n                    if (opts.hideAfterPaletteSelect) {\n                      hide();\n                    }\n                }\n\n                return false;\n            }\n\n            var paletteEvent = IE ? \"mousedown.spectrum\" : \"click.spectrum touchstart.spectrum\";\n            paletteContainer.delegate(\".sp-thumb-el\", paletteEvent, paletteElementClick);\n            initialColorContainer.delegate(\".sp-thumb-el:nth-child(1)\", paletteEvent, { ignore: true }, paletteElementClick);\n        }\n\n        function updateSelectionPaletteFromStorage() {\n\n            if (localStorageKey && window.localStorage) {\n\n                // Migrate old palettes over to new format.  May want to remove this eventually.\n                try {\n                    var oldPalette = window.localStorage[localStorageKey].split(\",#\");\n                    if (oldPalette.length > 1) {\n                        delete window.localStorage[localStorageKey];\n                        $.each(oldPalette, function(i, c) {\n                             addColorToSelectionPalette(c);\n                        });\n                    }\n                }\n                catch(e) { }\n\n                try {\n                    selectionPalette = window.localStorage[localStorageKey].split(\";\");\n                }\n                catch (e) { }\n            }\n        }\n\n        function addColorToSelectionPalette(color) {\n            if (showSelectionPalette) {\n                var rgb = tinycolor(color).toRgbString();\n                if (!paletteLookup[rgb] && $.inArray(rgb, selectionPalette) === -1) {\n                    selectionPalette.push(rgb);\n                    while(selectionPalette.length > maxSelectionSize) {\n                        selectionPalette.shift();\n                    }\n                }\n\n                if (localStorageKey && window.localStorage) {\n                    try {\n                        window.localStorage[localStorageKey] = selectionPalette.join(\";\");\n                    }\n                    catch(e) { }\n                }\n            }\n        }\n\n        function getUniqueSelectionPalette() {\n            var unique = [];\n            if (opts.showPalette) {\n                for (var i = 0; i < selectionPalette.length; i++) {\n                    var rgb = tinycolor(selectionPalette[i]).toRgbString();\n\n                    if (!paletteLookup[rgb]) {\n                        unique.push(selectionPalette[i]);\n                    }\n                }\n            }\n\n            return unique.reverse().slice(0, opts.maxSelectionSize);\n        }\n\n        function drawPalette() {\n\n            var currentColor = get();\n\n            var html = $.map(paletteArray, function (palette, i) {\n                return paletteTemplate(palette, currentColor, \"sp-palette-row sp-palette-row-\" + i, opts);\n            });\n\n            updateSelectionPaletteFromStorage();\n\n            if (selectionPalette) {\n                html.push(paletteTemplate(getUniqueSelectionPalette(), currentColor, \"sp-palette-row sp-palette-row-selection\", opts));\n            }\n\n            paletteContainer.html(html.join(\"\"));\n        }\n\n        function drawInitial() {\n            if (opts.showInitial) {\n                var initial = colorOnShow;\n                var current = get();\n                initialColorContainer.html(paletteTemplate([initial, current], current, \"sp-palette-row-initial\", opts));\n            }\n        }\n\n        function dragStart() {\n            if (dragHeight <= 0 || dragWidth <= 0 || slideHeight <= 0) {\n                reflow();\n            }\n            isDragging = true;\n            container.addClass(draggingClass);\n            shiftMovementDirection = null;\n            boundElement.trigger('dragstart.spectrum', [ get() ]);\n        }\n\n        function dragStop() {\n            isDragging = false;\n            container.removeClass(draggingClass);\n            boundElement.trigger('dragstop.spectrum', [ get() ]);\n        }\n\n        function setFromTextInput() {\n\n            var value = textInput.val();\n\n            if ((value === null || value === \"\") && allowEmpty) {\n                set(null);\n                updateOriginalInput(true);\n            }\n            else {\n                var tiny = tinycolor(value);\n                if (tiny.isValid()) {\n                    set(tiny);\n                    updateOriginalInput(true);\n                }\n                else {\n                    textInput.addClass(\"sp-validation-error\");\n                }\n            }\n        }\n\n        function toggle() {\n            if (visible) {\n                hide();\n            }\n            else {\n                show();\n            }\n        }\n\n        function show() {\n            var event = $.Event('beforeShow.spectrum');\n\n            if (visible) {\n                reflow();\n                return;\n            }\n\n            boundElement.trigger(event, [ get() ]);\n\n            if (callbacks.beforeShow(get()) === false || event.isDefaultPrevented()) {\n                return;\n            }\n\n            hideAll();\n            visible = true;\n\n            $(doc).bind(\"keydown.spectrum\", onkeydown);\n            $(doc).bind(\"click.spectrum\", clickout);\n            $(window).bind(\"resize.spectrum\", resize);\n            replacer.addClass(\"sp-active\");\n            container.removeClass(\"sp-hidden\");\n\n            reflow();\n            updateUI();\n\n            colorOnShow = get();\n\n            drawInitial();\n            callbacks.show(colorOnShow);\n            boundElement.trigger('show.spectrum', [ colorOnShow ]);\n        }\n\n        function onkeydown(e) {\n            // Close on ESC\n            if (e.keyCode === 27) {\n                hide();\n            }\n        }\n\n        function clickout(e) {\n            // Return on right click.\n            if (e.button == 2) { return; }\n\n            // If a drag event was happening during the mouseup, don't hide\n            // on click.\n            if (isDragging) { return; }\n\n            if (clickoutFiresChange) {\n                updateOriginalInput(true);\n            }\n            else {\n                revert();\n            }\n            hide();\n        }\n\n        function hide() {\n            // Return if hiding is unnecessary\n            if (!visible || flat) { return; }\n            visible = false;\n\n            $(doc).unbind(\"keydown.spectrum\", onkeydown);\n            $(doc).unbind(\"click.spectrum\", clickout);\n            $(window).unbind(\"resize.spectrum\", resize);\n\n            replacer.removeClass(\"sp-active\");\n            container.addClass(\"sp-hidden\");\n\n            callbacks.hide(get());\n            boundElement.trigger('hide.spectrum', [ get() ]);\n        }\n\n        function revert() {\n            set(colorOnShow, true);\n        }\n\n        function set(color, ignoreFormatChange) {\n            if (tinycolor.equals(color, get())) {\n                // Update UI just in case a validation error needs\n                // to be cleared.\n                updateUI();\n                return;\n            }\n\n            var newColor, newHsv;\n            if (!color && allowEmpty) {\n                isEmpty = true;\n            } else {\n                isEmpty = false;\n                newColor = tinycolor(color);\n                newHsv = newColor.toHsv();\n\n                currentHue = (newHsv.h % 360) / 360;\n                currentSaturation = newHsv.s;\n                currentValue = newHsv.v;\n                currentAlpha = newHsv.a;\n            }\n            updateUI();\n\n            if (newColor && newColor.isValid() && !ignoreFormatChange) {\n                currentPreferredFormat = preferredFormat || newColor.getFormat();\n            }\n        }\n\n        function get(opts) {\n            opts = opts || { };\n\n            if (allowEmpty && isEmpty) {\n                return null;\n            }\n\n            return tinycolor.fromRatio({\n                h: currentHue,\n                s: currentSaturation,\n                v: currentValue,\n                a: Math.round(currentAlpha * 100) / 100\n            }, { format: opts.format || currentPreferredFormat });\n        }\n\n        function isValid() {\n            return !textInput.hasClass(\"sp-validation-error\");\n        }\n\n        function move() {\n            updateUI();\n\n            callbacks.move(get());\n            boundElement.trigger('move.spectrum', [ get() ]);\n        }\n\n        function updateUI() {\n\n            textInput.removeClass(\"sp-validation-error\");\n\n            updateHelperLocations();\n\n            // Update dragger background color (gradients take care of saturation and value).\n            var flatColor = tinycolor.fromRatio({ h: currentHue, s: 1, v: 1 });\n            dragger.css(\"background-color\", flatColor.toHexString());\n\n            // Get a format that alpha will be included in (hex and names ignore alpha)\n            var format = currentPreferredFormat;\n            if (currentAlpha < 1 && !(currentAlpha === 0 && format === \"name\")) {\n                if (format === \"hex\" || format === \"hex3\" || format === \"hex6\" || format === \"name\") {\n                    format = \"rgb\";\n                }\n            }\n\n            var realColor = get({ format: format }),\n                displayColor = '';\n\n             //reset background info for preview element\n            previewElement.removeClass(\"sp-clear-display\");\n            previewElement.css('background-color', 'transparent');\n\n            if (!realColor && allowEmpty) {\n                // Update the replaced elements background with icon indicating no color selection\n                previewElement.addClass(\"sp-clear-display\");\n            }\n            else {\n                var realHex = realColor.toHexString(),\n                    realRgb = realColor.toRgbString();\n\n                // Update the replaced elements background color (with actual selected color)\n                if (rgbaSupport || realColor.alpha === 1) {\n                    previewElement.css(\"background-color\", realRgb);\n                }\n                else {\n                    previewElement.css(\"background-color\", \"transparent\");\n                    previewElement.css(\"filter\", realColor.toFilter());\n                }\n\n                if (opts.showAlpha) {\n                    var rgb = realColor.toRgb();\n                    rgb.a = 0;\n                    var realAlpha = tinycolor(rgb).toRgbString();\n                    var gradient = \"linear-gradient(left, \" + realAlpha + \", \" + realHex + \")\";\n\n                    if (IE) {\n                        alphaSliderInner.css(\"filter\", tinycolor(realAlpha).toFilter({ gradientType: 1 }, realHex));\n                    }\n                    else {\n                        alphaSliderInner.css(\"background\", \"-webkit-\" + gradient);\n                        alphaSliderInner.css(\"background\", \"-moz-\" + gradient);\n                        alphaSliderInner.css(\"background\", \"-ms-\" + gradient);\n                        // Use current syntax gradient on unprefixed property.\n                        alphaSliderInner.css(\"background\",\n                            \"linear-gradient(to right, \" + realAlpha + \", \" + realHex + \")\");\n                    }\n                }\n\n                displayColor = realColor.toString(format);\n            }\n\n            // Update the text entry input as it changes happen\n            if (opts.showInput) {\n                textInput.val(displayColor);\n            }\n\n            if (opts.showPalette) {\n                drawPalette();\n            }\n\n            drawInitial();\n        }\n\n        function updateHelperLocations() {\n            var s = currentSaturation;\n            var v = currentValue;\n\n            if(allowEmpty && isEmpty) {\n                //if selected color is empty, hide the helpers\n                alphaSlideHelper.hide();\n                slideHelper.hide();\n                dragHelper.hide();\n            }\n            else {\n                //make sure helpers are visible\n                alphaSlideHelper.show();\n                slideHelper.show();\n                dragHelper.show();\n\n                // Where to show the little circle in that displays your current selected color\n                var dragX = s * dragWidth;\n                var dragY = dragHeight - (v * dragHeight);\n                dragX = Math.max(\n                    -dragHelperHeight,\n                    Math.min(dragWidth - dragHelperHeight, dragX - dragHelperHeight)\n                );\n                dragY = Math.max(\n                    -dragHelperHeight,\n                    Math.min(dragHeight - dragHelperHeight, dragY - dragHelperHeight)\n                );\n                dragHelper.css({\n                    \"top\": dragY + \"px\",\n                    \"left\": dragX + \"px\"\n                });\n\n                var alphaX = currentAlpha * alphaWidth;\n                alphaSlideHelper.css({\n                    \"left\": (alphaX - (alphaSlideHelperWidth / 2)) + \"px\"\n                });\n\n                // Where to show the bar that displays your current selected hue\n                var slideY = (currentHue) * slideHeight;\n                slideHelper.css({\n                    \"top\": (slideY - slideHelperHeight) + \"px\"\n                });\n            }\n        }\n\n        function updateOriginalInput(fireCallback) {\n            var color = get(),\n                displayColor = '',\n                hasChanged = !tinycolor.equals(color, colorOnShow);\n\n            if (color) {\n                displayColor = color.toString(currentPreferredFormat);\n                // Update the selection palette with the current color\n                addColorToSelectionPalette(color);\n            }\n\n            if (isInput) {\n                boundElement.val(displayColor);\n            }\n\n            if (fireCallback && hasChanged) {\n                callbacks.change(color);\n                boundElement.trigger('change', [ color ]);\n            }\n        }\n\n        function reflow() {\n            dragWidth = dragger.width();\n            dragHeight = dragger.height();\n            dragHelperHeight = dragHelper.height();\n            slideWidth = slider.width();\n            slideHeight = slider.height();\n            slideHelperHeight = slideHelper.height();\n            alphaWidth = alphaSlider.width();\n            alphaSlideHelperWidth = alphaSlideHelper.width();\n\n            if (!flat) {\n                container.css(\"position\", \"absolute\");\n                if (opts.offset) {\n                    container.offset(opts.offset);\n                } else {\n                    container.offset(getOffset(container, offsetElement));\n                }\n            }\n\n            updateHelperLocations();\n\n            if (opts.showPalette) {\n                drawPalette();\n            }\n\n            boundElement.trigger('reflow.spectrum');\n        }\n\n        function destroy() {\n            boundElement.show();\n            offsetElement.unbind(\"click.spectrum touchstart.spectrum\");\n            container.remove();\n            replacer.remove();\n            spectrums[spect.id] = null;\n        }\n\n        function option(optionName, optionValue) {\n            if (optionName === undefined) {\n                return $.extend({}, opts);\n            }\n            if (optionValue === undefined) {\n                return opts[optionName];\n            }\n\n            opts[optionName] = optionValue;\n            applyOptions();\n        }\n\n        function enable() {\n            disabled = false;\n            boundElement.attr(\"disabled\", false);\n            offsetElement.removeClass(\"sp-disabled\");\n        }\n\n        function disable() {\n            hide();\n            disabled = true;\n            boundElement.attr(\"disabled\", true);\n            offsetElement.addClass(\"sp-disabled\");\n        }\n\n        function setOffset(coord) {\n            opts.offset = coord;\n            reflow();\n        }\n\n        initialize();\n\n        var spect = {\n            show: show,\n            hide: hide,\n            toggle: toggle,\n            reflow: reflow,\n            option: option,\n            enable: enable,\n            disable: disable,\n            offset: setOffset,\n            set: function (c) {\n                set(c);\n                updateOriginalInput();\n            },\n            get: get,\n            destroy: destroy,\n            container: container\n        };\n\n        spect.id = spectrums.push(spect) - 1;\n\n        return spect;\n    }\n\n    /**\n    * checkOffset - get the offset below/above and left/right element depending on screen position\n    * Thanks https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js\n    */\n    function getOffset(picker, input) {\n        var extraY = 0;\n        var dpWidth = picker.outerWidth();\n        var dpHeight = picker.outerHeight();\n        var inputHeight = input.outerHeight();\n        var doc = picker[0].ownerDocument;\n        var docElem = doc.documentElement;\n        var viewWidth = docElem.clientWidth + $(doc).scrollLeft();\n        var viewHeight = docElem.clientHeight + $(doc).scrollTop();\n        var offset = input.offset();\n        offset.top += inputHeight;\n\n        offset.left -=\n            Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?\n            Math.abs(offset.left + dpWidth - viewWidth) : 0);\n\n        offset.top -=\n            Math.min(offset.top, ((offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?\n            Math.abs(dpHeight + inputHeight - extraY) : extraY));\n\n        return offset;\n    }\n\n    /**\n    * noop - do nothing\n    */\n    function noop() {\n\n    }\n\n    /**\n    * stopPropagation - makes the code only doing this a little easier to read in line\n    */\n    function stopPropagation(e) {\n        e.stopPropagation();\n    }\n\n    /**\n    * Create a function bound to a given object\n    * Thanks to underscore.js\n    */\n    function bind(func, obj) {\n        var slice = Array.prototype.slice;\n        var args = slice.call(arguments, 2);\n        return function () {\n            return func.apply(obj, args.concat(slice.call(arguments)));\n        };\n    }\n\n    /**\n    * Lightweight drag helper.  Handles containment within the element, so that\n    * when dragging, the x is within [0,element.width] and y is within [0,element.height]\n    */\n    function draggable(element, onmove, onstart, onstop) {\n        onmove = onmove || function () { };\n        onstart = onstart || function () { };\n        onstop = onstop || function () { };\n        var doc = document;\n        var dragging = false;\n        var offset = {};\n        var maxHeight = 0;\n        var maxWidth = 0;\n        var hasTouch = ('ontouchstart' in window);\n\n        var duringDragEvents = {};\n        duringDragEvents[\"selectstart\"] = prevent;\n        duringDragEvents[\"dragstart\"] = prevent;\n        duringDragEvents[\"touchmove mousemove\"] = move;\n        duringDragEvents[\"touchend mouseup\"] = stop;\n\n        function prevent(e) {\n            if (e.stopPropagation) {\n                e.stopPropagation();\n            }\n            if (e.preventDefault) {\n                e.preventDefault();\n            }\n            e.returnValue = false;\n        }\n\n        function move(e) {\n            if (dragging) {\n                // Mouseup happened outside of window\n                if (IE && doc.documentMode < 9 && !e.button) {\n                    return stop();\n                }\n\n                var t0 = e.originalEvent && e.originalEvent.touches && e.originalEvent.touches[0];\n                var pageX = t0 && t0.pageX || e.pageX;\n                var pageY = t0 && t0.pageY || e.pageY;\n\n                var dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));\n                var dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));\n\n                if (hasTouch) {\n                    // Stop scrolling in iOS\n                    prevent(e);\n                }\n\n                onmove.apply(element, [dragX, dragY, e]);\n            }\n        }\n\n        function start(e) {\n            var rightclick = (e.which) ? (e.which == 3) : (e.button == 2);\n\n            if (!rightclick && !dragging) {\n                if (onstart.apply(element, arguments) !== false) {\n                    dragging = true;\n                    maxHeight = $(element).height();\n                    maxWidth = $(element).width();\n                    offset = $(element).offset();\n\n                    $(doc).bind(duringDragEvents);\n                    $(doc.body).addClass(\"sp-dragging\");\n\n                    move(e);\n\n                    prevent(e);\n                }\n            }\n        }\n\n        function stop() {\n            if (dragging) {\n                $(doc).unbind(duringDragEvents);\n                $(doc.body).removeClass(\"sp-dragging\");\n\n                // Wait a tick before notifying observers to allow the click event\n                // to fire in Chrome.\n                setTimeout(function() {\n                    onstop.apply(element, arguments);\n                }, 0);\n            }\n            dragging = false;\n        }\n\n        $(element).bind(\"touchstart mousedown\", start);\n    }\n\n    function throttle(func, wait, debounce) {\n        var timeout;\n        return function () {\n            var context = this, args = arguments;\n            var throttler = function () {\n                timeout = null;\n                func.apply(context, args);\n            };\n            if (debounce) clearTimeout(timeout);\n            if (debounce || !timeout) timeout = setTimeout(throttler, wait);\n        };\n    }\n\n    function inputTypeColorSupport() {\n        return $.fn.spectrum.inputTypeColorSupport();\n    }\n\n    /**\n    * Define a jQuery plugin\n    */\n    var dataID = \"spectrum.id\";\n    $.fn.spectrum = function (opts, extra) {\n\n        if (typeof opts == \"string\") {\n\n            var returnValue = this;\n            var args = Array.prototype.slice.call( arguments, 1 );\n\n            this.each(function () {\n                var spect = spectrums[$(this).data(dataID)];\n                if (spect) {\n                    var method = spect[opts];\n                    if (!method) {\n                        throw new Error( \"Spectrum: no such method: '\" + opts + \"'\" );\n                    }\n\n                    if (opts == \"get\") {\n                        returnValue = spect.get();\n                    }\n                    else if (opts == \"container\") {\n                        returnValue = spect.container;\n                    }\n                    else if (opts == \"option\") {\n                        returnValue = spect.option.apply(spect, args);\n                    }\n                    else if (opts == \"destroy\") {\n                        spect.destroy();\n                        $(this).removeData(dataID);\n                    }\n                    else {\n                        method.apply(spect, args);\n                    }\n                }\n            });\n\n            return returnValue;\n        }\n\n        // Initializing a new instance of spectrum\n        return this.spectrum(\"destroy\").each(function () {\n            var options = $.extend({}, opts, $(this).data());\n            var spect = spectrum(this, options);\n            $(this).data(dataID, spect.id);\n        });\n    };\n\n    $.fn.spectrum.load = true;\n    $.fn.spectrum.loadOpts = {};\n    $.fn.spectrum.draggable = draggable;\n    $.fn.spectrum.defaults = defaultOpts;\n    $.fn.spectrum.inputTypeColorSupport = function inputTypeColorSupport() {\n        if (typeof inputTypeColorSupport._cachedResult === \"undefined\") {\n            var colorInput = $(\"<input type='color' value='!' />\")[0];\n            inputTypeColorSupport._cachedResult = colorInput.type === \"color\" && colorInput.value !== \"!\";\n        }\n        return inputTypeColorSupport._cachedResult;\n    };\n\n    $.spectrum = { };\n    $.spectrum.localization = { };\n    $.spectrum.palettes = { };\n\n    $.fn.spectrum.processNativeColorInputs = function () {\n        var colorInputs = $(\"input[type=color]\");\n        if (colorInputs.length && !inputTypeColorSupport()) {\n            colorInputs.spectrum({\n                preferredFormat: \"hex6\"\n            });\n        }\n    };\n\n    // TinyColor v1.1.2\n    // https://github.com/bgrins/TinyColor\n    // Brian Grinstead, MIT License\n\n    (function() {\n\n    var trimLeft = /^[\\s,#]+/,\n        trimRight = /\\s+$/,\n        tinyCounter = 0,\n        math = Math,\n        mathRound = math.round,\n        mathMin = math.min,\n        mathMax = math.max,\n        mathRandom = math.random;\n\n    var tinycolor = function(color, opts) {\n\n        color = (color) ? color : '';\n        opts = opts || { };\n\n        // If input is already a tinycolor, return itself\n        if (color instanceof tinycolor) {\n           return color;\n        }\n        // If we are called as a function, call using new instead\n        if (!(this instanceof tinycolor)) {\n            return new tinycolor(color, opts);\n        }\n\n        var rgb = inputToRGB(color);\n        this._originalInput = color,\n        this._r = rgb.r,\n        this._g = rgb.g,\n        this._b = rgb.b,\n        this._a = rgb.a,\n        this._roundA = mathRound(100*this._a) / 100,\n        this._format = opts.format || rgb.format;\n        this._gradientType = opts.gradientType;\n\n        // Don't let the range of [0,255] come back in [0,1].\n        // Potentially lose a little bit of precision here, but will fix issues where\n        // .5 gets interpreted as half of the total, instead of half of 1\n        // If it was supposed to be 128, this was already taken care of by `inputToRgb`\n        if (this._r < 1) { this._r = mathRound(this._r); }\n        if (this._g < 1) { this._g = mathRound(this._g); }\n        if (this._b < 1) { this._b = mathRound(this._b); }\n\n        this._ok = rgb.ok;\n        this._tc_id = tinyCounter++;\n    };\n\n    tinycolor.prototype = {\n        isDark: function() {\n            return this.getBrightness() < 128;\n        },\n        isLight: function() {\n            return !this.isDark();\n        },\n        isValid: function() {\n            return this._ok;\n        },\n        getOriginalInput: function() {\n          return this._originalInput;\n        },\n        getFormat: function() {\n            return this._format;\n        },\n        getAlpha: function() {\n            return this._a;\n        },\n        getBrightness: function() {\n            var rgb = this.toRgb();\n            return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;\n        },\n        setAlpha: function(value) {\n            this._a = boundAlpha(value);\n            this._roundA = mathRound(100*this._a) / 100;\n            return this;\n        },\n        toHsv: function() {\n            var hsv = rgbToHsv(this._r, this._g, this._b);\n            return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: this._a };\n        },\n        toHsvString: function() {\n            var hsv = rgbToHsv(this._r, this._g, this._b);\n            var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);\n            return (this._a == 1) ?\n              \"hsv(\"  + h + \", \" + s + \"%, \" + v + \"%)\" :\n              \"hsva(\" + h + \", \" + s + \"%, \" + v + \"%, \"+ this._roundA + \")\";\n        },\n        toHsl: function() {\n            var hsl = rgbToHsl(this._r, this._g, this._b);\n            return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: this._a };\n        },\n        toHslString: function() {\n            var hsl = rgbToHsl(this._r, this._g, this._b);\n            var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);\n            return (this._a == 1) ?\n              \"hsl(\"  + h + \", \" + s + \"%, \" + l + \"%)\" :\n              \"hsla(\" + h + \", \" + s + \"%, \" + l + \"%, \"+ this._roundA + \")\";\n        },\n        toHex: function(allow3Char) {\n            return rgbToHex(this._r, this._g, this._b, allow3Char);\n        },\n        toHexString: function(allow3Char) {\n            return '#' + this.toHex(allow3Char);\n        },\n        toHex8: function() {\n            return rgbaToHex(this._r, this._g, this._b, this._a);\n        },\n        toHex8String: function() {\n            return '#' + this.toHex8();\n        },\n        toRgb: function() {\n            return { r: mathRound(this._r), g: mathRound(this._g), b: mathRound(this._b), a: this._a };\n        },\n        toRgbString: function() {\n            return (this._a == 1) ?\n              \"rgb(\"  + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \")\" :\n              \"rgba(\" + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \", \" + this._roundA + \")\";\n        },\n        toPercentageRgb: function() {\n            return { r: mathRound(bound01(this._r, 255) * 100) + \"%\", g: mathRound(bound01(this._g, 255) * 100) + \"%\", b: mathRound(bound01(this._b, 255) * 100) + \"%\", a: this._a };\n        },\n        toPercentageRgbString: function() {\n            return (this._a == 1) ?\n              \"rgb(\"  + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%)\" :\n              \"rgba(\" + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%, \" + this._roundA + \")\";\n        },\n        toName: function() {\n            if (this._a === 0) {\n                return \"transparent\";\n            }\n\n            if (this._a < 1) {\n                return false;\n            }\n\n            return hexNames[rgbToHex(this._r, this._g, this._b, true)] || false;\n        },\n        toFilter: function(secondColor) {\n            var hex8String = '#' + rgbaToHex(this._r, this._g, this._b, this._a);\n            var secondHex8String = hex8String;\n            var gradientType = this._gradientType ? \"GradientType = 1, \" : \"\";\n\n            if (secondColor) {\n                var s = tinycolor(secondColor);\n                secondHex8String = s.toHex8String();\n            }\n\n            return \"progid:DXImageTransform.Microsoft.gradient(\"+gradientType+\"startColorstr=\"+hex8String+\",endColorstr=\"+secondHex8String+\")\";\n        },\n        toString: function(format) {\n            var formatSet = !!format;\n            format = format || this._format;\n\n            var formattedString = false;\n            var hasAlpha = this._a < 1 && this._a >= 0;\n            var needsAlphaFormat = !formatSet && hasAlpha && (format === \"hex\" || format === \"hex6\" || format === \"hex3\" || format === \"name\");\n\n            if (needsAlphaFormat) {\n                // Special case for \"transparent\", all other non-alpha formats\n                // will return rgba when there is transparency.\n                if (format === \"name\" && this._a === 0) {\n                    return this.toName();\n                }\n                return this.toRgbString();\n            }\n            if (format === \"rgb\") {\n                formattedString = this.toRgbString();\n            }\n            if (format === \"prgb\") {\n                formattedString = this.toPercentageRgbString();\n            }\n            if (format === \"hex\" || format === \"hex6\") {\n                formattedString = this.toHexString();\n            }\n            if (format === \"hex3\") {\n                formattedString = this.toHexString(true);\n            }\n            if (format === \"hex8\") {\n                formattedString = this.toHex8String();\n            }\n            if (format === \"name\") {\n                formattedString = this.toName();\n            }\n            if (format === \"hsl\") {\n                formattedString = this.toHslString();\n            }\n            if (format === \"hsv\") {\n                formattedString = this.toHsvString();\n            }\n\n            return formattedString || this.toHexString();\n        },\n\n        _applyModification: function(fn, args) {\n            var color = fn.apply(null, [this].concat([].slice.call(args)));\n            this._r = color._r;\n            this._g = color._g;\n            this._b = color._b;\n            this.setAlpha(color._a);\n            return this;\n        },\n        lighten: function() {\n            return this._applyModification(lighten, arguments);\n        },\n        brighten: function() {\n            return this._applyModification(brighten, arguments);\n        },\n        darken: function() {\n            return this._applyModification(darken, arguments);\n        },\n        desaturate: function() {\n            return this._applyModification(desaturate, arguments);\n        },\n        saturate: function() {\n            return this._applyModification(saturate, arguments);\n        },\n        greyscale: function() {\n            return this._applyModification(greyscale, arguments);\n        },\n        spin: function() {\n            return this._applyModification(spin, arguments);\n        },\n\n        _applyCombination: function(fn, args) {\n            return fn.apply(null, [this].concat([].slice.call(args)));\n        },\n        analogous: function() {\n            return this._applyCombination(analogous, arguments);\n        },\n        complement: function() {\n            return this._applyCombination(complement, arguments);\n        },\n        monochromatic: function() {\n            return this._applyCombination(monochromatic, arguments);\n        },\n        splitcomplement: function() {\n            return this._applyCombination(splitcomplement, arguments);\n        },\n        triad: function() {\n            return this._applyCombination(triad, arguments);\n        },\n        tetrad: function() {\n            return this._applyCombination(tetrad, arguments);\n        }\n    };\n\n    // If input is an object, force 1 into \"1.0\" to handle ratios properly\n    // String input requires \"1.0\" as input, so 1 will be treated as 1\n    tinycolor.fromRatio = function(color, opts) {\n        if (typeof color == \"object\") {\n            var newColor = {};\n            for (var i in color) {\n                if (color.hasOwnProperty(i)) {\n                    if (i === \"a\") {\n                        newColor[i] = color[i];\n                    }\n                    else {\n                        newColor[i] = convertToPercentage(color[i]);\n                    }\n                }\n            }\n            color = newColor;\n        }\n\n        return tinycolor(color, opts);\n    };\n\n    // Given a string or object, convert that input to RGB\n    // Possible string inputs:\n    //\n    //     \"red\"\n    //     \"#f00\" or \"f00\"\n    //     \"#ff0000\" or \"ff0000\"\n    //     \"#ff000000\" or \"ff000000\"\n    //     \"rgb 255 0 0\" or \"rgb (255, 0, 0)\"\n    //     \"rgb 1.0 0 0\" or \"rgb (1, 0, 0)\"\n    //     \"rgba (255, 0, 0, 1)\" or \"rgba 255, 0, 0, 1\"\n    //     \"rgba (1.0, 0, 0, 1)\" or \"rgba 1.0, 0, 0, 1\"\n    //     \"hsl(0, 100%, 50%)\" or \"hsl 0 100% 50%\"\n    //     \"hsla(0, 100%, 50%, 1)\" or \"hsla 0 100% 50%, 1\"\n    //     \"hsv(0, 100%, 100%)\" or \"hsv 0 100% 100%\"\n    //\n    function inputToRGB(color) {\n\n        var rgb = { r: 0, g: 0, b: 0 };\n        var a = 1;\n        var ok = false;\n        var format = false;\n\n        if (typeof color == \"string\") {\n            color = stringInputToObject(color);\n        }\n\n        if (typeof color == \"object\") {\n            if (color.hasOwnProperty(\"r\") && color.hasOwnProperty(\"g\") && color.hasOwnProperty(\"b\")) {\n                rgb = rgbToRgb(color.r, color.g, color.b);\n                ok = true;\n                format = String(color.r).substr(-1) === \"%\" ? \"prgb\" : \"rgb\";\n            }\n            else if (color.hasOwnProperty(\"h\") && color.hasOwnProperty(\"s\") && color.hasOwnProperty(\"v\")) {\n                color.s = convertToPercentage(color.s);\n                color.v = convertToPercentage(color.v);\n                rgb = hsvToRgb(color.h, color.s, color.v);\n                ok = true;\n                format = \"hsv\";\n            }\n            else if (color.hasOwnProperty(\"h\") && color.hasOwnProperty(\"s\") && color.hasOwnProperty(\"l\")) {\n                color.s = convertToPercentage(color.s);\n                color.l = convertToPercentage(color.l);\n                rgb = hslToRgb(color.h, color.s, color.l);\n                ok = true;\n                format = \"hsl\";\n            }\n\n            if (color.hasOwnProperty(\"a\")) {\n                a = color.a;\n            }\n        }\n\n        a = boundAlpha(a);\n\n        return {\n            ok: ok,\n            format: color.format || format,\n            r: mathMin(255, mathMax(rgb.r, 0)),\n            g: mathMin(255, mathMax(rgb.g, 0)),\n            b: mathMin(255, mathMax(rgb.b, 0)),\n            a: a\n        };\n    }\n\n\n    // Conversion Functions\n    // --------------------\n\n    // `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:\n    // <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>\n\n    // `rgbToRgb`\n    // Handle bounds / percentage checking to conform to CSS color spec\n    // <http://www.w3.org/TR/css3-color/>\n    // *Assumes:* r, g, b in [0, 255] or [0, 1]\n    // *Returns:* { r, g, b } in [0, 255]\n    function rgbToRgb(r, g, b){\n        return {\n            r: bound01(r, 255) * 255,\n            g: bound01(g, 255) * 255,\n            b: bound01(b, 255) * 255\n        };\n    }\n\n    // `rgbToHsl`\n    // Converts an RGB color value to HSL.\n    // *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]\n    // *Returns:* { h, s, l } in [0,1]\n    function rgbToHsl(r, g, b) {\n\n        r = bound01(r, 255);\n        g = bound01(g, 255);\n        b = bound01(b, 255);\n\n        var max = mathMax(r, g, b), min = mathMin(r, g, b);\n        var h, s, l = (max + min) / 2;\n\n        if(max == min) {\n            h = s = 0; // achromatic\n        }\n        else {\n            var d = max - min;\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n            switch(max) {\n                case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n                case g: h = (b - r) / d + 2; break;\n                case b: h = (r - g) / d + 4; break;\n            }\n\n            h /= 6;\n        }\n\n        return { h: h, s: s, l: l };\n    }\n\n    // `hslToRgb`\n    // Converts an HSL color value to RGB.\n    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]\n    // *Returns:* { r, g, b } in the set [0, 255]\n    function hslToRgb(h, s, l) {\n        var r, g, b;\n\n        h = bound01(h, 360);\n        s = bound01(s, 100);\n        l = bound01(l, 100);\n\n        function hue2rgb(p, q, t) {\n            if(t < 0) t += 1;\n            if(t > 1) t -= 1;\n            if(t < 1/6) return p + (q - p) * 6 * t;\n            if(t < 1/2) return q;\n            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n            return p;\n        }\n\n        if(s === 0) {\n            r = g = b = l; // achromatic\n        }\n        else {\n            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n            var p = 2 * l - q;\n            r = hue2rgb(p, q, h + 1/3);\n            g = hue2rgb(p, q, h);\n            b = hue2rgb(p, q, h - 1/3);\n        }\n\n        return { r: r * 255, g: g * 255, b: b * 255 };\n    }\n\n    // `rgbToHsv`\n    // Converts an RGB color value to HSV\n    // *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]\n    // *Returns:* { h, s, v } in [0,1]\n    function rgbToHsv(r, g, b) {\n\n        r = bound01(r, 255);\n        g = bound01(g, 255);\n        b = bound01(b, 255);\n\n        var max = mathMax(r, g, b), min = mathMin(r, g, b);\n        var h, s, v = max;\n\n        var d = max - min;\n        s = max === 0 ? 0 : d / max;\n\n        if(max == min) {\n            h = 0; // achromatic\n        }\n        else {\n            switch(max) {\n                case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n                case g: h = (b - r) / d + 2; break;\n                case b: h = (r - g) / d + 4; break;\n            }\n            h /= 6;\n        }\n        return { h: h, s: s, v: v };\n    }\n\n    // `hsvToRgb`\n    // Converts an HSV color value to RGB.\n    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]\n    // *Returns:* { r, g, b } in the set [0, 255]\n     function hsvToRgb(h, s, v) {\n\n        h = bound01(h, 360) * 6;\n        s = bound01(s, 100);\n        v = bound01(v, 100);\n\n        var i = math.floor(h),\n            f = h - i,\n            p = v * (1 - s),\n            q = v * (1 - f * s),\n            t = v * (1 - (1 - f) * s),\n            mod = i % 6,\n            r = [v, q, p, p, t, v][mod],\n            g = [t, v, v, q, p, p][mod],\n            b = [p, p, t, v, v, q][mod];\n\n        return { r: r * 255, g: g * 255, b: b * 255 };\n    }\n\n    // `rgbToHex`\n    // Converts an RGB color to hex\n    // Assumes r, g, and b are contained in the set [0, 255]\n    // Returns a 3 or 6 character hex\n    function rgbToHex(r, g, b, allow3Char) {\n\n        var hex = [\n            pad2(mathRound(r).toString(16)),\n            pad2(mathRound(g).toString(16)),\n            pad2(mathRound(b).toString(16))\n        ];\n\n        // Return a 3 character hex if possible\n        if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {\n            return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);\n        }\n\n        return hex.join(\"\");\n    }\n        // `rgbaToHex`\n        // Converts an RGBA color plus alpha transparency to hex\n        // Assumes r, g, b and a are contained in the set [0, 255]\n        // Returns an 8 character hex\n        function rgbaToHex(r, g, b, a) {\n\n            var hex = [\n                pad2(convertDecimalToHex(a)),\n                pad2(mathRound(r).toString(16)),\n                pad2(mathRound(g).toString(16)),\n                pad2(mathRound(b).toString(16))\n            ];\n\n            return hex.join(\"\");\n        }\n\n    // `equals`\n    // Can be called with any tinycolor input\n    tinycolor.equals = function (color1, color2) {\n        if (!color1 || !color2) { return false; }\n        return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();\n    };\n    tinycolor.random = function() {\n        return tinycolor.fromRatio({\n            r: mathRandom(),\n            g: mathRandom(),\n            b: mathRandom()\n        });\n    };\n\n\n    // Modification Functions\n    // ----------------------\n    // Thanks to less.js for some of the basics here\n    // <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>\n\n    function desaturate(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.s -= amount / 100;\n        hsl.s = clamp01(hsl.s);\n        return tinycolor(hsl);\n    }\n\n    function saturate(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.s += amount / 100;\n        hsl.s = clamp01(hsl.s);\n        return tinycolor(hsl);\n    }\n\n    function greyscale(color) {\n        return tinycolor(color).desaturate(100);\n    }\n\n    function lighten (color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.l += amount / 100;\n        hsl.l = clamp01(hsl.l);\n        return tinycolor(hsl);\n    }\n\n    function brighten(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var rgb = tinycolor(color).toRgb();\n        rgb.r = mathMax(0, mathMin(255, rgb.r - mathRound(255 * - (amount / 100))));\n        rgb.g = mathMax(0, mathMin(255, rgb.g - mathRound(255 * - (amount / 100))));\n        rgb.b = mathMax(0, mathMin(255, rgb.b - mathRound(255 * - (amount / 100))));\n        return tinycolor(rgb);\n    }\n\n    function darken (color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.l -= amount / 100;\n        hsl.l = clamp01(hsl.l);\n        return tinycolor(hsl);\n    }\n\n    // Spin takes a positive or negative amount within [-360, 360] indicating the change of hue.\n    // Values outside of this range will be wrapped into this range.\n    function spin(color, amount) {\n        var hsl = tinycolor(color).toHsl();\n        var hue = (mathRound(hsl.h) + amount) % 360;\n        hsl.h = hue < 0 ? 360 + hue : hue;\n        return tinycolor(hsl);\n    }\n\n    // Combination Functions\n    // ---------------------\n    // Thanks to jQuery xColor for some of the ideas behind these\n    // <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>\n\n    function complement(color) {\n        var hsl = tinycolor(color).toHsl();\n        hsl.h = (hsl.h + 180) % 360;\n        return tinycolor(hsl);\n    }\n\n    function triad(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })\n        ];\n    }\n\n    function tetrad(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })\n        ];\n    }\n\n    function splitcomplement(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),\n            tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})\n        ];\n    }\n\n    function analogous(color, results, slices) {\n        results = results || 6;\n        slices = slices || 30;\n\n        var hsl = tinycolor(color).toHsl();\n        var part = 360 / slices;\n        var ret = [tinycolor(color)];\n\n        for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {\n            hsl.h = (hsl.h + part) % 360;\n            ret.push(tinycolor(hsl));\n        }\n        return ret;\n    }\n\n    function monochromatic(color, results) {\n        results = results || 6;\n        var hsv = tinycolor(color).toHsv();\n        var h = hsv.h, s = hsv.s, v = hsv.v;\n        var ret = [];\n        var modification = 1 / results;\n\n        while (results--) {\n            ret.push(tinycolor({ h: h, s: s, v: v}));\n            v = (v + modification) % 1;\n        }\n\n        return ret;\n    }\n\n    // Utility Functions\n    // ---------------------\n\n    tinycolor.mix = function(color1, color2, amount) {\n        amount = (amount === 0) ? 0 : (amount || 50);\n\n        var rgb1 = tinycolor(color1).toRgb();\n        var rgb2 = tinycolor(color2).toRgb();\n\n        var p = amount / 100;\n        var w = p * 2 - 1;\n        var a = rgb2.a - rgb1.a;\n\n        var w1;\n\n        if (w * a == -1) {\n            w1 = w;\n        } else {\n            w1 = (w + a) / (1 + w * a);\n        }\n\n        w1 = (w1 + 1) / 2;\n\n        var w2 = 1 - w1;\n\n        var rgba = {\n            r: rgb2.r * w1 + rgb1.r * w2,\n            g: rgb2.g * w1 + rgb1.g * w2,\n            b: rgb2.b * w1 + rgb1.b * w2,\n            a: rgb2.a * p  + rgb1.a * (1 - p)\n        };\n\n        return tinycolor(rgba);\n    };\n\n\n    // Readability Functions\n    // ---------------------\n    // <http://www.w3.org/TR/AERT#color-contrast>\n\n    // `readability`\n    // Analyze the 2 colors and returns an object with the following properties:\n    //    `brightness`: difference in brightness between the two colors\n    //    `color`: difference in color/hue between the two colors\n    tinycolor.readability = function(color1, color2) {\n        var c1 = tinycolor(color1);\n        var c2 = tinycolor(color2);\n        var rgb1 = c1.toRgb();\n        var rgb2 = c2.toRgb();\n        var brightnessA = c1.getBrightness();\n        var brightnessB = c2.getBrightness();\n        var colorDiff = (\n            Math.max(rgb1.r, rgb2.r) - Math.min(rgb1.r, rgb2.r) +\n            Math.max(rgb1.g, rgb2.g) - Math.min(rgb1.g, rgb2.g) +\n            Math.max(rgb1.b, rgb2.b) - Math.min(rgb1.b, rgb2.b)\n        );\n\n        return {\n            brightness: Math.abs(brightnessA - brightnessB),\n            color: colorDiff\n        };\n    };\n\n    // `readable`\n    // http://www.w3.org/TR/AERT#color-contrast\n    // Ensure that foreground and background color combinations provide sufficient contrast.\n    // *Example*\n    //    tinycolor.isReadable(\"#000\", \"#111\") => false\n    tinycolor.isReadable = function(color1, color2) {\n        var readability = tinycolor.readability(color1, color2);\n        return readability.brightness > 125 && readability.color > 500;\n    };\n\n    // `mostReadable`\n    // Given a base color and a list of possible foreground or background\n    // colors for that base, returns the most readable color.\n    // *Example*\n    //    tinycolor.mostReadable(\"#123\", [\"#fff\", \"#000\"]) => \"#000\"\n    tinycolor.mostReadable = function(baseColor, colorList) {\n        var bestColor = null;\n        var bestScore = 0;\n        var bestIsReadable = false;\n        for (var i=0; i < colorList.length; i++) {\n\n            // We normalize both around the \"acceptable\" breaking point,\n            // but rank brightness constrast higher than hue.\n\n            var readability = tinycolor.readability(baseColor, colorList[i]);\n            var readable = readability.brightness > 125 && readability.color > 500;\n            var score = 3 * (readability.brightness / 125) + (readability.color / 500);\n\n            if ((readable && ! bestIsReadable) ||\n                (readable && bestIsReadable && score > bestScore) ||\n                ((! readable) && (! bestIsReadable) && score > bestScore)) {\n                bestIsReadable = readable;\n                bestScore = score;\n                bestColor = tinycolor(colorList[i]);\n            }\n        }\n        return bestColor;\n    };\n\n\n    // Big List of Colors\n    // ------------------\n    // <http://www.w3.org/TR/css3-color/#svg-color>\n    var names = tinycolor.names = {\n        aliceblue: \"f0f8ff\",\n        antiquewhite: \"faebd7\",\n        aqua: \"0ff\",\n        aquamarine: \"7fffd4\",\n        azure: \"f0ffff\",\n        beige: \"f5f5dc\",\n        bisque: \"ffe4c4\",\n        black: \"000\",\n        blanchedalmond: \"ffebcd\",\n        blue: \"00f\",\n        blueviolet: \"8a2be2\",\n        brown: \"a52a2a\",\n        burlywood: \"deb887\",\n        burntsienna: \"ea7e5d\",\n        cadetblue: \"5f9ea0\",\n        chartreuse: \"7fff00\",\n        chocolate: \"d2691e\",\n        coral: \"ff7f50\",\n        cornflowerblue: \"6495ed\",\n        cornsilk: \"fff8dc\",\n        crimson: \"dc143c\",\n        cyan: \"0ff\",\n        darkblue: \"00008b\",\n        darkcyan: \"008b8b\",\n        darkgoldenrod: \"b8860b\",\n        darkgray: \"a9a9a9\",\n        darkgreen: \"006400\",\n        darkgrey: \"a9a9a9\",\n        darkkhaki: \"bdb76b\",\n        darkmagenta: \"8b008b\",\n        darkolivegreen: \"556b2f\",\n        darkorange: \"ff8c00\",\n        darkorchid: \"9932cc\",\n        darkred: \"8b0000\",\n        darksalmon: \"e9967a\",\n        darkseagreen: \"8fbc8f\",\n        darkslateblue: \"483d8b\",\n        darkslategray: \"2f4f4f\",\n        darkslategrey: \"2f4f4f\",\n        darkturquoise: \"00ced1\",\n        darkviolet: \"9400d3\",\n        deeppink: \"ff1493\",\n        deepskyblue: \"00bfff\",\n        dimgray: \"696969\",\n        dimgrey: \"696969\",\n        dodgerblue: \"1e90ff\",\n        firebrick: \"b22222\",\n        floralwhite: \"fffaf0\",\n        forestgreen: \"228b22\",\n        fuchsia: \"f0f\",\n        gainsboro: \"dcdcdc\",\n        ghostwhite: \"f8f8ff\",\n        gold: \"ffd700\",\n        goldenrod: \"daa520\",\n        gray: \"808080\",\n        green: \"008000\",\n        greenyellow: \"adff2f\",\n        grey: \"808080\",\n        honeydew: \"f0fff0\",\n        hotpink: \"ff69b4\",\n        indianred: \"cd5c5c\",\n        indigo: \"4b0082\",\n        ivory: \"fffff0\",\n        khaki: \"f0e68c\",\n        lavender: \"e6e6fa\",\n        lavenderblush: \"fff0f5\",\n        lawngreen: \"7cfc00\",\n        lemonchiffon: \"fffacd\",\n        lightblue: \"add8e6\",\n        lightcoral: \"f08080\",\n        lightcyan: \"e0ffff\",\n        lightgoldenrodyellow: \"fafad2\",\n        lightgray: \"d3d3d3\",\n        lightgreen: \"90ee90\",\n        lightgrey: \"d3d3d3\",\n        lightpink: \"ffb6c1\",\n        lightsalmon: \"ffa07a\",\n        lightseagreen: \"20b2aa\",\n        lightskyblue: \"87cefa\",\n        lightslategray: \"789\",\n        lightslategrey: \"789\",\n        lightsteelblue: \"b0c4de\",\n        lightyellow: \"ffffe0\",\n        lime: \"0f0\",\n        limegreen: \"32cd32\",\n        linen: \"faf0e6\",\n        magenta: \"f0f\",\n        maroon: \"800000\",\n        mediumaquamarine: \"66cdaa\",\n        mediumblue: \"0000cd\",\n        mediumorchid: \"ba55d3\",\n        mediumpurple: \"9370db\",\n        mediumseagreen: \"3cb371\",\n        mediumslateblue: \"7b68ee\",\n        mediumspringgreen: \"00fa9a\",\n        mediumturquoise: \"48d1cc\",\n        mediumvioletred: \"c71585\",\n        midnightblue: \"191970\",\n        mintcream: \"f5fffa\",\n        mistyrose: \"ffe4e1\",\n        moccasin: \"ffe4b5\",\n        navajowhite: \"ffdead\",\n        navy: \"000080\",\n        oldlace: \"fdf5e6\",\n        olive: \"808000\",\n        olivedrab: \"6b8e23\",\n        orange: \"ffa500\",\n        orangered: \"ff4500\",\n        orchid: \"da70d6\",\n        palegoldenrod: \"eee8aa\",\n        palegreen: \"98fb98\",\n        paleturquoise: \"afeeee\",\n        palevioletred: \"db7093\",\n        papayawhip: \"ffefd5\",\n        peachpuff: \"ffdab9\",\n        peru: \"cd853f\",\n        pink: \"ffc0cb\",\n        plum: \"dda0dd\",\n        powderblue: \"b0e0e6\",\n        purple: \"800080\",\n        rebeccapurple: \"663399\",\n        red: \"f00\",\n        rosybrown: \"bc8f8f\",\n        royalblue: \"4169e1\",\n        saddlebrown: \"8b4513\",\n        salmon: \"fa8072\",\n        sandybrown: \"f4a460\",\n        seagreen: \"2e8b57\",\n        seashell: \"fff5ee\",\n        sienna: \"a0522d\",\n        silver: \"c0c0c0\",\n        skyblue: \"87ceeb\",\n        slateblue: \"6a5acd\",\n        slategray: \"708090\",\n        slategrey: \"708090\",\n        snow: \"fffafa\",\n        springgreen: \"00ff7f\",\n        steelblue: \"4682b4\",\n        tan: \"d2b48c\",\n        teal: \"008080\",\n        thistle: \"d8bfd8\",\n        tomato: \"ff6347\",\n        turquoise: \"40e0d0\",\n        violet: \"ee82ee\",\n        wheat: \"f5deb3\",\n        white: \"fff\",\n        whitesmoke: \"f5f5f5\",\n        yellow: \"ff0\",\n        yellowgreen: \"9acd32\"\n    };\n\n    // Make it easy to access colors via `hexNames[hex]`\n    var hexNames = tinycolor.hexNames = flip(names);\n\n\n    // Utilities\n    // ---------\n\n    // `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`\n    function flip(o) {\n        var flipped = { };\n        for (var i in o) {\n            if (o.hasOwnProperty(i)) {\n                flipped[o[i]] = i;\n            }\n        }\n        return flipped;\n    }\n\n    // Return a valid alpha value [0,1] with all invalid values being set to 1\n    function boundAlpha(a) {\n        a = parseFloat(a);\n\n        if (isNaN(a) || a < 0 || a > 1) {\n            a = 1;\n        }\n\n        return a;\n    }\n\n    // Take input from [0, n] and return it as [0, 1]\n    function bound01(n, max) {\n        if (isOnePointZero(n)) { n = \"100%\"; }\n\n        var processPercent = isPercentage(n);\n        n = mathMin(max, mathMax(0, parseFloat(n)));\n\n        // Automatically convert percentage into number\n        if (processPercent) {\n            n = parseInt(n * max, 10) / 100;\n        }\n\n        // Handle floating point rounding errors\n        if ((math.abs(n - max) < 0.000001)) {\n            return 1;\n        }\n\n        // Convert into [0, 1] range if it isn't already\n        return (n % max) / parseFloat(max);\n    }\n\n    // Force a number between 0 and 1\n    function clamp01(val) {\n        return mathMin(1, mathMax(0, val));\n    }\n\n    // Parse a base-16 hex value into a base-10 integer\n    function parseIntFromHex(val) {\n        return parseInt(val, 16);\n    }\n\n    // Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1\n    // <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>\n    function isOnePointZero(n) {\n        return typeof n == \"string\" && n.indexOf('.') != -1 && parseFloat(n) === 1;\n    }\n\n    // Check to see if string passed in is a percentage\n    function isPercentage(n) {\n        return typeof n === \"string\" && n.indexOf('%') != -1;\n    }\n\n    // Force a hex value to have 2 characters\n    function pad2(c) {\n        return c.length == 1 ? '0' + c : '' + c;\n    }\n\n    // Replace a decimal with it's percentage value\n    function convertToPercentage(n) {\n        if (n <= 1) {\n            n = (n * 100) + \"%\";\n        }\n\n        return n;\n    }\n\n    // Converts a decimal to a hex value\n    function convertDecimalToHex(d) {\n        return Math.round(parseFloat(d) * 255).toString(16);\n    }\n    // Converts a hex value to a decimal\n    function convertHexToDecimal(h) {\n        return (parseIntFromHex(h) / 255);\n    }\n\n    var matchers = (function() {\n\n        // <http://www.w3.org/TR/css3-values/#integers>\n        var CSS_INTEGER = \"[-\\\\+]?\\\\d+%?\";\n\n        // <http://www.w3.org/TR/css3-values/#number-value>\n        var CSS_NUMBER = \"[-\\\\+]?\\\\d*\\\\.\\\\d+%?\";\n\n        // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.\n        var CSS_UNIT = \"(?:\" + CSS_NUMBER + \")|(?:\" + CSS_INTEGER + \")\";\n\n        // Actual matching.\n        // Parentheses and commas are optional, but not required.\n        // Whitespace can take the place of commas or opening paren\n        var PERMISSIVE_MATCH3 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\n        var PERMISSIVE_MATCH4 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\n\n        return {\n            rgb: new RegExp(\"rgb\" + PERMISSIVE_MATCH3),\n            rgba: new RegExp(\"rgba\" + PERMISSIVE_MATCH4),\n            hsl: new RegExp(\"hsl\" + PERMISSIVE_MATCH3),\n            hsla: new RegExp(\"hsla\" + PERMISSIVE_MATCH4),\n            hsv: new RegExp(\"hsv\" + PERMISSIVE_MATCH3),\n            hsva: new RegExp(\"hsva\" + PERMISSIVE_MATCH4),\n            hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,\n            hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,\n            hex8: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/\n        };\n    })();\n\n    // `stringInputToObject`\n    // Permissive string parsing.  Take in a number of formats, and output an object\n    // based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`\n    function stringInputToObject(color) {\n\n        color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();\n        var named = false;\n        if (names[color]) {\n            color = names[color];\n            named = true;\n        }\n        else if (color == 'transparent') {\n            return { r: 0, g: 0, b: 0, a: 0, format: \"name\" };\n        }\n\n        // Try to match string input using regular expressions.\n        // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]\n        // Just return an object and let the conversion functions handle that.\n        // This way the result will be the same whether the tinycolor is initialized with string or object.\n        var match;\n        if ((match = matchers.rgb.exec(color))) {\n            return { r: match[1], g: match[2], b: match[3] };\n        }\n        if ((match = matchers.rgba.exec(color))) {\n            return { r: match[1], g: match[2], b: match[3], a: match[4] };\n        }\n        if ((match = matchers.hsl.exec(color))) {\n            return { h: match[1], s: match[2], l: match[3] };\n        }\n        if ((match = matchers.hsla.exec(color))) {\n            return { h: match[1], s: match[2], l: match[3], a: match[4] };\n        }\n        if ((match = matchers.hsv.exec(color))) {\n            return { h: match[1], s: match[2], v: match[3] };\n        }\n        if ((match = matchers.hsva.exec(color))) {\n            return { h: match[1], s: match[2], v: match[3], a: match[4] };\n        }\n        if ((match = matchers.hex8.exec(color))) {\n            return {\n                a: convertHexToDecimal(match[1]),\n                r: parseIntFromHex(match[2]),\n                g: parseIntFromHex(match[3]),\n                b: parseIntFromHex(match[4]),\n                format: named ? \"name\" : \"hex8\"\n            };\n        }\n        if ((match = matchers.hex6.exec(color))) {\n            return {\n                r: parseIntFromHex(match[1]),\n                g: parseIntFromHex(match[2]),\n                b: parseIntFromHex(match[3]),\n                format: named ? \"name\" : \"hex\"\n            };\n        }\n        if ((match = matchers.hex3.exec(color))) {\n            return {\n                r: parseIntFromHex(match[1] + '' + match[1]),\n                g: parseIntFromHex(match[2] + '' + match[2]),\n                b: parseIntFromHex(match[3] + '' + match[3]),\n                format: named ? \"name\" : \"hex\"\n            };\n        }\n\n        return false;\n    }\n\n    window.tinycolor = tinycolor;\n    })();\n\n    $(function () {\n        if ($.fn.spectrum.load) {\n            $.fn.spectrum.processNativeColorInputs();\n        }\n    });\n\n});\n\n// Spectrum Colorpicker\n// Swedish (sv) localization\n// https://github.com/bgrins/spectrum\n\n(function ( $ ) {\n\n    var localization = $.spectrum.localization[\"sv\"] = {\n        cancelText: \"Avbryt\",\n        chooseText: \"Vlj\"\n    };\n\n    $.extend($.fn.spectrum.defaults, localization);\n\n})( jQuery );\n\nangular.module('angular-toArrayFilter', [])\n\n.filter('toArray', function () {\n  return function (obj, addKey) {\n    if (!angular.isObject(obj)) return obj;\n    if ( addKey === false ) {\n      return Object.keys(obj).map(function(key) {\n        return obj[key];\n      });\n    } else {\n      return Object.keys(obj).map(function (key) {\n        var value = obj[key];\n        return angular.isObject(value) ?\n          Object.defineProperty(value, '$key', { enumerable: false, value: key}) :\n          { $key: key, $value: value };\n      });\n    }\n  };\n});\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/select2/select2.html\",\"<style>\\r\\n    .select2 > .select2-choice.ui-select-match {\\r\\n        /* Because of the inclusion of Bootstrap */\\r\\n        height: 29px;\\r\\n    }\\r\\n\\r\\n    .selectize-control > .selectize-dropdown {\\r\\n        top: 36px;\\r\\n    }\\r\\n</style>\\r\\n\\r\\n<div class=\\\"form-group {{form.htmlClass}}\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <ui-select select2-search\\r\\n                   ng-show=\\\"form.key\\\"\\r\\n                   ng-model=\\\"$$value$$\\\"\\r\\n                   ng-model-options=\\\"form.ngModelOptions\\\"\\r\\n                   ng-disabled=\\\"form.readonly\\\"\\r\\n                   sf-changed=\\\"form\\\"\\r\\n                   ref=\\\"form.ref\\\"\\r\\n                   query=\\\"form.query\\\"\\r\\n                   shard=\\\"form.shard\\\"\\r\\n                   depends-on=\\\"form.dependsOn\\\">\\r\\n            <ui-select-match allow-clear=\\\"true\\\"\\r\\n                    ng-model=\\\"$$value$$\\\" placeholder=\\\"Search for {{form.title}}\\\">\\r\\n                {{printSelectedElement($select.selected)}}\\r\\n            </ui-select-match>\\r\\n            <ui-select-choices\\r\\n                    sf-changed=\\\"form\\\"\\r\\n                    ng-model=\\\"$$value$$\\\" refresh=\\\"search($select)\\\" refresh-delay=\\\"0\\\"\\r\\n                    repeat=\\\"selectIdField(item) as item in searchRes\\\">\\r\\n                <div ng-bind-html=\\\"selectDisplayField(item) | highlight: $select.search\\\"></div>\\r\\n                <small>\\r\\n                    <i>&lt;<span ng-bind-html=\\\"selectIdField(item)\\\"></span>&gt;</i>\\r\\n                </small>\\r\\n            </ui-select-choices>\\r\\n        </ui-select>\\r\\n        <span class=\\\"input-group-btn\\\">\\r\\n            <create-update-modal class=\\\"btn btn-primary\\\"\\r\\n                                 ng-model=\\\"$$value$$\\\"\\r\\n                                 sf-changed=\\\"form\\\"\\r\\n                                 ref=\\\"form.ref\\\" ng-click=\\\"open()\\\">New {{form.ref}}\\r\\n            </create-update-modal>\\r\\n            <create-update-modal class=\\\"btn btn-warning\\\"\\r\\n                                 ng-model=\\\"$$value$$\\\"\\r\\n                                 sf-changed=\\\"form\\\"\\r\\n                                 ref=\\\"form.ref\\\" type=\\\"edit\\\" ng-show=\\\"$$value$$\\\" ng-click=\\\"open()\\\">Edit\\r\\n            </create-update-modal>\\r\\n            <!--<button class=\\\"btn btn-primary\\\" ng-click=\\\"open()\\\">Create {{form.title}}</button>-->\\r\\n        </span>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n\\r\\n<script type=\\\"text/ng-template\\\" id=\\\"createUpdateModal.html\\\">\\r\\n    <div class=\\\"modal-header\\\">\\r\\n        <h3 class=\\\"modal-title\\\">Create a new {{schema.title}}</h3>\\r\\n    </div>\\r\\n    <div class=\\\"modal-body\\\">\\r\\n        <form name=\\\"ngForm\\\" sf-schema=\\\"schema\\\" sf-form=\\\"form\\\" sf-model=\\\"model\\\" ng-submit=\\\"submitForm(ngForm,model)\\\">\\r\\n            <input type=\\\"submit\\\" id=\\\"submit-form-{{schema.title}}\\\" class=\\\"hidden\\\"/></form>\\r\\n    </div>\\r\\n    <div class=\\\"modal-footer\\\">\\r\\n        <button class=\\\"btn btn-warning\\\" ng-click=\\\"cancel()\\\">Cancel</button>\\r\\n        <label class=\\\"btn btn-primary\\\" for=\\\"submit-form-{{schema.title}}\\\">Save</label><!--apon del 15, pero fa el submit sense haver de fer coses rares :)-->\\r\\n    </div>\\r\\n</script>\");}]);\nangular.module('schemaForm').directive('select2Search', ['$http', '$routeParams', 'models', 'common', 'selectCache', function ($http, $routeParams, models, common, selectCache) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        scope: true,\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var modelName = $routeParams.schema;\r\n            var shard = $routeParams.shard;\r\n\r\n            if (!element.select)\r\n                return;\r\n\r\n            var displayField = \"\";\r\n            var idSelect = \"\";\r\n            var userq = scope.$eval(attrs.query);\r\n\r\n            var userShard = scope.$eval(attrs.shard);\r\n            if(userShard) {\r\n                userShard.replace('/this\\./', scope.$eval(attrs.key));\r\n                var actualShard = common.getField(userShard, scope.model);\r\n                if(actualShard){\r\n                    shard = actualShard;\r\n                }\r\n            }\r\n\r\n            var dependsOn = scope.$eval(attrs.dependsOn);\r\n            if (dependsOn) {\r\n                dependsOn = dependsOn.split(\"=\");\r\n            }\r\n\r\n            function getDocumentById(modelId) {\r\n                return function (query, skip) {\r\n                    return models.getModel(scope.$eval(attrs.ref), function (m) {\r\n                        var config = m.config;\r\n                        var elem = \"\";\r\n\r\n                        if (modelId instanceof Object) {\r\n                            elem = modelId[config.id];\r\n                        } else {\r\n                            elem = modelId;\r\n                        }\r\n\r\n                        selectCache.getDocument(scope.$eval(attrs.ref), elem, shard, function (doc) {\r\n                            displayField = config.displayField;\r\n                            idSelect = config.id;\r\n\r\n                            var q = {};\r\n                            q.query = {};\r\n                            var regex = query.search;\r\n                            q.query.$or = [];\r\n\r\n                            var forDisplay = {};\r\n                            forDisplay[displayField] = {$regex: regex, $options: 'i'};\r\n                            q.query.$or.push(forDisplay);\r\n\r\n\r\n                            if (config.id != \"_id\" && m.schema[config.id] && m.schema[config.id].type == \"string\") {\r\n                                var forID = {};\r\n                                forID[idSelect] = {$regex: regex, $options: 'i'};\r\n                                q.query.$or.push(forID);\r\n                            }\r\n\r\n                            if (dependsOn) {\r\n                                if (dependsOn[0] && scope.model[dependsOn[1]]) {\r\n                                    if (!isValidObjectID(scope.model[dependsOn[1]])) {\r\n                                        q.query[dependsOn[0]] = {\r\n                                            $regex: scope.model[dependsOn[1]],\r\n                                            $options: 'i'\r\n                                        };\r\n                                    } else {\r\n                                        q.query[dependsOn[0]] = scope.model[dependsOn[1]];\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            function isValidObjectID(str) {\r\n                                // A valid Object Id must be 24 hex characters\r\n                                return (/^[0-9a-fA-F]{24}$/).test(str);\r\n                            }\r\n\r\n                            q.limit = 20;\r\n                            q.skip = skip;\r\n\r\n                            angular.extend(q, userq || {});\r\n                            selectCache.search(scope.$eval(attrs.ref), q, shard, function (response, count) {\r\n                                if (skip)\r\n                                    scope.searchRes = scope.searchRes.concat(response);\r\n                                else\r\n                                    scope.searchRes = response;\r\n\r\n                                if (doc) {\r\n                                    var present = scope.searchRes.some(function (element) {\r\n                                        return element[config.id] == doc[config.id];\r\n                                    });\r\n\r\n                                    if (!present) {\r\n                                        scope.searchRes.splice(0, 0, doc);\r\n                                    }\r\n                                }\r\n                            });\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n\r\n            var elements = getDocumentById(scope.$eval(attrs.ngModel));\r\n\r\n            scope.$watch(function () {\r\n                if (dependsOn) {\r\n                    if (scope.model[dependsOn[1]])\r\n                        return scope.model[dependsOn[1]];\r\n                }\r\n            }, function (newValue) {\r\n                getDocumentById(scope.$eval(attrs.ngModel))({search: ''});\r\n            });\r\n\r\n            scope.disabled = false;\r\n            scope.searchEnabled = true;\r\n            scope.searchRes = [];\r\n            scope.search = elements;\r\n\r\n            scope.printSelectedElement = function (document) {\r\n                if (document) {\r\n                    var f = common.getField(displayField, document);\r\n                    if (f && f != \"\" && f.length > 0)\r\n                        return f + \" <\" + document[idSelect] + \">\";\r\n                    else {\r\n                        return \"No display field. ID: <\" + document[idSelect] + \">\";\r\n                    }\r\n                }\r\n            };\r\n\r\n            scope.selectDisplayField = function (document) {\r\n                if (document) {\r\n                    var f = common.getField(displayField, document);\r\n                    if (f && f != \"\" && f.length > 0)\r\n                        return f;\r\n                    else {\r\n                        return \"<empty>\";\r\n                    }\r\n                }\r\n            };\r\n\r\n            scope.selectIdField = function (document) {\r\n                if (document != undefined) {\r\n                    return document[idSelect] || \"No ID\";\r\n                }\r\n            };\r\n\r\n            scope.$on('refreshSelect2' + scope.$eval(attrs.ref), function () {\r\n                console.log(\"REFRESH SELECT2\");\r\n                elements();\r\n            });\r\n\r\n            element.find('ul').bind('scroll', function () {\r\n                var raw = arguments[0].target;\r\n                if (raw.scrollTop + raw.offsetHeight > raw.scrollHeight) {\r\n                    elements(scope.$select, (raw.children[0].children.length - 2));\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n])\r\n;\r\n\r\nvar modalController = function ($scope, $http, $modalInstance, $routeParams, models, configs, modelName, id, dependsOn, common) {\r\n    //Override the functinos for every opened modal (fixes problem with residual variables)\r\n    var fromSchema = $routeParams.schema;\r\n    $routeParams.schema = modelName;\r\n    $routeParams.id = id;\r\n\r\n    //TODO: Maybe we should avoid duplicate code with formController !\r\n    models.getModel(modelName, function (m) {\r\n        var s = m.schema;\r\n        var base = function (doc) {\r\n            $scope.schema = {\r\n                \"type\": \"object\",\r\n                \"title\": modelName,\r\n                \"action\": (doc) ? \"Edit\" : \"New\",\r\n                \"properties\": s\r\n            };\r\n\r\n            var innerForm = common.processForm(m.config.form, false);\r\n\r\n            $scope.form = innerForm;\r\n\r\n            $scope.model = doc || {};\r\n\r\n            if (!doc && models.getShard(fromSchema) && models.getShard(fromSchema).value) {\r\n                $scope.model[models.getShard(fromSchema).key] = models.getShard(fromSchema).value;\r\n            }\r\n\r\n            dependsOn.apply($scope, modelName, $scope.model);\r\n\r\n            $scope.submitForm = function (form, model) {\r\n                // First we broadcast an event so all fields validate themselves\r\n                $scope.$broadcast('schemaFormValidate');\r\n                // Then we check if the form is valid\r\n                if (form.$valid) {\r\n                    if ($scope.schema.action === \"New\") {\r\n                        models.postDocument(modelName, model, function (response) {\r\n                            if (response.status == '201') {\r\n                                $scope.$broadcast('postedDocument', response.data);\r\n                                $modalInstance.close('saved');\r\n                            }\r\n                        });\r\n                    } else {\r\n                        models.putDocument(modelName, id, model, function (response) {\r\n                            if (response.status == '200') {\r\n                                $scope.$broadcast('postedDocument', response.data);\r\n                                $scope.$broadcast('puttedDocument', response.data);\r\n                                $modalInstance.close('saved');\r\n                            }\r\n                        });\r\n                    }\r\n                } else {\r\n                    alert('invalid form');\r\n                }\r\n            }\r\n        };\r\n\r\n        if (id) {\r\n            models.getDocument(modelName, id, function (document) {\r\n                base(document);\r\n            });\r\n        } else {\r\n            base();\r\n        }\r\n    });\r\n\r\n    $scope.cancel = function () {\r\n        $modalInstance.dismiss('cancel');\r\n    };\r\n};\nmodalController.$inject = ['$scope', '$http', '$modalInstance', '$routeParams', 'models', 'configs', 'modelName', 'id', 'dependsOn', 'common'];\r\n\r\nangular.module('schemaForm').directive('createUpdateModal', ['$http', '$routeParams', '$rootScope', '$modal', 'models', function ($http, $routeParams, $rootScope, $modal, models) {\r\n    return {\r\n        restrict: 'E',\r\n        scope: true,\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.open = function () {\r\n                var modalInstance = $modal.open({\r\n                    templateUrl: 'createUpdateModal.html',\r\n                    controller: modalController,\r\n                    size: 'lg',\r\n                    resolve: {\r\n                        modelName: function () {\r\n                            return scope.$eval(attrs.ref);\r\n                        },\r\n                        id: function () {\r\n                            if (attrs.type == \"edit\")\r\n                                return scope.$eval(attrs.ngModel);\r\n                            else\r\n                                return \"\";\r\n                        }\r\n                    }\r\n                });\r\n\r\n                modalInstance.result.then(function () {\r\n                    $rootScope.$broadcast('refreshSelect2' + scope.$eval(attrs.ref));\r\n                }, function () {\r\n                    console.info('Modal dismissed at: ' + new Date());\r\n                });\r\n            };\r\n        }\r\n    }\r\n}]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n            var select2 = function (name, schema, options) {\r\n                if (schema.ref) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'select2';\r\n                    f.query = schema.query;\r\n                    f.ref = schema.ref;\r\n                    f.shard = schema.shard;\r\n                    f.dependsOn = schema.dependsOn;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(select2);\r\n            schemaFormProvider.defaults.object.unshift(select2);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'select2',\r\n                'directives/decorators/bootstrap/select2/select2.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'select2',\r\n                'directives/decorators/bootstrap/select2/select2.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/simpleselect2/simple-select2.html\",\"<div class=\\\"form-group {{form.htmlClass}} schema-form-select\\\"\\n     ng-class=\\\"{\\'has-error\\': form.disableErrorState !== true && hasError(), \\'has-success\\': form.disableSuccessState !== true && hasSuccess(), \\'has-feedback\\': form.feedback !== false}\\\">\\n  <label class=\\\"control-label {{form.labelHtmlClass}}\\\" ng-show=\\\"showTitle()\\\">\\n    {{form.title}}\\n  </label>\\n  <select simple-select\\n\t      ng-model=\\\"$$value$$\\\"\\n          ng-model-options=\\\"form.ngModelOptions\\\"\\n          ng-disabled=\\\"form.readonly\\\"\\n          sf-changed=\\\"form\\\"\\n          class=\\\"form-control {{form.fieldHtmlClass}}\\\"\\n          schema-validate=\\\"form\\\"\\n          map=\\\"form.map\\\"\\n          dynmap=\\\"form.dynMap\\\"\\n          dynenum=\\\"form.dynEnum\\\"\\n          ng-options=\\\"item.value as item.name group by item.group for item in titleMap\\\"\\n          name=\\\"{{form.key.slice(-1)[0]}}\\\">\\n  </select>\\n  <div class=\\\"help-block\\\" sf-message=\\\"form.description\\\"></div>\\n</div>\\n\");}]);\r\nangular.module('schemaForm').directive('simpleSelect', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n\r\n    return {\r\n        restrict: 'AE',\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.titleMap = [];\r\n\r\n            var map = scope.$eval(attrs.map);\r\n            var dynMap = scope.$eval(attrs.dynmap);\r\n            var dynEnum = scope.$eval(attrs.dynenum);\r\n\r\n            if(dynEnum){\r\n                $http.get(dynEnum).then(function(res){\r\n                    var resultMap = {};\r\n                    angular.forEach(res.data, function(elem){\r\n                        resultMap[elem] = elem;\r\n                    });\r\n                    setMap(resultMap);\r\n                });\r\n            } else if(dynMap){\r\n                $http.get(dynMap).then(function(res){\r\n                   setMap(res.data);\r\n                });\r\n            } else if(map){\r\n                setMap(map);\r\n            }\r\n\r\n            function setMap(map){\r\n                angular.forEach(Object.keys(map), function(key) {\r\n                    var value = map[key];\r\n                    var o = {};\r\n                    o.value = key;\r\n                    if(typeof(value)==\"string\") {\r\n                        o.name = value;\r\n                    } else {\r\n                        o.name = value.name;\r\n                        o.group = value.group;\r\n                    }\r\n                    scope.titleMap.push(o);\r\n                });\r\n            }\r\n        }\r\n    }\r\n}]);\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var select2 = function (name, schema, options) {\r\n                if (schema.map || schema.dynEnum || schema.dynMap) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'simpleselect2';\r\n                    f.map = schema.map;\r\n                    f.dynMap = schema.dynMap;\r\n                    f.dynEnum = schema.dynEnum;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(select2);\r\n            schemaFormProvider.defaults.number.unshift(select2);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'simpleselect2',\r\n                'directives/decorators/bootstrap/simpleselect2/simple-select2.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'simpleselect2',\r\n                'directives/decorators/bootstrap/simpleselect2/simple-select2.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/datetimepicker/datetimepicker.html\",\"<div class=\\\"form-group schema-form-{{form.type}} {{form.htmlClass}}\\\">\\r\\n    <!--<div ri-date date-picker=\\\"date\\\" view=\\\"minutes\\\" ng-model=\\\"$$value$$\\\"></div>-->\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div ri-date ng-model=\\\"$$value$$\\\">\\r\\n        <!--<div class=\\\"col-md-6\\\">-->\\r\\n            <!--<div date-picker=\\\"modelDate\\\" view=\\\"date\\\" max-view=\\\"month\\\" min-view=\\\"date\\\"></div>-->\\r\\n        <!--</div>-->\\r\\n        <!--<div class=\\\"col-md-6\\\">-->\\r\\n            <!--<div date-picker=\\\"modelHours\\\" view=\\\"hours\\\" max-view=\\\"hours\\\"></div>-->\\r\\n        <!--</div>-->\\r\\n        <input date-time ng-disabled=\\\"form.readonly\\\" type=\\\"datetime\\\" ng-model=\\\"modelDate\\\" ng-change=\\\"{{updateDate(modelDate)}}\\\" view=\\\"date\\\" max-view=\\\"date\\\" class=\\\"form-control\\\" format=\\\"medium\\\">\\r\\n    </div>\\r\\n</div>\\r\\n\");}]);\nangular.module('schemaForm').directive('riDate', ['$http', 'models', function ($http, models) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        require: 'ngModel',\r\n        scope:false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.modelDate = null;\r\n            ngModel.$render = function(){\r\n                if(ngModel.$viewValue){\r\n                    if(!scope.modelDate || (scope.modelDate && scope.modelDate.toString() != ngModel.$viewValue)) {\r\n                        scope.modelDate = new Date(ngModel.$viewValue);\r\n                    }\r\n                    //scope.modelHours = new Date(ngModel.$viewValue);\r\n                }\r\n            };\r\n\r\n            scope.updateDate = function(m){\r\n                ngModel.$setViewValue(m);\r\n\r\n                if(m == \"\" || !m){\r\n                    ngModel.$setViewValue(null);\r\n                }\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'datetimepicker' || schema.format === \"date\")) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'datetimepicker';\r\n                    f.format = schema.dateFormat;\r\n\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'datetimepicker',\r\n                'directives/decorators/bootstrap/datetimepicker/datetimepicker.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'datetimepicker',\r\n                'directives/decorators/bootstrap/datetimepicker/datetimepicker.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-new-image-view ng-model=\\\"$$value$$\\\" ng-src=\\\"{{image}}\\\" filename=\\\"$$value$$.image\\\">\\r\\n            </div>\\r\\n            <p>{{$$value$$.originalName}}</p>\\r\\n\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload image -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change image -->\\r\\n                    <input bk-new-image-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"image\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"imageExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span\\r\\n                        class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"imageExists\\\" download=\\\"{{$$value$$.image}}\\\" ng-href=\\\"{{image}}\\\" target=\\\"_self\\\"\\r\\n                   class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a>\\r\\n                <!-- download -->\\r\\n                <a ng-if=\\\"imageExists\\\" ng-click=\\\"deleteImage(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span\\r\\n                        class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkNewImageUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if ($files && $files.length > 0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                            if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                var file = scope.myFiles[0];\r\n                                models.getModelConfig(modelName, function (config) {\r\n                                    var fieldName = scope.$eval(attrs.path);\r\n                                    //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                    models.uploadImage(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                        //console.log(data);\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkNewImageView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImage = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+Image';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getImageUrl(modelName, id, value, function (url) {\r\n                            scope.image = url;\r\n                            scope.imageExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.image = defaultImage;\r\n                        scope.imageExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download image from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteImage = function (index, model) {\r\n                    models.deleteImage(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"Image deleted\");\r\n                        ngModel.$setViewValue(null);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var newImageInjector = function (name, schema, options) {\r\n                if (schema.type === 'image') {\r\n                    var pathArray = options.path.filter(function(e){return e});\r\n                    //pathArray = pathArray.map(function (e) {\r\n                    //    if (e != \"\") {\r\n                    //        return e;\r\n                    //    }\r\n                    //});\r\n                    var path = pathArray.join('.');\r\n\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'image';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            if (!schemaFormProvider.defaults.image)\r\n                schemaFormProvider.defaults.image = [];\r\n            schemaFormProvider.defaults.image.unshift(newImageInjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'image',\r\n                'directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'image',\r\n                'directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/imageinjector/imageinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-image-view ng-src=\\\"{{image}}\\\" filename=\\\"$$value$$\\\">\\r\\n            </div>\\r\\n            {{$$value$$}}\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload image -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change image -->\\r\\n                    <input bk-image-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"image\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"imageExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"imageExists\\\" download=\\\"{{$$value$$}}\\\" ng-href=\\\"{{image}}\\\" target=\\\"_self\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a> <!-- download -->\\r\\n                <a ng-if=\\\"imageExists\\\" ng-click=\\\"deleteFile(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkImageUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if($files && $files.length>0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                                if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                    var file = scope.myFiles[0];\r\n                                    models.getModelConfig(modelName, function (config) {\r\n                                        var fieldName = scope.$eval(attrs.path);\r\n                                        //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                        models.uploadImage(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                            //console.log(data);\r\n                                        });\r\n                                    });\r\n                                }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkImageView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImage = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+Image';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getImageUrl(modelName, id, value, function (url) {\r\n                            scope.image = url;\r\n                            scope.imageExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.image = defaultImage;\r\n                        scope.imageExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download image from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteImage = function (index) {\r\n                    models.deleteImage(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"Image deleted\");\r\n                        scope.image = defaultImage;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var imageinjector = function (name, schema, options) {\r\n                if (schema.type === 'string' && schema.format === 'image') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'imageinjector';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = schema.path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(imageinjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'imageinjector',\r\n                'directives/decorators/bootstrap/imageinjector/imageinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'imageinjector',\r\n                'directives/decorators/bootstrap/imageinjector/imageinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/galleryimage/galleryimage.html\",\"<!--<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">-->\\r\\n<div class=\\\"form-group {{form.htmlClass}}\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <a ri-single-gallery-view ng-click=\\\"openGallery()\\\" ng-model=\\\"$$value$$\\\" alt=\\\"Click to open Gallery\\\">\\r\\n            <img ng-src=\\\"{{image}}\\\" error=\\\"{{defaultErrorImage}}\\\" class=\\\"img-thumbnail\\\" width=\\\"200\\\" height=\\\"150\\\">\\r\\n        </a>\\r\\n        <p>{{$$value$$}}</p>\\r\\n        <div>\\r\\n            <a ng-if=\\\"imageExists\\\" download=\\\"{{$$value$$}}\\\" ng-href=\\\"{{image}}\\\" target=\\\"_self\\\"\\r\\n               class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a>\\r\\n            <!-- download -->\\r\\n            <a ng-if=\\\"imageExists\\\" ng-click=\\\"delete()\\\" class=\\\"btn btn-default\\\"><span\\r\\n                    class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script type=\\\"text/ng-template\\\" id=\\\"galleryImage.html\\\">\\r\\n\\r\\n    <div class=\\\"modal-header\\\">\\r\\n        <h3 class=\\\"modal-title\\\">Gallery</h3>\\r\\n    </div>\\r\\n    <div class=\\\"modal-body\\\">\\r\\n        <tinyvision ng-model=\\\"ngModel\\\"></tinyvision>\\r\\n    </div>\\r\\n    <div class=\\\"modal-footer\\\">\\r\\n        <button class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">Cancel</button>\\r\\n        <button class=\\\"btn btn-default\\\" ng-click=\\\"select()\\\">Select</button>\\r\\n    </div>\\r\\n    <style>\\r\\n        .modal-body #tinyvision .tv-toolbar {\\r\\n            position: absolute;\\r\\n        }\\r\\n\\r\\n        .modal-body #tinyvision .tv-items {\\r\\n            margin: 50px 0 0 0;\\r\\n            width: 100%;\\r\\n        }\\r\\n    </style>\\r\\n</script>\\r\\n\");}]);\r\nangular.module('schemaForm')\r\n    .directive('riSingleGalleryView', ['$routeParams', 'models', '$modal', function ($routeParams, models, $modal) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImage = 'images/open_gallery.png';\r\n                scope.defaultErrorImage = 'images/image_not_found.png';\r\n\r\n                ngModel.$render = function (image) {\r\n                    if (image) {\r\n                        ngModel.$setViewValue(image);\r\n                    } else if (image === \"\") {\r\n                        ngModel.$setViewValue(\"\");\r\n                    }\r\n                    scope.image = ngModel.$viewValue + random() || defaultImage;\r\n                    scope.imageExists = ngModel.$viewValue || false;\r\n                };\r\n\r\n                scope.delete = function () {\r\n                    ngModel.$render(\"\");\r\n                };\r\n\r\n                scope.openGallery = function () {\r\n                    $modal.open({\r\n                        templateUrl: 'galleryImage.html',\r\n                        controller: 'SingleItemGalleryModalCtrl',\r\n                        size: 'lg',\r\n                        resolve: {\r\n                            ngModal: function () {\r\n                                return ngModel;\r\n                            }\r\n                        }\r\n                    }).result.then(function (selectedImage) {\r\n                        ngModel.$render(selectedImage);\r\n                    });\r\n                };\r\n\r\n                angular.element(element).find('img').bind('error', function () {\r\n                    angular.element(this).attr(\"src\", scope.defaultErrorImage);\r\n                });\r\n\r\n                function random() {\r\n                    return \"?time=\" + Date.now();\r\n                }\r\n            }\r\n        }\r\n    }])\r\n    .controller('SingleItemGalleryModalCtrl', ['$scope', '$modalInstance', function ($scope, $modalInstance) {\r\n\r\n            $scope.cancel = function () {\r\n                $modalInstance.dismiss('cancel');\r\n            };\r\n\r\n            $scope.select = function () {\r\n                $modalInstance.close($scope.ngModel);\r\n            };\r\n        }]\r\n    );\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var gallery = function (name, schema, options) {\r\n                if (schema.type === 'gallery') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'gallery';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = schema.path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            if (!schemaFormProvider.defaults.gallery)\r\n                schemaFormProvider.defaults.gallery = [];\r\n\r\n            schemaFormProvider.defaults.gallery.unshift(gallery);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'gallery',\r\n                'directives/decorators/bootstrap/galleryimage/galleryimage.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'gallery',\r\n                'directives/decorators/bootstrap/galleryimage/galleryimage.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/galleryfile/galleryfile.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img ng-if=\\\"sampleImage\\\" ng-model=\\\"$$value$$\\\" ri-file-view ng-show=\\\"sampleImage\\\" ng-src=\\\"{{sampleImage}}\\\">\\r\\n                <a ri-file-view filename=\\\"$$value$$\\\" href=\\\"{{$$value$$}}\\\" ng-model=\\\"$$value$$\\\">{{$$value$$}}</a>\\r\\n            </div>\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div ri-gallery-file-uploader ng-model=\\\"$$value$$\\\">\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span>\\r\\n                    <!-- upload file -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span>\\r\\n                    <!-- change file -->\\r\\n                    <input ri-gallery-file-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"file\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"fileExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span\\r\\n                        class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"fileExists\\\" download=\\\"{{$$value$$}}\\\" ng-href=\\\"{{file}}\\\" target=\\\"_self\\\"\\r\\n                   class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a>\\r\\n                <!-- download -->\\r\\n                <a ng-if=\\\"fileExists\\\" ng-click=\\\"deleteFile(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span\\r\\n                        class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('riGalleryFileUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                scope.onFileSelect = function ($files) {\r\n                    if ($files && $files.length > 0) {\r\n                        if (scope.myFiles && scope.myFiles.length > 0) {\r\n                            var file = scope.myFiles[0];\r\n                            models.uploadToGallery(file, function (data) {\r\n                                ngModel.$render(data[0]);\r\n                            });\r\n                        }\r\n                    }\r\n                };\r\n\r\n                ngModel.$render = function (image) {\r\n                    if (image) {\r\n                        ngModel.$setViewValue(image);\r\n                    } else if (image === \"\") {\r\n                        ngModel.$setViewValue(\"\");\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('riFileView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImageForFile = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+File';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        // models.getFileUrl(modelName, id, value, function (url) {\r\n                        scope.galleryPath = models.getGalleryPath();\r\n                        scope.file = models.getGalleryPath() + value;\r\n                        scope.fileExists = true;\r\n                        // });\r\n                    } else {\r\n                        scope.sampleImage = defaultImageForFile;\r\n                        scope.fileExists = false;\r\n                    }\r\n\r\n                    scope.downloadImage = function () {\r\n                        console.log(\"TODO: Download file from model\", modelName, \"and id\", id);\r\n                    };\r\n\r\n                    scope.deleteFile = function () {\r\n                        models.galleryDelete(value, function () {\r\n                            ngModel.$render(\"\");\r\n                        });\r\n                    }\r\n                });\r\n\r\n                ngModel.$render = function (image) {\r\n                    if (image) {\r\n                        ngModel.$setViewValue(image);\r\n                    } else if (image === \"\") {\r\n                        scope.sampleImage = defaultImageForFile;\r\n                        ngModel.$setViewValue(\"\");\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var file = function (name, schema, options) {\r\n                if (schema.type === 'gallery' && schema.format === 'file') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'file';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = schema.path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            if (!schemaFormProvider.defaults.gallery)\r\n                schemaFormProvider.defaults.gallery = [];\r\n\r\n            schemaFormProvider.defaults.gallery.unshift(file);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'file',\r\n                'directives/decorators/bootstrap/galleryfile/galleryfile.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'file',\r\n                'directives/decorators/bootstrap/galleryfile/galleryfile.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/geojson/geojson.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"css/leaflet/dist/leaflet.css\\\"/>\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <leaflet id=\\\"map\\\" lf-map ng-model=\\\"$$value$$\\\" width=\\\"100%\\\" lf-center=\\\"center || {}\\\" markers=\\\"markers\\\" height=\\\"480px\\\"></leaflet>\\r\\n    <!--<leaflet id=\\\"map\\\" width=\\\"100%\\\" height=\\\"480px\\\"></leaflet>-->\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n\");}]);\n(function () {\r\n    angular.module('schemaForm')\r\n        .directive('lfMap', ['$http', '$routeParams', 'models', 'leafletData', '$window', '$sce', function ($http, $routeParams, models, leafletData, $window, $sce) {\r\n            return {\r\n                restrict: 'AE',\r\n                require: 'ngModel',\r\n                priority: 1,\r\n                controller: ['$scope', function ($scope) {\r\n                    $scope.center = {\r\n                        lat: 41.2757772,\r\n                        lng: 1.9888791,\r\n                        zoom: 8\r\n                    };\r\n                }],\r\n                link: function (scope, element, attrs, ngModel) {\r\n                    if (ngModel) {\r\n                        ngModel.$render = function () {\r\n                            if (!ngModel.$viewValue) {\r\n                                return;\r\n                            }\r\n\r\n                            scope.center = {\r\n                                lat: ngModel.$viewValue.coordinates[1],\r\n                                lng: ngModel.$viewValue.coordinates[0],\r\n                                zoom: 15\r\n                            };\r\n                            scope.markers = {\r\n                                mainMarker: {\r\n                                    lat: ngModel.$viewValue.coordinates[1],\r\n                                    lng: ngModel.$viewValue.coordinates[0],\r\n                                    focus: true\r\n                                }\r\n                            };\r\n                        }\r\n                    }\r\n                    $window.dispatchEvent(new Event('resize'));\r\n                }\r\n            }\r\n        }\r\n        ]);\r\n})();\n(function () {\r\n    angular.module('schemaForm').config(\r\n        ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n                var geojson = function (name, schema, options) {\r\n                    if (schema.type == 'geojson') {\r\n                        var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                        f.key = options.path;\r\n                        f.type = 'geojson';\r\n                        options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                        return f;\r\n                    }\r\n                };\r\n\r\n                if (!schemaFormProvider.defaults.geojson)\r\n                    schemaFormProvider.defaults.geojson = [];\r\n\r\n                schemaFormProvider.defaults.geojson.unshift(geojson);\r\n\r\n                //Add to the bootstrap directive\r\n                schemaFormDecoratorsProvider.addMapping(\r\n                    'bootstrapDecorator',\r\n                    'geojson',\r\n                    'directives/decorators/bootstrap/geojson/geojson.html'\r\n                );\r\n                schemaFormDecoratorsProvider.createDirective(\r\n                    'geojson',\r\n                    'directives/decorators/bootstrap/geojson/geojson.html'\r\n                );\r\n            }\r\n        ]);\r\n})();\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/fileinjector/fileinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-file-view ng-src=\\\"{{file}}\\\" filename=\\\"$$value$$\\\">\\r\\n            </div>\\r\\n            {{$$value$$}}\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload file -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change file -->\\r\\n                    <input bk-file-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"file\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"fileExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"fileExists\\\" download=\\\"{{$$value$$}}\\\" ng-href=\\\"{{file}}\\\" target=\\\"_self\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a> <!-- download -->\\r\\n                <a ng-if=\\\"fileExists\\\" ng-click=\\\"deleteFile(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkFileUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if ($files && $files.length > 0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                            if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                var file = scope.myFiles[0];\r\n                                models.getModelConfig(modelName, function (config) {\r\n                                    var fieldName = scope.$eval(attrs.path);\r\n                                    //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                    models.uploadFile(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                        //console.log(data);\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkFileView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImageForFile = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+File';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getFileUrl(modelName, id, value, function (url) {\r\n                            scope.file = url;\r\n                            scope.fileExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.file = defaultImageForFile;\r\n                        scope.fileExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download file from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteFile = function (index) {\r\n                    models.deleteFile(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"File deleted\");\r\n                        scope.file = defaultImageForFile;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var fileinjector = function (name, schema, options) {\r\n                if (schema.type === 'string' && schema.format === 'file') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'fileinjector';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = schema.path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(fileinjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'fileinjector',\r\n                'directives/decorators/bootstrap/fileinjector/fileinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'fileinjector',\r\n                'directives/decorators/bootstrap/fileinjector/fileinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/mixed/mixed.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"dist/css/codemirror/theme/monokai.css\\\"/>\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <ui-codemirror ui-codemirror-opts=\\\"editorOptions\\\" ng-model=\\\"$$value$$\\\" ui-codemirror=\\\"{ onLoad : codemirrorLoaded }\\\"></ui-codemirror>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"dist/extra/codemirror/javascript.js\\\"></script>\");}]);\nangular.module('schemaForm').directive('uiCodemirror', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n    return {\r\n        restrict: 'AE',\r\n        require: 'ngModel',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.editorOptions = {\r\n                lineNumbers: true,\r\n                //theme: 'monokai',\r\n                mode: 'application/json',\r\n                foldGutter: {\r\n                    rangeFinder: new CodeMirror.fold.combine(CodeMirror.fold.brace)\r\n                },\r\n                matchBrackets: true,\r\n                gutters: [\"CodeMirror-foldgutter\"]\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('ui.codemirror', []).constant('uiCodemirrorConfig', {}).directive('uiCodemirror', ['uiCodemirrorConfig', function (uiCodemirrorConfig) {\r\n        return {\r\n            restrict: 'EA',\r\n            require: '?ngModel',\r\n            priority: 1,\r\n            compile: function compile() {\r\n                // Require CodeMirror\r\n                if (angular.isUndefined(window.CodeMirror)) {\r\n                    throw new Error('ui-codemirror need CodeMirror to work... (o rly?)');\r\n                }\r\n                return function postLink(scope, iElement, iAttrs, ngModel) {\r\n                    var options, opts, codeMirror, initialTextValue;\r\n                    initialTextValue = iElement.text();\r\n                    options = uiCodemirrorConfig.codemirror || {};\r\n                    opts = angular.extend({value: initialTextValue}, options, scope.$eval(iAttrs.uiCodemirror), scope.$eval(iAttrs.uiCodemirrorOpts));\r\n                    if (iElement[0].tagName === 'TEXTAREA') {\r\n                        // Might bug but still ...\r\n                        codeMirror = window.CodeMirror.fromTextArea(iElement[0], opts);\r\n                    } else {\r\n                        iElement.html('');\r\n                        codeMirror = new window.CodeMirror(function (cm_el) {\r\n                            iElement.append(cm_el);\r\n                        }, opts);\r\n                    }\r\n                    if (iAttrs.uiCodemirror || iAttrs.uiCodemirrorOpts) {\r\n                        var codemirrorDefaultsKeys = Object.keys(window.CodeMirror.defaults);\r\n                        scope.$watch(iAttrs.uiCodemirror || iAttrs.uiCodemirrorOpts, function updateOptions(newValues, oldValue) {\r\n                            if (!angular.isObject(newValues)) {\r\n                                return;\r\n                            }\r\n                            codemirrorDefaultsKeys.forEach(function (key) {\r\n                                if (newValues.hasOwnProperty(key)) {\r\n                                    if (oldValue && newValues[key] === oldValue[key]) {\r\n                                        return;\r\n                                    }\r\n                                    codeMirror.setOption(key, newValues[key]);\r\n                                }\r\n                            });\r\n                        }, true);\r\n                    }\r\n                    if (ngModel) {\r\n                        // CodeMirror expects a string, so make sure it gets one.\r\n                        // This does not change the model.\r\n                        ngModel.$formatters.push(function (value) {\r\n                            if (angular.isUndefined(value) || value === null) {\r\n                                return '';\r\n                            } else if (angular.isObject(value) || angular.isArray(value)) {\r\n                                return JSON.stringify(value);\r\n                            }\r\n                            return value;\r\n                        });\r\n                        // Override the ngModelController $render method, which is what gets called when the model is updated.\r\n                        // This takes care of the synchronizing the codeMirror element with the underlying model, in the case that it is changed by something else.\r\n                        ngModel.$render = function () {\r\n                            //Code mirror expects a string so make sure it gets one\r\n                            //Although the formatter have already done this, it can be possible that another formatter returns undefined (for example the required directive)\r\n                            var safeViewValue = ngModel.$viewValue || '';\r\n                            codeMirror.setValue(safeViewValue);\r\n                        };\r\n                        // Keep the ngModel in sync with changes from CodeMirror\r\n                        codeMirror.on('change', function (instance) {\r\n                            var newValue = instance.getValue();\r\n                            if (newValue !== ngModel.$viewValue) {\r\n                                // Changes to the model from a callback need to be wrapped in $apply or angular will not notice them\r\n                                scope.$apply(function () {\r\n                                    try {\r\n                                        var parsed = JSON.parse(newValue);\r\n                                        ngModel.$setViewValue(parsed);\r\n                                    } catch (e){\r\n                                        //Safe to ignore this :)\r\n                                    }\r\n                                });\r\n                            }\r\n\r\n                            //var totalLines = codeMirror.lineCount();\r\n                            //codeMirror.autoFormatRange({line:0, ch:0}, {line:totalLines});\r\n                        });\r\n                    }\r\n                    // Watch ui-refresh and refresh the directive\r\n                    if (iAttrs.uiRefresh) {\r\n                        scope.$watch(iAttrs.uiRefresh, function (newVal, oldVal) {\r\n                            // Skip the initial watch firing\r\n                            if (newVal !== oldVal) {\r\n                                codeMirror.refresh();\r\n                            }\r\n                        });\r\n                    }\r\n                    // Allow access to the CodeMirror instance through a broadcasted event\r\n                    // eg: $broadcast('CodeMirror', function(cm){...});\r\n                    scope.$on('CodeMirror', function (event, callback) {\r\n                        if (angular.isFunction(callback)) {\r\n                            callback(codeMirror);\r\n                        } else {\r\n                            throw new Error('the CodeMirror event requires a callback function');\r\n                        }\r\n                    });\r\n                    // onLoad callback\r\n                    if (angular.isFunction(opts.onLoad)) {\r\n                        opts.onLoad(codeMirror);\r\n                    }\r\n                };\r\n            }\r\n        };\r\n    }\r\n]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type == 'object' && !schema.ref && !schema.format && schema.mixed) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'mixed';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.object.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'mixed',\r\n                'directives/decorators/bootstrap/mixed/mixed.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'mixed',\r\n                'directives/decorators/bootstrap/mixed/mixed.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/button/button.html\",\"<div class=\\\"form-group {{form.htmlClass}}\\\">\\r\\n    <button bk-button type=\\\"button\\\" ng-click=\\\"click()\\\" ng-show=\\\"showTitle()\\\" class=\\\"btn\\\">{{form.title}}</button>\\r\\n</div>\\r\\n\");}]);\nangular.module('schemaForm').directive('bkButton', ['$http', 'models', function ($http, models) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var form = scope.form;\r\n            scope.click = function () {\r\n                scope.$emit('bkButton', form);\r\n                //if (form.action == 'api') {\r\n                //    if (form.method == 'GET') {\r\n                //        $http.get(form.url + 'dfdfdf').success(function (res) {\r\n                //            console.log(res);\r\n                //        }).error(function (err) {\r\n                //            console.error(err);\r\n                //        });\r\n                //    }\r\n                //} else if (form.action == 'function') {\r\n                //    console.log(scope.form);\r\n                //    window[form.func]();\r\n                //}\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'button')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'button';\r\n                    f.action = schema.action;\r\n                    if (f.action == 'api') {\r\n                        f.method = schema.method;\r\n                        f.url = schema.url;\r\n                        f.params = schema.params;\r\n                    } else if(f.action == 'function'){\r\n                        f.func = schema.func;\r\n                    }\r\n                    f.function = schema.onClick;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'button',\r\n                'directives/decorators/bootstrap/button/button.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'button',\r\n                'directives/decorators/bootstrap/button/button.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/textarea/textarea.html\",\"<div class=\\\"form-group has-feedback\\\" ng-class=\\\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\\\">\\n    <label ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\n    <textarea class=\\\"form-control\\\"\\n              sf-changed=\\\"form\\\"\\n              placeholder=\\\"{{form.placeholder}}\\\"\\n              ng-disabled=\\\"form.readonly\\\"\\n              ng-model=\\\"$$value$$\\\"\\n              ng-model-options=\\\"form.ngModelOptions\\\"\\n              schema-validate=\\\"form\\\"\\n              rows=\\\"{{form.rows}}\\\"></textarea>\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\n</div>\");}]);\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'textarea')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'textarea';\r\n                    f.rows = schema.rows;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'textarea',\r\n                'directives/decorators/bootstrap/textarea/textarea.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'textarea',\r\n                'directives/decorators/bootstrap/textarea/textarea.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/password/password.html\",\"<div class=\\\"form-group has-feedback {{form.divStyle}}\\\" ng-class=\\\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\\\">\\r\\n    <label ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <input type=\\\"password\\\" class=\\\"form-control {{form.style}}\\\"\\r\\n              sf-changed=\\\"form\\\"\\r\\n              placeholder=\\\"{{form.placeholder}}\\\"\\r\\n              ng-disabled=\\\"form.readonly\\\"\\r\\n              ng-model=\\\"$$value$$\\\"\\r\\n              ng-model-options=\\\"form.ngModelOptions\\\"\\r\\n              schema-validate=\\\"form\\\">\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\");}]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'password')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'password';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'password',\r\n                'directives/decorators/bootstrap/password/password.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'password',\r\n                'directives/decorators/bootstrap/password/password.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/seconds/seconds.html\",\"<fieldset ng-disabled=\\\"form.readonly\\\" class=\\\"schema-form-fieldset {{form.htmlClass}}\\\">\\n    <legend ng-show=\\\"form.title\\\">{{ form.title }}</legend>\\n\\n    <!--<sf-decorator>-->\\n    <div class=\\\"form-group schema-form-number col-xs-3 has-success has-feedback\\\">\\n        <label>Minutes</label>\\n        <input type=\\\"number\\\" min=\\\"0\\\" class=\\\"form-control\\\" ng-model=\\\"timeMinutes\\\"/>\\n            <span ng-if=\\\"form.feedback !== false\\\" class=\\\"form-control-feedback ng-scope glyphicon glyphicon-ok\\\"\\n                  ng-class=\\\"evalInScope(form.feedback) || {\\'glyphicon\\': true, \\'glyphicon-ok\\': hasSuccess(), \\'glyphicon-remove\\': hasError() }\\\"\\n                  aria-hidden=\\\"true\\\"></span>\\n    </div>\\n    <!--</sf-decorator>-->\\n\\n    <!--<sf-decorator class=\\\"ng-scope\\\">-->\\n    <div class=\\\"form-group schema-form-number col-xs-3 has-success has-feedback\\\">\\n        <label>Seconds</label>\\n        <input type=\\\"number\\\" min=\\\"0\\\" max=\\\"59\\\" class=\\\"form-control\\\" ng-model=\\\"timeSeconds\\\"/>\\n            <span ng-if=\\\"form.feedback !== false\\\" class=\\\"form-control-feedback ng-scope glyphicon glyphicon-ok\\\"\\n                  ng-class=\\\"evalInScope(form.feedback) || {\\'glyphicon\\': true, \\'glyphicon-ok\\': hasSuccess(), \\'glyphicon-remove\\': hasError() }\\\"\\n                  aria-hidden=\\\"true\\\"></span>\\n    </div>\\n    <!--</sf-decorator>-->\\n    <div class=\\\"help-block\\\"\\n         ng-show=\\\"(hasError() && errorMessage(schemaError())) || form.description\\\"\\n         ng-bind-html=\\\"(hasError() && errorMessage(schemaError())) || form.description\\\"></div>\\n</fieldset>\\n\\n<input bk-seconds ng-model=\\\"$$value$$\\\" type=\\\"hidden\\\"/>\");}]);\r\nangular.module('schemaForm').directive('bkSeconds', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n    return {\r\n        restrict: 'AE',\r\n        require: 'ngModel',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            ngModel.$render = function () {\r\n                if (ngModel.$viewValue != undefined) {\r\n                    scope.timeMinutes = Math.floor(ngModel.$viewValue / 60);\r\n                    scope.timeSeconds = ngModel.$viewValue % 60;\r\n                } else{\r\n                    scope.timeMinutes = 0;\r\n                    scope.timeSeconds = 0;\r\n                }\r\n            };\r\n\r\n            scope.$watch(\"timeMinutes\", function (newval) {\r\n                if (newval != undefined)\r\n                    ngModel.$setViewValue(newval * 60 + scope.timeSeconds);\r\n            });\r\n\r\n            scope.$watch(\"timeSeconds\", function (newval) {\r\n                if (newval != undefined)\r\n                    ngModel.$setViewValue(scope.timeMinutes * 60 + newval);\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var seconds = function (name, schema, options) {\r\n                if (schema.type === 'number' && schema.format === 'time-seconds') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'seconds';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.number.unshift(seconds);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'seconds',\r\n                'directives/decorators/bootstrap/seconds/seconds.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'seconds',\r\n                'directives/decorators/bootstrap/seconds/seconds.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/multiselect/multiselect.html\",\"<div class=\\\"form-group schema-form-select {{form.htmlClass}}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <ui-select select-multiple multiple ng-model=\\\"$$value$$\\\" separator=\\\"form.separator\\\" choices=\\\"choices\\\" enum=\\\"form.enum\\\" map=\\\"form.map\\\" lock=\\\"form.locked\\\" url=\\\"form.url\\\" ng-disabled=\\\"disabled\\\">\\r\\n        <ui-select-match placeholder=\\\"{{placeholder}}\\\">{{common.prettifyTitle($item.name)}}</ui-select-match>\\r\\n        <ui-select-choices\\r\\n                group-by=\\\"group\\\"\\r\\n                repeat=\\\"elem.value as elem in availableElems | filter: $select.search\\\"\\r\\n                refresh=\\\"refreshData($select.search)\\\">\\r\\n            {{getTitle(elem)}}\\r\\n        </ui-select-choices>\\r\\n    </ui-select>\\r\\n</div>\");}]);\nangular.module('schemaForm').directive('selectMultiple', ['$http', '$routeParams', 'models', 'common', function ($http, $routeParams, models, common) {\r\n    function convertToMap(elements){\r\n        var map = [];\r\n        angular.forEach(elements, function(val) {\r\n            if(val.name && val.value){\r\n                map.push(val);\r\n            } else if(val.split) { // is a string)\r\n                map.push({name: val, value: val});\r\n            } else{\r\n                console.error(\"Invalid value\", val, \"for multiselect element\")\r\n            }\r\n        });\r\n\r\n        return map;\r\n    }\r\n\r\n    function addStringToMap(val, map){\r\n        var exists = false;\r\n        angular.forEach(map, function(v){\r\n            if(v.value == val){\r\n                exists = true;\r\n            }\r\n        });\r\n\r\n        if(!exists) {\r\n            map.push({name: val, value: val});\r\n        }\r\n\r\n        return map;\r\n    }\r\n\r\n    return {\r\n        restrict: 'AE',\r\n        scope: false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n\r\n            //WAIT TO LOAD :)\r\n            //$('body').delegate('.page-sidebar li > a', 'click',  function (e) {});\r\n\r\n\r\n            scope.common = common;\r\n            scope.grouping = false;\r\n            scope.separator = scope.$eval(attrs.separator);\r\n            scope.url = scope.$eval(attrs.url);\r\n            scope.lock = scope.$eval(attrs.lock);\r\n            scope.availableElems = [];\r\n            scope.placeholder = \"Select\";\r\n            scope.enum = scope.$eval(attrs.enum);\r\n            scope.map = scope.$eval(attrs.map);\r\n\r\n            if(scope.separator){\r\n                scope.group = function(item){\r\n                    return item.name.split(scope.separator)[0];\r\n                };\r\n                scope.grouping = true;\r\n            }\r\n\r\n            scope.getTitle = function(val){\r\n                if(scope.separator){\r\n                    var splitted = val.name.split(scope.separator);\r\n                    splitted.splice(0,1);\r\n                    var value = splitted.join(scope.separator);\r\n                    return common.prettifyTitle(value, scope.separator);\r\n                } else {\r\n                    return common.prettifyTitle(val.name);\r\n                }\r\n            };\r\n\r\n            scope.refreshData = function (item) {\r\n                if(!scope.lock) {\r\n                    if (item) {\r\n                        scope.availableElems = addStringToMap(item, scope.availableElems);\r\n                    }\r\n                }\r\n            };\r\n\r\n            if(scope.url){\r\n                if(common.hasAngularVariable(scope.url)){\r\n                    if ($routeParams.id) {\r\n                        models.getDocument($routeParams.schema, $routeParams.id, function (doc) {\r\n                            var a = common.deAngularizeUrl(doc, scope.url);\r\n                            $http.get(a).then(function (elems) {\r\n                                var d = elems.data;\r\n                                if (d instanceof Array) {\r\n                                    scope.availableElems = convertToMap(d);\r\n                                } else {\r\n                                    console.error(\"Invalid values for multiselect\", \"values:\", d);\r\n                                }\r\n                            });\r\n                        });\r\n                    } else {\r\n                        scope.placeholder = \"Cannot resolve variable \" + common.getAngularVariables(scope.url) + \". Please save the document first\";\r\n                        scope.availableElems = convertToMap(scope.$eval(attrs.choices) || []);\r\n                    }\r\n                } else {\r\n                    $http.get(scope.url).then(function (elems) {\r\n                        var d = elems.data;\r\n                        if (d instanceof Array) {\r\n                            scope.availableElems = convertToMap(d);\r\n                        } else {\r\n                            console.error(\"Invalid values for multiselect\", \"values:\", d);\r\n                        }\r\n                    });\r\n                }\r\n\r\n            } else {\r\n                if(scope.map){\r\n                    scope.availableElems = convertToMap(scope.map);\r\n                } else if(scope.enum){\r\n                    scope.availableElems = convertToMap(scope.enum);\r\n                } else {\r\n                    console.error(\"Bad configuration for multiselect\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var multiselect = function (name, schema, options) {\r\n                if (schema.type === 'array' && schema.items.type === 'string' && (schema.items.enum || schema.items.enumUrl || schema.items.map)) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'multiselect';\r\n                    f.map = schema.items.map;\r\n                    f.enum = schema.items.enum;\r\n                    f.path = schema.path;\r\n                    f.separator = schema.items.separator;\r\n                    f.locked = schema.items.limitToOptions || false;\r\n                    f.url = schema.items.enumUrl;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.array.unshift(multiselect);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'multiselect',\r\n                'directives/decorators/bootstrap/multiselect/multiselect.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'multiselect',\r\n                'directives/decorators/bootstrap/multiselect/multiselect.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/rating/rating.html\",\"<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\n    <rating bk-rating ng-model=\\\"$$value$$\\\" max=\\\"form.maxValue\\\" min=\\\"form.minValue\\\" state-on=\\\"form.iconOn\\\" state-off=\\\"form.iconOff\\\"></rating>\\n</div>\");}]);\r\nangular.module('schemaForm').directive('bkRating', ['$http', '$routeParams', function ($http, $routeParams) {\r\n    return {\r\n        restrict: 'AE',\r\n        link: function (scope, element, attrs, ngModel) {\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'number' && (schema.format === 'rating')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'rating';\r\n\r\n                    if (schema.minValue)\r\n                        f.minValue = schema.minValue;\r\n                    if (schema.maxValue)\r\n                        f.maxValue = schema.maxValue;\r\n                    if (schema.iconOn)\r\n                        f.iconOn = schema.iconOn;\r\n                    if (schema.iconOff)\r\n                        f.iconOff = schema.iconOff;\r\n\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.number.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'rating',\r\n                'directives/decorators/bootstrap/rating/rating.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'rating',\r\n                'directives/decorators/bootstrap/rating/rating.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/tinymce/tinymce.html\",\"<div class=\\\"form-group {{form.htmlClass}}\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <textarea\\r\\n            ri-tinymce=\\\"form.tinymceOptions\\\"\\r\\n            ng-model=\\\"$$value$$\\\"\\r\\n            style=\\\"background-color: white\\\"\\r\\n            schema-validate=\\\"form\\\">\\r\\n    </textarea>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\");\n$templateCache.put(\"directives/decorators/bootstrap/tinymce/tinyvision.html\",\"<!--<!DOCTYPE html>-->\\r\\n<!--<html lang=\\\"en\\\">-->\\r\\n<!--<head>-->\\r\\n<!--<meta charset=\\\"utf-8\\\">-->\\r\\n<!--<meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge, chrome=1\\\">-->\\r\\n<!--<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\">-->\\r\\n<!--<title>TinyVision</title>-->\\r\\n<style>\\r\\n    /*body {*/\\r\\n    /*margin: 0 !important;*/\\r\\n    /*padding: 51px 0 0 !important;*/\\r\\n    /*}*/\\r\\n\\r\\n    @-webkit-keyframes spin {\\r\\n        100% {\\r\\n            -webkit-transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @-moz-keyframes spin {\\r\\n        100% {\\r\\n            -moz-transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @-ms-keyframes spin {\\r\\n        100% {\\r\\n            -ms-transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @-o-keyframes spin {\\r\\n        100% {\\r\\n            -o-transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @keyframes spin {\\r\\n        100% {\\r\\n            transform: rotate(360deg);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    @font-face {\\r\\n        font-family: \\'TinyVision\\';\\r\\n        font-style: normal;\\r\\n        font-weight: normal;\\r\\n        src: url(data:application/font-woff;charset=utf-8;base64,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) format(\\\"truetype\\\");\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon {\\r\\n        display: inline-block;\\r\\n        font-family: \\'TinyVision\\';\\r\\n        font-style: normal;\\r\\n        font-size: 16px;\\r\\n        text-transform: none;\\r\\n        font-variant: normal;\\r\\n        font-weight: normal;\\r\\n        line-height: 1;\\r\\n        speak: none;\\r\\n        vertical-align: text-bottom;\\r\\n        -webkit-font-smoothing: antialiased;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon-refresh:before {\\r\\n        content: \\\"\\\\e000\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon-upload:before {\\r\\n        content: \\\"\\\\e001\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon-remove:before {\\r\\n        content: \\\"\\\\e9ac\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-icon-folder:before {\\r\\n        content: \\\"\\\\e931\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .icon-back:before {\\r\\n        font-family: \\'TinyVision\\';\\r\\n        content: \\\"\\\\e967\\\";\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar {\\r\\n        border-bottom: 1px solid #9e9e9e;\\r\\n        left: 0;\\r\\n        padding: 10px;\\r\\n        position: fixed;\\r\\n        right: 0;\\r\\n        top: 0;\\r\\n        z-index: 1000;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar-left {\\r\\n        float: left;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar-left > * {\\r\\n        float: left;\\r\\n        margin-right: 3px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar-right {\\r\\n        float: right;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-toolbar-right > * {\\r\\n        float: left;\\r\\n        margin-left: 3px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-upload .tv-icon-upload {\\r\\n        margin-right: 3px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-search .tv-icon-search {\\r\\n        cursor: text;\\r\\n        left: 11px;\\r\\n        position: absolute;\\r\\n        top: 6px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-search input {\\r\\n        padding-left: 35px;\\r\\n        width: 200px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-notice {\\r\\n        border: 1px solid #eee;\\r\\n        color: #9e9e9e;\\r\\n        display: none;\\r\\n        font-size: 20px;\\r\\n        margin: 15% auto 0;\\r\\n        padding: 20px;\\r\\n        text-align: center;\\r\\n        white-space: normal;\\r\\n        width: 50%;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-items {\\r\\n        list-style: none;\\r\\n        margin: 10px auto;\\r\\n        width: 660px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item {\\r\\n        float: left;\\r\\n        margin: 10px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item.selected .tv-item-image {\\r\\n        border: 2px solid #0088cc !important;\\r\\n        padding: 4px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item.selected .tv-item-name {\\r\\n        color: #0088cc !important;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-link {\\r\\n        cursor: pointer;\\r\\n        display: block;\\r\\n        text-decoration: none;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-link:hover .tv-item-image {\\r\\n        border-color: #9e9e9e;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-link:hover .tv-item-name {\\r\\n        color: #000;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-dir {\\r\\n        border: 1px solid #eee;\\r\\n        height: 100px;\\r\\n        line-height: 100px;\\r\\n        padding: 5px;\\r\\n        text-align: center;\\r\\n        width: 100px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-dir span {\\r\\n        max-height: 100px;\\r\\n        max-width: 100px;\\r\\n        min-height: 1px;\\r\\n        min-width: 1px;\\r\\n        vertical-align: middle;\\r\\n        font-size: 70px;\\r\\n        font-family: \\'Glyphicons Halflings\\';\\r\\n        color: #696969;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-image {\\r\\n        border: 1px solid #eee;\\r\\n        height: 100px;\\r\\n        line-height: 100px;\\r\\n        padding: 5px;\\r\\n        text-align: center;\\r\\n        width: 100px;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-image img {\\r\\n        max-height: 100px;\\r\\n        max-width: 100px;\\r\\n        min-height: 1px;\\r\\n        min-width: 1px;\\r\\n        vertical-align: middle;\\r\\n    }\\r\\n\\r\\n    #tinyvision .tv-item-name {\\r\\n        color: #9e9e9e;\\r\\n        padding: 5px;\\r\\n        overflow: hidden;\\r\\n        text-overflow: ellipsis;\\r\\n        white-space: nowrap;\\r\\n        width: 100px;\\r\\n    }\\r\\n\\r\\n    .cf:before,\\r\\n    .cf:after {\\r\\n        content: \\' \\';\\r\\n        display: table;\\r\\n    }\\r\\n\\r\\n    .cf:after {\\r\\n        clear: both;\\r\\n    }\\r\\n</style>\\r\\n<!--<link rel=\\\"stylesheet\\\" href=\\\"tinyvision.css\\\">-->\\r\\n<!--</head>-->\\r\\n<!--<body>-->\\r\\n<div class=\\\"mce-container\\\" id=\\\"tinyvision\\\">\\r\\n    <div class=\\\"tv-toolbar mce-panel cf\\\">\\r\\n        <div class=\\\"tv-toolbar-left\\\">\\r\\n            <div class=\\\"tv-upload mce-widget mce-btn\\\">\\r\\n                <button ng-if=\\\"isEmptyDir\\\" type=\\\"button\\\" ng-click=\\\"removeDir()\\\" id=\\\"remove-dir\\\"><span\\r\\n                        class=\\\"tv-icon tv-icon-remove\\\"></span> Remove directory\\r\\n                </button>\\r\\n                <button ng-if=\\\"!isEmptyDir\\\" type=\\\"button\\\" ng-click=\\\"removeFile()\\\" id=\\\"remove\\\"><span\\r\\n                        class=\\\"tv-icon tv-icon-remove\\\"></span> Remove\\r\\n                </button>\\r\\n            </div>\\r\\n            <div class=\\\"tv-upload mce-widget mce-btn\\\">\\r\\n                <button type=\\\"button\\\" ng-click=\\\"refresh()\\\" id=\\\"refresh\\\"><span\\r\\n                        class=\\\"tv-icon tv-icon-refresh\\\"></span> Refresh\\r\\n                </button>\\r\\n            </div>\\r\\n            <div class=\\\"tv-upload mce-widget mce-btn\\\">\\r\\n                <button type=\\\"button\\\" ng-click=\\\"openUploadModal()\\\" id=\\\"upload\\\"><span\\r\\n                        class=\\\"tv-icon tv-icon-upload\\\"></span> Upload\\r\\n                </button>\\r\\n            </div>\\r\\n        </div>\\r\\n        <div class=\\\"tv-toolbar-right\\\">\\r\\n            <div class=\\\"tv-search mce-widget\\\">\\r\\n                <span class=\\\"tv-icon tv-icon-search\\\"></span>\\r\\n                <input class=\\\"mce-textbox\\\" ng-model=\\\"dir\\\" placeholder=\\\"Directory name\\\">\\r\\n            </div>\\r\\n            <div class=\\\"tv-refresh mce-widget mce-btn\\\">\\r\\n                <button type=\\\"button\\\" id=\\\"create\\\" ng-click=\\\"createDir(dir)\\\"><span class=\\\"tv-icon tv-icon-folder\\\"></span>\\r\\n                </button>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <div class=\\\"tv-notice\\\" id=\\\"notice\\\"></div>\\r\\n    <ol class=\\\"tv-items cf\\\" id=\\\"items\\\">\\r\\n        <li ng-if=\\\"pathStack\\\" class=\\\"tv-item\\\">\\r\\n            <a ng-click=\\\"findByPath(\\'..\\')\\\" class=\\\"tv-item-link\\\" title=\\\"{{name}}\\\">\\r\\n                <div class=\\\"tv-item-dir\\\">\\r\\n                    <span class=\\\"glyphicon glyphicon-folder-open\\\" aria-hidden=\\\"true\\\"></span>\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\"><span class=\\\"icon-back\\\"></span> Back</div>\\r\\n            </a>\\r\\n        </li>\\r\\n        <li ng-repeat=\\\"e in data.directories track by $index\\\" class=\\\"tv-item\\\">\\r\\n            <a ng-click=\\\"findByPath(e)\\\" class=\\\"tv-item-link\\\" title=\\\"{{name}}\\\">\\r\\n                <div class=\\\"tv-item-dir\\\">\\r\\n                    <span class=\\\"glyphicon glyphicon-folder-close\\\" aria-hidden=\\\"true\\\"></span>\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\">{{e}}</div>\\r\\n            </a>\\r\\n        </li>\\r\\n        <li ng-repeat=\\\"e in data.image track by $index\\\" class=\\\"tv-item\\\" ng-class=\\\"{\\'selected\\':selected==e}\\\">\\r\\n            <a ng-click=\\\"setSelected(e)\\\" class=\\\"tv-item-link\\\" title=\\\"{{e}}\\\">\\r\\n                <div class=\\\"tv-item-image\\\">\\r\\n                    <img ng-src=\\\"{{getFullPath(e)}}\\\">\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\">{{e}}</div>\\r\\n            </a>\\r\\n        </li>\\r\\n        <li ng-repeat=\\\"e in data.video track by $index\\\" class=\\\"tv-item\\\" ng-class=\\\"{\\'selected\\':selected==e}\\\">\\r\\n            <a ng-click=\\\"setSelected(e)\\\" class=\\\"tv-item-link\\\" title=\\\"{{e}}\\\">\\r\\n                <div class=\\\"tv-item-image\\\">\\r\\n                    <img ng-src=\\\"{{getFullPath(e)}}\\\">\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\">{{e}}</div>\\r\\n            </a>\\r\\n        </li>\\r\\n        <li ng-repeat=\\\"e in data.file track by $index\\\" class=\\\"tv-item\\\" ng-class=\\\"{\\'selected\\':selected==e}\\\">\\r\\n            <a ng-click=\\\"setSelected(e)\\\" class=\\\"tv-item-link\\\" title=\\\"{{e}}\\\">\\r\\n                <div class=\\\"tv-item-dir\\\">\\r\\n                    <span class=\\\"glyphicon glyphicon-file\\\" aria-hidden=\\\"true\\\"></span>\\r\\n                </div>\\r\\n                <div class=\\\"tv-item-name\\\"><a href=\\\"{{getFullPath(e)}}\\\" target=\\\"_blank\\\">{{e}}</a></div>\\r\\n            </a>\\r\\n        </li>\\r\\n    </ol>\\r\\n</div>\\r\\n<!--&lt;!&ndash;<script src=\\\"tinyvision.min.js\\\"></script>&ndash;&gt;-->\\r\\n<!--</body>-->\\r\\n<!--</html>-->\\r\\n<!--MODAL FOR VALIDATION-->\\r\\n<style>\\r\\n    .modal {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    .modal-dialog {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    #mce-modal-block {\\r\\n        z-index: 15000 !important;\\r\\n    }\\r\\n\\r\\n    .mce-floatpanel {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    #mce-modal-block .mce-panel {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    droplet {\\r\\n        display: inline-block;\\r\\n        z-index: 15003;\\r\\n        position: relative;\\r\\n        border-radius: 2px;\\r\\n        width: 100%;\\r\\n        height: 400px;\\r\\n        background-color: rgba(255, 255, 255, .1);\\r\\n        margin-top: -5px;\\r\\n        padding-top: 5px;\\r\\n        transition: box-shadow 0.35s;\\r\\n    }\\r\\n\\r\\n    droplet.event-dragover {\\r\\n        box-shadow: inset 0 0 100px rgba(255, 255, 255, .25), inset 0 0 5px rgba(255, 255, 255, .25);\\r\\n    }\\r\\n\\r\\n    droplet ul.files {\\r\\n        height: 100%;\\r\\n        width: 100%;\\r\\n        overflow-y: auto;\\r\\n        padding: 5px;\\r\\n        list-style-type: none;\\r\\n        transition: all .5s;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li {\\r\\n        width: 100px;\\r\\n        height: 100px;\\r\\n        padding: 1px;\\r\\n        float: left;\\r\\n        position: relative;\\r\\n        margin: 5px;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li img.droplet-preview {\\r\\n        max-width: 96px;\\r\\n        background-size: cover;\\r\\n        background-repeat: no-repeat;\\r\\n        height: 96px;\\r\\n        width: 96px;\\r\\n        background-color: white;\\r\\n        box-shadow: 0 0 10px rgba(0, 0, 0, .25);\\r\\n        border: 1px solid white;\\r\\n        display: block;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.delete {\\r\\n        background-color: rgba(0, 0, 0, .25);\\r\\n        width: 50px;\\r\\n        height: 50px;\\r\\n        font-family: Lato, Arial, Tahoma, Helvetica, sans-serif;\\r\\n        color: white;\\r\\n        font-size: 25px;\\r\\n        text-shadow: 1px 1px 0 rgba(0, 0, 0, .25);\\r\\n        text-align: center;\\r\\n        cursor: pointer;\\r\\n        line-height: 50px;\\r\\n        position: absolute;\\r\\n        border-radius: 50%;\\r\\n        z-index: 1010;\\r\\n        top: 25px;\\r\\n        left: 25px;\\r\\n        opacity: 0;\\r\\n        transition: all .30s;\\r\\n        transform: scale(0.5);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li:hover div.delete {\\r\\n        opacity: 1;\\r\\n        transform: scale(1);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.delete:hover {\\r\\n        background-color: rgba(0, 0, 0, .45);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.size {\\r\\n        background-color: rgba(255, 255, 255, .5);\\r\\n        position: absolute;\\r\\n        bottom: 5px;\\r\\n        right: 5px;\\r\\n        pointer-events: none;\\r\\n        font-size: 9px;\\r\\n        font-family: Lato, Arial, Tahoma, Helvetica, sans-serif;\\r\\n        padding: 1px 4px;\\r\\n    }\\r\\n</style>\\r\\n<script type=\\\"text/ng-template\\\" id=\\\"imgUploader.html\\\">\\r\\n    <div class=\\\"modal-header\\\">\\r\\n        <h3 class=\\\"modal-title\\\">Upload Files</h3>\\r\\n    </div>\\r\\n    <div class=\\\"modal-body\\\">\\r\\n        <droplet ng-model=\\\"dropletint\\\">\\r\\n\\r\\n            <!--<div class=\\\"loading\\\" ng-class=\\\"{ visible: dropletint.isUploading() }\\\">\\r\\n                <svg viewBox=\\\"0 0 400 400\\\">\\r\\n                    <path class=\\\"loading-path\\\" data-progressbar ng-model=\\\"dropletint.progress.percent\\\"\\r\\n                          d=\\\"M 0,1 L 398,1 L 398,234 L 1,234 L 0,1\\\"\\r\\n                          stroke=\\\"#D3B2D1\\\" stroke-width=\\\"1\\\" fill-opacity=\\\"0\\\"\\r\\n                          style=\\\"stroke-dasharray: 392px, 392px;stroke-dashoffset: 392px;\\\"></path>\\r\\n                </svg>\\r\\n            </div>-->\\r\\n\\r\\n            <section ng-show=\\\"dropletint.isUploading()\\\">Upload done. Press Cancel button or ESC key</section>\\r\\n\\r\\n            <ul class=\\\"files\\\">\\r\\n                <li ng-hide=\\\"dropletint.isUploading()\\\"\\r\\n                    ng-repeat=\\\"filemodel in dropletint.getFiles(dropletint.FILE_TYPES.VALID)\\\">\\r\\n                    <droplet-preview ng-model=\\\"filemodel\\\"></droplet-preview>\\r\\n                    <div class=\\\"delete\\\" ng-click=\\\"filemodel.deleteFile()\\\">&times;</div>\\r\\n                    <div class=\\\"size\\\">{{filemodel.file.size / 1024 / 1024 | number: 1}}MB</div>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </droplet>\\r\\n    </div>\\r\\n    <div class=\\\"modal-footer\\\">\\r\\n        <button class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">Cancel</button>\\r\\n        <button class=\\\"btn btn-primary\\\" ng-click=\\\"dropletint.uploadFiles()\\\" ng-hide=\\\"dropletint.isUploading()\\\">\\r\\n            Upload files\\r\\n        </button>\\r\\n    </div>\\r\\n</script>\");}]);\nangular.module('schemaForm').directive('riTinymce', ['$http', '$window', '$modal', function ($http, $window, $modal) {\r\n    var count = 0;\r\n\r\n    var defaultConf = {\r\n        plugins: \"code image -tinyvision autoresize fullscreen media link paste preview textcolor\",\r\n        toolbar1: \"undo redo | styleselect fontsizeselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | preview | fullscreen | forecolor backcolor\",\r\n        image_advtab: true,\r\n        forced_root_block: 'p',\r\n        width: '100%',\r\n        height: 400,\r\n        autoresize_min_height: 400,\r\n        autoresize_max_height: 800,\r\n        fullscreen_new_window: true,\r\n        skin_url: 'extra/tinymce/skins/lightgray',\r\n        fullscreen_settings: {\r\n            theme_advanced_path_location: \"top\"\r\n        },\r\n        paste_preprocess: function (pl, o) {\r\n            o.content = o.content.replace(/(<b>)/ig, \"<strong>\");\r\n            o.content = o.content.replace(/(<\\/b>)/ig, \"</strong>\");\r\n            o.content = o.content.replace(/(<i>)/ig, \"<em>\");\r\n            o.content = o.content.replace(/(<\\/i>)/ig, \"</em>\");\r\n        },\r\n        //valid_elements: 'p,a[href],span[class],div[class],img[style|class|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name]',\r\n        // tinyvision: {\r\n        //     source: '/gallery',\r\n        //     // upload: function () {\r\n        //     //     $modal.open({\r\n        //     //         templateUrl: 'imgUploader.html',\r\n        //     //         controller: 'ModalImgUploaderCtrl',\r\n        //     //         size: 'md'\r\n        //     //     });\r\n        //     // }\r\n        // }\r\n    };\r\n\r\n\r\n    return {\r\n        restrict: 'A',\r\n        require: 'ngModel',\r\n        scope: false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var tinymce;\r\n\r\n            if (!attrs.id) {\r\n                attrs.$set('id', 'ri-tinymce-' + count++);\r\n            } else {\r\n                //do we have real jQuery? or querySelector\r\n                var focus = function () {\r\n                    if (tinymce) {\r\n                    }\r\n                };\r\n                if ($window.jQuery) {\r\n                    jQuery('label[for=' + attrs.id + ']')\r\n                }\r\n            }\r\n\r\n            // function ensureInstance() {\r\n            //     if (!tinyInstance) {\r\n            //         tinyInstance = tinymce.get(attrs.id);\r\n            //     }\r\n            // }\r\n\r\n            function destroy() {\r\n                if (tinymce) {\r\n                    tinymce.save();\r\n                    tinymce.remove();\r\n                    tinymce = null;\r\n                }\r\n            }\r\n\r\n            scope.destroy = destroy;\r\n\r\n\r\n            scope.$on('$destroy', destroy);\r\n\r\n            scope.$watch(attrs.ngModel, function (value, old) {\r\n                console.log(value, old);\r\n                if (tinymce && angular.isDefined(value)) {\r\n                    var content = tinymce.getContent();\r\n                    if (angular.isString(value) && content !== value) {\r\n                        tinymce.setContent(value);\r\n                    }\r\n                }\r\n            });\r\n\r\n            var init = function (config) {\r\n                config = angular.extend(config || {}, defaultConf, {\r\n                    selector: '#' + attrs.id,\r\n                    setup: function (editor) {\r\n                        // tinyMCE.PluginManager.load('tinyvision', '/admin/extra/tinyvision/build/plugin.min.js');\r\n                        tinymce = editor;\r\n                        $window['focus' + attrs.id] = function () {\r\n                            tinymce.execCommand('mceFocus', false, attrs.id);\r\n                        };\r\n\r\n                        var update = function () {\r\n                            var content = editor.getContent();\r\n                            if (ngModel.$viewValue !== content) {\r\n                                ngModel.$setViewValue(content);\r\n\r\n                                //certain things like 'destroy' below triggers update inside a $digest cycle.\r\n                                if (!scope.$root.$$phase) {\r\n                                    scope.$apply();\r\n                                }\r\n                            }\r\n                        };\r\n\r\n                        editor.on('change', update);\r\n                        editor.on('KeyUp', update);\r\n                        editor.on('ExecCommand', update);\r\n                        editor.on('focus', function (e) {\r\n                            angular.element(e.target.contentAreaContainer).addClass('tx-tinymce-active');\r\n                        });\r\n                        editor.on('blur', function (e) {\r\n                            angular.element(e.target.contentAreaContainer).removeClass('tx-tinymce-active');\r\n                        });\r\n                        console.log(\"--> \" + ngModel.$viewValue);\r\n                    }\r\n                });\r\n\r\n                tinyMCE.init(config);\r\n            };\r\n\r\n            // If config is set watch it for changes, otherwise just init.\r\n            if (attrs.riTinymce) {\r\n                scope.$watch(attrs.riTinymce, function (c, old) {\r\n                    console.log(c);\r\n                    destroy();\r\n                    if (c) init(c);\r\n                    else init();\r\n                });\r\n            } else {\r\n                init();\r\n                destroy();\r\n            }\r\n        }\r\n    };\r\n}]);\nangular.module('schemaForm')\n    .run(['$templateCache', function ($templateCache) {\n        // Register the plugin with TinyMCE.\n        tinymce.PluginManager.add('tinyvision', function (editor, pluginUrl) {\n            /**\n             * Object to encapsulate everything.\n             *\n             * @type {Object}\n             */\n            var self = {};\n\n            /**\n             * TinyVision window.\n             *\n             * @type {tinymce.ui.Window}\n             * @see  {@link http://www.tinymce.com/wiki.php/api4:class.tinymce.ui.Window}\n             */\n            self.win = null;\n\n            /**\n             * Height of the TinyVision window.\n             *\n             * @constant {number}\n             * @default\n             */\n            self.WINDOW_HEIGHT = 537;\n\n            /**\n             * URL to open in the TinyVision window's iframe.\n             *\n             * @constant {string}\n             * @default\n             */\n            self.WINDOW_BODY = '<tinyvision></tinyvision>';//'directives/decorators/bootstrap/tinymce/tinyvision.html';//pluginUrl + '/tinyvision.html';\n\n            /**\n             * Width of the TinyVision window.\n             *\n             * @constant {number}\n             * @default\n             */\n            self.WINDOW_WIDTH = 702;\n\n            /**\n             * Get the URL of the TinyMCE editor skin. TinyMCE doesn't provide an\n             * accessor method, so the style sheets have to be manually parsed.\n             *\n             * @return {string} URL of the TinyMCE editor skin.\n             */\n            self.skinUrl = function () {\n                var regex = /\\/skins\\/\\w+\\/skin(\\.min)?\\.css$/,\n                    styleSheets = document.styleSheets,\n                    styleSheetsLength = styleSheets.length,\n                    styleSheetHref,\n                    url;\n\n                for (var i = 0; i < styleSheetsLength; i += 1) {\n                    styleSheetHref = styleSheets[i].href;\n\n                    if (styleSheetHref && styleSheetHref.match(regex)) {\n                        url = styleSheetHref;\n                        break;\n                    }\n                }\n\n                return url;\n            };\n\n            /**\n             * Get the iframe's window object.\n             *\n             * @return {Window} iframe's window object.\n             */\n            self.scope = function () {\n                return angular.element(self.win.getEl()).scope().$$childTail;\n            };\n\n            /**\n             * Get the currently selected item's data.\n             *\n             * @return {?Object} Item data.\n             */\n            self.selected = function () {\n                return self.scope().getCompleteSelected();\n            };\n\n            /**\n             * Populate the field that TinyVision was launched from with the selected\n             * item's `value`. Empties the field value if nothing selected.\n             *\n             * @param  {Element} field Field that TinyVision was launched from.\n             * @return {Object} self\n             */\n            self.populateField = function (field) {\n                var selected = self.selected();\n\n                field.value = selected ? selected : '';\n\n                return self;\n            };\n\n            /**\n             * Open the TinyMCE window for TinyVision. The window consists primarily of\n             * an iframe with the toolbar and items list.\n             *\n             * @param  {string} fieldId ID of field to populate with the selected value.\n             * @param  {string} fieldValue Current value of the field to populate.\n             * @param  {string} type The type of files to display.\n             * @param  {tinymce.ui.Window} parentWin Window launching TinyVision.\n             * @return {Object} self\n             */\n            self.openWindow = function (fieldId, fieldValue, type, parentWin) {\n                self.win = editor.windowManager.open({\n                    title: 'Select ' + type,\n                    html: self.WINDOW_BODY,\n                    buttons: [\n                        {\n                            text: 'Select',\n                            subtype: 'primary',\n                            onclick: function () {\n                                self.populateField(parentWin.document.getElementById(fieldId));\n                                self.win.close();\n                            }\n                        },\n                        {\n                            text: 'Cancel',\n                            onclick: 'close'\n                        }\n                    ],\n                    width: self.WINDOW_WIDTH,\n                    height: self.WINDOW_HEIGHT\n                }, {\n                    // Values passed to the iframe.\n                    fieldValue: fieldValue,\n                    options: editor.settings.tinyvision,\n                    skinUrl: self.skinUrl(),\n                    type: type\n                });\n                taka = self.win;\n                angular.element(document).injector().invoke([\"$compile\", \"$rootScope\", function ($compile, $rootScope) {\n                    var $targetDom = $(\"#\" + self.win._id + \"-body\");\n                    var $scope = $targetDom.html(\"<tinyvision></tinyvision>\").scope();\n                    $compile($targetDom)($scope);\n                    $rootScope.$digest();\n                }]);\n\n                return self;\n            };\n\n            // Add a TinyMCE command that other plugins can call to launch TinyVision.\n            editor.addCommand('tinyvision', function (options) {\n                self.openWindow(options.fieldId, options.fieldValue, options.type, options.win);\n            });\n\n            // Modify the editor's config to register TinyVision as the file browser.\n            /* jshint -W106 */\n            editor.settings.file_browser_callback = self.openWindow;\n            /* jshint +W106 */\n        });\n    }])\n    .directive(\"tinyvision\", ['$http', '$modal', 'models', function ($http, $modal, models) {\n        return {\n            restrict: 'E',\n            templateUrl: \"directives/decorators/bootstrap/tinymce/tinyvision.html\",\n            scope: {\n                ngModel: \"=\"\n            },\n            link: function (scope, element, attrs, ngModel) {\n                var pathStack = [];\n                scope.findByPath = function (path) {\n                    scope.data = undefined;\n                    if (path === \"..\") {\n                        pathStack.pop();\n                    } else if (path !== \"\") {\n                        pathStack.push(path);\n                    }\n                    models.galleryGetByPath(pathStack.join(\"/\") + \"/\", function (data) {\n                        scope.pathStack = pathStack.join(\"/\");\n                        scope.isEmptyDir = isEmptyDir(data);\n                        scope.data = data;\n                    });\n                };\n\n                scope.setSelected = function (e) {\n                    scope.selected = e;\n                    scope.ngModel = scope.getCompleteSelected();\n                    console.log(\"ngModel \" + ngModel);\n                    console.log(\"scope.ngModel \" + scope.ngModel);\n                    console.log(\"selected \" + scope.selected);\n                };\n\n                scope.getCompleteSelected = function () {\n                    return scope.getFullPath(scope.selected);\n                };\n\n                scope.getFullPath = function (img) {\n                    return (models.getGalleryPath() + pathStack.join(\"/\") + \"/\" + img).replace(/([^:]\\/)\\/+/g, \"$1\");\n                };\n\n                scope.openUploadModal = function () {\n                    $modal.open({\n                        templateUrl: 'imgUploader.html',\n                        controller: 'ModalImgUploaderCtrl',\n                        size: 'md',\n                        resolve: {\n                            pathstack: function () {\n                                return pathStack;\n                            }\n                        }\n                    }).result.then(function () {\n                        scope.refresh();\n                    });\n                };\n\n                scope.refresh = function () {\n                    scope.selected = undefined;\n                    scope.findByPath(\"\");\n                };\n\n                scope.remove = function (path) {\n                    models.galleryDeleteByPath(pathStack.join(\"/\") + path, function (data) {\n                        if (path === \"\") {\n                            scope.findByPath(\"..\");\n                        } else {\n                            scope.refresh();\n                        }\n                    });\n                };\n\n                scope.removeFile = function () {\n                    if (!scope.selected)\n                        return;\n                    scope.remove(\"/\" + scope.selected);\n                };\n\n                scope.removeDir = function () {\n                    scope.remove(\"\");\n                };\n\n                scope.createDir = function (dir) {\n                    if (!dir) return;\n                    models.galleryPostByPath(pathStack.join(\"/\") + \"/\" + dir, function (data) {\n                        scope.dir = undefined;\n                        scope.refresh();\n                    });\n                };\n\n                function isEmptyDir(data) {\n                    if (data.image && data.image.length) {\n                        return false;\n                    }\n                    if (data.video && data.video.length) {\n                        return false;\n                    }\n                    if (data.file && data.file.length) {\n                        return false;\n                    }\n                    if (data.directories && data.directories.length) {\n                        return false;\n                    }\n                    return true;\n                }\n\n                scope.refresh();\n            }\n        }\n    }\n    ])\n    .controller('ModalImgUploaderCtrl', ['$scope', '$modalInstance', '$timeout', 'loginProvider', 'pathstack', 'models', function ($scope, $modalInstance, $timeout, loginProvider, pathstack, models) {\n            $scope.success = false;\n            $scope.error = false;\n            $scope.$on('$dropletReady', function whenDropletReady() {\n                loginProvider.getUser(function (user) {\n                    $scope.dropletint.allowedExtensions(['png', 'jpg', 'bmp', 'gif', 'csv', 'pdf', 'zip', 'rar', 'xls', 'xlsx', 'xml', 'yml', 'json', 'doc', 'docx']);\n                    $scope.dropletint.setRequestHeaders({\n                        \"Authorization\": \"BEARER \" + user.token\n                    });\n                    $scope.dropletint.defineHTTPSuccess([200, 201]);\n                    $scope.dropletint.setRequestUrl(models.getGalleryPath() + pathstack.join(\"/\"));\n                });\n            });\n\n            $scope.$on('$dropletSuccess', function onDropletSuccess(event, response, files) {\n                $modalInstance.close();\n            });\n\n            $scope.cancel = function () {\n                $modalInstance.close();\n            };\n\n            $modalInstance.result.finally(function () {\n                // $('iframe').contents().find('#refresh').trigger('click');\n            });\n\n        }]\n    );\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var wysiwyg = function (name, schema, options) {\r\n                if (schema.type === 'string' && schema.format == 'html') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'wysiwyg';\r\n                    f.tinymceOptions = schema.tinymceOptions;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(wysiwyg);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping('bootstrapDecorator', 'wysiwyg',\r\n                'directives/decorators/bootstrap/tinymce/tinymce.html');\r\n            schemaFormDecoratorsProvider.createDirective('wysiwyg',\r\n                'directives/decorators/bootstrap/tinymce/tinymce.html');\r\n        }]);\r\n\n(function() {\n  var punchCardTemplate;\n\n  angular.module(\"punchCard\", []);\n\n  punchCardTemplate = \"<div id=\\\"punch-card\\\">\\n    <div class=\\\"punch-card-day\\\" ng-repeat='day in days'>\\n        <div class=\\\"punch-card-day-name\\\">\\n            <div class=\\\"punch-card-day-name-label\\\">{{ day }}</div>\\n        </div>\\n        <div class=\\\"punch-card-hour\\\"\\n             ng-repeat='hour in hours'\\n             ng-init=\\\"n = data[$parent.$index][$index]\\\">\\n            <div class=\\\"punch-card-hour-data size-{{ size(n) }}\\\"></div>\\n            <div class=\\\"punch-card-hour-tooltip\\\" ng-show=\\\"n\\\">\\n                <b>{{ n }}</b> {{ description(n) }}\\n                <div class=\\\"arrow\\\"></div>\\n            </div>\\n            <div class=\\\"punch-card-hour-tick\\\"></div>\\n        </div>\\n    </div>\\n    <div class=\\\"punch-card-hour-name\\\">\\n        <div class=\\\"punch-card-hour-name-label\\\" ng-repeat='hour in hours'>\\n            {{ hour }}\\n        </div>\\n    </div>\\n</div>\";\n\n  angular.module(\"punchCard\").directive(\"punchCard\", ['$compile', function($compile) {\n    return {\n      restrict: \"AE\",\n      scope: {\n        data: \"=\",\n        plural: \"@\",\n        singular: \"@\"\n      },\n      template: punchCardTemplate,\n      link: function($scope, element) {\n        $scope.days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n        $scope.hours = [\"00\", \"01\", \"02\", \"03\", \"04\", \"05\", \"06\", \"07\", \"08\", \"09\", \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\", \"18\", \"19\", \"20\", \"21\", \"22\", \"23\"];\n        $scope.description = function(n) {\n          if (n === 1) {\n            return $scope.singular || \"event\";\n          } else {\n            return $scope.plural || \"events\";\n          }\n        };\n        return $scope.$watch(\"data\", function(data) {\n          var flatten, max;\n          flatten = [].concat.apply([], $scope.data);\n          max = flatten.sort(function(a, b) {\n            return a - b;\n          })[flatten.length - 1];\n          $scope.size = function(n) {\n            return Math.floor(100 / max * +n / 10);\n          };\n          element.empty();\n          return element.append($compile(punchCardTemplate)($scope));\n        });\n      }\n    };\n  }]);\n\n}).call(this);\n\n/*globals define, module, require, document*/\n(function (root, factory) {\n    \"use strict\";\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else if (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = factory();\n    } else {\n        root.JsonHuman = factory();\n    }\n}(this, function () {\n    \"use strict\";\n\n    var indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n    function makePrefixer(prefix) {\n        return function (name) {\n            return prefix + \"-\" + name;\n        };\n    }\n\n    function isArray(obj) {\n        return toString.call(obj) === '[object Array]';\n    }\n\n    function sn(tagName, className, data) {\n        var result = document.createElement(tagName);\n\n        result.className = className;\n        result.appendChild(document.createTextNode(\"\" + data));\n\n        return result;\n    }\n\n    function scn(tagName, className, child) {\n        var result = document.createElement(tagName),\n            i, len;\n\n        result.className = className;\n\n        if (isArray(child)) {\n            for (i = 0, len = child.length; i < len; i += 1) {\n                result.appendChild(child[i]);\n            }\n        } else {\n            result.appendChild(child);\n        }\n\n        return result;\n    }\n\n    function linkNode(child, href, target){\n        var a = scn(\"a\", HYPERLINK_CLASS_NAME, child);\n        a.setAttribute('href', href);\n        a.setAttribute('target', target);\n        return a;\n    }\n\n    var toString = Object.prototype.toString,\n        prefixer = makePrefixer(\"jh\"),\n        p = prefixer,\n        ARRAY = 2,\n        BOOL = 4,\n        INT = 8,\n        FLOAT = 16,\n        STRING = 32,\n        OBJECT = 64,\n        SPECIAL_OBJECT = 128,\n        FUNCTION = 256,\n        UNK = 1,\n\n        STRING_CLASS_NAME = p(\"type-string\"),\n        STRING_EMPTY_CLASS_NAME = p(\"type-string\") + \" \" + p(\"empty\"),\n\n        BOOL_TRUE_CLASS_NAME = p(\"type-bool-true\"),\n        BOOL_FALSE_CLASS_NAME = p(\"type-bool-false\"),\n        BOOL_IMAGE = p(\"type-bool-image\"),\n        INT_CLASS_NAME = p(\"type-int\") + \" \" + p(\"type-number\"),\n        FLOAT_CLASS_NAME = p(\"type-float\") + \" \" + p(\"type-number\"),\n\n        OBJECT_CLASS_NAME = p(\"type-object\"),\n        OBJ_KEY_CLASS_NAME = p(\"key\") + \" \" + p(\"object-key\"),\n        OBJ_VAL_CLASS_NAME = p(\"value\") + \" \" + p(\"object-value\"),\n        OBJ_EMPTY_CLASS_NAME = p(\"type-object\") + \" \" + p(\"empty\"),\n\n        FUNCTION_CLASS_NAME = p(\"type-function\"),\n\n        ARRAY_KEY_CLASS_NAME = p(\"key\") + \" \" + p(\"array-key\"),\n        ARRAY_VAL_CLASS_NAME = p(\"value\") + \" \" + p(\"array-value\"),\n        ARRAY_CLASS_NAME = p(\"type-array\"),\n        ARRAY_EMPTY_CLASS_NAME = p(\"type-array\") + \" \" + p(\"empty\"),\n\n        HYPERLINK_CLASS_NAME = p('a'),\n\n        UNKNOWN_CLASS_NAME = p(\"type-unk\");\n\n    function getType(obj) {\n        var type = typeof obj;\n\n        switch (type) {\n        case \"boolean\":\n            return BOOL;\n        case \"string\":\n            return STRING;\n        case \"number\":\n            return (obj % 1 === 0) ? INT : FLOAT;\n        case \"function\":\n            return FUNCTION;\n        default:\n            if (isArray(obj)) {\n                return ARRAY;\n            } else if (obj === Object(obj)) {\n                if (obj.constructor === Object) {\n                    return OBJECT;\n                }\n                return OBJECT | SPECIAL_OBJECT\n            } else {\n                return UNK;\n            }\n        }\n    }\n\n    function _format(data, options, parentKey) {\n\n        var result, container, key, keyNode, valNode, len, childs, tr, value,\n            isEmpty = true,\n            isSpecial = false,\n            accum = [],\n            type = getType(data);\n\n        // Initialized & used only in case of objects & arrays\n        var hyperlinksEnabled, aTarget, hyperlinkKeys ;\n\n        if (type === BOOL) {\n            var boolOpt = options.bool;\n            container = document.createElement('div');\n\n            if (boolOpt.showImage) {\n                var img = document.createElement('img');\n                img.setAttribute('class', BOOL_IMAGE);\n\n                img.setAttribute('src',\n                    '' + (data ? boolOpt.img.true : boolOpt.img.false));\n\n                container.appendChild(img);\n            }\n\n            if (boolOpt.showText) {\n                container.appendChild(data ?\n                    sn(\"span\", BOOL_TRUE_CLASS_NAME, boolOpt.text.true) :\n                    sn(\"span\", BOOL_FALSE_CLASS_NAME, boolOpt.text.false));\n            }\n\n            result = container;\n\n        } else if (type === STRING) {\n            if (data === \"\") {\n                result = sn(\"span\", STRING_EMPTY_CLASS_NAME, \"(Empty Text)\");\n            } else {\n                result = sn(\"span\", STRING_CLASS_NAME, data);\n            }\n        } else if (type === INT) {\n            result = sn(\"span\", INT_CLASS_NAME, data);\n        } else if (type === FLOAT) {\n            result = sn(\"span\", FLOAT_CLASS_NAME, data);\n        } else if (type & OBJECT) {\n            if (type & SPECIAL_OBJECT) {\n                isSpecial = true;\n            }\n            childs = [];\n\n            aTarget =  options.hyperlinks.target;\n            hyperlinkKeys = options.hyperlinks.keys;\n\n            // Is Hyperlink Key\n            hyperlinksEnabled =\n                options.hyperlinks.enable &&\n                hyperlinkKeys &&\n                hyperlinkKeys.length > 0;\n\n            for (key in data) {\n                isEmpty = false;\n\n                value = data[key];\n\n                valNode = _format(value, options, key);\n                keyNode = sn(\"th\", OBJ_KEY_CLASS_NAME, key);\n\n                if( hyperlinksEnabled &&\n                    typeof(value) === 'string' &&\n                    indexOf.call(hyperlinkKeys, key) >= 0){\n\n                    valNode = scn(\"td\", OBJ_VAL_CLASS_NAME, linkNode(valNode, value, aTarget));\n                } else {\n                    valNode = scn(\"td\", OBJ_VAL_CLASS_NAME, valNode);\n                }\n\n                tr = document.createElement(\"tr\");\n                tr.appendChild(keyNode);\n                tr.appendChild(valNode);\n\n                childs.push(tr);\n            }\n\n            if (isSpecial) {\n                result = sn('span', STRING_CLASS_NAME, data.toString())\n            } else if (isEmpty) {\n                result = sn(\"span\", OBJ_EMPTY_CLASS_NAME, \"(Empty Object)\");\n            } else {\n                result = scn(\"table\", OBJECT_CLASS_NAME, scn(\"tbody\", '', childs));\n            }\n        } else if (type === FUNCTION) {\n            result = sn(\"span\", FUNCTION_CLASS_NAME, data);\n        } else if (type === ARRAY) {\n            if (data.length > 0) {\n                childs = [];\n                var showArrayIndices = options.showArrayIndex;\n\n                aTarget = options.hyperlinks.target;\n                hyperlinkKeys = options.hyperlinks.keys;\n\n                // Hyperlink of arrays?\n                hyperlinksEnabled = parentKey && options.hyperlinks.enable &&\n                    hyperlinkKeys &&\n                    hyperlinkKeys.length > 0 &&\n                    indexOf.call(hyperlinkKeys, parentKey) >= 0;\n\n                for (key = 0, len = data.length; key < len; key += 1) {\n\n                    keyNode = sn(\"th\", ARRAY_KEY_CLASS_NAME, key);\n                    value = data[key];\n\n                    if (hyperlinksEnabled && typeof(value) === \"string\") {\n                        valNode = _format(value, options, key);\n                        valNode = scn(\"td\", ARRAY_VAL_CLASS_NAME,\n                            linkNode(valNode, value, aTarget));\n                    } else {\n                        valNode = scn(\"td\", ARRAY_VAL_CLASS_NAME,\n                            _format(value, options, key));\n                    }\n\n                    tr = document.createElement(\"tr\");\n\n                    if (showArrayIndices) {\n                        tr.appendChild(keyNode);\n                    }\n                    tr.appendChild(valNode);\n\n                    childs.push(tr);\n                }\n\n                result = scn(\"table\", ARRAY_CLASS_NAME, scn(\"tbody\", '', childs));\n            } else {\n                result = sn(\"span\", ARRAY_EMPTY_CLASS_NAME, \"(Empty List)\");\n            }\n        } else {\n            result = sn(\"span\", UNKNOWN_CLASS_NAME, data);\n        }\n\n        return result;\n    }\n\n    function format(data, options) {\n        options = validateOptions(options || {});\n\n        var result;\n\n        result = _format(data, options);\n        result.className = result.className + \" \" + prefixer(\"root\");\n\n        return result;\n    }\n\n    function validateOptions(options){\n        options = validateArrayIndexOption(options);\n        options = validateHyperlinkOptions(options);\n        options = validateBoolOptions(options);\n\n        // Add any more option validators here\n\n        return options;\n    }\n\n\n    function validateArrayIndexOption(options) {\n        if(options.showArrayIndex === undefined){\n            options.showArrayIndex = true;\n        } else {\n            // Force to boolean just in case\n            options.showArrayIndex = options.showArrayIndex ? true: false;\n        }\n\n        return options;\n    }\n\n    function validateHyperlinkOptions(options){\n        var hyperlinks = {\n            enable : false,\n            keys : null,\n            target : ''\n        };\n\n        if(options.hyperlinks && options.hyperlinks.enable) {\n            hyperlinks.enable = true;\n\n            hyperlinks.keys =  isArray(options.hyperlinks.keys) ? options.hyperlinks.keys : [];\n\n            if(options.hyperlinks.target) {\n                hyperlinks.target = '' + options.hyperlinks.target;\n            } else {\n                hyperlinks.target = '_blank';\n            }\n        }\n\n        options.hyperlinks = hyperlinks;\n\n        return options;\n    }\n\n    function validateBoolOptions(options){\n        if(!options.bool){\n            options.bool = {\n                text:  {\n                    true : \"true\",\n                    false : \"false\"\n                },\n                img : {\n                    true: \"\",\n                    false: \"\"\n                },\n                showImage : false,\n                showText : true\n            };\n        } else {\n            var boolOptions = options.bool;\n\n            // Show text if no option\n            if(!boolOptions.showText && !boolOptions.showImage){\n                boolOptions.showImage  =  false;\n                boolOptions.showText  =  true;\n            }\n\n            if(boolOptions.showText){\n                if(!boolOptions.text){\n                    boolOptions.text = {\n                        true : \"true\",\n                        false : \"false\"\n                    };\n                } else {\n                    var t = boolOptions.text.true, f = boolOptions.text.false;\n\n                    if(getType(t) != STRING || t === ''){\n                        boolOptions.text.true = 'true';\n                    }\n\n                    if(getType(f) != STRING || f === ''){\n                        boolOptions.text.false = 'false';\n                    }\n                }\n            }\n\n            if(boolOptions.showImage){\n                if(!boolOptions.img.true && !boolOptions.img.false){\n                    boolOptions.showImage = false;\n                }\n            }\n        }\n\n        return options;\n    }\n\n    return {\n        format: format\n    };\n}));\n\n(function () {\n    'use strict';\n    angular.module('flash', [])\n        .factory('flash', ['$rootScope', '$timeout', function ($rootScope, $timeout) {\n            var messages = [];\n\n            var reset;\n            var cleanup = function () {\n                $timeout.cancel(reset);\n                reset = $timeout(function () {\n                    messages = [];\n                });\n            };\n\n            var emit = function (event, url, oldUrl) {\n                if (oldUrl && oldUrl.indexOf('/login') != -1) {\n                    messages = [];\n                    $rootScope.$emit('flashMessage', undefined, cleanup);\n                } else {\n                    $rootScope.$emit('flashMessage', messages[0], cleanup);\n                }\n            };\n\n            $rootScope.$on('$locationChangeSuccess', emit);\n\n            var factory = {};\n\n            factory.error = function () {\n                [].unshift.call(arguments, \"error\");\n                process.apply(this, arguments);\n            };\n            factory.success = function () {\n                [].unshift.call(arguments, \"success\");\n                process.apply(this, arguments);\n            };\n\n            factory.warning = function () {\n                [].unshift.call(arguments, \"warning\");\n                process.apply(this, arguments);\n            };\n\n            factory.getMessage = function () {\n                return messages[0];\n            };\n\n            function process() {\n                var length = arguments.length;\n                if (length < 3) {\n                    throw new Error(\"Minimum arguments for Flash is 2 (Title and Body)\");\n                }\n\n                var obj = {\n                    type: arguments[0],\n                    title: arguments[1]\n                };\n                if (length < 4) {\n                    obj.message = arguments[2];\n                } else {\n                    obj.messages = [];\n                    for (var i = 0; i < length - 2; i++) {\n                        obj.messages.push(arguments[2 + i]);\n                    }\n                }\n                emit(messages = [obj]);\n            }\n\n            return factory;\n        }])\n\n        .directive('flashMessage', function () {\n            return {\n                restrict: 'E',\n                template: '<div ng-if=\"type==\\'error\\'\" class=\"alert alert-danger\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>' +\n\n                '<div ng-if=\"type==\\'success\\'\" class=\"alert alert-success\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>' +\n\n                '<div ng-if=\"type==\\'warning\\'\" class=\"alert alert-warning\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>',\n                controller: ['$scope', '$rootScope', 'flash', function ($scope, $rootScope, flash) {\n                    $rootScope.$on('flashMessage', function (event, data, done) {\n                        processData(data);\n                        done();\n                    });\n                    $scope.getMessage = function () {\n\n                        processData(flash.getMessage());\n                    };\n                    $scope.getMessage();\n\n                    function processData(data) {\n                        if (data) {\n                            $scope.type = data.type;\n                            $scope.title = data.title;\n                            $scope.messages = data.messages;\n                            $scope.message = data.message;\n                            //done();\n                        } else {\n                            $scope.type = undefined;\n                            $scope.title = undefined;\n                            $scope.messages = undefined;\n                            $scope.message = undefined;\n                        }\n                    }\n                }]\n            };\n        });\n})();\n\n/**!\n * AngularJS file upload/drop directive and service with progress and abort\n * FileAPI Flash shim for old browsers not supporting FormData\n * @author  Danial  <danial.farid@gmail.com>\n * @version 5.0.9\n */\n\n(function () {\n  /** @namespace FileAPI.noContentTimeout */\n\n  function patchXHR(fnName, newFn) {\n    window.XMLHttpRequest.prototype[fnName] = newFn(window.XMLHttpRequest.prototype[fnName]);\n  }\n\n  function redefineProp(xhr, prop, fn) {\n    try {\n      Object.defineProperty(xhr, prop, {get: fn});\n    } catch (e) {/*ignore*/\n    }\n  }\n\n  if (!window.FileAPI) {\n    window.FileAPI = {};\n  }\n\n  FileAPI.shouldLoad = (window.XMLHttpRequest && !window.FormData) || FileAPI.forceLoad;\n  if (FileAPI.shouldLoad) {\n    var initializeUploadListener = function (xhr) {\n      if (!xhr.__listeners) {\n        if (!xhr.upload) xhr.upload = {};\n        xhr.__listeners = [];\n        var origAddEventListener = xhr.upload.addEventListener;\n        xhr.upload.addEventListener = function (t, fn) {\n          xhr.__listeners[t] = fn;\n          if (origAddEventListener) origAddEventListener.apply(this, arguments);\n        };\n      }\n    };\n\n    patchXHR('open', function (orig) {\n      return function (m, url, b) {\n        initializeUploadListener(this);\n        this.__url = url;\n        try {\n          orig.apply(this, [m, url, b]);\n        } catch (e) {\n          if (e.message.indexOf('Access is denied') > -1) {\n            this.__origError = e;\n            orig.apply(this, [m, '_fix_for_ie_crossdomain__', b]);\n          }\n        }\n      };\n    });\n\n    patchXHR('getResponseHeader', function (orig) {\n      return function (h) {\n        return this.__fileApiXHR && this.__fileApiXHR.getResponseHeader ? this.__fileApiXHR.getResponseHeader(h) : (orig == null ? null : orig.apply(this, [h]));\n      };\n    });\n\n    patchXHR('getAllResponseHeaders', function (orig) {\n      return function () {\n        return this.__fileApiXHR && this.__fileApiXHR.getAllResponseHeaders ? this.__fileApiXHR.getAllResponseHeaders() : (orig == null ? null : orig.apply(this));\n      };\n    });\n\n    patchXHR('abort', function (orig) {\n      return function () {\n        return this.__fileApiXHR && this.__fileApiXHR.abort ? this.__fileApiXHR.abort() : (orig == null ? null : orig.apply(this));\n      };\n    });\n\n    patchXHR('setRequestHeader', function (orig) {\n      return function (header, value) {\n        if (header === '__setXHR_') {\n          initializeUploadListener(this);\n          var val = value(this);\n          // fix for angular < 1.2.0\n          if (val instanceof Function) {\n            val(this);\n          }\n        } else {\n          this.__requestHeaders = this.__requestHeaders || {};\n          this.__requestHeaders[header] = value;\n          orig.apply(this, arguments);\n        }\n      };\n    });\n\n    patchXHR('send', function (orig) {\n      return function () {\n        var xhr = this;\n        if (arguments[0] && arguments[0].__isFileAPIShim) {\n          var formData = arguments[0];\n          var config = {\n            url: xhr.__url,\n            jsonp: false, //removes the callback form param\n            cache: true, //removes the ?fileapiXXX in the url\n            complete: function (err, fileApiXHR) {\n              xhr.__completed = true;\n              if (!err && xhr.__listeners.load)\n                xhr.__listeners.load({\n                  type: 'load',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (!err && xhr.__listeners.loadend)\n                xhr.__listeners.loadend({\n                  type: 'loadend',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (err === 'abort' && xhr.__listeners.abort)\n                xhr.__listeners.abort({\n                  type: 'abort',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (fileApiXHR.status !== undefined) redefineProp(xhr, 'status', function () {\n                return (fileApiXHR.status === 0 && err && err !== 'abort') ? 500 : fileApiXHR.status;\n              });\n              if (fileApiXHR.statusText !== undefined) redefineProp(xhr, 'statusText', function () {\n                return fileApiXHR.statusText;\n              });\n              redefineProp(xhr, 'readyState', function () {\n                return 4;\n              });\n              if (fileApiXHR.response !== undefined) redefineProp(xhr, 'response', function () {\n                return fileApiXHR.response;\n              });\n              var resp = fileApiXHR.responseText || (err && fileApiXHR.status === 0 && err !== 'abort' ? err : undefined);\n              redefineProp(xhr, 'responseText', function () {\n                return resp;\n              });\n              redefineProp(xhr, 'response', function () {\n                return resp;\n              });\n              if (err) redefineProp(xhr, 'err', function () {\n                return err;\n              });\n              xhr.__fileApiXHR = fileApiXHR;\n              if (xhr.onreadystatechange) xhr.onreadystatechange();\n              if (xhr.onload) xhr.onload();\n            },\n            progress: function (e) {\n              e.target = xhr;\n              if (xhr.__listeners.progress) xhr.__listeners.progress(e);\n              xhr.__total = e.total;\n              xhr.__loaded = e.loaded;\n              if (e.total === e.loaded) {\n                // fix flash issue that doesn't call complete if there is no response text from the server\n                var _this = this;\n                setTimeout(function () {\n                  if (!xhr.__completed) {\n                    xhr.getAllResponseHeaders = function () {\n                    };\n                    _this.complete(null, {status: 204, statusText: 'No Content'});\n                  }\n                }, FileAPI.noContentTimeout || 10000);\n              }\n            },\n            headers: xhr.__requestHeaders\n          };\n          config.data = {};\n          config.files = {};\n          for (var i = 0; i < formData.data.length; i++) {\n            var item = formData.data[i];\n            if (item.val != null && item.val.name != null && item.val.size != null && item.val.type != null) {\n              config.files[item.key] = item.val;\n            } else {\n              config.data[item.key] = item.val;\n            }\n          }\n\n          setTimeout(function () {\n            if (!FileAPI.hasFlash) {\n              throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n            }\n            xhr.__fileApiXHR = FileAPI.upload(config);\n          }, 1);\n        } else {\n          if (this.__origError) {\n            throw this.__origError;\n          }\n          orig.apply(xhr, arguments);\n        }\n      };\n    });\n    window.XMLHttpRequest.__isFileAPIShim = true;\n    window.FormData = FormData = function () {\n      return {\n        append: function (key, val, name) {\n          if (val.__isFileAPIBlobShim) {\n            val = val.data[0];\n          }\n          this.data.push({\n            key: key,\n            val: val,\n            name: name\n          });\n        },\n        data: [],\n        __isFileAPIShim: true\n      };\n    };\n\n    window.Blob = Blob = function (b) {\n      return {\n        data: b,\n        __isFileAPIBlobShim: true\n      };\n    };\n  }\n\n})();\n\n(function () {\n  /** @namespace FileAPI.forceLoad */\n  /** @namespace window.FileAPI.jsUrl */\n  /** @namespace window.FileAPI.jsPath */\n\n  function isInputTypeFile(elem) {\n    return elem[0].tagName.toLowerCase() === 'input' && elem.attr('type') && elem.attr('type').toLowerCase() === 'file';\n  }\n\n  function hasFlash() {\n    try {\n      var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n      if (fo) return true;\n    } catch (e) {\n      if (navigator.mimeTypes['application/x-shockwave-flash'] !== undefined) return true;\n    }\n    return false;\n  }\n\n  function getOffset(obj) {\n    var left = 0, top = 0;\n\n    if (window.jQuery) {\n      return jQuery(obj).offset();\n    }\n\n    if (obj.offsetParent) {\n      do {\n        left += (obj.offsetLeft - obj.scrollLeft);\n        top += (obj.offsetTop - obj.scrollTop);\n        obj = obj.offsetParent;\n      } while (obj);\n    }\n    return {\n      left: left,\n      top: top\n    };\n  }\n\n  if (FileAPI.shouldLoad) {\n\n    //load FileAPI\n    if (FileAPI.forceLoad) {\n      FileAPI.html5 = false;\n    }\n\n    if (!FileAPI.upload) {\n      var jsUrl, basePath, script = document.createElement('script'), allScripts = document.getElementsByTagName('script'), i, index, src;\n      if (window.FileAPI.jsUrl) {\n        jsUrl = window.FileAPI.jsUrl;\n      } else if (window.FileAPI.jsPath) {\n        basePath = window.FileAPI.jsPath;\n      } else {\n        for (i = 0; i < allScripts.length; i++) {\n          src = allScripts[i].src;\n          index = src.search(/\\/ng\\-file\\-upload[\\-a-zA-z0-9\\.]*\\.js/);\n          if (index > -1) {\n            basePath = src.substring(0, index + 1);\n            break;\n          }\n        }\n      }\n\n      if (FileAPI.staticPath == null) FileAPI.staticPath = basePath;\n      script.setAttribute('src', jsUrl || basePath + 'FileAPI.min.js');\n      document.getElementsByTagName('head')[0].appendChild(script);\n\n      FileAPI.hasFlash = hasFlash();\n    }\n\n    FileAPI.ngfFixIE = function (elem, createFileElemFn, bindAttr, changeFn) {\n      if (!hasFlash()) {\n        throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n      }\n      var makeFlashInput = function () {\n        if (elem.attr('disabled')) {\n          elem.$$ngfRefElem.removeClass('js-fileapi-wrapper');\n        } else {\n          var fileElem = elem.$$ngfRefElem;\n          if (!fileElem) {\n            fileElem = elem.$$ngfRefElem = createFileElemFn();\n            fileElem.addClass('js-fileapi-wrapper');\n            if (!isInputTypeFile(elem)) {\n//\t\t\t\t\t\tif (fileElem.parent().css('position') === '' || fileElem.parent().css('position') === 'static') {\n//\t\t\t\t\t\t\tfileElem.parent().css('position', 'relative');\n//\t\t\t\t\t\t}\n//\t\t\t\t\t\telem.parent()[0].insertBefore(fileElem[0], elem[0]);\n//\t\t\t\t\t\telem.css('overflow', 'hidden');\n            }\n            setTimeout(function () {\n              fileElem.bind('mouseenter', makeFlashInput);\n            }, 10);\n            fileElem.bind('change', function (evt) {\n              fileApiChangeFn.apply(this, [evt]);\n              changeFn.apply(this, [evt]);\n//\t\t\t\t\t\talert('change' +  evt);\n            });\n          } else {\n            bindAttr(elem.$$ngfRefElem);\n          }\n          if (!isInputTypeFile(elem)) {\n            fileElem.css('position', 'absolute')\n              .css('top', getOffset(elem[0]).top + 'px').css('left', getOffset(elem[0]).left + 'px')\n              .css('width', elem[0].offsetWidth + 'px').css('height', elem[0].offsetHeight + 'px')\n              .css('filter', 'alpha(opacity=0)').css('display', elem.css('display'))\n              .css('overflow', 'hidden').css('z-index', '900000')\n              .css('visibility', 'visible');\n          }\n        }\n      };\n\n      elem.bind('mouseenter', makeFlashInput);\n\n      var fileApiChangeFn = function (evt) {\n        var files = FileAPI.getFiles(evt);\n        //just a double check for #233\n        for (var i = 0; i < files.length; i++) {\n          if (files[i].size === undefined) files[i].size = 0;\n          if (files[i].name === undefined) files[i].name = 'file';\n          if (files[i].type === undefined) files[i].type = 'undefined';\n        }\n        if (!evt.target) {\n          evt.target = {};\n        }\n        evt.target.files = files;\n        // if evt.target.files is not writable use helper field\n        if (evt.target.files !== files) {\n          evt.__files_ = files;\n        }\n        (evt.__files_ || evt.target.files).item = function (i) {\n          return (evt.__files_ || evt.target.files)[i] || null;\n        };\n      };\n    };\n\n    FileAPI.disableFileInput = function (elem, disable) {\n      if (disable) {\n        elem.removeClass('js-fileapi-wrapper');\n      } else {\n        elem.addClass('js-fileapi-wrapper');\n      }\n    };\n  }\n})();\n\nif (!window.FileReader) {\n  window.FileReader = function () {\n    var _this = this, loadStarted = false;\n    this.listeners = {};\n    this.addEventListener = function (type, fn) {\n      _this.listeners[type] = _this.listeners[type] || [];\n      _this.listeners[type].push(fn);\n    };\n    this.removeEventListener = function (type, fn) {\n      if (_this.listeners[type]) _this.listeners[type].splice(_this.listeners[type].indexOf(fn), 1);\n    };\n    this.dispatchEvent = function (evt) {\n      var list = _this.listeners[evt.type];\n      if (list) {\n        for (var i = 0; i < list.length; i++) {\n          list[i].call(_this, evt);\n        }\n      }\n    };\n    this.onabort = this.onerror = this.onload = this.onloadstart = this.onloadend = this.onprogress = null;\n\n    var constructEvent = function (type, evt) {\n      var e = {type: type, target: _this, loaded: evt.loaded, total: evt.total, error: evt.error};\n      if (evt.result != null) e.target.result = evt.result;\n      return e;\n    };\n    var listener = function (evt) {\n      if (!loadStarted) {\n        loadStarted = true;\n        if (_this.onloadstart) _this.onloadstart(constructEvent('loadstart', evt));\n      }\n      var e;\n      if (evt.type === 'load') {\n        if (_this.onloadend) _this.onloadend(constructEvent('loadend', evt));\n        e = constructEvent('load', evt);\n        if (_this.onload) _this.onload(e);\n        _this.dispatchEvent(e);\n      } else if (evt.type === 'progress') {\n        e = constructEvent('progress', evt);\n        if (_this.onprogress) _this.onprogress(e);\n        _this.dispatchEvent(e);\n      } else {\n        e = constructEvent('error', evt);\n        if (_this.onerror) _this.onerror(e);\n        _this.dispatchEvent(e);\n      }\n    };\n    this.readAsArrayBuffer = function (file) {\n      FileAPI.readAsBinaryString(file, listener);\n    };\n    this.readAsBinaryString = function (file) {\n      FileAPI.readAsBinaryString(file, listener);\n    };\n    this.readAsDataURL = function (file) {\n      FileAPI.readAsDataURL(file, listener);\n    };\n    this.readAsText = function (file) {\n      FileAPI.readAsText(file, listener);\n    };\n  };\n}\n\n/**!\n * AngularJS file upload/drop directive and service with progress and abort\n * @author  Danial  <danial.farid@gmail.com>\n * @version 5.0.9\n */\n\nif (window.XMLHttpRequest && !(window.FileAPI && FileAPI.shouldLoad)) {\n  window.XMLHttpRequest.prototype.setRequestHeader = (function (orig) {\n    return function (header, value) {\n      if (header === '__setXHR_') {\n        var val = value(this);\n        // fix for angular < 1.2.0\n        if (val instanceof Function) {\n          val(this);\n        }\n      } else {\n        orig.apply(this, arguments);\n      }\n    };\n  })(window.XMLHttpRequest.prototype.setRequestHeader);\n}\n\nvar ngFileUpload = angular.module('ngFileUpload', []);\n\nngFileUpload.version = '5.0.9';\nngFileUpload.service('Upload', ['$http', '$q', '$timeout', function ($http, $q, $timeout) {\n  function sendHttp(config) {\n    config.method = config.method || 'POST';\n    config.headers = config.headers || {};\n\n    var deferred = $q.defer();\n    var promise = deferred.promise;\n\n    config.headers.__setXHR_ = function () {\n      return function (xhr) {\n        if (!xhr) return;\n        config.__XHR = xhr;\n        if (config.xhrFn) config.xhrFn(xhr);\n        xhr.upload.addEventListener('progress', function (e) {\n          e.config = config;\n          if (deferred.notify) {\n            deferred.notify(e);\n          } else if (promise.progressFunc) {\n            $timeout(function () {\n              promise.progressFunc(e);\n            });\n          }\n        }, false);\n        //fix for firefox not firing upload progress end, also IE8-9\n        xhr.upload.addEventListener('load', function (e) {\n          if (e.lengthComputable) {\n            e.config = config;\n            if (deferred.notify) {\n              deferred.notify(e);\n            } else if (promise.progressFunc) {\n              $timeout(function () {\n                promise.progressFunc(e);\n              });\n            }\n          }\n        }, false);\n      };\n    };\n\n    $http(config).then(function (r) {\n      deferred.resolve(r);\n    }, function (e) {\n      deferred.reject(e);\n    }, function (n) {\n      deferred.notify(n);\n    });\n\n    promise.success = function (fn) {\n      promise.then(function (response) {\n        fn(response.data, response.status, response.headers, config);\n      });\n      return promise;\n    };\n\n    promise.error = function (fn) {\n      promise.then(null, function (response) {\n        fn(response.data, response.status, response.headers, config);\n      });\n      return promise;\n    };\n\n    promise.progress = function (fn) {\n      promise.progressFunc = fn;\n      promise.then(null, null, function (update) {\n        fn(update);\n      });\n      return promise;\n    };\n    promise.abort = function () {\n      if (config.__XHR) {\n        $timeout(function () {\n          config.__XHR.abort();\n        });\n      }\n      return promise;\n    };\n    promise.xhr = function (fn) {\n      config.xhrFn = (function (origXhrFn) {\n        return function () {\n          if (origXhrFn) origXhrFn.apply(promise, arguments);\n          fn.apply(promise, arguments);\n        };\n      })(config.xhrFn);\n      return promise;\n    };\n\n    return promise;\n  }\n\n  this.upload = function (config) {\n    function addFieldToFormData(formData, val, key) {\n      if (val !== undefined) {\n        if (angular.isDate(val)) {\n          val = val.toISOString();\n        }\n        if (angular.isString(val)) {\n          formData.append(key, val);\n        } else if (config.sendFieldsAs === 'form') {\n          if (angular.isObject(val)) {\n            for (var k in val) {\n              if (val.hasOwnProperty(k)) {\n                addFieldToFormData(formData, val[k], key + '[' + k + ']');\n              }\n            }\n          } else {\n            formData.append(key, val);\n          }\n        } else {\n          val = angular.isString(val) ? val : JSON.stringify(val);\n          if (config.sendFieldsAs === 'json-blob') {\n            formData.append(key, new Blob([val], {type: 'application/json'}));\n          } else {\n            formData.append(key, val);\n          }\n        }\n      }\n    }\n\n    config.headers = config.headers || {};\n    config.headers['Content-Type'] = undefined;\n    config.transformRequest = config.transformRequest ?\n      (angular.isArray(config.transformRequest) ?\n        config.transformRequest : [config.transformRequest]) : [];\n    config.transformRequest.push(function (data) {\n      var formData = new FormData();\n      var allFields = {};\n      var key;\n      for (key in config.fields) {\n        if (config.fields.hasOwnProperty(key)) {\n          allFields[key] = config.fields[key];\n        }\n      }\n      if (data) allFields.data = data;\n      for (key in allFields) {\n        if (allFields.hasOwnProperty(key)) {\n          var val = allFields[key];\n          if (config.formDataAppender) {\n            config.formDataAppender(formData, key, val);\n          } else {\n            addFieldToFormData(formData, val, key);\n          }\n        }\n      }\n\n      if (config.file != null) {\n        var fileFormName = config.fileFormDataName || 'file';\n\n        if (angular.isArray(config.file)) {\n          var isFileFormNameString = angular.isString(fileFormName);\n          for (var i = 0; i < config.file.length; i++) {\n            formData.append(isFileFormNameString ? fileFormName : fileFormName[i], config.file[i],\n              (config.fileName && config.fileName[i]) || config.file[i].name);\n          }\n        } else {\n          formData.append(fileFormName, config.file, config.fileName || config.file.name);\n        }\n      }\n      return formData;\n    });\n\n    return sendHttp(config);\n  };\n\n  this.http = function (config) {\n    config.transformRequest = config.transformRequest || function (data) {\n        if ((window.ArrayBuffer && data instanceof window.ArrayBuffer) || data instanceof Blob) {\n          return data;\n        }\n        return $http.defaults.transformRequest[0](arguments);\n      };\n    return sendHttp(config);\n  };\n}\n\n]);\n\n(function () {\n    ngFileUpload.directive('ngfSelect', ['$parse', '$timeout', '$compile', function ($parse, $timeout, $compile) {\n            return {\n                restrict: 'AEC',\n                require: '?ngModel',\n                link: function (scope, elem, attr, ngModel) {\n                    linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile);\n                }\n            };\n        }]);\n\n    function linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile) {\n        /** @namespace attr.ngfSelect */\n        /** @namespace attr.ngfChange */\n        /** @namespace attr.ngModel */\n        /** @namespace attr.ngModelRejected */\n        /** @namespace attr.ngfMultiple */\n        /** @namespace attr.ngfCapture */\n        /** @namespace attr.ngfAccept */\n        /** @namespace attr.ngfMaxSize */\n        /** @namespace attr.ngfMinSize */\n        /** @namespace attr.ngfResetOnClick */\n        /** @namespace attr.ngfResetModelOnClick */\n        /** @namespace attr.ngfKeep */\n        /** @namespace attr.ngfKeepDistinct */\n\n        if (elem.attr('__ngf_gen__')) {\n            return;\n        }\n\n        scope.$on('$destroy', function () {\n            if (elem.$$ngfRefElem) elem.$$ngfRefElem.remove();\n        });\n\n        var disabled = false;\n        if (attr.ngfSelect.search(/\\W+$files\\W+/) === -1) {\n            scope.$watch(attr.ngfSelect, function (val) {\n                disabled = val === false;\n            });\n        }\n        function isInputTypeFile() {\n            return elem[0].tagName.toLowerCase() === 'input' && attr.type && attr.type.toLowerCase() === 'file';\n        }\n\n        var isUpdating = false;\n\n        function changeFn(evt) {\n            if (!isUpdating) {\n                isUpdating = true;\n                try {\n                    var fileList = evt.__files_ || (evt.target && evt.target.files);\n                    var files = [], rejFiles = [];\n\n                    for (var i = 0; i < fileList.length; i++) {\n                        var file = fileList.item(i);\n                        if (validate(scope, $parse, attr, file, evt)) {\n                            files.push(file);\n                        } else {\n                            rejFiles.push(file);\n                        }\n                    }\n                    updateModel($parse, $timeout, scope, ngModel, attr, attr.ngfChange || attr.ngfSelect, files, rejFiles, evt);\n                    if (files.length === 0) evt.target.value = files;\n//                if (evt.target && evt.target.getAttribute('__ngf_gen__')) {\n//                    angular.element(evt.target).remove();\n//                }\n                } finally {\n                    isUpdating = false;\n                }\n            }\n        }\n\n        function bindAttrToFileInput(fileElem) {\n            if (attr.ngfMultiple) fileElem.attr('multiple', $parse(attr.ngfMultiple)(scope));\n            if (attr.ngfCapture) fileElem.attr('capture', $parse(attr.ngfCapture)(scope));\n            if (attr.accept) fileElem.attr('accept', attr.accept);\n            for (var i = 0; i < elem[0].attributes.length; i++) {\n                var attribute = elem[0].attributes[i];\n                if ((isInputTypeFile() && attribute.name !== 'type') ||\n                    (attribute.name !== 'type' && attribute.name !== 'class' &&\n                    attribute.name !== 'id' && attribute.name !== 'style')) {\n                    fileElem.attr(attribute.name, attribute.value);\n                }\n            }\n        }\n\n        function createFileInput(evt, resetOnClick) {\n            if (!resetOnClick && (evt || isInputTypeFile())) return elem.$$ngfRefElem || elem;\n\n            var fileElem = angular.element('<input type=\"file\">');\n            bindAttrToFileInput(fileElem);\n\n            if (isInputTypeFile()) {\n                elem.replaceWith(fileElem);\n                elem = fileElem;\n                fileElem.attr('__ngf_gen__', true);\n                $compile(elem)(scope);\n            } else {\n                fileElem.css('visibility', 'hidden').css('position', 'absolute').css('overflow', 'hidden')\n                    .css('width', '0px').css('height', '0px').css('z-index', '-100000').css('border', 'none')\n                    .css('margin', '0px').css('padding', '0px').attr('tabindex', '-1');\n                if (elem.$$ngfRefElem) {\n                    elem.$$ngfRefElem.remove();\n                }\n                elem.$$ngfRefElem = fileElem;\n                document.body.appendChild(fileElem[0]);\n            }\n\n            return fileElem;\n        }\n\n        function resetModel(evt) {\n            updateModel($parse, $timeout, scope, ngModel, attr, attr.ngfChange || attr.ngfSelect, [], [], evt, true);\n        }\n\n        function clickHandler(evt) {\n            if (elem.attr('disabled') || disabled) return false;\n            if (evt != null) {\n                evt.preventDefault();\n                evt.stopPropagation();\n            }\n            var resetOnClick = $parse(attr.ngfResetOnClick)(scope) !== false;\n            var fileElem = createFileInput(evt, resetOnClick);\n\n            function clickAndAssign(evt) {\n                if (evt) {\n                    fileElem[0].click();\n                }\n                /*if (isInputTypeFile() || !evt) {\n                    elem.bind('click touchend', clickHandler);\n                }*/\n            }\n\n            if (fileElem) {\n                if (!evt || resetOnClick) fileElem.bind('change', changeFn);\n                if (evt && resetOnClick && $parse(attr.ngfResetModelOnClick)(scope) !== false) resetModel(evt);\n\n                // fix for android native browser < 4.4\n                if (shouldClickLater(navigator.userAgent)) {\n                    setTimeout(function () {\n                        clickAndAssign(evt);\n                    }, 0);\n                } else {\n                    clickAndAssign(evt);\n                }\n            }\n            return false;\n        }\n\n        if (window.FileAPI && window.FileAPI.ngfFixIE) {\n            window.FileAPI.ngfFixIE(elem, createFileInput, bindAttrToFileInput, changeFn);\n        } else {\n            clickHandler();\n            //if (!isInputTypeFile()) {\n            //  elem.bind('click touchend', clickHandler);\n            //}\n        }\n    }\n\n    function shouldClickLater(ua) {\n        // android below 4.4\n        var m = ua.match(/Android[^\\d]*(\\d+)\\.(\\d+)/);\n        if (m && m.length > 2) {\n            return parseInt(m[1]) < 4 || (parseInt(m[1]) === 4 && parseInt(m[2]) < 4);\n        }\n\n        // safari on windows\n        return /.*Windows.*Safari.*/.test(ua);\n    }\n\n    ngFileUpload.validate = function (scope, $parse, attr, file, evt) {\n        function globStringToRegex(str) {\n            if (str.length > 2 && str[0] === '/' && str[str.length - 1] === '/') {\n                return str.substring(1, str.length - 1);\n            }\n            var split = str.split(','), result = '';\n            if (split.length > 1) {\n                for (var i = 0; i < split.length; i++) {\n                    result += '(' + globStringToRegex(split[i]) + ')';\n                    if (i < split.length - 1) {\n                        result += '|';\n                    }\n                }\n            } else {\n                if (str.indexOf('.') === 0) {\n                    str = '*' + str;\n                }\n                result = '^' + str.replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\' + '-]', 'g'), '\\\\$&') + '$';\n                result = result.replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n            }\n            return result;\n        }\n\n        var accept = $parse(attr.ngfAccept)(scope, {$file: file, $event: evt});\n        var fileSizeMax = $parse(attr.ngfMaxSize)(scope, {$file: file, $event: evt}) || 9007199254740991;\n        var fileSizeMin = $parse(attr.ngfMinSize)(scope, {$file: file, $event: evt}) || -1;\n        if (accept != null && angular.isString(accept)) {\n            var regexp = new RegExp(globStringToRegex(accept), 'gi');\n            accept = (file.type != null && regexp.test(file.type.toLowerCase())) ||\n                (file.name != null && regexp.test(file.name.toLowerCase()));\n        }\n        return (accept == null || accept) && (file.size == null || (file.size < fileSizeMax && file.size > fileSizeMin));\n    };\n\n    ngFileUpload.updateModel = function ($parse, $timeout, scope, ngModel, attr, fileChange,\n                                         files, rejFiles, evt, noDelay) {\n        function update() {\n            if ($parse(attr.ngfKeep)(scope) === true) {\n                var prevFiles = (ngModel.$modelValue || []).slice(0);\n                if (!files || !files.length) {\n                    files = prevFiles;\n                } else if ($parse(attr.ngfKeepDistinct)(scope) === true) {\n                    var len = prevFiles.length;\n                    for (var i = 0; i < files.length; i++) {\n                        for (var j = 0; j < len; j++) {\n                            if (files[i].name === prevFiles[j].name) break;\n                        }\n                        if (j === len) {\n                            prevFiles.push(files[i]);\n                        }\n                    }\n                    files = prevFiles;\n                } else {\n                    files = prevFiles.concat(files);\n                }\n            }\n            if (ngModel) {\n                $parse(attr.ngModel).assign(scope, files);\n                $timeout(function () {\n                    if (ngModel) {\n                        ngModel.$setViewValue(files != null && files.length === 0 ? null : files);\n                    }\n                });\n            }\n            if (attr.ngModelRejected) {\n                $parse(attr.ngModelRejected).assign(scope, rejFiles);\n            }\n            if (fileChange) {\n                $parse(fileChange)(scope, {\n                    $files: files,\n                    $rejectedFiles: rejFiles,\n                    $event: evt\n                });\n            }\n        }\n\n        if (noDelay) {\n            update();\n        } else {\n            $timeout(function () {\n                update();\n            });\n        }\n    };\n\n    var validate = ngFileUpload.validate;\n    var updateModel = ngFileUpload.updateModel;\n\n})();\n\n(function () {\n  var validate = ngFileUpload.validate;\n  var updateModel = ngFileUpload.updateModel;\n\n  ngFileUpload.directive('ngfDrop', ['$parse', '$timeout', '$location', function ($parse, $timeout, $location) {\n    return {\n      restrict: 'AEC',\n      require: '?ngModel',\n      link: function (scope, elem, attr, ngModel) {\n        linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location);\n      }\n    };\n  }]);\n\n  ngFileUpload.directive('ngfNoFileDrop', function () {\n    return function (scope, elem) {\n      if (dropAvailable()) elem.css('display', 'none');\n    };\n  });\n\n  ngFileUpload.directive('ngfDropAvailable', ['$parse', '$timeout', function ($parse, $timeout) {\n    return function (scope, elem, attr) {\n      if (dropAvailable()) {\n        var fn = $parse(attr.ngfDropAvailable);\n        $timeout(function () {\n          fn(scope);\n          if (fn.assign) {\n            fn.assign(scope, true);\n          }\n        });\n      }\n    };\n  }]);\n\n  function linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location) {\n    var available = dropAvailable();\n    if (attr.dropAvailable) {\n      $timeout(function () {\n        if (scope[attr.dropAvailable]) {\n          scope[attr.dropAvailable].value = available;\n        } else {\n          scope[attr.dropAvailable] = available;\n        }\n      });\n    }\n    if (!available) {\n      if ($parse(attr.ngfHideOnDropNotAvailable)(scope) === true) {\n        elem.css('display', 'none');\n      }\n      return;\n    }\n\n    var disabled = false;\n    if (attr.ngfDrop.search(/\\W+$files\\W+/) === -1) {\n      scope.$watch(attr.ngfDrop, function(val) {\n        disabled = val === false;\n      });\n    }\n\n    var leaveTimeout = null;\n    var stopPropagation = $parse(attr.ngfStopPropagation);\n    var dragOverDelay = 1;\n    var actualDragOverClass;\n\n    elem[0].addEventListener('dragover', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      // handling dragover events from the Chrome download bar\n      if (navigator.userAgent.indexOf('Chrome') > -1) {\n        var b = evt.dataTransfer.effectAllowed;\n        evt.dataTransfer.dropEffect = ('move' === b || 'linkMove' === b) ? 'move' : 'copy';\n      }\n      $timeout.cancel(leaveTimeout);\n      if (!scope.actualDragOverClass) {\n        actualDragOverClass = calculateDragOverClass(scope, attr, evt);\n      }\n      elem.addClass(actualDragOverClass);\n    }, false);\n    elem[0].addEventListener('dragenter', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n    }, false);\n    elem[0].addEventListener('dragleave', function () {\n      if (elem.attr('disabled') || disabled) return;\n      leaveTimeout = $timeout(function () {\n        elem.removeClass(actualDragOverClass);\n        actualDragOverClass = null;\n      }, dragOverDelay || 1);\n    }, false);\n    elem[0].addEventListener('drop', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      elem.removeClass(actualDragOverClass);\n      actualDragOverClass = null;\n      extractFiles(evt, function (files, rejFiles) {\n        updateModel($parse, $timeout, scope, ngModel, attr,\n          attr.ngfChange || attr.ngfDrop, files, rejFiles, evt);\n      }, $parse(attr.ngfAllowDir)(scope) !== false, attr.multiple || $parse(attr.ngfMultiple)(scope));\n    }, false);\n\n    function calculateDragOverClass(scope, attr, evt) {\n      var accepted = true;\n      var items = evt.dataTransfer.items;\n      if (items != null) {\n        for (var i = 0; i < items.length && accepted; i++) {\n          accepted = accepted &&\n            (items[i].kind === 'file' || items[i].kind === '') &&\n            validate(scope, $parse, attr, items[i], evt);\n        }\n      }\n      var clazz = $parse(attr.ngfDragOverClass)(scope, {$event: evt});\n      if (clazz) {\n        if (clazz.delay) dragOverDelay = clazz.delay;\n        if (clazz.accept) clazz = accepted ? clazz.accept : clazz.reject;\n      }\n      return clazz || attr.ngfDragOverClass || 'dragover';\n    }\n\n    function extractFiles(evt, callback, allowDir, multiple) {\n      var files = [], rejFiles = [], items = evt.dataTransfer.items, processing = 0;\n\n      function addFile(file) {\n        if (validate(scope, $parse, attr, file, evt)) {\n          files.push(file);\n        } else {\n          rejFiles.push(file);\n        }\n      }\n\n      function traverseFileTree(files, entry, path) {\n        if (entry != null) {\n          if (entry.isDirectory) {\n            var filePath = (path || '') + entry.name;\n            addFile({name: entry.name, type: 'directory', path: filePath});\n            var dirReader = entry.createReader();\n            var entries = [];\n            processing++;\n            var readEntries = function () {\n              dirReader.readEntries(function (results) {\n                try {\n                  if (!results.length) {\n                    for (var i = 0; i < entries.length; i++) {\n                      traverseFileTree(files, entries[i], (path ? path : '') + entry.name + '/');\n                    }\n                    processing--;\n                  } else {\n                    entries = entries.concat(Array.prototype.slice.call(results || [], 0));\n                    readEntries();\n                  }\n                } catch (e) {\n                  processing--;\n                  console.error(e);\n                }\n              }, function () {\n                processing--;\n              });\n            };\n            readEntries();\n          } else {\n            processing++;\n            entry.file(function (file) {\n              try {\n                processing--;\n                file.path = (path ? path : '') + file.name;\n                addFile(file);\n              } catch (e) {\n                processing--;\n                console.error(e);\n              }\n            }, function () {\n              processing--;\n            });\n          }\n        }\n      }\n\n      if (items && items.length > 0 && $location.protocol() !== 'file') {\n        for (var i = 0; i < items.length; i++) {\n          if (items[i].webkitGetAsEntry && items[i].webkitGetAsEntry() && items[i].webkitGetAsEntry().isDirectory) {\n            var entry = items[i].webkitGetAsEntry();\n            if (entry.isDirectory && !allowDir) {\n              continue;\n            }\n            if (entry != null) {\n              traverseFileTree(files, entry);\n            }\n          } else {\n            var f = items[i].getAsFile();\n            if (f != null) addFile(f);\n          }\n          if (!multiple && files.length > 0) break;\n        }\n      } else {\n        var fileList = evt.dataTransfer.files;\n        if (fileList != null) {\n          for (var j = 0; j < fileList.length; j++) {\n            addFile(fileList.item(j));\n            if (!multiple && files.length > 0) {\n              break;\n            }\n          }\n        }\n      }\n      var delays = 0;\n      (function waitForProcess(delay) {\n        $timeout(function () {\n          if (!processing) {\n            if (!multiple && files.length > 1) {\n              i = 0;\n              while (files[i].type === 'directory') i++;\n              files = [files[i]];\n            }\n            callback(files, rejFiles);\n          } else {\n            if (delays++ * 10 < 20 * 1000) {\n              waitForProcess(10);\n            }\n          }\n        }, delay || 0);\n      })();\n    }\n  }\n\n  ngFileUpload.directive('ngfSrc', ['$parse', '$timeout', function ($parse, $timeout) {\n    return {\n      restrict: 'AE',\n      link: function (scope, elem, attr) {\n        if (window.FileReader) {\n          scope.$watch(attr.ngfSrc, function (file) {\n            if (file &&\n              validate(scope, $parse, attr, file, null) &&\n              (!window.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&\n              (!window.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {\n              $timeout(function () {\n                //prefer URL.createObjectURL for handling refrences to files of all sizes\n                //since it doesnt build a large string in memory\n                var URL = window.URL || window.webkitURL;\n                if (URL && URL.createObjectURL) {\n                  elem.attr('src', URL.createObjectURL(file));\n                } else {\n                  var fileReader = new FileReader();\n                  fileReader.readAsDataURL(file);\n                  fileReader.onload = function (e) {\n                    $timeout(function () {\n                      elem.attr('src', e.target.result);\n                    });\n                  };\n                }\n              });\n            } else {\n              elem.attr('src', attr.ngfDefaultSrc || '');\n            }\n          });\n        }\n      }\n    };\n  }]);\n\n  function dropAvailable() {\n    var div = document.createElement('div');\n    return ('draggable' in div) && ('ondrop' in div);\n  }\n\n})();\n"]}